<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>乙未丁酉</title>
  
  <subtitle>模拟工程师</subtitle>
  <link href="http://shenguosai.github.io/atom.xml" rel="self"/>
  
  <link href="http://shenguosai.github.io/"/>
  <updated>2024-03-25T07:30:34.023Z</updated>
  <id>http://shenguosai.github.io/</id>
  
  <author>
    <name>sgs</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CentOS 7 安装docker和docker-compose</title>
    <link href="http://shenguosai.github.io/2024/03/25/CentOS-7-%E5%AE%89%E8%A3%85docker%E5%92%8Cdocker-compose/"/>
    <id>http://shenguosai.github.io/2024/03/25/CentOS-7-%E5%AE%89%E8%A3%85docker%E5%92%8Cdocker-compose/</id>
    <published>2024-03-25T07:06:45.000Z</published>
    <updated>2024-03-25T07:30:34.023Z</updated>
    
    <content type="html"><![CDATA[<h1 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h1><p>更新 <code>yum</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum update<br></code></pre></td></tr></table></figure><br>安装配置时的依赖包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install -y yum-utils device-mapper-persistent-data lvm2<br></code></pre></td></tr></table></figure><br>配置阿里云的<code>yum</code>源<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure><br>查看仓库中所有的docker版本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum list docker-ce --showduplicates | <span class="hljs-built_in">sort</span> -r<br></code></pre></td></tr></table></figure><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240325151136.png" alt="20240325151136"><br>默认使用<code>yum install docker-ce</code>安装最新版的docker，当然也可以指定安装特定的版本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install docker-ce-24.0* -y<br></code></pre></td></tr></table></figure><br>验证是否安装成功<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker --version<br></code></pre></td></tr></table></figure><br>或者<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker -v<br></code></pre></td></tr></table></figure></p><h1 id="安装-Docker-compose"><a href="#安装-Docker-compose" class="headerlink" title="安装 Docker-compose"></a>安装 Docker-compose</h1><p>国外源安装:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -SL https://github.com/docker/compose/releases/download/v2.26.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure><br>国内源安装:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -SL https://get.daocloud.io/docker/compose/releases/download/v2.26.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure><br>赋予可执行权限:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure><br>验证是否安装成功:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker compose version<br></code></pre></td></tr></table></figure></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;安装-Docker&quot;&gt;&lt;a href=&quot;#安装-Docker&quot; class=&quot;headerlink&quot; title=&quot;安装 Docker&quot;&gt;&lt;/a&gt;安装 Docker&lt;/h1&gt;&lt;p&gt;更新 &lt;code&gt;yum&lt;/code&gt;&lt;br&gt;&lt;figure class=&quot;high</summary>
      
    
    
    
    <category term="Tutorial" scheme="http://shenguosai.github.io/categories/Tutorial/"/>
    
    
    <category term="docker" scheme="http://shenguosai.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>使用端口映射实现局域网内打印机远程打印</title>
    <link href="http://shenguosai.github.io/2024/03/12/%E4%BD%BF%E7%94%A8%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E5%AE%9E%E7%8E%B0%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85%E6%89%93%E5%8D%B0%E6%9C%BA%E8%BF%9C%E7%A8%8B%E6%89%93%E5%8D%B0/"/>
    <id>http://shenguosai.github.io/2024/03/12/%E4%BD%BF%E7%94%A8%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E5%AE%9E%E7%8E%B0%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85%E6%89%93%E5%8D%B0%E6%9C%BA%E8%BF%9C%E7%A8%8B%E6%89%93%E5%8D%B0/</id>
    <published>2024-03-12T07:42:56.000Z</published>
    <updated>2024-03-12T15:54:48.400Z</updated>
    
    <content type="html"><![CDATA[<p>打印机是现在办公设备必不可少的工具，我们常常需要使用打印机复印或打印各种文件资料，尤其对一些正在加班且不能在家陪伴孩子写作业的父母来说，学会远程打印的方法十分必要。<br>打印机种类: 激光打印机<br>打印机型号: DCP-B7520DW<br>目前这款打印机不支持远程打印，所以需要将打印端口映射到外网才能实现远程打印。<br>局域网内电脑系统: Windows 10<br>远程打印电脑系统: Windows 11<br><span id="more"></span><br>电脑进行远程打印可以用一下两种方法:</p><ol><li>使用zerotier将主路由加入到虚拟局域网中，这样家中所有设备都可以通过虚拟局域网进行访问，此种方式如能将手机也加入到zerotier的虚拟局域网中亦可以实现手机端的远程打印。</li><li>将打印机数据传输端口通过路由器进行端口映射来实现，此种方法目前还未能实现手机端的远程打印。<br>下面详细讲述第2中方法的实现步骤:<h4 id="一、设置映射"><a href="#一、设置映射" class="headerlink" title="一、设置映射"></a>一、设置映射</h4>首先保证局域网内能正常打印，进入<strong>控制面板</strong>——<strong>设备和打印机</strong>；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312160611.png" alt="20240312160611"><br>找到对应的打印机，右键<strong>打印机属性</strong>；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312160725.png" alt="20240312160725"><br>选择<strong>端口</strong>，找到对应的打印机，点击<strong>配置端口</strong>；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312160925.png" alt="20240312160925"><br>查看打印机的IP地址和端口号；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312161050.png" alt="20240312161050"><br>这个地方有一个问题，我的打印机原来默认是LPR协议，端口应该是515；现在我将它改成的Raw协议，Raw协议默认使用9100，9101，9102端口，这里选择默认的9100端口。<br>然后将你所使用的端口，这里是9100通过路由器的设置映射到外网，我家里使用的是华为的AX3 Pro路由器，设置界面如下，外部端口填写你想设置的端口即可(1~65535):<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312161449.png" alt="20240312161449"><br>点击保存即设置成功。<h4 id="二、远程打印电脑的设置"><a href="#二、远程打印电脑的设置" class="headerlink" title="二、远程打印电脑的设置"></a>二、远程打印电脑的设置</h4>点击<strong>开始</strong>——<strong>设置</strong>——选择<strong>蓝牙和其他设备</strong>——点击<strong>打印机和扫描仪</strong><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312162315.png" alt="20240312162315"><br>点击<strong>打印机和扫描仪</strong>——点击<strong>添加设备</strong><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312162447.png" alt="20240312162447"><br>点击<strong>手动添加</strong>——选择<strong>通过手动设置添加本地打印机或网络打印机</strong>，<strong>下一步</strong>；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312162952.png" alt="20240312162952"><br>选择<strong>创建新端口</strong>，端口类型选择<strong>Standard TCP/IP Port</strong>，下一步；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312163246.png" alt="20240312163246"><br><strong>主机名或IP地址</strong>和<strong>端口名称</strong>，填写自己的公网IP或域名地址。(由于现在供应商提供的公网IP是会变的，所以建议使用DDNS在此处填写自己的DDNS域名。)<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312164131.png" alt="20240312164131"><br>设置类型选择<strong>自定义</strong>，点击<strong>设置</strong>，<strong>原始设置</strong>里的<strong>端口号</strong>填入上面映射到外网的外部端口号，<strong>确定</strong>然后<strong>下一步</strong>；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312165944.png" alt="20240312165944"><br>然后就是安装驱动程序，点击<strong>从磁盘安装</strong>，<strong>制造商文件复制来源</strong>选择对应打印机驱动的安装目录里，这里要求选择<code>.inf</code>文件。<br>我这边驱动目录下的路径是<code>D:\51_Installer\DCP-B7520DW\Y17C_C1_ULWL_PP-inst-H1\xmlpaper\BRXM17A.INF</code><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312171646.png" alt="20240312171646"><br>根据我的打印机型号，选择<code>Brother DCP-B7520DW XML Paper1</code>。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312172309.png" alt="20240312172309"><br>选择<strong>替换当前的驱动程序</strong>，下一步，<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312172405.png" alt="20240312172405"><br>给打印机自定义一个名字，下一步；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312174733.png" alt="20240312174733"><br>选择<strong>不共享这台打印机</strong>，下一步；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312174819.png" alt="20240312174819"><br>点击<strong>完成</strong>。也可以打印测试页看是否成功。</li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;打印机是现在办公设备必不可少的工具，我们常常需要使用打印机复印或打印各种文件资料，尤其对一些正在加班且不能在家陪伴孩子写作业的父母来说，学会远程打印的方法十分必要。&lt;br&gt;打印机种类: 激光打印机&lt;br&gt;打印机型号: DCP-B7520DW&lt;br&gt;目前这款打印机不支持远程打印，所以需要将打印端口映射到外网才能实现远程打印。&lt;br&gt;局域网内电脑系统: Windows 10&lt;br&gt;远程打印电脑系统: Windows 11&lt;br&gt;</summary>
    
    
    
    <category term="网络" scheme="http://shenguosai.github.io/categories/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="远程打印" scheme="http://shenguosai.github.io/categories/%E7%BD%91%E7%BB%9C/%E8%BF%9C%E7%A8%8B%E6%89%93%E5%8D%B0/"/>
    
    
    <category term="网络" scheme="http://shenguosai.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>ZeroTier Documention</title>
    <link href="http://shenguosai.github.io/2024/03/06/ZeroTier-Documention/"/>
    <id>http://shenguosai.github.io/2024/03/06/ZeroTier-Documention/</id>
    <published>2024-03-06T02:09:35.000Z</published>
    <updated>2024-03-19T06:49:55.748Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://docs.zerotier.com/"><strong>ZeroTier Documentation</strong></a><br><span id="more"></span></p><h1 id="Getting-Started-with-ZeroTier"><a href="#Getting-Started-with-ZeroTier" class="headerlink" title="Getting Started with ZeroTier"></a>Getting Started with ZeroTier</h1><p>ZeroTier securely connects all your devices and services with each other, anywhere.</p><h2 id="What-is-ZeroTier"><a href="#What-is-ZeroTier" class="headerlink" title="What is ZeroTier?"></a>What is ZeroTier?</h2><p>ZeroTier is a way to connect devices over your own private network anywhere in the world. You do this by creating a network and then joining <em>two or more devices</em> to that network. You can use ZeroTier to play games, connect to remote business resources or even as a cloud backplane for your enterprise.<a href="https://docs.zerotier.com/start">Create your network.</a></p><blockquote><p><strong>ADVANCED</strong><br>ZeroTier uses a set of globally distributed root servers and network controllers to automatically negotiate P2P connections for your devices and provision your networks. You use Central to manage your networks. <a href="https://docs.zerotier.com/protocol">Here’s a technical deep dive of the protocol</a>.</p></blockquote><h2 id="Ceate-a-Network"><a href="#Ceate-a-Network" class="headerlink" title="Ceate a Network"></a>Ceate a Network</h2><p>A ZeroTier network is essentially a secure Local Area Network(LAN) that you can use anywhere in the world. Let’s make one and connect two devices over ZeroTier.<br>We’ll use <code>ping</code> to test the connection. Any two devices that can run ZeroTier will do: laptop, phone, virtual machine, etc…<br>Both devices can be at the same location, on the same physical network. If you move one to a cafe or to your office, it should still just work.<br>The rough outline is:</p><ul><li>Cerate a ZeroTier network</li><li>Join the network from two devices</li><li><code>ping</code> one device from the other over the ZeroTier network<br>This should take about 5 minutes.<blockquote><p>Results Preview<br>Here is a summary of the results of this tutorial, if you’re a networking person.<br>If this doesn’t mean anything to you, that’s OK. We’ll get there.<br>Each zerotier network you join creates a network interface on your devices. It’s like adding another Ethernet port to your computer.</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">node1</span># ip -o a<br><span class="hljs-attribute">1</span>: lo    inet <span class="hljs-number">127.0.0.1</span>/<span class="hljs-number">8</span> scope host lo\       valid_lft forever preferred_lft forever<br><span class="hljs-attribute">2</span>: eth0    inet <span class="hljs-number">192.168.182.201</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">192.168.182.255</span> scope global dynamic noprefixroute eth0\       valid_lft <span class="hljs-number">3277</span>sec preferred_lft <span class="hljs-number">2827</span>sec<br><span class="hljs-attribute">9</span>: zt3jn2z57r    inet <span class="hljs-number">10.2.0.11</span>/<span class="hljs-number">23</span> brd <span class="hljs-number">10.2.1.255</span> scope global zt3jn2z57r\       valid_lft forever preferred_lft forever<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">node2</span># ip -o a<br><span class="hljs-attribute">1</span>: lo    inet <span class="hljs-number">127.0.0.1</span>/<span class="hljs-number">8</span> scope host lo\       valid_lft forever preferred_lft forever<br><span class="hljs-attribute">2</span>: eth0    inet <span class="hljs-number">192.168.182.202</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">192.168.182.255</span> scope global dynamic noprefixroute eth0\       valid_lft <span class="hljs-number">3277</span>sec preferred_lft <span class="hljs-number">2827</span>sec<br><span class="hljs-attribute">9</span>: zt3jn2z57r    inet <span class="hljs-number">10.2.0.12</span>/<span class="hljs-number">23</span> brd <span class="hljs-number">10.2.1.255</span> scope global zt3jn2z57r\       valid_lft forever preferred_lft forever<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">node1#<span class="hljs-built_in"> ping </span>-c 3 10.2.0.12<span class="hljs-built_in"></span><br><span class="hljs-built_in">PING </span>10.2.0.2 (10.2.0.12) 56(84) bytes of data.<br>64 bytes <span class="hljs-keyword">from</span> 10.2.0.12: <span class="hljs-attribute">icmp_seq</span>=1 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=5.66 ms<br>64 bytes <span class="hljs-keyword">from</span> 10.2.0.12: <span class="hljs-attribute">icmp_seq</span>=2 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=6.62 ms<br>64 bytes <span class="hljs-keyword">from</span> 10.2.0.12: <span class="hljs-attribute">icmp_seq</span>=3 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=8.50 ms<br><br>--- 10.2.0.12<span class="hljs-built_in"> ping </span>statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 2004ms<br></code></pre></td></tr></table></figure></blockquote></li></ul><h3 id="Create-your-first-ZeroTier-network"><a href="#Create-your-first-ZeroTier-network" class="headerlink" title="Create your first ZeroTier network"></a>Create your first ZeroTier network</h3><h4 id="Create-an-account"><a href="#Create-an-account" class="headerlink" title="Create an account"></a>Create an account</h4><blockquote><p>NOTE<br>It’s free, no credit card is required.</p><ul><li>Go to <a href="https://my.zerotier.com/">my.zerotier.com</a> and create an account.<h4 id="Create-a-network"><a href="#Create-a-network" class="headerlink" title="Create a network"></a>Create a network</h4></li><li>Make sure you’re on the “Networks” tab of my.zerotier.com<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306141725.png" alt="20240306141725"></li><li>Click the <strong>Create A Network</strong> button.<br>This creates a virtual network with a random ID and a random name. We got “fervent_smathers” and <code>d5e04297a16fa690</code> here.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306142035.png" alt="20240306142035"></li><li>Click anywhere on the network to go to the details page for this network.<br>See the Network Settings panel:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306142144.png" alt="20240306142144"><br>We don’t need to change any settings, but we can change the name of the network to personalize it.</li><li>Change “fervent_smathers” to “my cool network” or whatever you like.</li><li>Collapse the Settings panel. Click on the word “Settings” at the top of the panel.<br>You don’t need to change any other settings.</li><li>See the Network Members panel:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306142515.png" alt="20240306142515"><br>It should say “No devices have joined this network”.</li><li>Leave this brower tab open. We’ll look at it again later.</li></ul></blockquote><h3 id="Setup-the-ZeroTier-app"><a href="#Setup-the-ZeroTier-app" class="headerlink" title="Setup the ZeroTier app"></a>Setup the ZeroTier app</h3><h4 id="Download-and-install-ZeroTier"><a href="#Download-and-install-ZeroTier" class="headerlink" title="Download and install ZeroTier"></a>Download and install ZeroTier</h4><p>For mobile devices, use the app store.</p><ul><li>Go to <a href="https://www.zerotier.com/download">zerotier.com/download</a></li><li>Run the installer<br>The ZeroTier client should now running on your devices.<h4 id="Join-your-first-ZeroTier-network"><a href="#Join-your-first-ZeroTier-network" class="headerlink" title="Join your first ZeroTier network"></a>Join your first ZeroTier network</h4>We need to tell the client to “join” the virtual network we just created.</li><li>Copy the Network ID of the network from my.zerotier.com. This is the long number that looks like: <code>d5e04297a16fa690</code></li><li>Paste the Network ID into the “join” command on your device<br>On macOS and Windows, there is a menubar/tray app. Select “join” from the menu.<blockquote><p><strong>NOTE</strong><br>Every running instance of ZeroTier has a unique address. It’s the 10 digit “Address” in the app, or <code>zerotier-cli info</code> command.<br>ZeroTier addresses are a very secure method of unique identification.</p></blockquote></li></ul><h3 id="Authorize-your-device-on-your-network"><a href="#Authorize-your-device-on-your-network" class="headerlink" title="Authorize your device on your network"></a>Authorize your device on your network</h3><p>At this point, your client should say “Access Denied.” A device can’t talk on your network unless you allow it, even if someone discovers the network’s ID.</p><h4 id="Authorize-your-device"><a href="#Authorize-your-device" class="headerlink" title="Authorize your device"></a>Authorize your device</h4><ul><li>Go to the Members panel that we left open on my.zerotier.com</li><li>Your node that just “joined” should appear here.</li><li>The “Address” should match the address in your client.</li><li>Click the “Auth?” check box for it.</li><li>Give it a name. Type something like “laptop” or “bob” into the <code>(short name)</code> input.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306150746.png" alt="20240306150746"></li></ul><h4 id="Confirm-authorization"><a href="#Confirm-authorization" class="headerlink" title="Confirm authorization"></a>Confirm authorization</h4><p>Back on your computer, your client should now say “OK” instead of “ACCESS DENIED” and it should show your custom “my cool network” name.<br>Now you have 1 member on your network. A network with 1 member can’t do much.</p><h3 id="Repeat-with-another-device"><a href="#Repeat-with-another-device" class="headerlink" title="Repeat with another device"></a>Repeat with another device</h3><p>We need to have 2 devices connected to the same ZeroTier network.</p><ul><li>Repeat the join and authorize steps with your second device.</li></ul><h3 id="Test-connectivity"><a href="#Test-connectivity" class="headerlink" title="Test connectivity"></a>Test connectivity</h3><p>Now you have two authorized nodes on your network. They should be able to talk over ZeroTier.<br>Your Network Members section should look something like this:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306151255.png" alt="20240306151255"><br>The “Managed IPs” will be different on your network.<br>We’re going to test with <code>ping</code>. It’s the only program that we can think of that exists by default on every operating system.<br>This is a command line program, but don’t worry: You can do it.</p><h4 id="Gotcha-Windows-blocks-ping"><a href="#Gotcha-Windows-blocks-ping" class="headerlink" title="Gotcha: Windows blocks ping"></a>Gotcha: Windows blocks ping</h4><p><del>Windows by default doesn’t respond to pings. If you try to ping a Windows computer from a different computer, it won’t work. You can enable ping.</del><br>ZeroTier automatically enables ping on your ZeroTier network adapter now. You can probably skip this step!</p><blockquote><p>How to enable ping on Windows</p><ul><li>Search for Windows Firewall in the Start Menu, and click to open it.</li><li>Click Advanced Settings on the left.</li><li>From the left pane of the resulting window, click Inbound Rules.</li><li>In the right pane, find the rules titled File and Printer Sharing(Echo Request - ICMPv4-In).</li><li>Right-click each rule and choose Enable Rule.<br>Here is a <a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-firewall/create-an-inbound-icmp-rule">tutorial by Microsoft</a><h4 id="Open-the-command-line"><a href="#Open-the-command-line" class="headerlink" title="Open the command line"></a>Open the command line</h4></li><li>Open the command line on your computer<h4 id="Find-the-ZeroTier-IP-Address-of-your-devices"><a href="#Find-the-ZeroTier-IP-Address-of-your-devices" class="headerlink" title="Find the ZeroTier IP Address of your devices"></a>Find the ZeroTier IP Address of your devices</h4><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306153157.png" alt="20240306153157"><h4 id="Try-the-ping-command"><a href="#Try-the-ping-command" class="headerlink" title="Try the ping command"></a>Try the ping command</h4>Back in the Command Line / Terminal that you just opened:</li><li>type <code>ping -c 5 $ZEROTIER_IP_ADDRESS</code> <code>&lt;enter&gt;</code> into your command line.<br>A successful <code>ping</code><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros">%<span class="hljs-built_in"> ping </span>-c 5 172.22.217.93<span class="hljs-built_in"></span><br><span class="hljs-built_in">PING </span>172.22.217.93 (172.22.217.93): 56 data bytes<br>64 bytes <span class="hljs-keyword">from</span> 172.22.217.93: <span class="hljs-attribute">icmp_seq</span>=0 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=22.362 ms<br>64 bytes <span class="hljs-keyword">from</span> 172.22.217.93: <span class="hljs-attribute">icmp_seq</span>=1 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=10.157 ms<br>64 bytes <span class="hljs-keyword">from</span> 172.22.217.93: <span class="hljs-attribute">icmp_seq</span>=2 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=9.414 ms<br>64 bytes <span class="hljs-keyword">from</span> 172.22.217.93: <span class="hljs-attribute">icmp_seq</span>=3 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=9.019 ms<br>64 bytes <span class="hljs-keyword">from</span> 172.22.217.93: <span class="hljs-attribute">icmp_seq</span>=4 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=9.180 ms<br><br>--- 172.22.217.93<span class="hljs-built_in"> ping </span>statistics ---<br>5 packets transmitted, 5 packets received, 0.0% packet loss<br>round-trip min/avg/max/stddev = 9.019/12.026/22.362/5.182 ms<br></code></pre></td></tr></table></figure>Try it with both ZeroTier Managed addresses on your network.<br>One of them is the same device you’re on, so you’re pinging yourself. Pinging the other device might be a little more interesting.<br><strong>INFO</strong><br>If something goes wrong you might see something like:<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs applescript">% ping -c <span class="hljs-number">5</span> <span class="hljs-number">172.22</span><span class="hljs-number">.217</span><span class="hljs-number">.92</span><br>PING <span class="hljs-number">172.22</span><span class="hljs-number">.217</span><span class="hljs-number">.92</span> (<span class="hljs-number">172.22</span><span class="hljs-number">.217</span><span class="hljs-number">.92</span>): <span class="hljs-number">56</span> data bytes<br>Request <span class="hljs-keyword">timeout</span> <span class="hljs-keyword">for</span> icmp_seq <span class="hljs-number">0</span><br>Request <span class="hljs-keyword">timeout</span> <span class="hljs-keyword">for</span> icmp_seq <span class="hljs-number">1</span><br>Request <span class="hljs-keyword">timeout</span> <span class="hljs-keyword">for</span> icmp_seq <span class="hljs-number">2</span><br>Request <span class="hljs-keyword">timeout</span> <span class="hljs-keyword">for</span> icmp_seq <span class="hljs-number">3</span><br><br><span class="hljs-comment">--- 172.22.217.92 ping statistics ---</span><br><span class="hljs-number">5</span> packets transmitted, <span class="hljs-number">0</span> packets received, <span class="hljs-number">100.0</span>% packet loss<br></code></pre></td></tr></table></figure>or<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ping</span> -c <span class="hljs-number">5</span> <span class="hljs-number">192.168.123.234</span><br><span class="hljs-attribute">PING</span> <span class="hljs-number">192.168.123.234</span> (<span class="hljs-number">192.168.123.234</span>): <span class="hljs-number">56</span> data bytes<br><span class="hljs-attribute">92</span> bytes from <span class="hljs-number">192.168.82.1</span>: Destination Port Unreachable<br><span class="hljs-attribute">Vr</span> HL TOS  Len   ID Flg  <span class="hljs-literal">off</span> TTL Pro  cks      Src      Dst<br><span class="hljs-attribute">4</span>  <span class="hljs-number">5</span>  <span class="hljs-number">00</span> <span class="hljs-number">5400</span> <span class="hljs-number">56</span>e7   <span class="hljs-number">0</span> <span class="hljs-number">0000</span>  <span class="hljs-number">3</span>f  <span class="hljs-number">01</span> d4ad <span class="hljs-number">192.168.82.217</span>  <span class="hljs-number">192.168.123.234</span><br></code></pre></td></tr></table></figure>There may just be a typo in the IP address. Double check that your device is authorized at my.zerotier.com<br>Contact us on the <a href="https://discuss.zerotier.com/">discussion forum</a> and see the <a href="https://docs.zerotier.com/faq">troubling section</a> if you get stuck.</li></ul></blockquote><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p><code>ping</code> doesn’t accomplish anything, but it does tell us ZeroTier is working. It’s useful to know about for troubleshooting networks, not just ZeroTier networks.<br>Visit the <a href="https://discuss.zerotier.com/">discussion forum</a> to talk about your use-cases or if you get stuck.</p><h4 id="Now-use-ZeroTier-to-do-something-you-want-to-do"><a href="#Now-use-ZeroTier-to-do-something-you-want-to-do" class="headerlink" title="Now, use ZeroTier to do something you want to do"></a>Now, use ZeroTier to do something you want to do</h4><h4 id="Some-popular-uses"><a href="#Some-popular-uses" class="headerlink" title="Some popular uses"></a>Some popular uses</h4><ul><li>Windows Remote Desktop</li><li>ssh(try <a href="https://mosh.org/">mosh</a>)</li><li>Private Gaming LAN</li><li>Access the web interfaces of your home lab</li><li>Build your own <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/7110693/Overriding+Default+Route+Full+Tunnel+Mode">VPN</a></li><li>Route to a <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/224395274/Route+between+ZeroTier+and+Physical+Networks">remote subnet</a></li><li>Route to a <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/7274520/Using+NDP+Emulated+6PLANE+Addressing+With+Docker">Docker network</a></li><li>Add <a href="https://docs.zerotier.com/dns">dns</a> to your network<h4 id="Join-multiple-networks"><a href="#Join-multiple-networks" class="headerlink" title="Join multiple networks"></a>Join multiple networks</h4>A node can join many networks at once. Make sure they don’t use the same subnet!<br>You can have a <code>home</code> network, a <code>friends</code> network, and a <code>work</code> network, for example.<br>They don’t all need to be networks that you’ve created. You can join other people’s network.<h4 id="Check-out-the-Whitepaper"><a href="#Check-out-the-Whitepaper" class="headerlink" title="Check out the Whitepaper"></a>Check out the Whitepaper</h4>For more info on the cryptography and protocol, see the: <a href="https://docs.zerotier.com/protocol">Design Whitepaper</a></li></ul><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="Minimum-System-Requirements"><a href="#Minimum-System-Requirements" class="headerlink" title="Minimum System Requirements"></a>Minimum System Requirements</h3><p>ZeroTier is lightweight, portable, and compatible across all major platforms and architectures. It typically consumes less than 16 MB of memory, only about 1 MB of storage, and even has a <a href="https://docs.zerotier.com/lbm">low-bandwidth mode</a> for IoT applications. It supports <code>32-bit ARM(arm32)</code>, <code>64-bit ARM(arm64)</code>, <code>32-bit Intel(x86)</code>, <code>64-bit Intel(x64/amd64)</code>, <code>MIPS</code>, and <code>s390x</code>. You can run it on <a href="https://docs.zerotier.com/linux">Linux</a>, <a href="https://docs.zerotier.com/macos">macOS</a>, <a href="https://docs.zerotier.com/windows">Windows</a>, <a href="https://docs.zerotier.com/ios">iOS/iPadOS</a>, <a href="https://docs.zerotier.com/android">Android</a>, and <a href="https://docs.zerotier.com/freebsd">FreeBSD</a>. You can run it on <a href="https://docs.zerotier.com/routers">Routers</a>, <a href="https://docs.zerotier.com/nas">Network Attached Storage</a>, and we <a href="https://docs.zerotier.com/proxy">have solutions</a> for when you can’t install ZeroTier on a small IoT sensor.<br>Our most recent client can still be run on tiny single-board computers like the original Raspberry Pi made over a decade ago and all versions of ZeroTier are backwards compatible.<br>ZeroTier is currently single-threaded so devices with more than two cores typically will not offer significant performance gains. Future versions of ZeroTier will introduce multithreading.</p><ul><li>While ZeroTier will operate on very low-power hardware(e.g. a single core 32-Bit ARM running at 600Mhz without AES hardware acceleration(AES-NI)), its performance will suffer.<br>We recommend the following for a happy ZeroTier experience: <code>&gt;=1GHz</code> CPU with at least <code>2</code> cores, and <code>AES-NI</code>.<blockquote><p><strong>ARM</strong><br>If you’re planning on embedding ZeroTier in a product such as a router, network attached storage or some other IoT application we see that our partners have a better experence with <code>64-bit ARM</code> as opposed to <code>32-bit ARM</code> since the core speeds are typically higher and the chips are more likely to have <code>AES-NI</code>.</p><h3 id="What-happens-if-a-ZeroTier-Inc-root-goes-down"><a href="#What-happens-if-a-ZeroTier-Inc-root-goes-down" class="headerlink" title="What happens if a ZeroTier, Inc root goes down?"></a>What happens if a ZeroTier, Inc root goes down?</h3><p>Out roots are globally distributed and redundant, if one fails requests will seamlessly fail-over to other roots.<br>If you are running your own roots the effect would be that no new connections can be established between nodes but existing connections would still work.</p><h3 id="Can-ZeroTier-Inc-See-my-traffic"><a href="#Can-ZeroTier-Inc-See-my-traffic" class="headerlink" title="Can ZeroTier, Inc. See my traffic?"></a>Can ZeroTier, Inc. See my traffic?</h3><p>No. Your traffic is end-to-end encrypted and your device’s private identity keys are never transmitted off of your device. Learn more about our <a href="https://docs.zerotier.com/protocol#crypto">cryptograph protocol</a>.</p><h3 id="Metrics-and-Monitoring"><a href="#Metrics-and-Monitoring" class="headerlink" title="Metrics and Monitoring"></a>Metrics and Monitoring</h3><p>ZeroTier Inc doesn’t have access to your traffic. We don’t current supply a monitoring “dashboard” for your networks and nodes. You can build your own.</p></blockquote></li><li><a href="https://github.com/zerotier/ZeroTierOne#prometheus-metrics">Prometheus Metrics</a> for the zerotier-one agent are available. Pipe these into the common prometheus/grafana setup.</li><li>Use your preferred monitoring tool <em>over</em> your ZeroTier networks. Some examples: Prometheus <a href="https://github.com/prometheus/blackbox_exporter">Blackbox exporter</a>, <a href="https://oss.oetiker.ch/smokeping/">SmokePing</a>, <a href="https://uptime.kuma.pet/">UptimeKuma</a></li><li><a href="https://docs.zerotier.com/rules#353trafficobservationandinterceptionaname3_5_3a">Traffic Observation and Interception</a><h3 id="Why-does-my-peers-list-have-nodes-I-don’t-recognize"><a href="#Why-does-my-peers-list-have-nodes-I-don’t-recognize" class="headerlink" title="Why does my peers list have nodes I don’t recognize?"></a>Why does my peers list have nodes I don’t recognize?</h3>The nodes are usually our infrastructure that your node needs to talk to in order to function. This includes thing like: <a href="https://docs.zerotier.com/roots">Root servers</a> and <a href="https://docs.zerotier.com/controller">Controllers</a>. Or possibly nodes from a previously joined network. The command <code>zerotier-cli peers</code> shows a list of nodes that your node knows about. Nodes can not talk to each other unless they are joined and authorized on the same network. Our root servers and controllers do not have access to you nodes’ encryption keys and thus cannot decrypt your traffic.<blockquote><p><strong>HOW TO IDENTIFY A CONTROLLER</strong><br>A controller is a ZeroTier node. The first 10 digits of a Network ID is the controller’s address.</p><h3 id="What-is-error-NOT-FOUND"><a href="#What-is-error-NOT-FOUND" class="headerlink" title="What is error NOT_FOUND?"></a>What is error <code>NOT_FOUND</code>?</h3><p>When your ZeroTier Client is showing NOT_FOUND as your network status, this usually means that you’ve entered your network ID incorrectly and are trying to join a non-existent network. Please check your network ID and try again.</p><h3 id="High-Latency-amp-Relaying"><a href="#High-Latency-amp-Relaying" class="headerlink" title="High Latency &amp; Relaying"></a>High Latency &amp; Relaying</h3><p>If you’re experiencing high latency(or high ping times), it’s possible the connection between two nodes is being Relayed. The command <code>zerotier-cli peers</code> (available in 1.4.x and above) will give you infomation on what if any connections are being relayed. The output will look something like this:</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@host] <span class="hljs-comment"># zerotier-cli peers</span><br>&lt;ztaddr&gt;   &lt;ver&gt;  &lt;role&gt; &lt;lat&gt; &lt;link&gt; &lt;lastTX&gt; &lt;lastRX&gt; &lt;path&gt;<br>61d294b9cb -      PLANET   <span class="hljs-number"> 43 </span>DIRECT<span class="hljs-number"> 1617 </span>   <span class="hljs-number"> 6580 </span>    50.7.73.34/9993<br>62f865ae71 -      PLANET  <span class="hljs-number"> 193 </span>DIRECT<span class="hljs-number"> 1617 </span>   <span class="hljs-number"> 1424 </span>    2001:49f0:d0db:2::2/9993<br>6xxxxxxxx1 1.6.4  LEAF    <span class="hljs-number"> 730 </span>DIRECT<span class="hljs-number"> 8714 </span>   <span class="hljs-number"> 8714 </span>    35.222.83.92/62191<br>778cde7190 -      PLANET   <span class="hljs-number"> 76 </span>DIRECT<span class="hljs-number"> 1617 </span>   <span class="hljs-number"> 11607 </span>   103.195.103.66/9993<br>992fcf1db7 -      PLANET  <span class="hljs-number"> 163 </span>DIRECT<span class="hljs-number"> 6623 </span>   <span class="hljs-number"> 1454 </span>    2a02:6ea0:c024::/9993<br>deadbeef01 1.6.4  LEAF      -1 RELAY<br></code></pre></td></tr></table></figure><p>If you see the peer you’re trying to contact in the RELAY state, that means packets are bouncing through our root servers because a direct connection between peers cannot be established. Side effects of RELAYING are increased latency and possible packet loss. See <a href="https://docs.zerotier.com/routertips">Router Configuration Tips</a> for how to resolve this.<br><strong>TIP</strong><br>If you experience high latency or packet jitter for more than four hours please contact your network admin as this may be a sign of a serious network condition.</p><h3 id="Bandwidth-considerations"><a href="#Bandwidth-considerations" class="headerlink" title="Bandwidth considerations"></a>Bandwidth considerations</h3><p>In the best case scenario, and in most cases, ZeroTier connects peer-to-peer and none of your network traffic travels through our servers. This means transfers go as fast as your CPU &amp; network can compress, encrypt and send packets, and how fast the remote end can receive them.<br>There are some cases, such as hostile NATs &amp; firewalls in which your encrypted packets do indeed get relayed through our root servers. Relaying through our root adds latency. The packets must travel farther physically than they would for a direct, peer to peer connection.<br>We do not throttle any of these packets, nor can we read the contents of the packets due to encryption. We also, however, cannot guarantee connection reliability when this happens. We do our best effort to get your packets where they need to go, but this is not always possible.<br>Considerations:</p></blockquote></li><li>CPU speed. The current version of zerotier-one is single threaded. Raw CPU speed is important in high bandwidth use cases.</li><li>Physical Internet connection. ZeroTier can only go as fast as the physical connection it’s running over.</li><li>Hardware Encryption. ZerTier uses hardware AES acceleration when available. Most current ARM and x86_64 platforms have AES acceleration.</li><li>Geographic distance. If your remote peer is on a different continent, there will be latency. We can’t improve the speed of light.<blockquote><p>TIP<br>If you are experiencing slow network speeds or difficulty making direct connections see <a href="https://docs.zerotier.com/routertips">Router Configuration Tips</a> or <a href="https://docs.zerotier.com/corporate-firewalls">Corporate Firewalls</a></p><h4 id="Will-transfers-go-faster-on-paid-accounts"><a href="#Will-transfers-go-faster-on-paid-accounts" class="headerlink" title="Will transfers go faster on paid accounts?"></a>Will transfers go faster on paid accounts?</h4><p>ZeroTier performance is not at all related to your account or subscription level. You may be able to change things on your end to enable faster connections between peers.</p><h3 id="Error-Cannot-connect-to-ZeroTier-service"><a href="#Error-Cannot-connect-to-ZeroTier-service" class="headerlink" title="Error: Cannot connect to ZeroTier service"></a>Error: Cannot connect to ZeroTier service</h3><p>This error means that the ZeroTier background service on your computer is either not running, or your local firewall is preventing the UI or CLI from talking to it.</p><h4 id="Windows-10"><a href="#Windows-10" class="headerlink" title="Windows 10"></a>Windows 10</h4><p>Open Task Manager and go to the “Services” tab. Scroll down until you see <code>ZeroTierOneService</code>. The status column should say <code>Running</code>. If it does not, right click on the line and click <code>Start</code></p><h4 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h4><p>Open Terminal.app and excute the following commands</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">sudo launchctl unload /Library/LaunchDaemons/com<span class="hljs-selector-class">.zerotier</span><span class="hljs-selector-class">.one</span><span class="hljs-selector-class">.plist</span><br>sudo launchctl load /Library/LaunchDaemons/com<span class="hljs-selector-class">.zerotier</span><span class="hljs-selector-class">.one</span>.plist<br></code></pre></td></tr></table></figure><h4 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h4><p>If your Linux distribution uses systemd, execute <code>sudo service zerotier-one start</code><br>If not, execute <code>sudo /etc/init.d/zerotier-one start</code></p><h4 id="Still-doesn’t-work"><a href="#Still-doesn’t-work" class="headerlink" title="Still doesn’t work?"></a>Still doesn’t work?</h4><p>Your system firewall is likely blocking communication with the ZeroTier service. Look up instructions for how to unblock an application from the firewall for your OS. ZeroTier will need to be accessible via TCP port 9993 fro the UI and CLI to interact with it.</p><h3 id="Where-can-I-find-old-version-of-ZeroTier"><a href="#Where-can-I-find-old-version-of-ZeroTier" class="headerlink" title="Where can I find old version of ZeroTier?"></a>Where can I find old version of ZeroTier?</h3><p>See <a href="https://docs.zerotier.com/releases#old">Release</a></p><h3 id="What-is-Earth"><a href="#What-is-Earth" class="headerlink" title="What is Earth?"></a>What is Earth?</h3><p><code>Earth</code> or <code>8056c2e21c000001</code> was a test network operated by ZeroTier, Inc., it was decommissioned in 2023.</p><h3 id="How-do-I-Update-Zerotier"><a href="#How-do-I-Update-Zerotier" class="headerlink" title="How do I Update Zerotier?"></a>How do I Update Zerotier?</h3><p>When you update ZeroTier, your configuration stays. You don’t need to re-join your networks.</p><h4 id="macOS-and-Windows"><a href="#macOS-and-Windows" class="headerlink" title="macOS and Windows"></a>macOS and Windows</h4><p>Grab the latest version from the <a href="https://www.zerotier.com/download">download page</a> and run the installer</p><h4 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a>Linux</h4><p>Use your OS’s package manager. eg <code>apt</code> on Debian based distributions, or <code>yum</code> or <code>dnf</code> on RedHat based distributions.</p><h4 id="iOS-and-Android"><a href="#iOS-and-Android" class="headerlink" title="iOS and Android"></a>iOS and Android</h4><p>Use the respective app stores.</p><h3 id="How-to-clear-or-reset-your-ZeroTier-address"><a href="#How-to-clear-or-reset-your-ZeroTier-address" class="headerlink" title="How to clear or reset your ZeroTier address"></a>How to clear or reset your ZeroTier address</h3><p>If you would like to clear or reset ZeroTier’s address on a device (the 10-digit address node ID) or you have cloned a device and you want to prevent it from using the same address, follow these steps in order:</p><h4 id="Step-1-Stop-the-service"><a href="#Step-1-Stop-the-service" class="headerlink" title="Step 1. Stop the service"></a>Step 1. Stop the service</h4><h5 id="On-Windows"><a href="#On-Windows" class="headerlink" title="On Windows"></a>On Windows</h5><p>On Windows this is done with the service manager.(Open the Start Menu and start typing “service”)</p><h5 id="On-macOS"><a href="#On-macOS" class="headerlink" title="On macOS"></a>On macOS</h5><p>On macOS you can open a terminal and use</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">sudo launchctl <span class="hljs-built_in">unload</span> /Library/LaunchDaemons/com.zerotier.<span class="hljs-literal">one</span>.plist<br></code></pre></td></tr></table></figure><h5 id="On-Linux"><a href="#On-Linux" class="headerlink" title="On Linux"></a>On Linux</h5><p>This is usually</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">sudo systemctl <span class="hljs-built_in">stop</span> zerotier-<span class="hljs-literal">one</span><br></code></pre></td></tr></table></figure><p>or</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">sudo service zerotier-<span class="hljs-literal">one</span> <span class="hljs-built_in">stop</span><br></code></pre></td></tr></table></figure><h4 id="Step-2-Delete-the-file-identity-public-and-identity-secret-from-ZeroTier’s-working-directory"><a href="#Step-2-Delete-the-file-identity-public-and-identity-secret-from-ZeroTier’s-working-directory" class="headerlink" title="Step 2. Delete the file identity.public and identity.secret from ZeroTier’s working directory"></a>Step 2. Delete the file identity.public and identity.secret from ZeroTier’s working directory</h4></blockquote></li><li>On Windows this is usually <code>\ProgramData\ZeroTier\One</code></li><li>On Mac this is <code>/Library/Application Support/ZeroTier/One</code> in your terminal, type opne <code>/Library/Application Support/ZeroTier/One</code> to open the folder in Finder</li><li>On Linux this is usually <code>/var/lib/zerotier-one</code><h4 id="Step-3-Restart-the-service"><a href="#Step-3-Restart-the-service" class="headerlink" title="Step 3. Restart the service"></a>Step 3. Restart the service</h4><h5 id="On-Windows-1"><a href="#On-Windows-1" class="headerlink" title="On Windows"></a>On Windows</h5>Starting via the service manager on Windows<h5 id="On-Mac"><a href="#On-Mac" class="headerlink" title="On Mac"></a>On Mac</h5><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">sudo launchctl <span class="hljs-keyword">load</span> /<span class="hljs-keyword">Library</span>/LaunchDaemons/com.zerotier.one.plist<br></code></pre></td></tr></table></figure><h5 id="On-Linux-1"><a href="#On-Linux-1" class="headerlink" title="On Linux"></a>On Linux</h5><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">sudo systemctl <span class="hljs-built_in">start</span> zerotier-<span class="hljs-literal">one</span><br></code></pre></td></tr></table></figure>or<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">sudo service zerotier-<span class="hljs-literal">one</span> <span class="hljs-built_in">start</span><br></code></pre></td></tr></table></figure>When started without identities ZeroTier will generate new ones. You will need to authorize this new identity on any networks.<blockquote><p><strong>CAN’T FIND AN ANSWER?</strong><br><a href="https://discuss.zerotier.com/">Ask our community for help</a></p></blockquote></li></ul><blockquote><p><strong>NEXT STEPS</strong><br>Click <a href="https://docs.zerotier.com/start/">here</a> to create your network and start adding devices.</p></blockquote><h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><blockquote><p><strong>CAN’T FIND AN ANSWER?</strong><br><a href="https://discuss.zerotier.com/">Ask out community for help</a></p><h3 id="Ping-is-not-working"><a href="#Ping-is-not-working" class="headerlink" title="Ping is not working"></a>Ping is not working</h3><p>First, make sure your device is authorized on the network and you’re using the ZeroTier assigned Managed IP address. Aside from that, some OSes block pings in their local firewall by default.</p><h4 id="Windows-Firewall"><a href="#Windows-Firewall" class="headerlink" title="Windows Firewall"></a>Windows Firewall</h4><p>ZeroTier versions 1.10.3 and greater automatically enable ping on ZeroTier adapters.</p><h4 id="macOS-Firewall"><a href="#macOS-Firewall" class="headerlink" title="macOS Firewall"></a>macOS Firewall</h4><p>The firewall is not enabled by default on macOS, and thus pings will not be blocked by default. If your firewall is enabled on macOS, go into System Preferences -&gt; Security &amp; Privacy. Under Firewall Options, ensure “Enable stealth mode”, is disabled. Stealth mode blocks pings.</p><h4 id="Linux-Firewalls"><a href="#Linux-Firewalls" class="headerlink" title="Linux Firewalls"></a>Linux Firewalls</h4><p>There are far too many Linux distributions out there to list instructions for all of them here. Please refer to your distribution’s documentation for how to unblock ICMP packets.<br><strong>GET STARTED</strong><br>Click <a href="https://docs.zerotier.com/start/">here</a> to create your network and start adding devices.</p><h3 id="Error-Cannot-connect-to-ZeroTier-service-or-Node-ID-“Unknown”-in-the-GUI-apps"><a href="#Error-Cannot-connect-to-ZeroTier-service-or-Node-ID-“Unknown”-in-the-GUI-apps" class="headerlink" title="Error: Cannot connect to ZeroTier service(or Node ID “Unknown” in the GUI apps)"></a>Error: Cannot connect to ZeroTier service(or Node ID “Unknown” in the GUI apps)</h3><p>This error means that the ZeroTier background service on your computer is either not running, or your local firewall is preventing the UI or CLI from talking to it.</p><h4 id="Windows-Service"><a href="#Windows-Service" class="headerlink" title="Windows Service"></a>Windows Service</h4><p>Open Task Manager and go to the “Services” tab. Scroll down until you see “SeroTierOneService”. The status column should say “Running”. If it does not, right click on the line and click “Start”.</p><h4 id="macOS-Service"><a href="#macOS-Service" class="headerlink" title="macOS Service"></a>macOS Service</h4><p>Open Terminal.app and excute the following commands<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">sudo launchctl unload /Library/LaunchDaemons/com<span class="hljs-selector-class">.zerotier</span><span class="hljs-selector-class">.one</span><span class="hljs-selector-class">.plist</span><br>sudo launchctl load /Library/LaunchDaemons/com<span class="hljs-selector-class">.zerotier</span><span class="hljs-selector-class">.one</span>.plist<br></code></pre></td></tr></table></figure></p><h4 id="Linux-Service"><a href="#Linux-Service" class="headerlink" title="Linux Service"></a>Linux Service</h4><p>If your Linux distribution uses systemd, excute:<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">sudo service zerotier-<span class="hljs-literal">one</span> <span class="hljs-built_in">start</span><br></code></pre></td></tr></table></figure><br>If not, excute:<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">/etc/init.d/zerotier-<span class="hljs-literal">one</span> <span class="hljs-built_in">start</span><br></code></pre></td></tr></table></figure></p><h4 id="Still-doesn’t-work-1"><a href="#Still-doesn’t-work-1" class="headerlink" title="Still doesn’t work?"></a>Still doesn’t work?</h4><p>Your system firewall is likely blocking communication with the ZeroTier service. Look up instructions for how to unblock an application from the firewall for your OS. ZeroTier will need to be accessible via TCP port 9993 for the UI and CLI to interact with it.</p><h3 id="Emergency-Instructions"><a href="#Emergency-Instructions" class="headerlink" title="Emergency Instructions"></a>Emergency Instructions</h3><p>“It was working, but now it’s not and I’m not sure why. And I need to get up and running quick.”<br>First, check with your friendly firewall admin that no configuration in the physical network connection has changed.<br>See the <a href="https://docs.zerotier.com/cli">CLI</a> article for help with the CLI.<br>We’re not aware of any bugs that require these steps, or we’d fix them, but sometimes poeple try the below.<br>Listed in order of severity:</p><h4 id="Restart-the-service"><a href="#Restart-the-service" class="headerlink" title="Restart the service"></a>Restart the service</h4><h5 id="macOS-1"><a href="#macOS-1" class="headerlink" title="macOS"></a>macOS</h5><p>Open Terminal.app, paste the below, and press enter:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">sudo launchctl unload /Library/LaunchDaemons/com<span class="hljs-selector-class">.zerotier</span><span class="hljs-selector-class">.one</span><span class="hljs-selector-class">.plist</span><br>sudo launchctl load /Library/LaunchDaemons/com<span class="hljs-selector-class">.zerotier</span><span class="hljs-selector-class">.one</span>.plist<br></code></pre></td></tr></table></figure><br>It will ask you for your password. It’s the password you use to log in to your mac.</p><h5 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h5><ul><li>Type “Services” into the Start Menu to open the Windows Services Manager</li><li>Start and Stop the zerotier-one service in the Windows Services Manage.<h4 id="Linux-2"><a href="#Linux-2" class="headerlink" title="Linux"></a>Linux</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">systemctl restart zerotier-one</span><br></code></pre></td></tr></table></figure><h4 id="Leave-all-networks-and-rejoin-them"><a href="#Leave-all-networks-and-rejoin-them" class="headerlink" title="Leave all networks and rejoin them"></a>Leave all networks and rejoin them</h4>Use the UI, or<br><code>zerotier-cli leave &lt;network-id&gt;</code> and <code>zerotier-cli join &lt;network-id&gt;</code><h4 id="Stop-service-Delete-peers-d-Start-servic"><a href="#Stop-service-Delete-peers-d-Start-servic" class="headerlink" title="Stop service, Delete peers.d, Start servic"></a>Stop service, Delete peers.d, Start servic</h4>Find peers.d in the <a href="http://localhost:3000/config#system">zerotier system directory</a><h4 id="Reset-Node-ID"><a href="#Reset-Node-ID" class="headerlink" title="Reset Node ID"></a>Reset Node ID</h4>The new node ID will have be re-authorized on any networks, and the node’s managed IP address manually re-assigned if needed.</li><li>Stop the service</li><li>Move or delete indentity.secret and identity.public files in the <a href="http://localhost:3000/config#system">zerotier system directory</a></li><li>Delete peers.d too</li><li>Start the service</li></ul></blockquote><h2 id="What-can-I-do-with-ZeroTier"><a href="#What-can-I-do-with-ZeroTier" class="headerlink" title="What can I do with ZeroTier?"></a>What can I do with ZeroTier?</h2><p>A List of Awesome ZeroTier Things<br>This repository contains a list of all things ZeroTier that can be found on The Internet. Feel free to add yours!<br><a href="https://github.com/zerotier/awesome-zerotier/edit/main/README.md">Pull Request</a> accepted!</p><h3 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h3><ul><li><a href="https://docs.zerotier.com/awesome#zerotier-self-hosting">ZeroTier Self-Hosting</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-training">ZeroTier Training</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-networking">ZeroTier Networking</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-linux">ZeroTier Linux</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-remote-access">ZeroTier Remote Access</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-sd-wan">ZeroTier SD-WAN</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-iot">ZeroTier IoT</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-droneuav">ZeroTier Drone/UAV</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-robotics">ZeroTier Robotics</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-automotive">ZeroTier Automotive</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-blockchaincrypto">ZeroTier Blockchain/Crypto</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-infosec">ZeroTier Infosec</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-ibm">ZeroTier IBM</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-terraform">ZeroTier Terraform</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-kubernetes">ZeroTier Kubernetes</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-docker">ZeroTier Docker</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-bridging">ZeroTier Bridging</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-mikrotik">ZeroTier MikroTik</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-ubiquiti">ZeroTier Ubiquiti</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-teltonika">ZeroTier Teltonika</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-openwrt">ZeroTier OpenWrt</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-opnsense">ZeroTier OPNsense</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-pfsense">ZeroTier pfSense</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-synology">ZeroTier Synology</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-raspberry-pi">ZeroTier Raspberry Pi</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-3-d-printing">ZeroTier 3-D Printing</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-homelab">ZeroTier Homelab</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-home-automation">ZeroTier Home Automation</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-videocameracctv">ZeroTier Video/Camera/CCTV</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-eve-ng">ZeroTier EVE-NG</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-blender">ZeroTier Blender</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-oculus">ZeroTier Oculus</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-gaming">ZeroTier Gaming</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-everything-else">ZeroTier Everything Else</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-reddit">ZeroTier Reddit</a></li><li><a href="https://docs.zerotier.com/awesome#zerotier-youtube">ZeroTier YouTube</a><blockquote><p><strong>NEXT STEPS</strong><br>Click <a href="">here</a> to create your network and start adding devices.</p><h3 id="ZeroTier-Self-Hosting"><a href="#ZeroTier-Self-Hosting" class="headerlink" title="ZeroTier Self-Hosting"></a>ZeroTier Self-Hosting</h3><h4 id="Self-Hosting-Network-Controller-Interfaces"><a href="#Self-Hosting-Network-Controller-Interfaces" class="headerlink" title="Self-Hosting Network Controller Interfaces"></a>Self-Hosting Network Controller Interfaces</h4></blockquote></li><li><a href="https://github.com/key-networks/ztncui">key-networks / ztncui</a> - GUI for self-hosted ZeroTier.</li><li><a href="https://github.com/key-networks/ztncui-aio">key-networks / ztncui-aio</a> - ZeroTier network controller user interface in a Docker container.</li><li><a href="https://github.com/thedunston/bash_cli_zt">thedunston / bash_cli_zt</a> - Command Line interface for self-hosted ZeroTier.</li><li><a href="https://github.com/dec0dOS/zero-ui">dec0dOS / zero-ui</a> - GUI for self-hosted ZeroTier.</li><li><a href="https://hub.docker.com/r/mdplusplus/zerotier-network-controller-ui">mdplusplus/zerotier-network-controller-ui</a> - Docker image for self-hosted ZeroTier.<h4 id="Self-Hosting-article"><a href="#Self-Hosting-article" class="headerlink" title="Self-Hosting article"></a>Self-Hosting article</h4></li><li><a href="https://www.exclusionzone.org/2019/12/10/zerotier-the-dorknet-rises/">zero - The Dorknet rises</a> - Self-hosted ZeroTier on OPNsense.</li><li><a href="https://medium.com/iotops/from-zero-to-zerotier-in-k3s-way-eadff5745566">From zero to Zerotier in k3s way</a> - Self-hosted ZeroTier on a Raspberry Pi, using k3s.<h4 id="Self-Hosting-videos"><a href="#Self-Hosting-videos" class="headerlink" title="Self-Hosting videos"></a>Self-Hosting videos</h4></li><li><a href="https://www.youtube.com/watch?v=oC7y_qYKUTU">DB Tech - ZeroTier Network Controller in Docker</a> - Self-hosted ZeroTier on Docker.<h3 id="ZeroTier-Training"><a href="#ZeroTier-Training" class="headerlink" title="ZeroTier Training"></a>ZeroTier Training</h3><h4 id="ZeroTier-Training-courses"><a href="#ZeroTier-Training-courses" class="headerlink" title="ZeroTier Training courses"></a>ZeroTier Training courses</h4></li><li><a href="https://www.cbtnuggets.com/it-training/skills/securely-connect-local-network-devices-aws-vpczerotier">CBT Nuggets - Securely Connect Local Network Devices to AWS VPC with ZeroTier</a><h3 id="ZeroTier-Networking"><a href="#ZeroTier-Networking" class="headerlink" title="ZeroTier Networking"></a>ZeroTier Networking</h3><h4 id="Networking-articles"><a href="#Networking-articles" class="headerlink" title="Networking articles"></a>Networking articles</h4></li><li><a href="https://dev.to/issmirnov/abusing-public-dns-for-zerotier-routing-36ke">Abusing Public DNS for Zerotier Routing</a></li><li><a href="https://www.petekeen.net/building-a-private-backplane-network-with-zerotier">Building a Private Backplane Network for your VPSs with ZeroTier | Pete Keen</a></li><li><a href="https://dzone.com/articles/creating-secure-private-networks-with-zerotier-vpn">Creating Secure Private Networks With ZeroTier VPN</a></li><li><a href="https://www.linkedin.com/pulse/creating-site-to-site-vpn-zerotier-bgp-robert-lynch/">Creating a Site-to-Site VPN with ZeroTier and BGP</a></li><li><a href="https://blog.fosketts.net/2022/01/14/how-to-connect-everything-from-everywhere-with-zerotier/">How To Connect Everything From Everywhere with ZeroTier</a></li><li><a href="https://www.danmanners.com/posts/2021-12-multi-cloud-k3s-and-booted-from-gcloud/">Multi-Cloud K3s, and also I got (temporarily) kicked off Google Cloud</a></li><li><a href="https://stubarea51.net/2021/11/23/network-modeling-segmented-lab-access-with-containerlab-and-zerotier">Network Modeling: Segmented Lab access with Containerlab and ZeroTier</a></li><li><a href="https://chrisatech.wordpress.com/2021/02/22/routing-traffic-to-zerotiers-subnet-from-all-devices-on-the-lan/">Routing traffic to ZeroTier’s subnet from all devices on the LAN</a><h4 id="Networking-articles-global"><a href="#Networking-articles-global" class="headerlink" title="Networking articles global"></a>Networking articles global</h4></li><li><a href="https://jiayaoo3o.github.io/2020/06/11/%E6%AF%94frp%E6%9B%B4%E5%A5%BD%E7%94%A8%E7%9A%84%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7-ZeroTier%20One/#more">比frp更好用的内网穿透工具-ZeroTier One</a></li><li><a href="https://blog.toolman.xyz/article/240">zerotier 基礎使用步驟教學</a></li><li><a href="https://cerebrux.net/2021/10/24/zerotier-%ce%b4%ce%b9%ce%ba%cf%84%cf%8d%cf%89%cf%83%ce%b7-%ce%b1%cf%80%ce%bf%ce%bc%ce%b1%ce%ba%cf%81%cf%85%cf%83%ce%bc%ce%ad%ce%bd%cf%89%ce%bd-%cf%83%cf%85%cf%83%ce%ba%ce%b5%cf%85%cf%8e%ce%bd/">ZeroTier | Δικτύωση απομακρυσμένων Linux, Windows, macOS, BSD, Android, iOS συσκευών</a><h4 id="Networking-videos"><a href="#Networking-videos" class="headerlink" title="Networking videos"></a>Networking videos</h4></li><li><a href="https://www.youtube.com/watch?v=Af758HL6VkA">Considered Normal? - Creating a Local LAN with ZeroTier</a></li><li><a href="https://www.youtube.com/watch?v=xp2ujXe1SOU">Duane Dunston - Private ZeroTier Network on the Public Internet</a></li><li><a href="https://www.youtube.com/watch?v=Fb65bU3oyEo">Duane Dunston - ZeroTier Hub and Spoke</a></li><li><a href="https://www.youtube.com/watch?v=XrLk21Xy2i0">Eric Sloof - ZeroTier - The ethernet switch for planet earth</a></li><li><a href="https://www.youtube.com/watch?v=JwGKi3UWJ_I">infoTK - Finally ! work from home using VPN free and without Public IP</a></li><li><a href="https://www.youtube.com/watch?v=eI-yxrMH3uY">MRP - Local Network everywhere - Zero Tier : Global Area Networking</a></li><li><a href="https://www.youtube.com/watch?v=Lao9T_RQTak">Network Collective - How Does ZeroTier Actually Work?</a></li><li><a href="https://www.youtube.com/watch?v=QfcwiSkV_AU">Lawrence Systems - Open Source Mesh VPN Solutions</a></li><li><a href="https://www.youtube.com/watch?v=Bl_Vau8wtgc">Lawrence Systems - ZeroTier Tutorial: Delivering the Capabilities of VPN, SDN, and SD-WAN via an Open Source System</a></li><li><a href="https://www.youtube.com/watch?v=9GTXN0opsdw">LearnLinuxTV - Networking with ZeroTier: Creating software-defined networks with Ease</a></li><li><a href="https://www.youtube.com/watch?v=1Sobvh6OiC8">Sheridan Computers - ZeroTier | Virtual Networking | Remote Desktop | Remote Working | VPN</a><h4 id="Networking-videos-global"><a href="#Networking-videos-global" class="headerlink" title="Networking videos global"></a>Networking videos global</h4></li><li><a href="https://www.youtube.com/watch?v=7tN9iw7FIo4">ADINATA - ZeroTier Solusi Remote Perangkat Aman Dan Nyaman Untuk Pengguna Internet Broadband Dan Dedicated</a></li><li><a href="https://blog.ayudait.eu/2020/11/usando-zerotier-one-y-nextdns.html">Usando ZeroTier One y NextDNS para acceder a tus datos por VPN</a></li><li><a href="https://www.youtube.com/watch?v=ZtXhZCkxaak">NASeros - Incorporación de un ordenador a ZeroTier</a></li><li><a href="https://www.youtube.com/watch?v=z8N1NeYORbM">Servicios Virtuales Administrados SVA - Multi Usuario RDP/VPN ZeroTier — CURSO GRATUITO</a></li><li><a href="https://www.youtube.com/watch?v=Pk5EXqNLFzA&amp;t=1s">Software Defined Networks with ZeroTier | Urdu</a></li><li>[VPN multisitio con ZeroTier]<a href="https://www.youtube.com/watch?v=ZDcwKQM1J4s&amp;t=2s">(</a>)</li><li><a href="https://www.youtube.com/watch?v=LHilEAF5S2U&amp;t">Zerotier: la Terra è il tuo ufficio (sicuro e privato)</a><h3 id="ZeroTier-Linux"><a href="#ZeroTier-Linux" class="headerlink" title="ZeroTier Linux"></a>ZeroTier Linux</h3></li><li><a href="https://github.com/Duoslow/zerotierIndicator">Duoslow / zerotierIndicator</a><h4 id="Linux-articles"><a href="#Linux-articles" class="headerlink" title="Linux articles"></a>Linux articles</h4></li><li><a href="https://www.simplecto.com/zerotier-jq-manage-zerotier-networks/">Curl and jq to Manage ZeroTier networks</a></li><li><a href="https://www.greghilston.com/post/install_zerotier/">Install Zerotier CLI Linux</a><h4 id="Linux-videos"><a href="#Linux-videos" class="headerlink" title="Linux videos"></a>Linux videos</h4></li><li><a href="https://www.youtube.com/watch?v=9KMHwCUzf4g">Roel Van de Paar - Install ZeroTier on Ubuntu with armhf hardware</a><h3 id="ZeroTier-Remote-Access"><a href="#ZeroTier-Remote-Access" class="headerlink" title="ZeroTier Remote Access"></a>ZeroTier Remote Access</h3><h4 id="Remote-Access-articles"><a href="#Remote-Access-articles" class="headerlink" title="Remote Access articles"></a>Remote Access articles</h4></li><li><a href="https://john.muchovej.com/thoughts/remote-access-without-port-forwarding/">Remote Access Without Port Forwarding</a></li><li><a href="https://www.spikefishsolutions.com/post/setting-up-remote-access-during-a-crisis">Setting up Remote Access During a Crisis</a></li><li><a href="https://www.stratospherix.com/support/how-to-access-your-files-from-anywhere-with-zerotier.php">Stratospherix FileBrowser - How to access your files from anywhere</a><h4 id="Remote-Access-articles-global"><a href="#Remote-Access-articles-global" class="headerlink" title="Remote Access articles global"></a>Remote Access articles global</h4></li><li><a href="https://www.canaletto.fr/post/teletravail-rdp-vpn">Télétravail, RDP &amp; VPN</a></li><li><a href="https://www.clien.net/service/board/park/14534750">zerotier 팀뷰어만 되는 환경에서 사용하니 정말 좋군요.</a><h4 id="Remote-Access-videos"><a href="#Remote-Access-videos" class="headerlink" title="Remote Access videos"></a>Remote Access videos</h4></li><li><a href="https://www.youtube.com/watch?v=ZShna7v77xc">Lawrence Systems - How To Work Remotely Using ZeroTier &amp; Windows Remote Desktop (RDP)</a></li><li><a href="https://www.youtube.com/watch?v=EgdFzxit_6M">Odly Otter - Setting up ZeroTier to securely connect to your home server while roaming</a></li><li><a href="https://www.youtube.com/watch?v=7C2AGnr9Q-w">Remote Access: Securely connect your devices over the internet with ZeroTier</a></li><li><a href="https://www.youtube.com/watch?v=bUOU8BW0IrM">The Cyber Mentor - Hack From Anywhere! - ZeroTier Remote Access</a><h3 id="ZeroTier-SD-WAN"><a href="#ZeroTier-SD-WAN" class="headerlink" title="ZeroTier SD-WAN"></a>ZeroTier SD-WAN</h3><h4 id="SD-WAN-articles"><a href="#SD-WAN-articles" class="headerlink" title="SD-WAN articles"></a>SD-WAN articles</h4></li><li><a href="https://www.linkedin.com/pulse/consumer-grade-sd-wan-solution-improve-mobile-jonathan-gearinger/">A consumer-grade SD-WAN solution to improve mobile internet</a></li><li><a href="https://know.innon.com/vpn-zerotier-and-teltonika">How do I create a VPN/SD-WAN with Zerotier and Teltonika?</a></li><li><a href="https://foro.seguridadwireless.net/openwrt/vpn-con-zerotier-en-openwrt/">ZeroTier on OpenWrt (VPN + SD-WAN)</a><h4 id="SD-WAN-videos"><a href="#SD-WAN-videos" class="headerlink" title="SD-WAN videos"></a>SD-WAN videos</h4></li><li><a href="https://www.youtube.com/watch?v=dn8rFCttJVg">Profitap HQ B.V - How to Connect IOTA to ZeroTier SD-WAN environment</a></li><li><a href="https://www.youtube.com/watch?v=pntbQBtneZg">SecurityGuy - Hands-on with ZeroTier SD-WAN for Cloud Connectivity</a><h4 id="SD-WAN-videos-global"><a href="#SD-WAN-videos-global" class="headerlink" title="SD-WAN videos global"></a>SD-WAN videos global</h4></li><li><a href="https://www.youtube.com/watch?v=pM2ZQ9trcM8">LACNIC RIR - ZeroTier - Usando una solución Open Source para integrar VPNs e iniciar operaciones SD-WAN</a><h3 id="ZeroTier-IoT"><a href="#ZeroTier-IoT" class="headerlink" title="ZeroTier IoT"></a>ZeroTier IoT</h3></li></ul><h2 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h2><h3 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h3><p><a href="https://github.com/zerotier/">github.com/zerotier/zerotierone</a></p><blockquote><p><strong>NEXT STEPS</strong><br>Click <a href="https://docs.zerotier.com/start/">here</a> to create your network and start adding devices.</p></blockquote><h2 id="Releases"><a href="#Releases" class="headerlink" title="Releases"></a>Releases</h2><blockquote><p><strong>BEFORE DOWNLOADING</strong><br>Click <a href="https://docs.zerotier.com/start/">here</a> to create your network and then start adding devices.</p><h3 id="Downloads-Page"><a href="#Downloads-Page" class="headerlink" title="Downloads Page"></a>Downloads Page</h3><p><a href="http://www.zerotier.com/download">http://www.zerotier.com/download</a></p><h3 id="Past-versions-of-ZeroTier"><a href="#Past-versions-of-ZeroTier" class="headerlink" title="Past versions of ZeroTier"></a>Past versions of ZeroTier</h3><p><a href="http://download.zerotier.com/RELEASES/">download.zerotier.com/RELEASES/</a></p><h3 id="Release-Notes"><a href="#Release-Notes" class="headerlink" title="Release Notes"></a>Release Notes</h3><p><a href="https://github.com/zerotier/ZeroTierOne/blob/dev/RELEASE-NOTES.md">github.com/zerotier/zerotierone</a></p></blockquote><h1 id="How-ZeroTier-Works"><a href="#How-ZeroTier-Works" class="headerlink" title="How ZeroTier Works"></a>How ZeroTier Works</h1><p>Our installable client service.</p><h2 id="The-Protocol"><a href="#The-Protocol" class="headerlink" title="The Protocol"></a>The Protocol</h2><p>ZeroTier is a smart programmable Ethernet switch for planet Earth. It allows all networked devices, VMs, containers, and applications to communicate as if they all reside in the same physical data center or cloud region.</p><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p>ZeroTier is a distributed network hypervisor built atop a cryptographically secure global peer to peer network. It provides advanced network virtualization and management capabilities on par with an enterprise SDN switch, but across both local and wide area networks and connecting almost any kind of app or device.<br>This is accomplished by combining a cryptographically addressed and secure peer to peer network (termed VL1) with an Ethernet emulation layer somewhat similar to VXLAN (termed VL2). Our VL2 Ethernet virtualization layer includes advanced enterprise SDN features like fine grained access control rules for network micro-segmentation and securty monitoring.<br>All ZeroTier traffic is encrypted end-to-end using secret keys that only you control. Most traffic flows peer to peer, though we offer free (but slow) relaying for users who cannot establish peer to peer connections.<br>Everything in the ZeroTier world is controlled by two types of identifier: 40-bit/10-digit <em>ZeroTier address</em> and 64-bit/16-digit <em>network IDs</em>. These identifiers are easily distinguished by their length. A ZeroTier address identifies a node or “device”(laptop, phone, server, VM, app, etc.) while a network ID identifies a virtual Ethernet network that can be joined by devices.<br>ZeroTier addresses can be thought of as port numbers on an enormous planet-wide enterprise Ethernet smart switch supporting VLANs. Network IDs are VLAN IDs to which these ports may be assigned. A single port can be assigned to more than one VLAN.<br>A ZeroTier address looks like <code>8056c2e21c</code> and a network ID looks like <code>8056c2e21c000001</code>. Network IDs are composed of the ZeroTier address of that network’s primary controller and an arbitrary 24-bit ID that identifies the network on this controller. Network controllers are roughly analogous to SDN controllers in SDN protocols like <a href="https://en.wikipedia.org/wiki/OpenFlow">OpenFlow</a>, though as with the analogy between VXLAN and VL2 this should not be read to imply that the protocols or design are the same. You can use our convenient and inexpensive SaaS hosted controllers at <a href="https://my.zerotier.com/">my.zerotier.com</a> or <a href="https://github.com/zerotier/ZeroTierOne/controller/">run your own controller</a> if you don’t mind messing around with JSON configuration files or writing scripts to do so.</p><blockquote><p><strong>INFO</strong><br>Visit <a href="https://www.zerotier.com/">ZeroTier’s site</a> for more information and <a href="https://www.zerotier.com/download/">pre-built binary packages</a>. Apps for Android and iOS are available for free in the Google Play and Apple app stores.</p></blockquote><h3 id="Origin-and-Design-Philosophy"><a href="#Origin-and-Design-Philosophy" class="headerlink" title="Origin and Design Philosophy"></a>Origin and Design Philosophy</h3><p>The goals and design principles of ZeroTier are inspired by among other things the original <a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/43231.pdf">Google BeyondCorp</a> paper and the <a href="https://en.wikipedia.org/wiki/Jericho_Forum">Jericho Forum</a> with its notion of “deperimeterizationg.”</p><h3 id="Network-Hypervisor"><a href="#Network-Hypervisor" class="headerlink" title="Network Hypervisor"></a>Network Hypervisor</h3><p>The ZeroTier network hypervisor (currently found in the <a href="https://github.com/zerotier/ZeroTierOne/tree/master/node">node/</a> subfolder of the ZeroTierOne git repository) is a self-contained network virtualization engine that implements an Ethernet virtualization layer similar to <a href="https://en.wikipedia.org/wiki/Virtual_Extensible_LAN">VXLAN</a> on top of a global encrypted peer to peer network.<br>The ZeroTier protocol is original, though aspects of it are similar to VXLAN and IPSec. It has two conceptually separate but closely coupled layer <a href="https://en.wikipedia.org/wiki/OSI_model">in the OSI model</a> sense: <strong>VL1</strong> and <strong>VL2</strong>. VL1 is the underlying peer to peer transport layer, the “virtual wire,” while VL2 is an emulated Ethernet layer that provides operating systems and apps with a familiar communication medium.</p><h3 id="The-ZeroTier-Peer-to-Peer-Network-VL1"><a href="#The-ZeroTier-Peer-to-Peer-Network-VL1" class="headerlink" title="The ZeroTier Peer to Peer Network (VL1)"></a>The ZeroTier Peer to Peer Network (VL1)</h3><p>A global data center requires a global wire closet.<br>In conventional networks L1 (OSI layer 1) refers to the actual CAT5/CAT6 cables or wireless radio channels over which data is carried and the physical transceiver chips that modulate and demodulate it. VL1 is a peer to peer network that does the same thing by using encryption, authentication, and a lot of networking tricks to create virtual wires on a dynamic as-needed basis.</p><h3 id="Network-Topology-and-Peer-Discovery"><a href="#Network-Topology-and-Peer-Discovery" class="headerlink" title="Network Topology and Peer Discovery"></a>Network Topology and Peer Discovery</h3><p>VL1 is designed to be zero-configuration. A user can start a new ZeroTier node without having to write configuration files or provide the IP addresses of other nodes. It’s also designed to be fast. Any two devices in the world should be able to locate each other and communicate almost instantly.<br>To achieve this VL1 is organized like DNS. At the base of the network is a collection of always-present <strong>root servers</strong> whose role is similar to that of <a href="https://en.wikipedia.org/wiki/Root_name_server">DNS root name servers.</a> Roots run the same software as regular endpoints but reside at fast stable locations on the network and are designated as such by a <strong>world definition</strong>. World definitions come in two forms: the <strong>planet</strong> and one or more <strong>moons</strong>. The protocol includes a secure mechanism allowing world definitions to be updated in-band if root servers’ IP addresses or ZeroTier addresses change.<br>There is only one planet. Earth’s root servers are operated by ZeroTier, Inc. as a free service. There are currently four root servers distributed across the globe and multiple network providers. Almost everyone in the wrold has one within less than 100ms network latency from their location.<br>A node can “orbit” any number of moons. A moon is just a convenient way to add user-defined root servers to the pool. Users can create moons to reduce dependency on ZeroTier, Inc. infrastructure or to locate root servers closer for better performance. For on-premise SDN use a cluster of root servers can be located inside a building or data center so that ZeroTier can continue to operate normally if Internet connectivity is lost.<br>Nodes start with no direct links to one another, only upstream to roots (planet and moons). Every peer on VL1 possesses a globally unique 40-bit (10 hex digit) <strong>ZeroTier address</strong>, but unlike IP addresses these are opaque cryptographic identifiers that encode no routing information. To communicate peers first send packets “up” the tree, and as these packets traverse the network they trigger the opportunistic creation of direct links along the way. The tree is constantly trying to “collapse itself” to optimize itself to the pattern of traffic it is carrying.<br>Peer to peer connection setup goes like this:</p><ol><li>A wants to send a packet to B, but since it has no direct path it sends it upstream to R (a root).</li><li>If R has a direct link to B, it forwards the packet there. Otherwise it sends the packet upstream until planetary roots are reached. Planetary roots know about all nodes, so eventually the packet will reach B if B is online.</li><li>R also sends a message called <em>rendezvous</em> to A containing hints about how it might reach A.</li><li>A and B get their <em>rendezous</em> messages and attempt to send test messages to each other, possibly accomplishing <a href="https://en.wikipedia.org/wiki/UDP_hole_punching">hole punching</a> of any NATs or stateful firewalls that happen to be in the way. If this works a direct link is established and packets no longer need to take the scenic route.</li></ol><p>Since roots forward packets, A and B can reach each other instantly. A and B then begin attempting to make a direct peer to peer connection. If this succeeds it results in a faster lower latency like. We call this <em>transport triggered link provisioning</em> since it’s the forwarding of the packet itself that triggers the peer to peer network to attempt direct connection.<br>VL1 never gives up. If a direct path can’t be established, communication can continue through (slower) relaying. Direct connection attempts continue forever on a periodic basis. VL1 also has other features for establishing direct connectivity including LAN peer discovery, port prediction for traversal of symmetric IPv4 NATs, and explicit port mapping using uPnP and/or NAT-PMP if these are available on the local physical LAN.<br><em><a href="http://adamierymenko.com/decentralization.html">A blog post from 2014 by ZeroTier’s original author explains some of the reasoning behind VL1’s design.</a></em></p><h3 id="Addressing"><a href="#Addressing" class="headerlink" title="Addressing"></a>Addressing</h3><p>Every node is uniquely identified on VL1 by a 40-bit (10 hex digit) <strong>ZeroTier address</strong>. This address is computed from the public portion of public/provate key pair. A node’s address, public key, and private key together form its <strong>identity</strong>.<br><em>On devices running ZeroTier One the node identity is stored in <code>identity.public</code> and <code>identity.secret</code> in the service’s home directory.</em><br>When ZeroTier starts for the first time it generates a new identity. It then attempts to advertise it upstream to the network. In the very unlikely event that the identity’s 40-bit unique address is taken, it discards it and generates another.<br>Identities are claimed on a first come first serve basis and currently expire from planetary roots after 60 days of inactivity. If a long-dormant device returns it may re-claim its identity unless its address has been taken in the meantime (again, highly unlikely).<br>The address derivation algorithm used to compute addresses from public keys imposes a computational cost barrier against the intentional generation of a collision. Currently it would take approximately 10,000 CPU-years to do so (assuming e.g. a 3ghz intel core). This is expensive but not impossible, but it’s only the first line of defense. After generating a collision an attacker would then have to compromise all upstream nodes, network controllers, and anything else that has recently communicated with the target node and replace their cached identities.<br>ZeroTier addresses are, once advertised and claimed, a very secure method of unique identification.<br>When a node attempts to send a message to another node whose identity is not cached, it sends a <em>whois</em> query upstream to a root. Roots provide an authoritative identity cache.</p><h3 id="Cryptography"><a href="#Cryptography" class="headerlink" title="Cryptography"></a>Cryptography</h3><p>If you don’t know much about cryptography you can safely skip this section. <strong>TL;DR: packets are end-to-end encrypted and can’t be read by roots or anyone else, and we use modern 256-bit crypto in ways recommended by the professional cryptographers that created it.</strong><br>Asymmetric public key encryption is <a href="https://en.wikipedia.org/wiki/Curve25519">Curve25519/Ed25519</a>, a 256-bit elliptic curve variant.<br>Every VL1 packet is encrypted end to end using (as of the current version) 256-bit <a href="https://ianix.com/pub/salsa20-deployment.html">Salsa20</a> and authenticated using the <a href="https://en.wikipedia.org/wiki/Poly1305">Poly1305</a> message authentication (MAC) algorithm. MAC is computed after encryption <a href="https://tonyarcieri.com/all-the-crypto-code-youve-ever-written-is-probably-broken">(encrypt-then-MAC)</a> and the cipher/MAC composition used is identical to the <a href="https://nacl.cr.yp.to/">NaCI reference implementation</a>.<br>As of today we do not implement <a href="https://en.wikipedia.org/wiki/Forward_secrecy">forward secrecy</a> or other stateful cryptographic features in VL1. We don’t do this for the sake of simplicity, reliability, and code footprint, and because frequently changing state makes features like clustering and fail-over much harder to implement. See <a href="https://github.com/zerotier/ZeroTierOne/issues/204">our discussion on GitHub</a>.<br>We may implement forward secrecy in the future. For those who want this level of security today, we recommend using other cryptographic protocols such as SSL or SSH over ZeroTier. These protocols typically implement forward secrecy, but using them over ZeroTier also provides the secondary benefit of defense in depth. Most cryptography is compromised not by a flaw in encryption bu through bugs in the implementation. If you’re using two secure transports, the odds of a critical bug being discovered in both at the same time is very low. The CPU overhead of double-encryption is not significant for most work loads.</p><blockquote><p><strong>SECURITY</strong><br><a href="https://docs.zerotier.com/faq-security">More information on ZeroTier’s security practices</a></p></blockquote><h3 id="Trusted-Paths-for-Fast-Local-SDN"><a href="#Trusted-Paths-for-Fast-Local-SDN" class="headerlink" title="Trusted Paths for Fast Local SDN"></a>Trusted Paths for Fast Local SDN</h3><p>To support the use of ZeroTier as a high performance SDN/NFV protocol over physically secure network the protocol supports a feature called <em>trusted paths</em>. It is possible to configure all ZeroTier devices on a given network to skip encryption and authentication for traffic over a designated physical path. This can cut CPU use noticeably in high traffic scenarios but at the cost of losing virtually all transport security.<br>Trusted paths do not prevent communication with devices elsewhere, since traffic over other paths will be encrypted and authenticated normally.<br>We don’t recommend the use of this feature unless you really need the performance and you know what you’re doing. We also recommend thinking carefully before disabling transport security on a cloud private network. Larger cloud providers such as Amazon and Azure tend to provide good network segregation but many less costly providers offer private networks that are “party lines” and are not much more secure than the open Internet.</p><h3 id="Multipath"><a href="#Multipath" class="headerlink" title="Multipath"></a>Multipath</h3><p>Multipath allows the simultaneous (or conditional) aggregation of multiple physical links into a bond for increased total throughput, load balancing, redundancy, and fault tolerance. There is a set of standard bonding policies available that can be used right out of the box with no configuration. These policies are inspired by the policies offered by the Linux kernel. A bonding policy can be used easily without specifying any additional parameters.</p><blockquote><p><strong>MULTIPATH GUIDE</strong></p><ul><li>See <a href="https://docs.zerotier.com/multipath">here</a> for more info and examples.</li></ul></blockquote><h3 id="Ethernet-Virtualization-Layer-VL2"><a href="#Ethernet-Virtualization-Layer-VL2" class="headerlink" title="Ethernet Virtualization Layer (VL2)"></a>Ethernet Virtualization Layer (VL2)</h3><p><strong>VL2</strong> is a <a href="https://en.wikipedia.org/wiki/Virtual_Extensible_LAN">VXLAN</a>-like network virtualization protocol with SDN management features. It implements secure VLAN boundaries, multicast, rules, capability based security, and certificate based access control.<br>VL2 is built atop and carried by VL1, and in so doing it inherits VL1’s encryption and endpoint authentication and can use VL1 asymmetric keys to sign and verify credentials. VL1 also allows us to implement VL2 entirely free of concern for underlying physical network topology. Connectivity and routing efficiency issues are VL1 concerns. It’s important to understand that there is no relationship between VL2 virtual networks and VL1 paths. Much like VLAN multiplexing on a wired LAN, two nodes that share multiple network memberships in common will still only have one VL1 path (virtual wire) between them.</p><h3 id="Network-Identifiers-and-Controllers"><a href="#Network-Identifiers-and-Controllers" class="headerlink" title="Network Identifiers and Controllers"></a>Network Identifiers and Controllers</h3><p>Each VL2 network (VLAN) is identified by a 64-bit (16 hex digit) <strong>ZeroTier network ID</strong> that contains the 40-bit ZeroTier address of the network’s <strong>controller</strong> and a 24-bit number identifying the network on the controller.<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">Network ID: 8056c2e21c123456<br>            |<span class="hljs-string">         </span>|<br>            |<span class="hljs-string">         Network number on controller</span><br><span class="hljs-string">            </span>|<br>            ZeroTier address of controller<br></code></pre></td></tr></table></figure><br>When a node joins a network or requests a network configuration update, it sends a network config query message (via VL1) to the network’s controller. The controller can then use the node’s VL1 address to look it up on the network and send it the appropriate certificates, credentials, and configuration information. From the perspective of VL2 virtual networks, VL1 ZeroTier addresses can be thought of as port numbers on an enormous global-scale virtual switch.<br>A common misunderstanding is to conflate network controllers with root servers (planet and moons). Root servers are connection facilitators that operate at the VL1 level. Network controllers are configuration managers and certificate authorities that belong to VL2. Generally root servers don’t join or control virtual networks and network controllers are not root servers, though it is possible to have a node do both.</p><h4 id="Controller-Security-Considerations"><a href="#Controller-Security-Considerations" class="headerlink" title="Controller Security Considerations"></a>Controller Security Considerations</h4><p>Network controllers serve as certificate authorities for ZeroTier virtual networks. As such, their <code>identity.secret</code> files should be guarded closely and backed up securely. Compromise of a controller’s secret key would allow an attacker to issue fraudulent network configurations or admit unauthorized members, while loss of the secret key results in loss of ability to control the network in any way or issue configuration updates and effectively renders the network unusable.<br>It is important that controllers’ system clocks remain relatively accurate (to within 30-60 seconds) and that they are secure against against remote tampering. Many cloud providers provide secure time sources either directly via the hypervisor or via NTP servers within their networks.</p><h3 id="Certificates-and-Other-Credentials"><a href="#Certificates-and-Other-Credentials" class="headerlink" title="Certificates and Other Credentials"></a>Certificates and Other Credentials</h3><p>All credentials issued by network controllers to member nodes in a given network are signed by the controller’s secret key to allow all network members to verify them. Credentials have timestamp fields populated by the controller, allowing relative comparison without the need to trust the node’s local system clock.<br>Credentials are issued only to their owners and are then pushed peer to peer by nodes that wish to communicate with other nodes on the network. This allows networks to grow to enormous sizes without requiring nodes to cache large numbers of credentials or to constantly consult the controller.</p><h4 id="Credential-Types"><a href="#Credential-Types" class="headerlink" title="Credential Types"></a>Credential Types</h4><ul><li><strong>Certificates of Membership</strong>: a certificate that a node presents to obtain the riht to communicate on a given network. Certificates of membership are accepted if they <em>agree</em>, meaning that the submitting member’s certificate’s timestamp differs from the recipient’s certificate’s timestamp by no more than the recipient certificate’s maximum timestamp delta value. This creates a decentralized moving-window scheme for certificate expiration without requiring node clock synchronization or constant checking with the controller.</li><li><strong>Revocations</strong>: a revocation instantaneously revokes a given credential by setting a hard timestamp limit before which it will not be accepted. Revocations are rapidly propagated peer to peer among members of a network using a rumor mill algorithm, allowing a controller to revoke a member credential across the entire network even if its connection to some members is unreliable.</li><li><strong>Capabilities</strong>: a capability is a bundle of network rules that is signed by the controller and can be presented to other members of a network to grant the presenter elevated privileges within the framwork of the network’s base rule set. More on this in the section on rules.</li><li><strong>Tags</strong>: a tag is a key/value pair signed by the controller that is automatically presented by members to one another and can be matched on in base or capability network rules. Tags can be used to categorize members by role, department, classification, ect.</li><li><strong>Certificates of Ownership</strong>: these certify that a given netwrok member owns something, such as an IP address. These are currently only used to lock down netwroks against IP address spoofing but could be used in the future to certify ownership of other network-level entities that can be matched in a filter.</li></ul><h3 id="Multicast-ARP-NDP-and-Special-Addressing-Modes"><a href="#Multicast-ARP-NDP-and-Special-Addressing-Modes" class="headerlink" title="Multicast, ARP, NDP, and Special Addressing Modes"></a>Multicast, ARP, NDP, and Special Addressing Modes</h3><p>ZeroTier netwroks support multicast via a simple publish/subscribe system.<br>When a node wishes to receive multicasts for a given multicast group, it advertises membership in this group to other members of the network with which it is communicating and to the network controller. When a node wishes to send a multicast it both consults its cache of recent advertisements and periodically solicits additional advertisements.<br>Broadcast (Ethernet <em>ff:ff:ff:ff:ff:ff</em>) is treated as a multicast group to which all members subscribe. It can be disabled at the network level to reduce traffic if it is not needed. IPv4 ARP receives special handling (see below) and will still work if normal broadcast is disabled.<br>Multicasts are propagated using simple sender-side replication. This places the full outbound bandwidth load for multicast on the sender and minimizes multicast latency. Network configurations contain a network-wide <strong>multicast limit</strong> configurable at the network controller. This specifies the maximum number of other nodes to which any node will send a multicast. If the number of known recipients in a given multicast group exceeds the multicast limit, the sender chooses a random subset.<br>There is no global limit on multicast recipients, but setting the multicast limit very high on very large networks could result in significant bandwidth overhead.</p><h4 id="Special-Handling-of-IPv4-ARP-Broadcasts"><a href="#Special-Handling-of-IPv4-ARP-Broadcasts" class="headerlink" title="Special Handling of IPv4 ARP Broadcasts"></a>Special Handling of IPv4 ARP Broadcasts</h4><p>IPv4 <a href="https://en.wikipedia.org/wiki/Address_Resolution_Protocol">ARP</a> is built on simple Ethernet broadcast and scales poorly on large or distributed networks. To improve ARP’s scalability ZeroTier generates a unique multicast group for each IPv4 address detected on its system and then transparently intercepts ARP queries and sends them only to the correct group. This converts ARP into effectively a unicast or narrow multicast protocol (like IPv6 NDP) and allows IPv4 ARP to work reliably across wide area networks without excess bandwidth consumption. A similar strategy is implemented under the hood by a number of enterprise switches and WiFi routers designed for deployment on extremely large LANs. This ARP emulation mode is transparent to the OS and application layers, but it does mean that packet sniffers will not see all ARP queries on a virtual network the way they typically can on smaller wired LANs.</p><h4 id="Multicast-Free-IPv6-Addressing-Modes"><a href="#Multicast-Free-IPv6-Addressing-Modes" class="headerlink" title="Multicast-Free IPv6 Addressing Modes"></a>Multicast-Free IPv6 Addressing Modes</h4><p>IPv6 uses a protocol called <a href="https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol">NDP</a> in place of ARP. It is similar in role and design but uses narrow multicast in place of broadcast for superior scalability on large networks. This protocol nevertheless still imposes the latency of an additional multicast lookup whenever a new address is contacted. This can add hundreds of milliseconds over a wide area network, or more if latencies associated with pub/sub recipient lookup are significant.<br>IPv6 addresses are large enough to easily encode ZeroTier addresses. For faster operation and better scaling we’ve implemented several special IPv6 addressing modes that allow the local node to emulate NDP. These are ZeroTier’s <strong>rfc4193</strong> and <strong>6plane</strong> IPv6 address assignment schemes. If these addressing schemes are enabled on a network, nodes locally intercept outbound NDP queries for matching addresses and then locally generate spoofed NDP replies.<br>Both modes dramatically reduce initial connection latency between network members. <strong>6plane</strong> additionally exploits NDP emulation to transparently assign an entire IPv6 /80 prefix to every node without requiring any node to possess additional routing table entries. This is designed for virtual machine and container hosts that wish to auto-assign IPv6 addresses to guests and is very useful on microservice architecture backplane networks.<br>Finally there is a security benefit to NDP emulation. ZeroTier addresses are cryptographically authenticated, and since Ethernet MAC addresses on networks are computed from ZeroTier addresses these are also secure. NDP emulated IPv6 addressing modes are therefore not vulnerable to NDP reply spoofing.<br>Normal non-NDP-emulated IPv6 addresses (including link-local addresses) can coexist with NDP-emulated addressing schemes. Any NDP queries that do not match NDP-emulated addresses are sent via normal multicast.</p><h3 id="Ethernet-Bridging"><a href="#Ethernet-Bridging" class="headerlink" title="Ethernet Bridging"></a>Ethernet Bridging</h3><p>ZeroTier emulates a true Ethernet switch. This includes the ability to L2 bridge other Ethernet networks (wired LAN, WiFi, virtual backplanes, etc.) to virtual networks using conventional Ethernet bridging.<br>To act as a bridge a network member must be designated as such by the controller. This is for security reasons as normal network members are not permitted to send traffic from any origin other than their MAC address. Designated bridges also receive special treatment from the multicast algorithm, which more aggressively and directly queries them for group subscriptions and replicates all broadcast traffic and ARP requests to them. As a result bridge nodes experience a slightly higher amount of multicast bandwidth overhead.<br>Bridging has been tested extensively on Linux using the Linux kernel native bridge, which cleanly handles network MTU mismatch. There are third party reports of bridging working on other platforms. The details of setting up bridging, including how to selectively block traffic like DHCP that may not be wanted across the bridge, are beyond the scope of this manual.</p><blockquote><p><strong>GUIDE</strong><br>See our <a href="https://docs.zerotier.com/bridging">bridging tutorial</a></p></blockquote><h3 id="Public-Networks"><a href="#Public-Networks" class="headerlink" title="Public Networks"></a>Public Networks</h3><p>It is possible to disable access control on a ZeroTier network. A public network’s members do not check certificates of membership, and new members to a public network are automatically marked as authorized by their host controller. It is not possible to de-authorize a member from a public network.<br>Rules on the other hand are enforced, so it’s possible to implement a special purpose public network that only allows access to a few things or that only allows a restricted subset of traffic.<br>Public networks are useful for testing and for peer to peer “party lines” for gaming, chat, and other applications. <strong>Participants in public networks are warned to pay special attention to security. If joining a public network be careful not to expose vulnerable services or accidentally share private files via open network shares or HTTP servers. Make sure your operating system, applications, and services are fully up to date.</strong></p><h3 id="Ad-Hoc-Networks"><a href="#Ad-Hoc-Networks" class="headerlink" title="Ad-Hoc Networks"></a>Ad-Hoc Networks</h3><p>A special kind of public network called an ad-hoc network may be accessed by joining a network ID with the format:<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">ffSSSSEEEE000000<br>|<span class="hljs-string"> </span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<br>|<span class="hljs-string"> </span>|<span class="hljs-string">   </span>|<span class="hljs-string">   Reserved for future use, must be 0</span><br><span class="hljs-string"></span>|<span class="hljs-string"> </span>|<span class="hljs-string">   End of port range (hex)</span><br><span class="hljs-string"></span>|<span class="hljs-string"> Start of port range (hex)</span><br><span class="hljs-string">Reserved ZeroTier address prefix indicating a controller-less network</span><br></code></pre></td></tr></table></figure><br>Ad-hoc networks are public (no access control) networks that have no network controller. Instead their configuration and other credentials are generated locally. Ad-hoc networks permit only IPv6 UDP and TCP unicast traffic (no multicast or broadcast) using 6plane format NDP-emulated IPv6 addresses. In addition an ad-hoc network ID encodes an IP port range. UDP packets and TCP SYN (connection open) packets are only allowed to destination ports within the encoded range.<br>For example <code>ff00160016000000</code> is an ad-hoc network allowing only SSH, while <code>ff0000ffff000000</code> is an ad-hoc network allowing any UDP or TCP port.<br>Keep in mind that these networks are public and anyone in the entire world can join them. Care must be taken to avoid exposing vulnerable services or sharing unwanted files or other resources.</p><blockquote><p><strong>GETTING STARTED</strong><br>Click <a href="https://docs.zerotier.com/start/">here</a> to create your network and start adding devices.</p></blockquote><h2 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h2><h3 id="Cryptography-1"><a href="#Cryptography-1" class="headerlink" title="Cryptography"></a>Cryptography</h3><p>ZeroTier uses state of the art cryptographic methods to encrypt your traffic end-to-end. <a href="https://docs.zerotier.com/protocol#cryptography">Read more here</a></p><h3 id="Report-a-vulnerability"><a href="#Report-a-vulnerability" class="headerlink" title="Report a vulnerability"></a>Report a vulnerability</h3><p>If you believe you’ve found a vulnerability please follow the instructions here to <a href="https://github.com/zerotier/ZeroTierOne/blob/dev/SECURITY.md">report it to our team</a></p><h3 id="Audit"><a href="#Audit" class="headerlink" title="Audit"></a>Audit</h3><p>In March 2020 we worked with <code>@trailofbits</code> to audit our protocol and cryptographic designs for ZeroTier 2.0. As one of its subjects is in our just-released beta, we are ready to make our first preliminary audit public <a href="https://storage.googleapis.com/zt-web-large-files/ZeroTier%20Protocol%20Review%20Summary.pdf">here</a>. A full code audit is coming after 2.0.</p><h2 id="Rules-Engine"><a href="#Rules-Engine" class="headerlink" title="Rules Engine"></a>Rules Engine</h2><p>Traffic on ZeroTier networks can be observed and controlled with a system of globally applied network rules. These are enforced in a distributed fashion by both the senders and the receivers of packets. To escape the rules engine a malicious attacker would need to fully compromise both sides of any conversation.<br>The ZeroTier VL2 rules engine differs from most other firewalls and SDN rules engines in several ways. The most immediately relevant of these is that the ZeroTier rules engine is stateless, meaning it lacks connection tracking. This means that bidirectional whitelisting can’t be accomplished by simply whitelisting reply packets to established connections. Instead some thought must be put into how to allow both sides of a desired flow. Rule patterns to achieve the most common desired objectives are included in this manual.<br>The decision to make our rules engine stateless was a design trade-off driven by several concerns. First we wanted to keep complexity, code footprint, and memory use very low to support small embedded devices. The second and more fundamental reason is that distributed stateful filtering requires distributed state synchronization. This would have added a large volume of additional sync traffic as well as introducing <a href="https://en.wikipedia.org/wiki/CAP_theorem">inescapable</a> new sources of instability and failure and a lot of surface area for security vulnerabilities.<br>While ZeroTier lacks state tracking, its rules engine includes something not found anywhere else in the enterprise networking space: <a href="https://en.wikipedia.org/wiki/Capability-based_security">capability-based security</a> and device tagging. Capabilities and tags allow extremely complex micro-segmented network rule schemes to be implemented in a sane, conceptual way that is both easier for human beings to understand and more efficient for machines to handle.<br>This section assumes some level of familiarity with network rules as they’re commonly used on firewalls and routers, etc. While the rules engine is part of VL2, it’s been given its own section in this manual due to the depth and cross-cutting nature of the topic.</p><h3 id="Rule-Sets-and-Rule-Evaluation"><a href="#Rule-Sets-and-Rule-Evaluation" class="headerlink" title="Rule Sets and Rule Evaluation"></a>Rule Sets and Rule Evaluation</h3><p>Rule sets are ordered lists of one or more rules, with each rule consisting of one or more <strong>match</strong> conditions followed by one <strong>action</strong>. As a rule set is evaluated, each match is tested in order and is then ANDed or ORed with the previous match result state. When an action is encountered it is taken if the result of the preceding matches is true. An action with no preceding matches is always taken. If no permissive actions are taken by any rule set the packet is discarded.<br>Here is a simple rule set that constrains Ethernet traffic on a network to only IPv4, ARP, or IPv6 as it would appear in the raw JSON format used by ZeroTier One’s built-in network controller implementation. (Don’t worry if this seems verbose and difficult. We have a more human-friendly way of writing rule sets, but before we introduce it it’s important to understand what is really happening.)<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;etherType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2048</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;not&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;or&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MATCH_ETHERTYPE&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;etherType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2054</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;not&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;or&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MATCH_ETHERTYPE&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;etherType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">34525</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;not&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;or&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MATCH_ETHERTYPE&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ACTION_DROP&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ACTION_ACCEPT&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure><br>This checks whether an Ethernet level packet is not IPv4 (ethertype 2048) and not IPv4 ARP (ethertype 2054) and not IPv6 (ethertype 34525). If all three matches evaluate to true (meaning the ethertype is none of these) then the <strong>drop</strong> action is taken. Otherwise the <strong>accept</strong> action is taken.<br>Networks have one base rule set that is applied to all traffic. Its size is constrained to 1024 entries (each match or action is an entry). It should be used to set the overall policies for all members of the network, and for most common use cases it’s all you’ll need. For more complex scenarios, both capabilities and tags provide methods of both managing complexity and scaling the overall size of a network’s rule system.</p><h3 id="Actions-and-Match-Conditions"><a href="#Actions-and-Match-Conditions" class="headerlink" title="Actions and Match Conditions"></a>Actions and Match Conditions</h3><p>These are the available matches and actions in raw form. The rule definition language outlined in <a href="https://docs.zerotier.com/rules#rule-definition-language">Rule Definition Language</a> provides a friendlier way for human beings to specify rules.</p><div class="table-container"><table><thead><tr><th><strong>Action</strong></th><th><strong>Argument(s)</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>ACTION_DROP</td><td></td><td>Drop packet and terminate all rule evaluation, including capabilities.</td></tr><tr><td>ACTION_BREAK</td><td></td><td>Terminate evaluation of this rule set but continue evaluating capabilities.</td></tr><tr><td>ACTION_ACCEPT</td><td></td><td>Accept packet and terminate further evaluation.</td></tr><tr><td>ACTION_TEE</td><td>length, address</td><td>Send a copy of up to the first <em>length</em> bytes (-1 for all) to a ZeroTier address.</td></tr><tr><td>ACTION_REDIRECT</td><td>address</td><td>Transparently redirect this packet to a ZeroTier address without changing its headers.</td></tr><tr><td><strong>Match Condition</strong></td><td><strong>Argument(s)</strong></td><td><strong>Description</strong></td></tr><tr><td>MATCH_SOURCE_ZEROTIER_ADDRESS</td><td>zt</td><td>VL1 source address.</td></tr><tr><td>MATCH_DEST_ZEROTIER_ADDRESS</td><td>zt</td><td>VL1 destination address.</td></tr><tr><td>MATCH_MAC_SOURCE</td><td>mac</td><td>Ethernet source address.</td></tr><tr><td>MATCH_MAC_DEST</td><td>mac</td><td>Ethernet destination address.</td></tr><tr><td>MATCH_IPV4_SOURCE</td><td>ip</td><td>IPv4 source address.</td></tr><tr><td>MATCH_IPV4_DEST</td><td>ip</td><td>IPv4 destination address.</td></tr><tr><td>MATCH_IPV6_SOURCE</td><td>ip</td><td>IPv6 source address.</td></tr><tr><td>MATCH_IPV6_DEST</td><td>ip</td><td>IPv6 destination address.</td></tr><tr><td>MATCH_IP_TOS</td><td>mask,start,end</td><td>IP TOS field bitwise-ANDed with mask is within range.</td></tr><tr><td>MATCH_IP_PROTOCOL</td><td>ipProtocol</td><td>IP protocol number.</td></tr><tr><td>MATCH_ETHERTYPE</td><td>etherType</td><td>Ethernet frame type.</td></tr><tr><td>MATCH_ICMP</td><td>icmpType,icmpCode</td><td>ICMP type and code, if applicable. (V4 or V6)</td></tr><tr><td>MATCH_IP_SOURCE_PORT_RANGE</td><td>start,end</td><td>IP (V4 or V6) source port range (inclusive).</td></tr><tr><td>MATCH_IP_DEST_PORT_RANGE</td><td>start,end</td><td>IP (V4 or V6) destination port range (inclusive).</td></tr><tr><td>MATCH_CHARACTERISTICS</td><td>mask</td><td>Bitwise AND characteristic bits with mask, true if result is nonzero.</td></tr><tr><td>MATCH_FRAME_SIZE_RANGE</td><td>start,end</td><td>Ethernet frame size range (inclusive).</td></tr><tr><td>MATCH_RANDOM</td><td>probability</td><td>Match if a random 32-bit number is less than or equal to the probability.</td></tr><tr><td>MATCH_TAGS_DIFFERENCE</td><td>id,value</td><td>Difference between tags with this ID is less than or equal to the value.</td></tr><tr><td>MATCH_TAGS_BITWISE_AND</td><td>id,value</td><td>Tags ANDed together equal value.</td></tr><tr><td>MATCH_TAGS_BITWISE_OR</td><td>id,value</td><td>Tags ORed together equal value.</td></tr><tr><td>MATCH_TAGS_BITWISE_XOR</td><td>id,value</td><td>Tags XORed together equal value.</td></tr><tr><td>MATCH_TAGS_EQUAL</td><td>id,value</td><td>Both tags equal the same value.</td></tr><tr><td>MATCH_TAG_SENDER</td><td>id,value</td><td>Sending side’s tag equals this value.</td></tr><tr><td>MATCH_TAG_RECEIVER</td><td>id,value</td><td>Receiving side’s tag equals this value.</td></tr></tbody></table></div><h3 id="Capabilities"><a href="#Capabilities" class="headerlink" title="Capabilities"></a>Capabilities</h3><p>A capability is a small rule set that is bundled into a credential object, signed by the network controller, and issued to only those member(s) permitted to exercise it. When a member detects that outgoing traffic does not match the base rule set but is allowed by one of its capabilities, it periodically pushes the matching capability credential to the recipient ahead of the packet(s) in question. Peer to peer capability distribution is automatic and is triggered by capability match.<br>When the recipient receives the capability it authenticates it by checking its signature and timestamp and, provided the capability is valid, adds it to the set of capabilities to apply to incoming traffic from the capability’s owner. The sender has effectively told the recipient “I can too send this packet! Teacher says so!”<br>Capabilities allow large systems of rules to be broken down into functional aspects and then distributed intelligently only to those members with a need to know. This avoids the bandwidth and storage overhead of distributing huge monolithic rule sets and organizes rules conceptually to make them easier for administrators to understand.<br>There are three terminating actions that can be taken in a rule set: <strong>accept</strong>, <strong>break</strong>, and <strong>drop</strong>. The accept action terminates rule evaluation and accepts the packet. The break action terminates the evaluation of the current rule set but permits the further evaluation of capabilities. The drop action terminates rule evaluation and drops the packet without checking capabilities in the base rule set, but is equivalent to break in capability rule sets. In most cases break should be used unless certain traffic must be absolutely prohibited under any circumstance.<br>In the simple base rule set example in section 3.1 the drop action is taken in the unapproved case. This means that Ethernet whitelisting cannot be overridden by a capability. If we change <em>ACTION_DROP</em> in our example to <em>ACTION_BREAK</em>, then it becomes possible to issue the following capability:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;etherType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2114</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;not&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;or&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MATCH_ETHERTYPE&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ACTION_ACCEPT&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure><br>Ethertype 2114 is <a href="https://wiki.wireshark.org/WakeOnLAN">wake-on-LAN</a>, a special packet that can cause some systems to wake from sleep mode. If we place the above tiny rule set into a capability and issue it to a device, this device <em>but no others</em> will now be permitted to send wake-on-LAN magic packets. (Wake-on-LAN requires hardware support so it would only work to target devices plugged into a physical network bridged to a ZeroTier network, but don’t worry about that here. It’s just an example of special traffic.)<br>Capability rule sets are limited to only 64 entries. The idea is to keep them small and simple. A capability should grant one thing or one small set of conceptually related things.</p><h3 id="Tags"><a href="#Tags" class="headerlink" title="Tags"></a>Tags</h3><p>ZeroTier provides a second mechanism to control rule set complexity. Tags are 32-bit numeric key-value pair credentials that are issued to network members and signed by the controller. They are then distributed peer to peer on a need to know basis in a similar manner to capabilities.<br>Tags provide a way to conditionally drop or allow traffic between members by member classification. They allow very detailed network micro-segmentation by member role, permission, function, etc. without resulting in a combinatorial explosion in rules table size.<br>Let’s say we want to permit traffic on TCP ports 139 and 445 (netbios/CIFS file sharing) only between systems that belong to the same department. Our company has 12,000 devices and 10 departments. Without tags this would require 144,000,000 rules, but with tags it can be accomplished by only a few.<br>First a tag is created to represent the department. Let’s give it tag ID 100. Each member system receives the tag with a value from 1 to 10 indicating which department it belongs to. We can then add the following rules to our network’s base rule set (or to a capability if so desired):<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MATCH_IP_DEST_PORT_RANGE&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;not&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;or&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">139</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;end&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">139</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MATCH_IP_DEST_PORT_RANGE&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;not&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;or&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">445</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;end&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">445</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MATCH_IP_PROTOCOL&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;not&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;or&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;ipProtocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MATCH_TAGS_DIFFERENCE&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;not&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;or&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ACTION_ACCEPT&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure><br>This tells members in our network to accept TCP packets on ports 139 or 445 if the difference between tags with tag ID 10 is zero, meaning they match. (If a member does not have a value for this tag, it does not match.) Now all members of the same department can access CIFS file shares, but CIFS sharing between departments could still be prohibited. (TCP whitelisting requires some additional rules due to the stateless nature of our rules engine. See the section below on rule design patterns.)<br>Tags can be compared on numeric value or as bit fields via several different bit mask operations allowing many different systems of member classification to be implemented.<br>Tags without a default value may behave confusingly. As a best practice, use <code>default 0</code> in your tag definitions.</p><h3 id="Rule-Definition-Language"><a href="#Rule-Definition-Language" class="headerlink" title="Rule Definition Language"></a>Rule Definition Language</h3><p>Raw rule sets are verbose and difficult to write, so we created a minimal rule definition language that’s easier for human beings.<br>The parser for this language can be found in the <a href="https://github.com/zerotier/ZeroTierOne/tree/master/rule-compiler">rule-compiler subfolder of the ZeroTierOne project</a> and as <a href="https://www.npmjs.com/package/zerotier-rule-compiler">zerotier-rule-compiler</a> on NPM. It’s written in JavaScript and is the same code that powers the in-browser editor in ZeroTier Central.</p><h3 id="An-Introductory-Example"><a href="#An-Introductory-Example" class="headerlink" title="An Introductory Example"></a>An Introductory Example</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Whitelist only IPv4 (/ARP) and IPv6 traffic and allow only ZeroTier-assigned IP addresses</span><br>drop                      <span class="hljs-comment"># drop cannot be overridden by capabilities</span><br>  not ethertype ipv4      <span class="hljs-comment"># frame is not ipv4</span><br>  and not ethertype arp   <span class="hljs-comment"># AND is not ARP</span><br>  and not ethertype ipv6  <span class="hljs-comment"># AND is not ipv6</span><br>  or not chr ipauth       <span class="hljs-comment"># OR IP addresses are not authenticated (1.2.0+ only!)</span><br>;<br><br><span class="hljs-comment"># Allow SSH, HTTP, and HTTPS by allowing all TCP packets (including SYN/!ACK) to these ports</span><br>accept<br>  dport 22 or dport 80 or dport 443<br>  and ipprotocol tcp<br>;<br><br><span class="hljs-comment"># Create a tag for which department someone is in</span><br>tag department<br>  <span class="hljs-built_in">id</span> 1000                 <span class="hljs-comment"># arbitrary, but must be unique</span><br>  enum 100 sales          <span class="hljs-comment"># has no meaning to filter, but used in UI to offer a selection</span><br>  enum 200 engineering<br>  enum 300 support<br>  enum 400 manufacturing<br>  default 0<br>;<br><br><span class="hljs-comment"># Allow Windows CIFS and netbios between computers in the same department using a tag</span><br>accept<br>  dport 139 or dport 445<br>  and ipprotocol tcp<br>  and tdiff department 0  <span class="hljs-comment"># difference between department tags is 0, meaning they match</span><br>;<br><br><span class="hljs-comment"># Drop TCP SYN,!ACK packets (new connections) not explicitly whitelisted above</span><br><span class="hljs-built_in">break</span>                     <span class="hljs-comment"># break can be overridden by a capability</span><br>  chr tcp_syn             <span class="hljs-comment"># TCP SYN (TCP flags will never match non-TCP packets)</span><br>  and not chr tcp_ack     <span class="hljs-comment"># AND not TCP ACK</span><br>;<br><br><span class="hljs-comment"># Create a capability called &quot;superuser&quot; that lets its holders override all but the initial &quot;drop&quot;</span><br><span class="hljs-built_in">cap</span> superuser<br>  <span class="hljs-built_in">id</span> 1000 <span class="hljs-comment"># arbitrary, but must be unique</span><br>  accept; <span class="hljs-comment"># allow with no match conditions means allow anything and everything</span><br>;<br><br><span class="hljs-comment"># Accept other packets</span><br>accept;<br></code></pre></td></tr></table></figure><p>This creates a network that can pass IPv4 (and ARP) and IPv6 traffic but no other Ethernet frame types. In addition the <code>not chr ipauth</code> condition drops traffic between IP addresses that have not been assigned by ZeroTier to their respective sources or destinations, blocking all IP spoofing. These are enforced with a hard <code>drop</code>, preventing them from being overridden by any capability.<br>All UDP is allowed, but all non-whitelisted new TCP connections (SYN/!ACK packets) are blocked. This is done with a soft <code>break</code>, allowing it to be overridden by capabilities. New TCP connections are allowed on ports 22, 80, and 443 for everyone. Windows file sharing is allowed only between computers in the same department by way of a tag. A super-user capability that can be assigned to administrative nodes allows the sender to initiate any kind of connection.<br>See TCP <a href="https://docs.zerotier.com/rules/#tcp-whitelisting">Whitelisting</a> for a discussion of how we accomplish TCP whitelisting here.</p><h3 id="Rule-Definition-Language-Syntax"><a href="#Rule-Definition-Language-Syntax" class="headerlink" title="Rule Definition Language Syntax"></a>Rule Definition Language Syntax</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># The remainder of this line is a comment.</span><br><br>action [ ... args ... ]<br>  [and|or] [not] match [... args ...]<br>  [ ... additional matches ... ]<br>;<br><br>tag &lt;name&gt;<br>  <span class="hljs-built_in">id</span> &lt;<span class="hljs-built_in">id</span>&gt;                 <span class="hljs-comment"># arbitrary unique 32-bit ID</span><br>  [default &lt;value&gt;]       <span class="hljs-comment"># default tag value to assign to members</span><br>  [enum &lt;value&gt; &lt;name&gt;]   <span class="hljs-comment"># value can be any 32-bit unsigned integer</span><br>  [flag &lt;bit&gt; &lt;name&gt;]     <span class="hljs-comment"># bit can be 0 to 31</span><br>  [ ... additional enums or flags ... ]<br>;<br><br><span class="hljs-built_in">cap</span> &lt;name&gt;<br>  <span class="hljs-built_in">id</span> &lt;<span class="hljs-built_in">id</span>&gt;                 <span class="hljs-comment"># arbitrary unique 32-bit ID</span><br>  action [ ... args ... ]<br>    [ ... ]<br>  ;<br>  [ ... additional action blocks ... ]<br>;<br><br>macro &lt;name[(<span class="hljs-variable">$var1</span>,...)]&gt;<br>  action [ ... args ... ]<br>    [ ... ]<br>  ;<br>;<br><br>include &lt;name(value,...)&gt;<br></code></pre></td></tr></table></figure><p>Each action, tag, capability, or macro block ends with a semicolon. White space separates things. Indentation is not significant. Hash symbols indicate that the remainder of a line is a comment.<br>As described in sections <a href="https://docs.zerotier.com/rules#rulesets">Rule Sets and Rule Evaluation</a> through <a href="https://docs.zerotier.com/rules#tags">Tags</a>, a rule set is composed of one or more sequences of match,[match],…,action in which the action is taken if the chain of matches evaluates to true. Capabilities are small bundles of rules that can be assigned to nodes to give them special abilities, and tags are key/value pairs that can be assigned to nodes to allow rules to be selectively applied.<br>Macros are just a convenient way of defining more complex actions that can then be applied in multiple places. An example of a macro might be:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">macro allowtcp(<span class="hljs-variable">$port</span>)<br>  accept<br>    ipprotocol tcp<br>    and dport <span class="hljs-variable">$port</span><br>  ;<br>;<br></code></pre></td></tr></table></figure><br>You could then allow TCP ports in a standard TCP whitelisting scheme by just saying:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">include allowtcp(80)<br>include allowtcp(443)<br>include allowtcp(8080)<br></code></pre></td></tr></table></figure><br>Tag <code>enum</code> and <code>flag</code> directives have no meaning to the actual ZeroTier rules engine, but they can be used by user interfaces like ZeroTier Central to make it easier to assign and search tags.</p><h3 id="Actions-Matches-Operators-and-Constants"><a href="#Actions-Matches-Operators-and-Constants" class="headerlink" title="Actions, Matches, Operators, and Constants"></a>Actions, Matches, Operators, and Constants</h3><div class="table-container"><table><thead><tr><th><strong>Action</strong></th><th><strong>Argument(s)</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>drop</td><td></td><td>Drop packet and terminate all rule evaluation, including capabilities.</td></tr><tr><td>break</td><td></td><td>erminate evaluation of this rule set but continue evaluating capabilities.</td></tr><tr><td>accept</td><td></td><td>Accept packet and terminate further evaluation.</td></tr><tr><td>tee</td><td>&lt;length&gt; &lt;address&gt;</td><td>Send a copy of up to the first length bytes (-1 for all) to a ZeroTier address.</td></tr><tr><td>redirect</td><td>&lt;address&gt;</td><td>Transparently redirect this packet to a ZeroTier address without changing its headers.</td></tr><tr><td><strong>Match Condition</strong></td><td><strong>Argument(s)</strong></td><td><strong>Description</strong></td></tr><tr><td>ztsrc</td><td>&lt;address&gt;</td><td>VL1 source address.</td></tr><tr><td>ztdest</td><td>&lt;address&gt;</td><td>VL1 destination address.</td></tr><tr><td>macsrc</td><td>&lt;address&gt;</td><td>Ethernet source address.</td></tr><tr><td>macdest</td><td>&lt;address&gt;</td><td>Ethernet destination address.</td></tr><tr><td>ipsrc</td><td>&lt;address/prefix&gt;</td><td>Source IP address or network (V4 or V6 auto-detected).</td></tr><tr><td>ipdest</td><td>&lt;address/prefix&gt;</td><td>Destination IP address or network (V4 or V6 auto-detected).</td></tr><tr><td>iptos</td><td>&lt;mask&gt; &lt;start[-end]&gt;</td><td>IP TOS field bitwise-ANDed with mask is within range.</td></tr><tr><td>ipprotocol</td><td>&lt;protocol&gt;</td><td>IP protocol number.</td></tr><tr><td>ethertype</td><td>&lt;type&gt;</td><td>Ethernet frame type.</td></tr><tr><td>icmp</td><td>&lt;type&gt; &lt;code&gt;</td><td>ICMP type (V4 or V6) and code. Use -1 for code if not applicable.</td></tr><tr><td>sport</td><td>&lt;start[-end]&gt;</td><td>IP (V4 or V6) source port range (inclusive).</td></tr><tr><td>dport</td><td>&lt;start[-end]&gt;</td><td>IP (V4 or V6) destination port range (inclusive).</td></tr><tr><td>chr</td><td>&lt;mask/name&gt;</td><td>Bitwise AND characteristic bits with mask, true if result is nonzero.</td></tr><tr><td>framesize</td><td>&lt;start[-end]&gt;</td><td>Ethernet frame size range (inclusive).</td></tr><tr><td>random</td><td>&lt;probability&gt;</td><td>Match randomly with probability 0.0 (0%) to 1.0 (100%).</td></tr><tr><td>tdiff</td><td>&lt;id&gt; &lt;value&gt;</td><td>Difference between tags (absolute value) with this ID is less than or equal to the value.</td></tr><tr><td>tand</td><td>&lt;id&gt; &lt;value&gt;</td><td>Tags ANDed together equal value.</td></tr><tr><td>tor</td><td>&lt;id&gt; &lt;value&gt;</td><td>Tags ORed together equal value.</td></tr><tr><td>txor</td><td>&lt;id&gt; &lt;value&gt;</td><td>Tags XORed together equal value.</td></tr><tr><td>teq</td><td>&lt;id&gt; &lt;value&gt;</td><td>Both tags equal the same value.</td></tr><tr><td>tseq</td><td>&lt;id&gt; &lt;value&gt;</td><td>Sending side’s tag equals this value.</td></tr><tr><td>treq</td><td>&lt;id&gt; &lt;value&gt;</td><td>Receiving side’s tag equals this value.</td></tr></tbody></table></div><p>Match conditions may be joined by <strong>and</strong> (default if none specified) or <strong>or</strong> and may be modified by <strong>not</strong>.<br>Match conditions are evaluated from left to right; <code>a and b or c</code> is a different rule than <code>b or c and a</code>. The rules language doesn’t support parentheses, but for example purposes the above would evaluate as: <code>(a and b) or c</code> vs <code>(b or c) and a</code><br>Traffic won’t be <code>tee</code>d if it is blocked by a <code>break</code> or <code>drop</code>.<br>For convenience the following symbols can be used when matching on certain packet attributes:</p><ul><li>IP protocols (<code>ipprotocol</code>): <strong>icmp</strong> (for IPv4), <strong>igmp</strong>, <strong>ipip</strong>, <strong>tcp</strong>, <strong>egp</strong>, <strong>igp</strong>, <strong>udp</strong>, <strong>rdp</strong>, <strong>esp</strong>, <strong>ah</strong>, <strong>icmp6</strong> (for IPv6), <strong>l2tp</strong>, <strong>sctp</strong>, and <strong>udplite</strong>.</li><li>Ethernet frame types (<code>ethertype</code>): <strong>ipv4</strong>, <strong>arp</strong>, <strong>ipv6</strong>, <strong>wol</strong> (wake on LAN), <strong>rarp</strong>, <strong>atalk</strong>, <strong>aarp</strong>, <strong>ipx_a</strong>, <strong>ipx_b</strong>.</li><li>Packet characteristics (bit masks for <code>chr</code>):<ul><li><strong>inbound</strong>: packet is being filtered on the receiving side (use not inbound for sending side)</li><li><strong>multicast</strong>: destination is a multicast or broadcast MAC</li><li><strong>broadcast</strong>: destination is the broadcast MAC</li><li><strong>ipauth</strong>: sender IP is assigned by ZeroTier to the sending node</li><li><strong>tcp_fin</strong>: packet is TCP with FIN flag set</li><li><strong>tcp_syn</strong>: packet is TCP with SYN flag set</li><li><strong>tcp_rst</strong>: packet is TCP with RST flag set</li><li><strong>tcp_psh</strong>: packet is TCP with PSH flag set</li><li><strong>tcp_ack</strong>: packet is TCP with ACK flag set</li><li><strong>tcp_urg</strong>: packet is TCP with URG flag set</li><li><strong>tcp_ece</strong>: packet is TCP with ECE flag set</li><li><strong>tcp_cwr</strong>: packet is TCP with CWR flag set</li><li><strong>tcp_ns</strong>: packet is TCP with NS flag set</li><li><strong>tcp_rs2</strong>: packet is TCP with RS2 (reserved bit 2) flag set</li><li><strong>tcp_rs1</strong>: packet is TCP with RS1 (reserved bit 1) flag set</li><li><strong>tcp_rs0</strong>: packet is TCP with RS0 (reserved bit 0) flag set</li></ul></li></ul><h3 id="Usefull-Design-Patterns"><a href="#Usefull-Design-Patterns" class="headerlink" title="Usefull Design Patterns"></a>Usefull Design Patterns</h3><h3 id="TCP-Whitelisting"><a href="#TCP-Whitelisting" class="headerlink" title="TCP Whitelisting"></a>TCP Whitelisting</h3><p>First, add this at or near the bottom of your rules:<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-comment"># Block TCP SYN,!ACK to prevent new non-whitelisted TCP connections from being initiated</span><br><span class="hljs-comment"># unless previously whitelisted or allowed by a capability.</span><br><span class="hljs-keyword">break</span> <span class="hljs-keyword">chr</span> tcp_syn <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">chr</span> tcp_ack;<br></code></pre></td></tr></table></figure><br>Then above the SYN,!ACK break (or in a capability) add rules to allow TCP packets with permitted destination ports:<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># Allow TCP port 80 (HTTP)</span><br><span class="hljs-attribute">accept</span> ipprotocol tcp and dport <span class="hljs-number">80</span>;<br></code></pre></td></tr></table></figure><br>ZeroTier’s filter is stateless. If we block all TCP packets except those with the correct destination port, this will prevent reply packets from returning to their senders.<br>Allowing reply packets with the correct (inverse) source port seems like a simple fix, but this is insecure as it allows anyone to initiate any TCP connection if they bind to whitelisted source ports.<br>The best solution is to block all non-whitelisted TCP packets with flags SYN,!ACK (SYN and not ACK) and and then whitelist desired destination ports. This way TCP replies and control traffic are allowed, but new connections cannot be opened unless they are permitted.</p><h3 id="Locking-Down-UDP"><a href="#Locking-Down-UDP" class="headerlink" title="Locking Down UDP"></a>Locking Down UDP</h3><p>UDP is tougher to deal with in a stateless paradigm. It’s connectionless so there is no way to specifically select a new session vs. an existing session. The best way to lock down UDP on a network is to use tags to allow it to and from things like DNS servers that need to speak it.<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">tag udpserver<br>  id <span class="hljs-number">1000</span><br>  default <span class="hljs-number">0</span><br>;<br><br>accept<br>  ipprotocol udp<br>  <span class="hljs-keyword">and </span>tor udpserver <span class="hljs-number">1</span><br>  <span class="hljs-keyword">or </span>chr <span class="hljs-keyword">multicast</span><br><span class="hljs-keyword"></span>;<br><br><span class="hljs-keyword">break </span>ipprotocol udp;<br></code></pre></td></tr></table></figure><br>First we define a tag called udpserver with a default value of 0. We don’t set any enums or flags for this tag since it will be used as a boolean. For servers that need to respond to DNS queries, set the udpserver to 1.<br>Then we accept UDP traffic if the value of the udpserver tag is 1 when both sender and receiver tags are ORed together, or if UDP traffic is multicast. This allows multicast mDNS and Netbios announcements and allows UDP traffic to and from UDP servers, but prohibits other horizontal UDP traffic.</p><h3 id="Traffic-Observation-and-Interception"><a href="#Traffic-Observation-and-Interception" class="headerlink" title="Traffic Observation and Interception"></a>Traffic Observation and Interception</h3><p>Here’s a simple rule to monitor everything:<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># Send a copy of EVERY packet on both sender and receiver side to ZeroTier address &quot;deadbeef11&quot;.</span><br><span class="hljs-attribute">tee</span> -<span class="hljs-number">1</span> deadbeef11;<br></code></pre></td></tr></table></figure><br>That’s going to flood <code>deadbeef11</code> with two full copies of every single packet, since it will match on both the sender and the recipient side. A less bandwidth-intensive security monitor setup might look like this:<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">tee <span class="hljs-number">128</span> deadbeef11<br>  chr inbound<br>  <span class="hljs-keyword">and </span>chr tcp_syn <span class="hljs-keyword">or </span>chr tcp_rst <span class="hljs-keyword">or </span>chr tcp_fin<br>  <span class="hljs-keyword">or </span><span class="hljs-built_in">random</span> <span class="hljs-number">0</span>.<span class="hljs-number">1</span><br>;<br><br>tee <span class="hljs-number">128</span> deadbeef22<br>  not chr inbound<br>  <span class="hljs-keyword">and </span>chr tcp_syn <span class="hljs-keyword">or </span>chr tcp_rst <span class="hljs-keyword">or </span>chr tcp_fin<br>  <span class="hljs-keyword">or </span><span class="hljs-built_in">random</span> <span class="hljs-number">0</span>.<span class="hljs-number">1</span><br>;<br></code></pre></td></tr></table></figure><br>This is a bit more clever. It sends the first 128 bytes of every TCP SYN, RST, or FIN packet (TCP connection open and close) to one observer on the inbound side and another observer on the outbound side. It also sends the first 128 bytes of other packets with a probability of one in ten. The first 128 bytes of a packet will be enough to see the Ethernet and IP headers as well as layer 4+ information about many protocols.<br>This would allow observers to watch every new TCP connection on the network and also passively monitor other traffic in a “fuzzy” probabilistic fashion without using very much bandwidth. We split sending and receiving observers to prevent duplicate packets and also to allow us to detect cases where one side is failing to tee traffic more frequently than would be easily explained by packet loss.<br>There are many, many variations on the above that are possible but hopefully these will be enough to get you started.<br>Passive out-of-line monitoring with <strong>tee</strong> is not perfect. If bandwidth between two parties exceeds the bandwidth of one or both parties to the observer, packets will get dropped. It also provides no mechanism to filter traffic in depth since the observer cannot directly intervene (though it could de-authorize a member via the controller API).<br>Active in-line monitoring can be achieved with <strong>redirect</strong>:<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">redirect deadbeef11<br>  dport <span class="hljs-number">80</span> <span class="hljs-keyword">or </span>sport <span class="hljs-number">80</span><br>  <span class="hljs-keyword">and </span>ipprotocol tcp<br>;<br></code></pre></td></tr></table></figure><br>This will pipe all HTTP traffic through <code>deadbeef11</code>. The target node will receive each Ethernet frame intact including its original Ethernet source and destination MAC address. To forward the packet on to its final destination, simply re-send it unmodified via the same interface on which it was received. The intermediate node could scan, modify, and interrupt HTTP traffic across the network. To regular network participants this is completely invisible as it occurs at layer 2 (Ethernet), though some performance degradation may be noticed especially if the link is running across WAN.</p><h3 id="The-Classified-System-Pattern"><a href="#The-Classified-System-Pattern" class="headerlink" title="The Classified System Pattern"></a>The Classified System Pattern</h3><p>One useful pattern for access control resembles the way military organizations classify data. Information is deemed classified, and only those who have the required level of classification are allowed to access it.<br>A model resembling this can be implemented in ZeroTier network rules as follows:<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs tap"><span class="hljs-comment"># Is this member classified?</span><br>tag classified<br>  id 2<br>  enum<span class="hljs-number"> 0 </span>no<br>  enum<span class="hljs-number"> 1 </span>secret<br>  enum<span class="hljs-number"> 2 </span>top<br>  default no<br>;<br><br><span class="hljs-comment"># Clearance flags (a bit like groups)</span><br>tag clearance<br>  id 1<br>  default 0<br>  flag<span class="hljs-number"> 0 </span>staging<br>  flag<span class="hljs-number"> 1 </span>production<br>  flag<span class="hljs-number"> 2 </span>financial<br>  flag<span class="hljs-number"> 3 </span>security<br>  flag<span class="hljs-number"> 4 </span>executive<br>;<br><br><span class="hljs-comment"># If one party is classified, require at least one overlapping clearance bit</span><br>break<br>  not tor classified 0<br>  and tand clearance 0<br>;<br></code></pre></td></tr></table></figure><br>Initially members will be assigned a default classification of 0 (“no”). These can freely communicate since the bitwise OR of their classified tags will be zero. Neither member possesses a classification requirement.<br>To restrict access to a member, set its classified tag to secret or top. (In this example there is no difference, but two levels are included in case you want to implement some kind of more detailed segmentation based on these.) Now the first match (<code>not tor classified 0</code>) will be true and the packet will be dropped unless the two communicating members have at least one clearance bit in common (<code>tand clearance 0)</code>.</p><h2 id="Client-Configuration"><a href="#Client-Configuration" class="headerlink" title="Client Configuration"></a>Client Configuration</h2><p>ZeroTier One is a service that can run on laptops, desktops, servers, virtual machines, and containers to provide virtual network connectivity through a virtual network port much like a VPN client. It can also act as a network controller and as a federated root server.<br><a href="https://www.zerotier.com/download.shtml">Binary packages are available on the ZeroTier site</a> and source code is found on <a href="https://github.com/zerotier/ZeroTierOne">GitHub</a>.<br>After the service is installed and started, networks can be joined using their 16-digit network IDs. Each network appears as a virtual “tap” network port on your system that behaves just like an ordinary Ethernet port.</p><h3 id="ZeroTier-runs-as-Admin"><a href="#ZeroTier-runs-as-Admin" class="headerlink" title="ZeroTier runs as Admin"></a>ZeroTier runs as Admin</h3><p>There are two separate ZeroTier apps on PCs.<br>There is a ZeroTier system service. It runs as Admin. It does all the networking. There is a user interface tray app. It does not run as Admin. It talks to the service to join and leave networks.<br>For the app to talk to the service, it needs access to the secret token. If the user running the UI app can’t access the token, it can’t talk the service, so they can’t leave or join networks or change other settings.<br>During install, the token is copied to a location that the installing user can access.</p><h3 id="Configuration-Files"><a href="#Configuration-Files" class="headerlink" title="Configuration Files"></a>Configuration Files</h3><h4 id="System"><a href="#System" class="headerlink" title="System"></a>System</h4><p>The ZeroTier One service keeps its configuration and state information in its working directory. The working directory location is:</p><ul><li>Windows: <code>C:\ProgramData\ZeroTier\One</code></li><li>macOS: <code>/Library/Application Support/ZeroTier/One</code></li><li>Linux: <code>/var/lib/zerotier-one</code></li><li>FreeBSD/OpenBSD: <code>/var/db/zerotier-one</code></li></ul><h5 id="Network-Specific-Configuration"><a href="#Network-Specific-Configuration" class="headerlink" title="Network Specific Configuration"></a>Network Specific Configuration</h5><p>See <code>$WORKING/networks.d</code> in the working directory</p><h5 id="amp-lt-network-id-amp-gt-conf-is-a-binary-file-You-can’t-edit-it-by-hand"><a href="#amp-lt-network-id-amp-gt-conf-is-a-binary-file-You-can’t-edit-it-by-hand" class="headerlink" title="&amp;lt;network-id&amp;gt;.conf is a binary file. You can’t edit it by hand"></a><code>&amp;lt;network-id&amp;gt;.conf</code> is a binary file. You can’t edit it by hand</h5><p>If you place an empty file named <code>&amp;lt;network-id&amp;gt;.conf</code> in <code>networks.d</code>, ZeroTier will join that network when it starts.</p><h5 id="amp-lt-network-id-amp-gt-local-conf-text-file-with-the-netwrok’s-setting"><a href="#amp-lt-network-id-amp-gt-local-conf-text-file-with-the-netwrok’s-setting" class="headerlink" title="&amp;lt;network-id&amp;gt;.local.conf text file with the netwrok’s setting"></a><code>&amp;lt;network-id&amp;gt;.local.conf</code> text file with the netwrok’s setting</h5><p>The contents look like this:<br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">allowManaged</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><br><span class="hljs-attribute">allowGlobal</span><span class="hljs-operator">=</span><span class="hljs-number">0</span><br><span class="hljs-attribute">allowDefault</span><span class="hljs-operator">=</span><span class="hljs-number">0</span><br><span class="hljs-attribute">allowDNS</span><span class="hljs-operator">=</span><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><br>These settings apply to the specific ZeroTier network.<br>Here is a summary of their meanings:</p><ul><li>Allow Managed. Default Yes. Allow ZeroTier to set IP Addresses and Routes ( <a href="https://en.wikipedia.org/wiki/Private_network">local/private</a> ranges only)</li><li>Allow Global. Default No. Allow ZeroTier to set Global/Public/Not-Private range IPs and Routes.</li><li>Allow Default. Default No. Allow ZeroTier to set the Default Route on the system. See <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/7110693/Overriding+Default+Route+Full+Tunnel+Mode">Full Tunnel Mode</a>.</li><li>Allow DNS. Default No. Allow ZeroTier to set DNS servers.</li></ul><p>ZeroTier will use these settings when it starts. If you change these settings from the UI or zerotier-cli, the file will update. If you edit the file directly, you need to restart the service.</p><h4 id="User"><a href="#User" class="headerlink" title="User"></a>User</h4><p>Some user specific settings may be stored in the user’s path:</p><ul><li><code>C:\Users\&lt;User&gt;\AppData\Local\ZeroTier</code> (Windows)</li><li><code>~/Library/Application\ Support/ZeroTier</code> (macOS)<h3 id="Local-Configuration-OPtions"><a href="#Local-Configuration-OPtions" class="headerlink" title="Local Configuration OPtions"></a>Local Configuration OPtions</h3>A file called local.conf in the ZeroTier home folder contains configuration options that apply to the local node. It can be used to set up trusted paths, blacklist physical paths, set up physical path hints for certain nodes, and define trusted upstream devices (federated roots). Most of the time, you don’t need to change any of these settings.<br>In a large deployment it can be deployed using a tool like Puppet, Chef, SaltStack, etc. to set a uniform configuration across systems.<br><code>local.conf</code> is a JSON format file that can also be edited and rewritten by ZeroTier One itself, so ensure that proper JSON formatting is used. Paste your JSON into a JSON tool before saving your configuration file.<br>Settings available in <code>local.conf</code> (this is not valid JSON, and JSON does not allow comments):<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;physical&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-comment">/* Settings that apply to physical L2/L3 network paths. */</span><br>        <span class="hljs-attr">&quot;NETWORK/bits&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-comment">/* Network e.g. 10.0.0.0/24 or fd00::/32 */</span><br>            <span class="hljs-attr">&quot;blacklist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>|<span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span> <span class="hljs-comment">/* If true, blacklist this path for all ZeroTier traffic */</span><br>            <span class="hljs-attr">&quot;trustedPathId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>|!<span class="hljs-number">0</span> <span class="hljs-comment">/* If present and nonzero, define this as a trusted path (see below) */</span><br>        <span class="hljs-punctuation">&#125;</span> <span class="hljs-comment">/* ,... additional networks */</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;virtual&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-comment">/* Settings applied to ZeroTier virtual network devices (VL1) */</span><br>        <span class="hljs-attr">&quot;##########&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-comment">/* 10-digit ZeroTier address */</span><br>            <span class="hljs-attr">&quot;try&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> <span class="hljs-string">&quot;IP/port&quot;</span><span class="hljs-comment">/*,...*/</span> <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">/* Hints on where to reach this peer if no upstream/roots are online */</span><br>            <span class="hljs-attr">&quot;blacklist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> <span class="hljs-string">&quot;NETWORK/bits&quot;</span><span class="hljs-comment">/*,...*/</span> <span class="hljs-punctuation">]</span> <span class="hljs-comment">/* Blacklist a physical path for only this peer. */</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-comment">/* Other global settings */</span><br>        <span class="hljs-attr">&quot;primaryPort&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-number">-65535</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">/* If set, override default port of 9993 and any command line port */</span><br>        <span class="hljs-attr">&quot;portMappingEnabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>|<span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span> <span class="hljs-comment">/* If true (the default), try to use uPnP or NAT-PMP to map ports */</span><br>        <span class="hljs-attr">&quot;softwareUpdate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;apply&quot;</span>|<span class="hljs-string">&quot;download&quot;</span>|<span class="hljs-string">&quot;disable&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">/* Automatically apply updates, just download, or disable built-in software updates */</span><br>        <span class="hljs-attr">&quot;softwareUpdateChannel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;release&quot;</span>|<span class="hljs-string">&quot;beta&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">/* Software update channel */</span><br>        <span class="hljs-attr">&quot;softwareUpdateDist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>|<span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span> <span class="hljs-comment">/* If true, distribute software updates (only really useful to ZeroTier, Inc. itself, default is false) */</span><br>        <span class="hljs-attr">&quot;interfacePrefixBlacklist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> <span class="hljs-string">&quot;XXX&quot;</span><span class="hljs-punctuation">,</span>... <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">/* Array of interface name prefixes (e.g. eth for eth#) to blacklist for ZT traffic */</span><br>        <span class="hljs-attr">&quot;allowManagementFrom&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> <span class="hljs-string">&quot;NETWORK/bits&quot;</span> <span class="hljs-punctuation">]</span>|<span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-comment">/* If non-NULL, allow JSON/HTTP management from this IP network. Default is 127.0.0.1 only. */</span><br>        <span class="hljs-attr">&quot;allowTcpFallbackRelay&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>|<span class="hljs-literal"><span class="hljs-keyword">false</span></span> <span class="hljs-comment">/* Allow or disallow establishment of TCP relay connections (true by default) */</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><strong>trustedPathld</strong>:A trusted path is a physical network over which encryption and authentication are not required. This provides a performance boost but sacrifices all ZeroTier’s security features when communicating over this path. Only use this feature if you know what you are doing and really need the performance! To set up a trusted path, all devices on the same trusted physical network must have the same trusted path ID. Trusted path IDs are arbitrary unsigned 64-bit integers. These are not secrets. The security of a trusted path depends on its physical configuration. Take special care that any firewalls at its boundaries do not allow traffic in our out with IPs overlapping the trusted network range.</li></ul><p>An example local.conf:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;physical&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;10.0.0.0/24&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;blacklist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;10.10.10.0/24&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;trustedPathId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">101010024</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;virtual&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;feedbeef12&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;UPSTREAM&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;try&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> <span class="hljs-string">&quot;10.10.20.1/9993&quot;</span> <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;blacklist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> <span class="hljs-string">&quot;192.168.0.0/24&quot;</span> <span class="hljs-punctuation">]</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;softwareUpdate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;apply&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;softwareUpdateChannel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;release&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></p><h3 id="authtoken-location"><a href="#authtoken-location" class="headerlink" title="authtoken location"></a><code>authtoken</code> location</h3><p>The installer copies <code>authtoken.secret</code> to the installing user’s <a href="https://docs.zerotier.com/config#user">path</a>.<br>To control the ZeroTier system service, you need the token. If you don’t have the token, you can’t leave or join networks, for example. The UI app uses the token to control the system service. The cli, <code>zerotier-cli</code>, uses it also.<br>The token is called <code>authtoken.secret</code> and it is stored in the ZeroTier working directory. You need to be Admin to access the working directory.<br>The user’s copy of <code>authtoken.secret</code> is in:</p><ul><li>C:\Users\<User>\AppData\Local\ZeroTier (Windows)</li><li>~/Library/Application\ Support/ZeroTier (macOS)</li></ul><p>If you don’t want a user to control ZeroTier, don’t give them this file and don’t give them access to the working directory.</p><h2 id="What-is-a-Network-Controller"><a href="#What-is-a-Network-Controller" class="headerlink" title="What is a Network Controller?"></a>What is a Network Controller?</h2><blockquote><p><strong>INFO</strong><br><a href="https://docs.zerotier.com/controller">Set up your own Controller</a></p></blockquote><p>Every ZeroTier virtual network has a network controller responsible for admitting members to the network, issuing certificates, and issuing default configuration information.<br>This is our reference controller implementation and is almost the same as the one we use to power our own hosted services at <a href="https://my.zerotier.com/">my.zerotier.com</a>. The only difference is the database backend used.<br>Controller data is stored in JSON format under <code>controller.d</code> in the ZeroTier working directory. It can be copied, rsync’d, placed in <code>git</code>, etc. The files under <code>controller.d</code> should not be modified in place while the controller is running or data loss may result, and if they are edited directly take care not to save corrupt JSON since that can also lead to data loss when the controller is restarted. Going through the API is strongly preferred to directly modifying these files.<br>See the API section below for information about controlling the controller.</p><h3 id="Scalability-and-Reliability"><a href="#Scalability-and-Reliability" class="headerlink" title="Scalability and Reliability"></a>Scalability and Reliability</h3><p>Controllers can in theory host up to 2^24 networks and serve many millions of devices (or more), but we recommend spreading large numbers of networks across many controllers for load balancing and fault tolerance reasons. Since the controller uses the filesystem as its data store we recommend fast filesystems and fast SSD drives for heavily loaded controllers.<br>Since ZeroTier nodes are mobile and do not need static IPs, implementing high availability fail-over for controllers is easy. Just replicate their working directories from master to backup and have something automatically fire up the backup if the master goes down. Modern orchestration tools like Nomad and Kubernetes can be of help here.</p><h3 id="Dockerizing-Controllers"><a href="#Dockerizing-Controllers" class="headerlink" title="Dockerizing Controllers"></a>Dockerizing Controllers</h3><p>ZeroTier network controllers can easily be run in Docker or other container systems. Since containers do not need to actually join networks, extra privilege options like “—device=/dev/net/tun —privileged” are not needed. You’ll just need to map the local JSON API port of the running controller and allow it to access the Internet (over UDP/9993 at a minimum) so things can reach and query it.</p><h3 id="Upgrading-from-Older-1-1-14-or-earlier-Version"><a href="#Upgrading-from-Older-1-1-14-or-earlier-Version" class="headerlink" title="Upgrading from Older (1.1.14 or earlier) Version"></a>Upgrading from Older (1.1.14 or earlier) Version</h3><p>Older versions of this code used a SQLite database instead of in-filesystem JSON. A migration utility called <code>migrate-sqlite</code> is included here and must be used to migrate this data to the new format. If the controller is started with an old <code>controller.db</code> in its working directory it will terminate after printing an error to stderr. This is done to prevent “surprises” for those running DIY controllers using the old code.<br>The migration tool is written in nodeJS and can be used like this:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> migrate-sqlite<br>npm install<br>node migrate.js &lt;/path/to/controller.db&gt; &lt;/path/to/controller.d&gt;<br></code></pre></td></tr></table></figure></p><h3 id="Network-Controller-API"><a href="#Network-Controller-API" class="headerlink" title="Network Controller API"></a>Network Controller API</h3><p>The controller API is hosted via the same JSON API endpoint that ZeroTier One uses for local control (usually at 127.0.0.1 port 9993). All controller options are routed under the <code>/controller</code> base path.<br>The controller microservice itself does not implement any fine-grained access control. Access control is via the ZeroTier control interface itself and <code>authtoken.secret</code>. This can be sent as the <code>X-ZT1-Auth</code> HTTP header field or appended to the URL as <code>?auth=&lt;token&gt;</code>. Take care when doing the latter that request URLs are not being logged.<br>While networks with any valid ID can be added to the controller’s database, it will only actually work to control networks whose first 10 hex digits correspond with the network controller’s ZeroTier ID. See <a href="https://docs.zerotier.com/protocol#nwid">Network Identifiers and Controllers</a>.<br>The controller JSON API is very sensitive about types. Integers must be integers and strings strings, etc. Incorrect types may be ignored, set to default values, or set to undefined values.<br>Full documentation of the Controller API can be found on our <a href="https://docs.zerotier.com/service/v1#tag/controller">documentation site</a></p><h3 id="Prometheus-Metrics"><a href="#Prometheus-Metrics" class="headerlink" title="Prometheus Metrics"></a>Prometheus Metrics</h3><p>Controller specific metrics are available from the <code>/metrics</code> endpoint.<br><strong>Metric Name</strong>|<strong>Type</strong>|<strong>Description</strong><br>——|——|——<br>controller_network_count|Gauge|number of networks the controller is serving<br>controller_member_count|Gauge|number of network members the controller is serving<br>controller_network_change_count|Counter|number of times a network configuration is changed<br>controller_member_change_count|Counter|number of times a network member configuration is changed<br>controller_member_auth_count|Counter|number of network member auths<br>controller_member_deauth_count|Counter|number of network member deauths</p><h1 id="Central"><a href="#Central" class="headerlink" title="Central"></a>Central</h1><h2 id="Create-a-Network"><a href="#Create-a-Network" class="headerlink" title="Create a Network"></a>Create a Network</h2><p>A ZeroTier network is essentially a secure Local Area Network (LAN) that you can use anywhere in the world. Let’s make one and connect two devices over ZeroTier.<br>We’ll use <code>ping</code> to test the connection. Any two devices that can run ZeroTier will do: laptop, phone, virtual machine, etc…<br>Both devices can be at the same location, on the same physical network. If you move one to a cafe or to your office, it should still just work.<br>The rough outline is:</p><ul><li>Create a ZeroTier network</li><li>Join the network from two devices</li><li><code>ping</code> one device from the other over the ZeroTier network</li></ul><p>This should take about 5 minutes.</p><blockquote><p><strong>Results Preview</strong><br>Here is a summary of the results of this tutorial, if you’re a networking person.<br>If this doesn’t mean anything to you, that’s OK. We’ll get there.<br>Each zerotier network you join creates a network interface on your device. It’s like adding another Ethernet port to your computer.<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">node1</span># ip -o a<br><span class="hljs-attribute">1</span>: lo    inet <span class="hljs-number">127.0.0.1</span>/<span class="hljs-number">8</span> scope host lo\       valid_lft forever preferred_lft forever<br><span class="hljs-attribute">2</span>: eth0    inet <span class="hljs-number">192.168.182.201</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">192.168.182.255</span> scope global dynamic noprefixroute eth0\       valid_lft <span class="hljs-number">3277</span>sec preferred_lft <span class="hljs-number">2827</span>sec<br><span class="hljs-attribute">9</span>: zt3jn2z57r    inet <span class="hljs-number">10.2.0.11</span>/<span class="hljs-number">23</span> brd <span class="hljs-number">10.2.1.255</span> scope global zt3jn2z57r\       valid_lft forever preferred_lft forever<br></code></pre></td></tr></table></figure><br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">node2</span># ip -o a<br><span class="hljs-attribute">1</span>: lo    inet <span class="hljs-number">127.0.0.1</span>/<span class="hljs-number">8</span> scope host lo\       valid_lft forever preferred_lft forever<br><span class="hljs-attribute">2</span>: eth0    inet <span class="hljs-number">192.168.182.202</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">192.168.182.255</span> scope global dynamic noprefixroute eth0\       valid_lft <span class="hljs-number">3277</span>sec preferred_lft <span class="hljs-number">2827</span>sec<br><span class="hljs-attribute">9</span>: zt3jn2z57r    inet <span class="hljs-number">10.2.0.12</span>/<span class="hljs-number">23</span> brd <span class="hljs-number">10.2.1.255</span> scope global zt3jn2z57r\       valid_lft forever preferred_lft forever<br></code></pre></td></tr></table></figure><br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">node1#<span class="hljs-built_in"> ping </span>-c 3 10.2.0.12<span class="hljs-built_in"></span><br><span class="hljs-built_in">PING </span>10.2.0.2 (10.2.0.12) 56(84) bytes of data.<br>64 bytes <span class="hljs-keyword">from</span> 10.2.0.12: <span class="hljs-attribute">icmp_seq</span>=1 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=5.66 ms<br>64 bytes <span class="hljs-keyword">from</span> 10.2.0.12: <span class="hljs-attribute">icmp_seq</span>=2 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=6.62 ms<br>64 bytes <span class="hljs-keyword">from</span> 10.2.0.12: <span class="hljs-attribute">icmp_seq</span>=3 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=8.50 ms<br><br>--- 10.2.0.12<span class="hljs-built_in"> ping </span>statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 2004ms<br></code></pre></td></tr></table></figure></p></blockquote><h3 id="Create-your-first-ZeroTier-network-1"><a href="#Create-your-first-ZeroTier-network-1" class="headerlink" title="Create your first ZeroTier network"></a>Create your first ZeroTier network</h3><h4 id="Create-an-account-1"><a href="#Create-an-account-1" class="headerlink" title="Create an account"></a>Create an account</h4><blockquote><p><strong>NOTE</strong><br>It’s free, no credit card is required.</p></blockquote><ul><li>Go to <a href="https://my.zerotier.com/">my.zerotier.com</a> and create an account.<h4 id="Create-a-network-1"><a href="#Create-a-network-1" class="headerlink" title="Create a network"></a>Create a network</h4></li><li>Make sure you’re on the “Networks” tab of my.zerotier.com<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316155636.png" alt="20240316155636"></li><li>Click the <strong>Create A Network</strong> button.</li></ul><p>This creates a virtual network with a random ID and a random name. We got “fervent_smathers” and d5e04297a16fa690 here.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316155855.png" alt="20240316155855"></p><ul><li>Click anywhere on the network to go to the details page for this network.</li></ul><p>See the Network Settings panel:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316155931.png" alt="20240316155931"><br>We don’t need to change any settings, but we can change the name of the network to personalize it.</p><ul><li>Change “fervent_smathers” to “my cool network” or whatever you like.</li><li>Collapse the Settings panel. Click on the word “Settings” at the top of the panel.</li></ul><p>You don’t need to change any other settings.</p><ul><li>See the Network Members panel:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316160036.png" alt="20240316160036"><br>It should say “No devices have joined this network”.</li><li>Leave this browser tab open. We’ll look at it again later.</li></ul><h3 id="Setup-the-ZeroTier-app-1"><a href="#Setup-the-ZeroTier-app-1" class="headerlink" title="Setup the ZeroTier app"></a>Setup the ZeroTier app</h3><h4 id="Download-and-install-ZeroTier-1"><a href="#Download-and-install-ZeroTier-1" class="headerlink" title="Download and install ZeroTier"></a>Download and install ZeroTier</h4><p>For mobile devices, use the app store.</p><ul><li>Go to <a href="https://www.zerotier.com/download">zerotier.com/download</a> in a different tab of your browser.</li><li>Run the installer</li></ul><p>The ZeroTier client should now running on your device.</p><h4 id="Join-your-first-ZeroTier-netwrok"><a href="#Join-your-first-ZeroTier-netwrok" class="headerlink" title="Join your first ZeroTier netwrok"></a>Join your first ZeroTier netwrok</h4><p>We need to tell the client to “join” the virtual network we just created.</p><ul><li>Copy the Network ID of the network from my.zerotier.com This is the long number that looks like like: d5e04297a16fa690</li><li>Paste the Network ID into the “join” command on your device<br>On macOS and Windows, there is a menubar/tray app. Select “join” from the menu.<blockquote><p><strong>NOTE</strong><br>Every running instance of ZeroTier has a unique address. It’s the 10 digit “Address” in the app, or <code>zerotier-cli</code> info command.<br>ZeroTier addresses are a very secure method of unique identification.</p></blockquote></li></ul><h3 id="Authorize-your-device-on-your-network-1"><a href="#Authorize-your-device-on-your-network-1" class="headerlink" title="Authorize your device on your network"></a>Authorize your device on your network</h3><p>At this point, your client should say “Access Denied.” A device can’t talk on your network unless you allow it, even if someone discovers the network’s ID.</p><h4 id="Authorize-your-device-1"><a href="#Authorize-your-device-1" class="headerlink" title="Authorize your device"></a>Authorize your device</h4><ul><li>Go to the Members panel that we left open on my.zerotier.com</li><li>Your node that just “joined” should appear here.</li><li>The “Address” should match the address in your client.</li><li>Click the “Auth?” check box for it.</li><li>Give it a name. Type something like “laptop” or “bob” into the (short name) input.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316160617.png" alt="20240316160617"></li></ul><h4 id="Confirm-authorization-1"><a href="#Confirm-authorization-1" class="headerlink" title="Confirm authorization"></a>Confirm authorization</h4><p>Back on your computer, your client should now say “OK” instead of “ACCESS DENIED” and it should show your custom “my cool network” name.<br>Now you have 1 member on your network. A network with 1 member can’t do much.</p><h3 id="Repeat-with-another-device-1"><a href="#Repeat-with-another-device-1" class="headerlink" title="Repeat with another device"></a>Repeat with another device</h3><p>We need to have 2 devices connected to the same ZeroTier network.</p><ul><li>Repeat the join and authorize steps with your second device.</li></ul><h3 id="Test-connectivity-1"><a href="#Test-connectivity-1" class="headerlink" title="Test connectivity"></a>Test connectivity</h3><p>Now you have two authorized nodes on your network. They should be able to talk over ZeroTier.<br>Your Network Members section should look something like this:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316160752.png" alt="20240316160752"><br>The “Managed IPs” will be different on your network.<br>We’re going to test with <code>ping</code>. It’s the only program that we can think of that exists by default on every operating system.<br>This is a command line program, but don’t worry: You can do it.</p><h4 id="Gotcha-Windows-blocks-ping-1"><a href="#Gotcha-Windows-blocks-ping-1" class="headerlink" title="Gotcha: Windows blocks ping"></a>Gotcha: Windows blocks ping</h4><p><del>Windows by default doesn’t respond to pings. If you try to ping a Windows computer from a different computer, it won’t work. You can enable ping.</del><br>ZeroTier automatically enables ping on your ZeroTier network adapter now. You can probably skip this step!</p><blockquote><p><strong>How to enable ping on Windows</strong></p><ul><li>Search for Windows Firewall in the Start Menu, and click to open it.</li><li>Click Advanced Settings on the left.</li><li>From the left pane of the resulting window, click Inbound Rules.</li><li>In the right pane, find the rules titled File and Printer Sharing (Echo Request - ICMPv4-In).</li><li>Right-click each rule and choose Enable Rule.<br>Here is a <a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-firewall/create-an-inbound-icmp-rule">tutorial by Microsoft</a></li></ul></blockquote><h4 id="Open-the-command-line-1"><a href="#Open-the-command-line-1" class="headerlink" title="Open the command line"></a>Open the command line</h4><ul><li>Open the command line on your computer</li></ul><h5 id="macOS-2"><a href="#macOS-2" class="headerlink" title="macOS"></a>macOS</h5><ul><li>Use Spotlight (cmd-space) to search for Terminal</li></ul><p><a href="https://support.apple.com/guide/terminal/open-or-quit-terminal-apd5265185d-f365-44cb-8b09-71a064a42125/mac">Apple’s Instructions</a></p><h5 id="Windows-1"><a href="#Windows-1" class="headerlink" title="Windows"></a>Windows</h5><ul><li>Search for “powershell” and open it</li></ul><p><a href="https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/starting-windows-powershell?view=powershell-7.3">Microsoft’s Instructions</a></p><h5 id="Linux-3"><a href="#Linux-3" class="headerlink" title="Linux"></a>Linux</h5><ul><li>It’s different on every flavor of Linux. You’ll have to search duckduckgo for “open terminal ubuntu” or similar.</li></ul><h5 id="Mobile"><a href="#Mobile" class="headerlink" title="Mobile"></a>Mobile</h5><p>Mobile operating systems don’t have a command line. You can download a “ping” app from your app store if you want.<br>Or <code>ping</code> your phone from your desktop computer.<br>Try switching your phone from wifi to cell and back. It may take about a minute, but ZeroTier should automatically keep the connection working.</p><h4 id="Find-the-ZeroTier-IP-Addresses-of-your-devices"><a href="#Find-the-ZeroTier-IP-Addresses-of-your-devices" class="headerlink" title="Find the ZeroTier IP Addresses of your devices"></a>Find the ZeroTier IP Addresses of your devices</h4><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316161618.png" alt="20240316161618"></p><h4 id="Try-the-ping-command-1"><a href="#Try-the-ping-command-1" class="headerlink" title="Try the ping command"></a>Try the ping command</h4><p>Back in the Command Line / Terminal that you just opened:<br>type <code>ping -c 5 $ZEROTIER_IP_ADDRESS</code> <code>&lt;enter&gt;</code> into your command line.<br>A successful <code>ping</code>:<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cmd">% <span class="hljs-built_in">ping</span> -c <span class="hljs-number">5</span> <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">217</span>.<span class="hljs-number">93</span><br><span class="hljs-built_in">PING</span> <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">217</span>.<span class="hljs-number">93</span> (<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">217</span>.<span class="hljs-number">93</span>): <span class="hljs-number">56</span> data bytes<br><span class="hljs-number">64</span> bytes from <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">217</span>.<span class="hljs-number">93</span>: icmp_seq=<span class="hljs-number">0</span> ttl=<span class="hljs-number">64</span> <span class="hljs-built_in">time</span>=<span class="hljs-number">22</span>.<span class="hljs-number">362</span> ms<br><span class="hljs-number">64</span> bytes from <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">217</span>.<span class="hljs-number">93</span>: icmp_seq=<span class="hljs-number">1</span> ttl=<span class="hljs-number">64</span> <span class="hljs-built_in">time</span>=<span class="hljs-number">10</span>.<span class="hljs-number">157</span> ms<br><span class="hljs-number">64</span> bytes from <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">217</span>.<span class="hljs-number">93</span>: icmp_seq=<span class="hljs-number">2</span> ttl=<span class="hljs-number">64</span> <span class="hljs-built_in">time</span>=<span class="hljs-number">9</span>.<span class="hljs-number">414</span> ms<br><span class="hljs-number">64</span> bytes from <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">217</span>.<span class="hljs-number">93</span>: icmp_seq=<span class="hljs-number">3</span> ttl=<span class="hljs-number">64</span> <span class="hljs-built_in">time</span>=<span class="hljs-number">9</span>.<span class="hljs-number">019</span> ms<br><span class="hljs-number">64</span> bytes from <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">217</span>.<span class="hljs-number">93</span>: icmp_seq=<span class="hljs-number">4</span> ttl=<span class="hljs-number">64</span> <span class="hljs-built_in">time</span>=<span class="hljs-number">9</span>.<span class="hljs-number">180</span> ms<br><br>--- <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">217</span>.<span class="hljs-number">93</span> <span class="hljs-built_in">ping</span> statistics ---<br><span class="hljs-number">5</span> packets transmitted, <span class="hljs-number">5</span> packets received, <span class="hljs-number">0</span>.<span class="hljs-number">0</span>% packet loss<br>round-trip min/avg/max/stddev = <span class="hljs-number">9</span>.<span class="hljs-number">019</span>/<span class="hljs-number">12</span>.<span class="hljs-number">026</span>/<span class="hljs-number">22</span>.<span class="hljs-number">362</span>/<span class="hljs-number">5</span>.<span class="hljs-number">182</span> ms<br></code></pre></td></tr></table></figure><br>Try it with both ZeroTier Managed addresses on your network.<br>One of them is the same device you’re on, so you’re pinging yourself. Pinging the other device might be a little more interesting.</p><blockquote><p><strong>INFO</strong><br>If something goes wrong you might see something like:<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs applescript">% ping -c <span class="hljs-number">5</span> <span class="hljs-number">172.22</span><span class="hljs-number">.217</span><span class="hljs-number">.92</span><br>PING <span class="hljs-number">172.22</span><span class="hljs-number">.217</span><span class="hljs-number">.92</span> (<span class="hljs-number">172.22</span><span class="hljs-number">.217</span><span class="hljs-number">.92</span>): <span class="hljs-number">56</span> data bytes<br>Request <span class="hljs-keyword">timeout</span> <span class="hljs-keyword">for</span> icmp_seq <span class="hljs-number">0</span><br>Request <span class="hljs-keyword">timeout</span> <span class="hljs-keyword">for</span> icmp_seq <span class="hljs-number">1</span><br>Request <span class="hljs-keyword">timeout</span> <span class="hljs-keyword">for</span> icmp_seq <span class="hljs-number">2</span><br>Request <span class="hljs-keyword">timeout</span> <span class="hljs-keyword">for</span> icmp_seq <span class="hljs-number">3</span><br><br><span class="hljs-comment">--- 172.22.217.92 ping statistics ---</span><br><span class="hljs-number">5</span> packets transmitted, <span class="hljs-number">0</span> packets received, <span class="hljs-number">100.0</span>% packet loss<br></code></pre></td></tr></table></figure></p></blockquote><p>or</p><blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ping</span> -c <span class="hljs-number">5</span> <span class="hljs-number">192.168.123.234</span><br><span class="hljs-attribute">PING</span> <span class="hljs-number">192.168.123.234</span> (<span class="hljs-number">192.168.123.234</span>): <span class="hljs-number">56</span> data bytes<br><span class="hljs-attribute">92</span> bytes from <span class="hljs-number">192.168.82.1</span>: Destination Port Unreachable<br><span class="hljs-attribute">Vr</span> HL TOS  Len   ID Flg  <span class="hljs-literal">off</span> TTL Pro  cks      Src      Dst<br> <span class="hljs-attribute">4</span>  <span class="hljs-number">5</span>  <span class="hljs-number">00</span> <span class="hljs-number">5400</span> <span class="hljs-number">56</span>e7   <span class="hljs-number">0</span> <span class="hljs-number">0000</span>  <span class="hljs-number">3</span>f  <span class="hljs-number">01</span> d4ad <span class="hljs-number">192.168.82.217</span>  <span class="hljs-number">192.168.123.234</span><br></code></pre></td></tr></table></figure><p>There may just be a typo in the IP address. Double check that your device is authorized at my.zerotier.com<br>Contact us on the <a href="https://discuss.zerotier.com/">discussion forum</a> and see the <a href="https://docs.zerotier.com/faq">troubleshooting section</a> if you get stuck.</p></blockquote><h3 id="Conclusion-1"><a href="#Conclusion-1" class="headerlink" title="Conclusion"></a>Conclusion</h3><p><code>ping</code> doesn’t accomplish anything, but it does tell us ZeroTier is working. It’s useful to know about for troubleshooting networks, not just ZeroTier networks.<br>Visit the <a href="https://discuss.zerotier.com/">discussion forum</a> to talk about your use-cases or if you get stuck.</p><h4 id="Now-use-ZeroTier-to-do-something-you-want-to-do-1"><a href="#Now-use-ZeroTier-to-do-something-you-want-to-do-1" class="headerlink" title="Now, use ZeroTier to do something you want to do"></a>Now, use ZeroTier to do something you want to do</h4><h4 id="Some-popular-uses-1"><a href="#Some-popular-uses-1" class="headerlink" title="Some popular uses"></a>Some popular uses</h4><ul><li>Windows Remote Desktop</li><li>ssh (try <a href="https://mosh.org/">mosh</a>)</li><li>Private Gaming LAN</li><li>Access the web interfaces of your home lab</li><li>Build your own <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/7110693/Overriding+Default+Route+Full+Tunnel+Mode">VPN</a></li><li>Route to a <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/224395274/Route+between+ZeroTier+and+Physical+Networks">remote subnet</a></li><li>Route to a <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/7274520/Using+NDP+Emulated+6PLANE+Addressing+With+Docker">Docker network</a></li><li>Add <a href="https://docs.zerotier.com/dns">dns</a> to your network</li></ul><h4 id="Join-multiple-networks-1"><a href="#Join-multiple-networks-1" class="headerlink" title="Join multiple networks"></a>Join multiple networks</h4><p>A node can join many networks at once. Make sure they don’t use the same subnet!<br>You can have a <code>home</code> network, a <code>friends</code> network, and a <code>work</code> network, for example.<br>They don’t all need to be networks that you’ve created. You can join other people’s networks.</p><h4 id="Check-out-the-Whitepaper-1"><a href="#Check-out-the-Whitepaper-1" class="headerlink" title="Check out the Whitepaper"></a>Check out the Whitepaper</h4><p>For more info on the cryptography and protocol, see the: <a href="https://docs.zerotier.com/protocol">Design Whitepaper</a></p><h2 id="Central-FAQ"><a href="#Central-FAQ" class="headerlink" title="Central FAQ"></a>Central FAQ</h2><h3 id="Can-I-move-or-transfer-my-network-s-to-another-user"><a href="#Can-I-move-or-transfer-my-network-s-to-another-user" class="headerlink" title="Can I move or transfer my network(s) to another user?"></a>Can I move or transfer my network(s) to another user?</h3><p>When you join an <a href="https://docs.zerotier.com/organizations">Organization</a>, all of your networks are transferred to the Organization.<br>Other than that, there is no way to transfer individual networks between accounts.</p><h4 id="To-change-your-Organization-Owner"><a href="#To-change-your-Organization-Owner" class="headerlink" title="To change your Organization Owner"></a>To change your Organization Owner</h4><p>What you can do is change the email address of your account to a different address. From the account page, select “Manage Account” then “Personal Info”. From there you can change the email address. After changing, please log out and log back in.<br>Note: This email address must not already have a ZeroTier Central account.<br>Many users prefer to use something like “billing” or “admin” <code>@example.com</code> for their organization owner email account and then invite <code>alice@example.com</code> and <code>bob@example.com</code> as network admins.</p><blockquote><p><strong>TIP</strong><br>You can avoid this process by using a shared email address or distribution list (example: <code>zerotier@example.com</code>) instead of a personal address for the account that manages your organization.</p></blockquote><h3 id="Can-I-make-my-subnet-bigger"><a href="#Can-I-make-my-subnet-bigger" class="headerlink" title="Can I make my subnet bigger?"></a>Can I make my subnet bigger?</h3><p>Yes. Your network’s existing members will keep their existing IPs.</p><ol><li>Create a new, larger Managed Route.</li><li>Delete the old, smaller Managed Route.</li><li>Change IPv4 Auto-Assign from Easy to Advanced</li><li>Delete the existing range</li><li>Add the new, bigger range</li></ol><p>For example, if your network was on the Easy Mode <code>192.168.195.*</code> (/24)</p><ul><li>Change the managed route to 192.168.194.0/23</li><li>Change the auto assign range to: 192.168.194.1 to 192.168.195.254</li></ul><p>If you change to a completely different, non-overlapping subnet, your network’s members will get new IPs in the new range, and keep their old IPs. You will have to delete the old IPs from each member if you don’t like to see them in the list.<br>For example, if you change from <code>192.168.195.*</code> to <code>10.244.*.*</code>, then the member nodes will have IPs in both ranges, like: 192.16.195.1 and 10.244.1.1<br>IPs don’t actually get applied on the operating system unless the network has a matching managed route.</p><h3 id="How-are-nodes-counted-against-my-subscription"><a href="#How-are-nodes-counted-against-my-subscription" class="headerlink" title="How are nodes counted against my subscription?"></a>How are nodes counted against my subscription?</h3><p>If the same node is a member of multiple networks, it is counted only once.<br>Only authorized nodes are counted. You don’t need to hide or delete nodes for billing purposes. De-authorized nodes aren’t counted.</p><h2 id="SSO-OIDC"><a href="#SSO-OIDC" class="headerlink" title="SSO/OIDC"></a>SSO/OIDC</h2><h3 id="ZeroTier-Central-configuration"><a href="#ZeroTier-Central-configuration" class="headerlink" title="ZeroTier Central configuration"></a>ZeroTier Central configuration</h3><blockquote><p><strong>NOTE</strong><br>SSO is currently only supported on desktop operating systems such as macOS and Windows. Support for iOS and Android, and better support for authenticating via the command line is still to come.</p></blockquote><h4 id="Update-clients"><a href="#Update-clients" class="headerlink" title="Update clients"></a>Update clients</h4><ul><li>Download and install ZeroTier 1.10.3 or greater on clients that will use SSO.<br><a href="https://www.zerotier.com/download/">https://www.zerotier.com/download/</a></li></ul><h4 id="Configure-SSO-in-ZeroTier-Central"><a href="#Configure-SSO-in-ZeroTier-Central" class="headerlink" title="Configure SSO in ZeroTier Central"></a>Configure SSO in ZeroTier Central</h4><p>Visit <a href="https://my.zerotier.com/account">https://my.zerotier.com/account</a> and complete the SSO configuration toward the bottom of the page. You will need your sso provider’s Issuer URL as well as a Client ID.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318091806.png" alt="20240318091806"><br>You can configure multiple OIDC clients for your organization, but only one may be used at a time on an individual network.</p><h4 id="Configure-SSO-on-individual-networks"><a href="#Configure-SSO-on-individual-networks" class="headerlink" title="Configure SSO on individual networks"></a>Configure SSO on individual networks</h4><p>If you enable this on an existing network, you may accidentally block existing users. Please practice on a test network.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318091853.png" alt="20240318091853"><br>There are three login modes for SSO enabled networks:</p><ol><li>Standard - If the user can successfully authenticate to your OIDC provider, they will be allowed access to the ZeroTier network</li><li><a href="https://docs.zerotier.com/sso#email-based-network-access">Email Based Access</a> - The user is allowed to access the network if and only if their email address is in the email list provided by the network administrator.</li><li><a href="https://docs.zerotier.com/sso#email-based-network-access">Group/Role Based Access</a> - The user is allowed to access the network if and only if they are assigned one of the proper roles by the OIDC server.<h4 id="Exclude-specific-devices-from-SSO-requirements"><a href="#Exclude-specific-devices-from-SSO-requirements" class="headerlink" title="Exclude specific devices from SSO requirements"></a>Exclude specific devices from SSO requirements</h4>This is useful for routers, servers, embedded devices, etc… You can do this from the wrench icon in the Members list.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318092456.png" alt="20240318092456"><h3 id="SSO-provider-configuration"><a href="#SSO-provider-configuration" class="headerlink" title="SSO provider configuration"></a>SSO provider configuration</h3></li></ol><ul><li>SSO Provider <strong>must</strong> support <a href="https://oauth.net/2/pkce/">PKCE</a></li><li>Requires the following scopes:<ul><li><code>openid</code></li><li><code>profile</code></li><li><code>email</code></li><li><code>offline_access</code></li></ul></li><li>Configure the callback URL to <code>http://localhost:9993/sso</code></li></ul><h3 id="Provider-Specific-Configuration-Notes"><a href="#Provider-Specific-Configuration-Notes" class="headerlink" title="Provider Specific Configuration Notes"></a>Provider Specific Configuration Notes</h3><h4 id="Auth0"><a href="#Auth0" class="headerlink" title="Auth0"></a>Auth0</h4><p>Please ensure the following fields are set on your Auth0 application config:</p><ul><li>Application Type: Native</li><li>Token Endpoint Authentication Method: None</li><li>Allowed Callback URL: <a href="http://localhost:9993/sso">http://localhost:9993/sso</a></li><li>Under Advanced Settings -&gt; Grant Types, ensure Authorization Code, and Refresh Token are selected.</li></ul><blockquote><p><strong>NOTE</strong><br>The OIDC spec is picky about the Issuer URL you enter. It must match what the server configuration metadata endpoint returns.<br>In the case of Auth0 specifically, Your Issuer URL MUST end with a <code>/</code>. For example, in Auth0’s application configuration, show’s just the fully qualified domain name. What must be entered in the Issuer field in ZeroTier Central is: <code>https://your-domain-id.auth0.com/</code></p></blockquote><h4 id="Authelia"><a href="#Authelia" class="headerlink" title="Authelia"></a>Authelia</h4><p><a href="https://www.authelia.com/">Authelia</a> is a self hosted SSO solution. ZeroTier uses PKCE, so the field <code>secret</code> must be an empty string and <code>public</code> must be true.</p><blockquote><p><strong>NOTE</strong><br>Use of Authelia requires ZeroTierOne version 1.10.1 or greater. There is an incompatibility between the two in the 1.10.0 release.</p></blockquote><p>Example client configuration:<br><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">clients</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-comment">## The ID is the OpenID Connect ClientID which is used to link an application to a configuration.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">id: authelia-sso-client</span><br><br>    <span class="hljs-comment">## The description to show to users when they end up on the consent screen. Defaults to the ID above.</span><br>    <span class="hljs-attribute">description</span><span class="hljs-punctuation">:</span> <span class="hljs-string">zerotier</span><br><br>    <span class="hljs-comment">## The client secret is a shared secret between Authelia and the consumer of this client.</span><br>    <span class="hljs-attribute">secret</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-comment">## Sector Identifiers are occasionally used to generate pairwise subject identifiers. In most cases this is not</span><br>    <span class="hljs-comment">## necessary. Read the documentation for more information.</span><br>    <span class="hljs-comment">## The subject identifier must be the host component of a URL, which is a domain name with an optional port.</span><br>    <span class="hljs-comment"># sector_identifier: example.com</span><br><br>    <span class="hljs-comment">## Sets the client to public. This should typically not be set, please see the documentation for usage.</span><br>    <span class="hljs-attribute">public</span><span class="hljs-punctuation">:</span> <span class="hljs-string">true</span><br><br>    <span class="hljs-comment">## The policy to require for this client; one_factor or two_factor.</span><br>    <span class="hljs-attribute">authorization_policy</span><span class="hljs-punctuation">:</span> <span class="hljs-string">one_factor</span><br><br>    <span class="hljs-comment">## By default users cannot remember pre-configured consents. Setting this value to a period of time using a</span><br>    <span class="hljs-comment">## duration notation will enable users to remember consent for this client. The time configured is the amount</span><br>    <span class="hljs-comment">## of time the pre-configured consent is valid for granting new authorizations to the user.</span><br>    <span class="hljs-comment"># pre_configured_consent_duration:</span><br><br>    <span class="hljs-comment">## Audience this client is allowed to request.</span><br>    <span class="hljs-attribute">audience</span><span class="hljs-punctuation">:</span> <span class="hljs-string">[</span><br>      <span class="hljs-attribute">&quot;authelia-test-client&quot;</span><br><span class="hljs-attribute">    ]</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">    ## Scopes this client is allowed to request.</span><br><span class="hljs-attribute">    scopes</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">openid</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">groups</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">email</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">profile</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">offline_access</span><br><br>    <span class="hljs-comment">## Redirect URI&#x27;s specifies a list of valid case-sensitive callbacks for this client.</span><br>    <span class="hljs-attribute">redirect_uris</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">http://localhost:9993/sso</span><br><br>    <span class="hljs-comment">## Grant Types configures which grants this client can obtain.</span><br>    <span class="hljs-comment">## It&#x27;s not recommended to define this unless you know what you&#x27;re doing.</span><br>    <span class="hljs-attribute">grant_types</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">refresh_token</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">authorization_code</span><br><br>    <span class="hljs-comment">## Response Types configures which responses this client can be sent.</span><br>    <span class="hljs-comment">## It&#x27;s not recommended to define this unless you know what you&#x27;re doing.</span><br>    <span class="hljs-attribute">response_types</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">code</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">id_token</span><br><br>    <span class="hljs-comment">## Response Modes configures which response modes this client supports.</span><br>    <span class="hljs-attribute">response_modes</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">form_post</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">query</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">fragment</span><br><br>    <span class="hljs-comment">## The algorithm used to sign userinfo endpoint responses for this client, either none or RS256.</span><br>    <span class="hljs-attribute">userinfo_signing_algorithm</span><span class="hljs-punctuation">:</span> <span class="hljs-string">none</span><br></code></pre></td></tr></table></figure></p><h4 id="Azure-AD"><a href="#Azure-AD" class="headerlink" title="Azure AD"></a>Azure AD</h4><p>Navigate to your directory in the Azure portal, and select “App Registrations” in the Manage column.<br>Click “New Registration”<br>Set the Name of the application. e.g. “ZeroTier Central SSO”<br>Under Redirect URI:<br>Platform: Public client/native (mobile &amp; desktop)<br>Set the Redirect URI to <code>http://localhost:9993/sso</code><br>Do not use a trailing <code>/</code> when you enter the “issuer” url in Central.</p><h4 id="Google-Workspace"><a href="#Google-Workspace" class="headerlink" title="Google Workspace"></a>Google Workspace</h4><p>Google OAuth2/OIDC is not supported as Google does not support PKCE clients at this time. You can, however, use <a href="http://localhost:3000/central/sso#keycloak-as-a-saml-identity-broker">Keycloak as a SAML Identity Broker</a> with Google Workspace.</p><h4 id="Keycloak"><a href="#Keycloak" class="headerlink" title="Keycloak"></a>Keycloak</h4><p>Log into your Keycloak administration console, go to the Client configuration and create a new client. Configuration is fairly straightforward, with the following requirements:</p><ul><li>Client Protocol: openid-connect</li><li>Access Type: public</li><li>Standard Flow Enabled: ON</li><li>Root URL: <a href="https://my.zerotier.com/">https://my.zerotier.com</a></li><li>Valid Redirect URLS<ul><li><a href="https://my.zerotier.com/">https://my.zerotier.com/</a>*</li><li><a href="http://localhost/sso">http://localhost/sso</a></li></ul></li><li>Admin URL: <a href="https://my.zerotier.com/">https://my.zerotier.com</a></li><li>Web Origins: *<br>See <a href="https://www.keycloak.org/docs/latest/server_admin/index.html#assembly-managing-clients_server_administration_guide">here</a> for full documentation for configuring OpenID Connect clients with Keycloak.<h5 id="Keycloak-as-a-SAML-Identity-Broker"><a href="#Keycloak-as-a-SAML-Identity-Broker" class="headerlink" title="Keycloak as a SAML Identity Broker"></a>Keycloak as a SAML Identity Broker</h5>If you have a SAML provider, but not an OpenID Connect provider, <a href="https://www.keycloak.org/">Keycloak</a> can also be used to bridge the gap. On your keycloak Admin page, go to Identity Providers. From the dropdown, select <code>SAML v2.0</code> and create the connection to your SAML provider. Combined with the general Keycloak OIDC client settings above, you now have an OIDC server that authenticates against your SAML provider.<h4 id="Okta"><a href="#Okta" class="headerlink" title="Okta"></a>Okta</h4></li><li>Application Type: Native</li><li>Token Endpoint Authentication Method: None</li><li>Allowed Callback URL: <a href="http://localhost:9993/sso">http://localhost:9993/sso</a></li><li>Under Advanced Settings -&gt; Grant Types, ensure Implicit, Authorization Code, and Refresh Token are selected.</li></ul><h4 id="OneLogin"><a href="#OneLogin" class="headerlink" title="OneLogin"></a>OneLogin</h4><blockquote><p><strong>NOTE</strong><br>OneLogin requires ZeroTier One v1.10.3+</p></blockquote><p>Log in to your OneLogin admin console. Select “Custom Connectors” from the “Applications” menu. Hit the “New Connector” button. Name your connector, set Sign on method to OpenID Connect, and set the Redirect URI to <code>https://localhost:9993/sso</code>. Finally, back on the on Custom Connectors page, hit the “Add App to Connector” link. Adjust the description &amp; logo settings as you see fit, and then save.<br>Once the above steps are complete, go to the SSO tab for your new OneLogin Application. Set “Application Type” to “Native”, and “Token Endpoint” to “None (PKCE)”. You’ll also find the required Client ID and Issuer URLs to enter into <a href="https://my.zerotier.com/account">https://my.zerotier.com/account</a>.</p><h3 id="Customizing-the-Final-SSO-Flow-Page"><a href="#Customizing-the-Final-SSO-Flow-Page" class="headerlink" title="Customizing the Final SSO Flow Page"></a>Customizing the Final SSO Flow Page</h3><p>If you wish, you can customize the final view of the sso login process. Create the file <code>$ZEROTIER_HOME/sso-auth.template.html</code>.<br>Note: Any CSS or images must be hosted externally, or placed within the single HTML page itself.<br>You may customize the page to look however you wish. At this time there are only two template values set by zerotier:</p><ul><li><code>networkId</code></li><li><code>messageText</code><br>Templates must be valid HTML, and the template values must be placed inside <code>&#123;&#123; ... &#125;&#125;</code> blocks like so:<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">networkId</span> &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">messageText</span> &#125;&#125;</span><br></code></pre></td></tr></table></figure>You may react to errors via the <code>isError</code> variable:<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs django"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> isError %&#125;</span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: red;&quot;</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; messageText &#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">else</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123; messageText &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><h3 id="Email-Based-Network-Access"><a href="#Email-Based-Network-Access" class="headerlink" title="Email Based Network Access"></a>Email Based Network Access</h3>With Email based network access, a network administrator can limit access to the network to only users whose email addresses are present in the list specified by the network administrator.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318093942.png" alt="20240318093942"><h3 id="Role-Based-Network-Access"><a href="#Role-Based-Network-Access" class="headerlink" title="Role Based Network Access"></a>Role Based Network Access</h3>Configuring Role Based Access controls is different across all of the different OIDC providers available. We’ll give examples for many of the large ones.<br>Role/group names are up to the network administrator. Simply add one or more role name to your network configuration, and users will be required to have at least one of those roles assigned in order to access the network.<h4 id="Auth0-1"><a href="#Auth0-1" class="headerlink" title="Auth0"></a>Auth0</h4>Auth0 requires multiple steps to configure.<h5 id="Step-1-Create-a-Role-and-Assign-Users"><a href="#Step-1-Create-a-Role-and-Assign-Users" class="headerlink" title="Step 1: Create a Role and Assign Users"></a>Step 1: Create a Role and Assign Users</h5>Log into your auth0.com management console. Go to User Management and select roles. Hit the <code>+ Create Role</code> button in the upper right corner. Give your new role a name &amp; description of your choosing.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318094126.png" alt="20240318094126"><br>Once the new role is created, go to the Users tab. There you will be able to add the users you wish to have access to the role.<h5 id="Step-2-Attach-Roles-to-ID-and-Access-Tokens"><a href="#Step-2-Attach-Roles-to-ID-and-Access-Tokens" class="headerlink" title="Step 2: Attach Roles to ID and Access Tokens"></a>Step 2: Attach Roles to ID and Access Tokens</h5>In order for ZeroTier to be able to read the roles a user has been assigned, they must be added to the ID and Access tokens, and mapped to the correct name. In the Auth0.com dashboard, go to Actions, and select Flows. Click the Login flow. On the right side of the screen, hit the + next to <code>Add Action</code> and select <code>Build Custom</code>. Give the action a name such as “Attach ZeroTier Roles” with Trigger set to “Login/Post Login” and Runtime set to “Node 16” (or whatever the latest default is).<br>Next you will get a screen with a code editor. Delete everything in the buffer and add the following:<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-built_in">exports</span>.<span class="hljs-property">onExecutePostLogin</span> = <span class="hljs-keyword">async</span> (event, api) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">namespace</span> = &quot;https://my.zerotier.com&quot;;<br>    if (event.authorization) &#123;<br>        api.<span class="hljs-property">idToken</span>.<span class="hljs-title function_">setCustomClaim</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-keyword">namespace</span>&#125;</span>/roles`</span>, event.<span class="hljs-property">authorization</span>.<span class="hljs-property">roles</span>);<br>        api.<span class="hljs-property">accessToken</span>.<span class="hljs-title function_">setCustomClaim</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-keyword">namespace</span>&#125;</span>/roles`</span>, event.<span class="hljs-property">authorization</span>.<span class="hljs-property">roles</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p><strong>NOTE</strong><br>Auth0 requires roles to be in a namespaced name. To properly integrate with ZeroTier Central, the final claim name set on the token via the script above <strong>must</strong> be <code>https://my.zerotier.com/roles</code>. Please enter the login script exactly as shown above to reduce the chances of errors.</p></blockquote></li></ul><p>Once it is entered, hit <code>Deploy</code> on the upper right hand side of the screen.<br>Hit the <code>&lt;- Back to flow</code> link, which will take you back to the Login Flow graph. Under Add Action, select Custom. You’ll find your new action listed there. Drag it between <code>Start</code> and <code>Complete</code> in the login flow and click Apply. When finished, your flow will look something like this:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318094440.png" alt="20240318094440"><br>Your users’ assigned roles will now be attached to the tokens required to authorize a user on your ZeroTier networks.</p><h4 id="Azure-AD-1"><a href="#Azure-AD-1" class="headerlink" title="Azure AD"></a>Azure AD</h4><p><a href="https://learn.microsoft.com/en-us/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps">https://learn.microsoft.com/en-us/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps</a></p><h4 id="Step-1-Create-an-App-Role"><a href="#Step-1-Create-an-App-Role" class="headerlink" title="Step 1: Create an App Role"></a>Step 1: Create an App Role</h4><p>In the Azure portal, go to Azure Active Directory and select App Registrations. Select the app you’ve created for integration with ZeroTier Central. In the Manage menu, select App Roles, and then create a new app role and hit Apply<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318094647.png" alt="20240318094647"><br>The <code>Value</code> field is what you use as the role name in the network configuration on <a href="https://my.zerotier.com">https://my.zerotier.com</a></p><h4 id="Step-2-Assign-App-Role"><a href="#Step-2-Assign-App-Role" class="headerlink" title="Step 2: Assign App Role"></a>Step 2: Assign App Role</h4><p>Go back to Azure Active Directory in the Azure portal. Select Enterprise Applications from the list of options on the side of the screen. Select the app to be used for ZeroTier Central integration.<br>Select <code>Users and Groups</code> from the Manage menu. Select all of the users you want to assign the App Role and select <code>Edit Assignment</code>. Click on the area of the screen that says “Select a Role”, then find your newly created app role from step 1, click it and hit the <code>Select</code> button.</p><h4 id="Okta-1"><a href="#Okta-1" class="headerlink" title="Okta"></a>Okta</h4><p>Okta doesn’t have the concept of Roles, but it does have Groups that can be used for the same purpose when authenticating to a ZeroTier network.</p><blockquote><p><strong>NOTE</strong><br>Okta role/group based access requires ZeroTier One version 1.10.3+</p></blockquote><h5 id="Step-1-Create-a-Group-and-Assign-Users"><a href="#Step-1-Create-a-Group-and-Assign-Users" class="headerlink" title="Step 1: Create a Group and Assign Users"></a>Step 1: Create a Group and Assign Users</h5><p>From your Okta administrator dashboard, go to Directory and select Groups. Create a group with the name of your choice. Once created, assign people to the group that you want to have access to your ZeroTier network.</p><h5 id="Step-2-Attach-Groups-to-Tokens"><a href="#Step-2-Attach-Groups-to-Tokens" class="headerlink" title="Step 2: Attach Groups to Tokens"></a>Step 2: Attach Groups to Tokens</h5><p>In the Okta administrator dashboard, go to Applications and open the configuration for the Okta Application you’ve configured for use with ZeroTier. Click the ‘Edit’ button in the “OpenID Connect ID Token” box. Set “Group claim type” to “Filter”, and set the three fields for “Group claim filter” to <code>roles</code>, <code>Matches regex</code>, and <code>.*</code>.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318094935.png" alt="20240318094935"><br>It is possible to limit the groups to only certain groups. See Okta’s <a href="https://developer.okta.com/docs/reference/okta-expression-language/#group-functions">group filter documentation</a> for more information.</p><h4 id="OneLogin-by-OneIdentity"><a href="#OneLogin-by-OneIdentity" class="headerlink" title="OneLogin by OneIdentity"></a>OneLogin by OneIdentity</h4><p>Coming Soon</p><h2 id="Add-new-SSO-Seats"><a href="#Add-new-SSO-Seats" class="headerlink" title="Add new SSO Seats"></a>Add new SSO Seats</h2><p>If you are already on the Pro plan, to increase your Node, Admin, or SSO entitlements:<br>Go to the Account page<br>Click Modify Plan<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318160443.png" alt="20240318160443"><br>You will see your current subscription level<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318160518.png" alt="20240318160518"><br>Adjust the levels to your new needs<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318160555.png" alt="20240318160555"><br>Click checkout<br>The system will figure out any needed credits or proration.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318160627.png" alt="20240318160627"><br>Click Update Subscription to finish to accept the changes<br>This will charge your card if needed and update your account to the new subscription levels.</p><h2 id="Authentication-Login-and-Email-issues"><a href="#Authentication-Login-and-Email-issues" class="headerlink" title="Authentication, Login, and Email issues"></a>Authentication, Login, and Email issues</h2><h3 id="Not-receiving-emails-from-us"><a href="#Not-receiving-emails-from-us" class="headerlink" title="Not receiving emails from us?"></a>Not receiving emails from us?</h3><p>If you are not receiving password reset emails, first check your Spam/Junk Mail folder.<br>If it’s not in your Spam/Junk Mail folder, contact your email administrator to ensure emails from <a href="my@zerotier.com">my@zerotier.com</a> are not being blocked at the server level.</p><h3 id="Changing-Your-Email-Address"><a href="#Changing-Your-Email-Address" class="headerlink" title="Changing Your Email Address"></a>Changing Your Email Address</h3><p>Log into ZeroTier Central at <a href="https://my.zerotier.com">https://my.zerotier.com</a>. Once logged in, there’s a “Manage Account” link on the Account page. Click that and then “Personal Info” and you’ll be taken to a form where you can change your email address.</p><h3 id="Invalid-Authenticator-Code"><a href="#Invalid-Authenticator-Code" class="headerlink" title="Invalid Authenticator Code"></a>Invalid Authenticator Code</h3><p>This can be caused by the time being wrong on your computer or phone.</p><h3 id="Lost-Authenticator-Code"><a href="#Lost-Authenticator-Code" class="headerlink" title="Lost Authenticator Code"></a>Lost Authenticator Code</h3><p>Use the Password Reset flow. Click “forgot password” on the login screen.</p><blockquote><p><strong>HISTORY</strong><br>If you have not logged in to your account since 2019, accounts were migrated to a new system in 2019. Your networks are still there!<br>Please try to create an account with the same email address you used before.</p></blockquote><h2 id="Organizations"><a href="#Organizations" class="headerlink" title="Organizations"></a>Organizations</h2><p>You’ve subscribed to my.zerotier.com and want your coworkers to also have the benefits of a Pro account.<br>Add them to your Organization by going to my.zerotier.com/account<br>Create an invite by typing in an email address<br>We will email them the link. You can also paste it into your company chat.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318161100.png" alt="20240318161100"><br>Once they accept the invite, they can be added as Admins to individual networks.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318161120.png" alt="20240318161120"><br>The invited User will see:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318161207.png" alt="20240318161207"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318161236.png" alt="20240318161236"></p><h3 id="Removing-Admins-from-the-Organization"><a href="#Removing-Admins-from-the-Organization" class="headerlink" title="Removing Admins from the Organization"></a>Removing Admins from the Organization</h3><p>You can click the “remove” button next to their name in the list of admins. They will lose Admin access to the organizations networks.</p><h3 id="Change-the-Organization-owner"><a href="#Change-the-Organization-owner" class="headerlink" title="Change the Organization owner"></a>Change the Organization owner</h3><p>There is currently no straight-forward way to do this, and ZeroTier support can’t change your organization owner via email/ticket because that would be insecure.<br>The secure way to do this is to change the login of the organization owner:</p><ul><li>Go to <a href="https://my.zerotier.com/account">https://my.zerotier.com/account</a></li><li>click Manage Account</li><li>Click Personal Info</li><li>Change the email address to the new organization owner’s email</li><li>Log out and back in</li><li>You may want to change the password as well</li></ul><p>Consider using a general email address like “<a href="billing@example.com">billing@example.com</a>“ or “<a href="zerotier@example.com">zerotier@example.com</a>“ when you sign up, or when you change org owners.</p><h4 id="Can-I-move-or-transfer-my-network-s-to-another-user-1"><a href="#Can-I-move-or-transfer-my-network-s-to-another-user-1" class="headerlink" title="Can I move or transfer my network(s) to another user?"></a>Can I move or transfer my network(s) to another user?</h4><p>The only process that moves networks is joining an organization. When you join, the organization absorbs all your existing networks.<br>If your networks are small; It may be faster to start a new account and new networks.</p><h2 id="Add-Network-Admin"><a href="#Add-Network-Admin" class="headerlink" title="Add Network Admin"></a>Add Network Admin</h2><p>Professional subscriptions have a shared administration feature.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318161858.png" alt="20240318161858"><br>Toward the bottom of a Network’s page. There is a section titled “Administrators”<br>A user must be a member of your Organization to become a Network Administrator.</p><h3 id="Permissions"><a href="#Permissions" class="headerlink" title="Permissions"></a>Permissions</h3><p>You can allow another my.zerotier.com user permission to</p><ul><li><strong>Read</strong>. They can look at the network but not change anything</li><li><strong>Authorize</strong>. Allow them to Authorize new members, but not make other changes.</li><li><strong>Modify</strong>. Allow them to change any settings on this Network.</li><li><strong>Delete</strong>. Allow them to delete the network.<h2 id="Pricing"><a href="#Pricing" class="headerlink" title="Pricing"></a>Pricing</h2><blockquote><p><strong> INFO</strong><br>See our <a href="https://www.zerotier.com/pricing/">pricing page</a> for current plans.</p></blockquote></li></ul><h3 id="Do-my-networks-still-work-properly-if-I’m-out-of-compliance"><a href="#Do-my-networks-still-work-properly-if-I’m-out-of-compliance" class="headerlink" title="Do my networks still work properly if I’m out of compliance?"></a>Do my networks still work properly if I’m out of compliance?</h3><p>Yes, everything works fine for the old network members you’ve set up. Many people use ZeroTier for critical infrastructure and we make it our highest priority to ensure your service isn’t interrupted in relation to the new pricing plan. Our enforcement just blocks your ability to add new members to your network until you’re in compliance with the new plan.</p><blockquote><p><strong>HISTORY</strong><br>On Thursday, 9 June 2022 we updated our product plans and the Free Basic plan has changed. Here are some things to know:<br>We have changed the number of nodes available on the Free Basic plan from 50 to 25.<br>We have also changed how we count them. We now count total nodes authorized across all the networks you have, not individual members on networks, so while the free limit is now 25, these nodes can now be authorized on multiple networks. Networks are free. For some users with multiple networks, this may amount to a limit increase.<br>If you are over the limit, your networks and the nodes already authorized on them will still work, but you will need to purchase node packs to add new nodes.<br>Node packs are only $5.00/month for packs of 25 nodes. You can purchase them on your account page in ZeroTier Central.<br>For more information about the pricing plan, please read: <a href="https://www.zerotier.com/2022/06/09/zerotier-business-sso-is-here-and-so-is-our-new-pricing/">https://www.zerotier.com/2022/06/09/zerotier-business-sso-is-here-and-so-is-our-new-pricing/</a></p></blockquote><h2 id="Invoices-Billing-Unsubscribe"><a href="#Invoices-Billing-Unsubscribe" class="headerlink" title="Invoices, Billing, Unsubscribe"></a>Invoices, Billing, Unsubscribe</h2><ul><li>Go to your <a href="https://my.zerotier.com/account">account page</a></li><li>Click Manage Billing<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318162449.png" alt="20240318162449"><br>It will take you to this page where you can update information and download invoices:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318162507.png" alt="20240318162507"><h3 id="I-don’t-see-a-“Manage-Billing”-button"><a href="#I-don’t-see-a-“Manage-Billing”-button" class="headerlink" title="I don’t see a “Manage Billing” button"></a>I don’t see a “Manage Billing” button</h3>Only the Organization Owner can edit billing info. The account page will show who your Organization Owner is, if it is not you.<h3 id="If-the-address-is-incorrect-on-your-invoice"><a href="#If-the-address-is-incorrect-on-your-invoice" class="headerlink" title="If the address is incorrect on your invoice"></a>If the address is incorrect on your invoice</h3>Please use the Update Information link. If possible, use Address Line 1 for your company name. And Line 2 for your address. If it doesn’t fit please contact us.<br>After changing the address, use the <em>download invoice</em> link. If too much time has passed since the invoice was finalized, it won’t be updated. Sorry.<h3 id="My-invoices-don’t-show-my-Tax-ID"><a href="#My-invoices-don’t-show-my-Tax-ID" class="headerlink" title="My invoices don’t show my Tax ID"></a>My invoices don’t show my Tax ID</h3>ZeroTier’s US Tax ID is 47-3126707. We aren’t incorporated outside of the US so we don’t have a Tax ID for anywhere outside of the US. Our payment processor will not print your Tax ID on invoices for this reason.<br>If you need a Tax ID in order to purchase ZeroTier, consider reaching out to a local MSP to buy ZeroTier through them.<h3 id="How-to-delete-your-whole-account"><a href="#How-to-delete-your-whole-account" class="headerlink" title="How to delete your whole account"></a>How to delete your whole account</h3>Go to your <a href="https://my.zerotier.com/account">account page</a> and click on the “delete account” button.<br>This deletes everything about your account, in accordance with various privacy laws.</li></ul><h2 id="Hide-or-Delete-Nodes"><a href="#Hide-or-Delete-Nodes" class="headerlink" title="Hide or Delete Nodes"></a>Hide or Delete Nodes</h2><p>There are delete and hide buttons on the right side of the list nodes in the Members section of a ZeroTier network.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318162824.png" alt="20240318162824"></p><h3 id="Hiding-a-Member"><a href="#Hiding-a-Member" class="headerlink" title="Hiding a Member"></a>Hiding a Member</h3><p>The member will be de-authorized and hidden from view in the list.<br>Hidden members can be revealed by setting the “Hidden” checkbox above the member’s list.</p><h3 id="Deleting-a-Member"><a href="#Deleting-a-Member" class="headerlink" title="Deleting a Member"></a>Deleting a Member</h3><p>The member will be de-authorized and completely removed from the list. It’s a little more permanent than hiding.</p><h3 id="Recover-a-Deleted-Member"><a href="#Recover-a-Deleted-Member" class="headerlink" title="Recover a Deleted Member"></a>Recover a Deleted Member</h3><p>You’ve deleted a member from your network, possibly by accident, and you want to get it back:</p><ul><li>Go to the Settings section of the network</li><li>Find the Manually Add Member section</li><li>Paste in the Node ID<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318163025.png" alt="20240318163025"><br>If you’ve lost your Node ID, it can be viewed on the device in the ZeroTier app.<br>Delete should only be used if the node will never join again. Just de-authorize them instead if you don’t want them counted against your node limits.<br>If you don’t see the Delete and Hide Buttons, you have likely turned off your network’s access control by setting it to Public.<br>Public networks have no access control. If you deleted or de-authorized a member it would reappear within a few seconds.<br>Set your network to back to Private.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318163059.png" alt="20240318163059"><h2 id="Web-Hooks"><a href="#Web-Hooks" class="headerlink" title="Web Hooks"></a>Web Hooks</h2>Subscribers can receive notifications of changes to their networks, network members, and organizations on my.zerotier.com via Web Hooks.<h3 id="Configuring-Web-Hooks"><a href="#Configuring-Web-Hooks" class="headerlink" title="Configuring Web Hooks"></a>Configuring Web Hooks</h3>Go to the <a href="https://my.zerotier.com/account">Account</a> page. Under <code>Your Organization</code> there is a section called <code>Webhooks</code>.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318163227.png" alt="20240318163227"><br>Enter the URL your HTTP(S) endpoint that will receive the webhook and (optionally) enter a description, then select the event types you wish to receive on the webhook.<br>See <a href="https://github.com/zerotier/ztchooks">github.com/zerotier/ztchooks</a> for example code for receiving &amp; processing webhooks.<br>All hooks fired will contain the following three fields:<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">&#123;<br>    <span class="hljs-string">&quot;hookd_id&quot;</span>: <span class="hljs-string">...</span>,<br>    <span class="hljs-string">&quot;org_id&quot;</span>: <span class="hljs-string">...</span>,<br>    <span class="hljs-string">&quot;hook_type&quot;</span>: <span class="hljs-string">...</span>,<br>&#125;<br></code></pre></td></tr></table></figure>The rest of the fields vary by <code>hook_type</code>. Full definitions of all of the fields can be found <a href="https://github.com/zerotier/ztchooks/blob/main/types.go">here</a>.<h3 id="Hook-Types"><a href="#Hook-Types" class="headerlink" title="Hook Types"></a>Hook Types</h3></li><li>Network Join (<code>NETWORK_JOIN</code>) - Fired when a new member is requesting to join a network. NOTE: This is only fired once when the network controller first receives the join request from the network member.</li><li>Network Auth (<code>NETWORK_AUTH</code>) - Fired when an administrator authorizes a new member to a network.</li><li>Network Deauth (<code>NETWORK_DEAUTH</code>) - Fired when an administrator revokes authorization from a network.</li><li>Network Created (<code>NETWORK_CREATED</code>) - Fired when an administrator creates a new network.</li><li>Network Deleted (<code>NETWORK_DELETED</code>) - Fired when an administrator deletes a network.</li><li>Network Configuration Change (<code>NETWORK_CONFIG_CHANGED</code>) - Fired when an administrator changes the configuration of a network.</li><li>Network SSO Login (<code>NETWORK_SSO_LOGIN</code>) - Fired when a user is authorized/reauthorized to a network via SSO.</li><li>Network SSO Login Error (<code>NETWORK_SSO_LOGIN_ERROR</code>) - Fired when there is an error authorizing/reauthorizing to a network via SSO.</li><li>Member Configuration Change (<code>MEMBER_CONFIG_CHANGED</code>) - Fired when an administrator makes a configuration change to a network member.</li><li>Member Deleted (<code>MEMBER_DELETED</code>) - Fired when an administrator deletes a network member.</li><li>Organization Invite Sent (<code>ORG_INVITE_SENT</code>) - Fired when the account owner invites an administrator to the network.</li><li>Organization Invite Accepted (<code>ORG_INVITE_ACCEPTED</code>) - Fired when the invitee accepts and joins the organization.</li><li>Organization Invite Rejected (<code>ORG_INVITE_REJECTED</code>) - Fired when the invitee rejects the invitation.</li><li>Organization Member Removed (<code>ORG_MEMBER_REMOVED</code>) - Fired when the account owner removes a member from the organization.<h3 id="Retries"><a href="#Retries" class="headerlink" title="Retries"></a>Retries</h3>If a hook fails to be sent for any reason, it will be retried up to a maximum of 10 times with an exponential backoff policy. The 2nd attempt will be approximately 1 minute after the first. The third approximately 2 minutes after the 2nd, and so on to a maximum of 1 hour between attempts. If there is still a failure after 10 attempts, the call will be abandoned.<h3 id="Web-Hook-Security"><a href="#Web-Hook-Security" class="headerlink" title="Web Hook Security"></a>Web Hook Security</h3>In order enhance security, and to prevent replay attacks, we have implemented a hook signing algorithm so you can verify each hook request as you receive it. We have also provided a <a href="https://github.com/zerotier/ztchooks">Go Library</a> and a <a href="https://github.com/zerotier/ztchooks-ts">TypeScript Library</a> for your use in verifying incoming webhooks.<br>First you must create a Webhook Signing Secret from your <a href="https://my.zerotier.com/account">account page</a>.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318163829.png" alt="20240318163829"><br>The secret is a hexadecimal string. You will need a copy in order to verify webhooks. The signature will be placed in the HTTP header <code>X-ZTC-Signature</code>.<h4 id="Go-Example"><a href="#Go-Example" class="headerlink" title="Go Example"></a>Go Example</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/zerotier/ztchooks&quot;</span><br>)<br><br><span class="hljs-keyword">const</span> PSK = <span class="hljs-string">&quot;&lt;your_signing_secret&gt;&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">hookCatcher</span><span class="hljs-params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;<br>    body, err := io.ReadAll(req.Body)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-built_in">panic</span>(err)<br>    &#125;<br><br>    signature := req.Header.Get(<span class="hljs-string">&quot;X-ZTC-Signature&quot;</span>)<br>    <span class="hljs-keyword">if</span> err := ztchooks.VerifyHookSignature(PSK, signature, body, ztchooks.DefaultTolerance); err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-comment">// signature verification failed</span><br>        res.WriteHeader(http.StatusInternalServerError)<br>        w.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;500 - Signature Verification Failed&quot;</span>))<br>        <span class="hljs-keyword">return</span><br>    &#125;<br><br>    <span class="hljs-comment">// Signature verification succeded</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    http.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, hookCatcher)<br>    http.ListenAndServe(<span class="hljs-string">&quot;:9999&quot;</span>, <span class="hljs-literal">nil</span>)<br>&#125;<br><br></code></pre></td></tr></table></figure>NOTE: A more complete example of verification &amp; processing hooks can be found <a href="https://github.com/zerotier/ztchooks/blob/main/example/hook-catcher.go">here</a>.<br>It is possible to have multiple signing secrets. Hooks will be signed with all secrets, and the verification method provided by the <code>ztchooks</code> library does take this into account automatically.</li></ul><h1 id="Guides"><a href="#Guides" class="headerlink" title="Guides"></a>Guides</h1><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>Simple example using an interactive shell.<br>ZeroTier One makes ZeroTier virtual networks available as ‘tap’ virtual network ports. To do this inside a Docker container requires a few elevated permissions and access to the <code>/dev/net/tun</code> device.<br>Fortunately this is easy:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -it --rm \<br><span class="hljs-attribute">--cap-add</span>=NET_ADMIN \<br><span class="hljs-attribute">--cap-add</span>=SYS_ADMIN \<br><span class="hljs-attribute">--device</span>=/dev/net/tun centos:7 [<span class="hljs-built_in">..</span>. command <span class="hljs-built_in">..</span>.]<br></code></pre></td></tr></table></figure><br>Where <code>[... command ...]</code> is an optional command, in the example below we’ll provide <code>/bin/bash</code> to get an interactive shell.</p><blockquote><p><strong>INFO</strong><br><code>SYS_ADMIN</code> is needed because <code>NET_ADMIN</code> does not include the <code>ioctl()</code> required to put <code>/dev/net/tun</code> in tap mode. This appears to be a bug in Linux’s capability model but it would have to be fixed upstream.</p></blockquote><p>Here’s a transcript of an example session where we start a command prompt in a test container, install ZeroTier, start it (must be done manually here because the container does not run init or systemd), join a test network, and ping something.<br>Starting a container with an interactive shell:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -it --<span class="hljs-built_in">rm</span> \<br>--cap-add=NET_ADMIN \<br>--cap-add=SYS_ADMIN \<br>--device=/dev/net/tun centos:7 /bin/bash<br></code></pre></td></tr></table></figure><br>Then, while inside the container we install ZeroTier:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@5b88595860bc /]<span class="hljs-comment"># curl https://install.zerotier.com/ | bash</span><br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100 12243  100 12243    0     0  18523      0 --:--:-- --:--:-- --:--:-- 18550<br><br>*** ZeroTier One Quick Install <span class="hljs-keyword">for</span> Unix-like Systems<br><br>*** Supported targets <span class="hljs-keyword">for</span> this script:<br>***    macOS (10.7+) on x86_64 (just installs ZeroTier One.pkg)<br>***    Linux / Debian (wheezy or newer) on i386, x86_64, and armhf (Raspbian/jessie only)<br>***    Linux / Ubuntu (trusty or newer) on i386 and x86_64<br>***    Linux / SuSE (12+) on i386 and x86_64<br>***    Linux / CentOS (6+) on i386 and x86_64<br>***    Linux / Fedora (22+) on i386 and x86_64<br>***    Linux / Amazon (2016.03+) on x86_64<br><br>*** Please report problems to contact@zerotier.com and we will try to fix ASAP!<br><br>*** Detecting Linux Distribution<br><br>*** Found RHEL/CentOS, creating /etc/yum.repos.d/zerotier.repo<br><br>*** Installing zerotier-one package...<br>[ ... snipped a bunch of yum install output ...]<br><br>*** Enabling and starting zerotier-one service...<br>Created symlink from /etc/systemd/system/multi-user.target.wants/zerotier-one.service to /usr/lib/systemd/system/zerotier-one.service.<br>Failed to get D-Bus connection: Operation not permitted<br><br>*** Package installed but cannot start service! You may be <span class="hljs-keyword">in</span> a Docker<br>*** container or using a non-standard init service.<br></code></pre></td></tr></table></figure><br>Start ZeroTier and join a network:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@5b88595860bc /]<span class="hljs-comment"># /usr/sbin/zerotier-one -d</span><br>[root@5b88595860bc /]<span class="hljs-comment"># /usr/sbin/zerotier-cli join 8056c2e21c000001</span><br>200 <span class="hljs-built_in">join</span> OK<br>[root@5b88595860bc /]<span class="hljs-comment"># /usr/sbin/zerotier-cli listnetworks</span><br>200 listnetworks<br>200 listnetworks 8056c2e21c000001 - 02:e6:10:ab:69:33 REQUESTING_CONFIGURATION PRIVATE zt0 -<br>[root@5b88595860bc /]<span class="hljs-comment"># /usr/sbin/zerotier-cli listnetworks</span><br>200 listnetworks<br>200 listnetworks 8056c2e21c000001 earth.zerotier.net 02:e6:10:ab:69:33 OK PUBLIC zt0 fd80:56c2:e21c:0000:0199:93e6:10b7:8bf1/88,28.183.140.10/7<br></code></pre></td></tr></table></figure><br>Try pinging something:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@5b88595860bc /]<span class="hljs-comment"># ping &lt;some_other_zerotier_nodes_ip&gt;</span><br></code></pre></td></tr></table></figure><br>Exit<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@5b88595860bc /]<span class="hljs-comment"># exit</span><br></code></pre></td></tr></table></figure></p><h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><blockquote><p><strong>BETA</strong><br>This feature is still in beta. This will soon be integrated into ZeroTier 2.0, but for now, it is segregated to allow us to iterate quickly.</p><h3 id="Conceptual-Prerequisites"><a href="#Conceptual-Prerequisites" class="headerlink" title="Conceptual Prerequisites"></a>Conceptual Prerequisites</h3><ul><li>When ZeroTier joins a network, it creates a virtual network interface.</li><li>When ZeroTier joins multiple networks, there will be multiple network interfaces.</li><li>When ZeroNSD starts, it binds to a ZeroTier network interface.</li><li>When ZeroTier is joined to multiple networks, it needs multiple ZeroNSDs, one for each interface.</li></ul></blockquote><p>This means:</p><ul><li>ZeroNSD will be accessible from the node it is running on.</li><li>ZeroNSD will be accessible from other nodes on the ZeroTier network.</li><li>ZeroNSD will be isolated from other networks the node might be on.</li></ul><h3 id="Technical-Prerequisites"><a href="#Technical-Prerequisites" class="headerlink" title="Technical Prerequisites"></a>Technical Prerequisites</h3><p>This Quickstart was written using two machines - one Ubuntu virtual machine on Digital Ocean, and one macOS laptop on a residential ISP. To follow along step by step, you’ll need to provision equivalent infrastructure. If you use different platforms, you should be able to figure out what to do with minimal effort.</p><h3 id="Create-a-ZeroTier-Network"><a href="#Create-a-ZeroTier-Network" class="headerlink" title="Create a ZeroTier Network"></a>Create a ZeroTier Network</h3><p>You may do this manually through the <a href="https://my.zerotier.com/">ZeroTier Central WebUI</a>,<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182436.png" alt="20240318182436"></p><h3 id="Install-ZeroTier"><a href="#Install-ZeroTier" class="headerlink" title="Install ZeroTier"></a>Install ZeroTier</h3><p>ZeroTier must be installed and joined to the network you intend to provide DNS service to. The following should work from the CLI on most platforms. Windows users may download the MSI from the <a href="https://www.zerotier.com/download/">ZeroTier Downloads</a> page. For the remainder of this document, please replace the example network <code>af78bf94364e2035</code> with a network ID your own.<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">notroot<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>curl -s <span class="hljs-symbol">https:</span>//install.zerotier.com | sudo bash<br>notroot<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo zerotier-cli join af78bf94364e2035<br>notroot<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo zerotier-cli  set af78bf94364e2035 allowDNS=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></p><h3 id="Authorize-the-Nodes"><a href="#Authorize-the-Nodes" class="headerlink" title="Authorize the Nodes"></a>Authorize the Nodes</h3><p>Authorize the node to the network by clicking the “Auth” button in the Members section in the <a href="https://my.zerotier.com/">ZeroTier Central WebUI</a>.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182525.png" alt="20240318182525"><br>First, <a href="https://docs.zerotier.com/api/tokens">create a Central API token</a>.<br>Next, you will need to stash this in a file for ZeroNSD to read.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo bash -c <span class="hljs-string">&quot;echo ZEROTIER_CENTRAL_TOKEN &gt; /var/lib/zerotier-one/token&quot;</span><br>sudo <span class="hljs-built_in">chown</span> zerotier-one:zerotier-one /var/lib/zerotier-one/token<br>sudo <span class="hljs-built_in">chmod</span> 600 /var/lib/zerotier-one/token<br></code></pre></td></tr></table></figure></p><h3 id="ZeroTier-Systemd-Manager"><a href="#ZeroTier-Systemd-Manager" class="headerlink" title="ZeroTier Systemd Manager"></a>ZeroTier Systemd Manager</h3><p>zerotier-systemd-manager publishes rpm and deb packages available at <a href="https://github.com/zerotier/zerotier-systemd-manager/releases">https://github.com/zerotier/zerotier-systemd-manager/releases</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://github.com/zerotier/zerotier-systemd-manager/releases/download/v0.1.9/zerotier-systemd-manager_0.1.9_linux_amd64.deb<br>sudo dpkg -i zerotier-systemd-manager_0.1.9_linux_amd64.deb<br></code></pre></td></tr></table></figure><br>Finally, restart all the ZeroTier services.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl daemon-reload<br>sudo systemctl restart zerotier-one<br>sudo systemctl <span class="hljs-built_in">enable</span> zerotier-systemd-manager.timer<br>sudo systemctl start zerotier-systemd-manager.timer<br></code></pre></td></tr></table></figure></p><h3 id="Install-ZeroNSD"><a href="#Install-ZeroNSD" class="headerlink" title="Install ZeroNSD"></a>Install ZeroNSD</h3><p>ZeroNSD should only run on one node per network. Latency for DNS really matters, so try to place it as close to the clients as possible.</p><h4 id="Packages"><a href="#Packages" class="headerlink" title="Packages"></a>Packages</h4><p>ZeroNSD publishes rpm, deb, and msi packages, available <a href="https://github.com/zerotier/zeronsd/releases">here</a>.<br><em>The latest release is <strong>not</strong> reflected below. Go to the link above to get a link!</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://github.com/zerotier/zeronsd/releases/download/v0.1.7/zeronsd_0.1.7_amd64.deb<br>sudo dpkg -i zeronsd_0.1.7_amd64.deb<br></code></pre></td></tr></table></figure></p><h4 id="Cargo"><a href="#Cargo" class="headerlink" title="Cargo"></a>Cargo</h4><p>If we don’t have packages for your platform, you can still install it with cargo.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo /usr/bin/apt-get -y install net-tools librust-openssl-dev pkg-config cargo<br>sudo /usr/bin/cargo install zeronsd --root /usr/local<br></code></pre></td></tr></table></figure></p><h4 id="Serve-DNS"><a href="#Serve-DNS" class="headerlink" title="Serve DNS"></a>Serve DNS</h4><p>For each network you want to serve DNS to, do the following (replace <code>af78bf94364e2035</code> with <em>your</em> network ID)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo zeronsd supervise -t /var/lib/zerotier-one/token -w -d beyond.corp af78bf94364e2035<br>sudo systemctl start zeronsd-af78bf94364e2035<br>sudo systemctl <span class="hljs-built_in">enable</span> zeronsd-af78bf94364e2035<br></code></pre></td></tr></table></figure></p><h4 id="Verify-functionality"><a href="#Verify-functionality" class="headerlink" title="Verify functionality"></a>Verify functionality</h4><p>You should be able to ping the laptop via it’s DNS name (or any preceding subdomain, since we’ve set the wildcard flag)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">notroot@ubuntu:~$ ping laptop.beyond.corp<br>PING laptop.beyond.corp (172.22.192.177) 56(84) bytes of data.<br>64 bytes from 172.22.192.177 (172.22.192.177): icmp_seq=1 ttl=64 time=50.1 ms<br>64 bytes from 172.22.192.177 (172.22.192.177): icmp_seq=2 ttl=64 time=49.5 ms<br>64 bytes from 172.22.192.177 (172.22.192.177): icmp_seq=3 ttl=64 time=48.6 ms<br></code></pre></td></tr></table></figure><br>or<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">notroot@ubuntu:~$ ping laptop.beyond.corp<br>PING travel.laptop.beyond.corp (172.22.192.177) 56(84) bytes of data.<br>64 bytes from 172.22.192.177 (172.22.192.177): icmp_seq=1 ttl=64 time=50.1 ms<br>64 bytes from 172.22.192.177 (172.22.192.177): icmp_seq=2 ttl=64 time=49.5 ms<br>64 bytes from 172.22.192.177 (172.22.192.177): icmp_seq=3 ttl=64 time=48.6 ms<br></code></pre></td></tr></table></figure></p><h4 id="Update-flag-settings"><a href="#Update-flag-settings" class="headerlink" title="Update flag settings"></a>Update flag settings</h4><p>In order to change the settings (such as the TLD), do the following (replace <code>af78bf94364e2035</code> with your network ID)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo zeronsd supervise -t /var/lib/zerotier-one/token -w -d beyond.corp af78bf94364e2035<br>sudo systemctl daemon-reload<br>sudo systemctl <span class="hljs-built_in">enable</span> zeronsd-af78bf94364e2035<br></code></pre></td></tr></table></figure><br>Most Linux distributions, by default, do not have per-interface DNS resolution out of the box. To test DNS queries against ZeroNSD without <code>zerotier-systemd-manager</code>, find the IP address that ZeroNSD has bound itself to, and run queries against it explicitly.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo lsof -i -n | grep ^zeronsd | grep UDP | awk <span class="hljs-string">&#x27;&#123; print $9 &#125;&#x27;</span> | <span class="hljs-built_in">cut</span> -f1 -d:<br>172.22.245.70<br></code></pre></td></tr></table></figure><br>Query the DNS server directly with the dig command<br>The Ubuntu machine can be queried with:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">dig +short @172.22.245.70 zt-3513e8b98d.beyond.corp<br>172.22.245.70<br>dig +short @172.22.245.70 server.beyond.corp<br>172.22.245.70<br></code></pre></td></tr></table></figure><br>The macOS laptop can be queried with:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">dig +short @172.22.245.70 zt-eff05def90.beyond.corp<br>172.22.245.70<br>dig +short @172.22.245.70 laptop.beyond.corp<br>172.22.192.177<br></code></pre></td></tr></table></figure><br>Add a line to <code>/etc/hosts</code> and query again.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -c <span class="hljs-string">&#x27;echo &quot;1.2.3.4 test&quot; &gt;&gt; /etc/hosts&#x27;</span><br>dig +short @172.22.245.70 test.beyond.corp<br>1.2.3.4<br></code></pre></td></tr></table></figure><br>Query a domain on the public DNS to verify fall through<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">dig +short @172.22.245.70 example.com<br>93.184.216.34<br></code></pre></td></tr></table></figure></p><h4 id="macOS-3"><a href="#macOS-3" class="headerlink" title="macOS"></a>macOS</h4><p>macOS uses <code>dns-sd</code> for DNS resolution. Unfortunately, <code>nslookup</code>,<code>host</code>, and <code>dig</code> are broken on macOS. <code>ping</code> works.<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">user@osx:~$<span class="hljs-built_in"> ping </span>server.beyond.corp<span class="hljs-built_in"></span><br><span class="hljs-built_in">PING </span>server.beyond.corp (172.22.245.70): 56 data bytes<br>64 bytes <span class="hljs-keyword">from</span> 172.22.245.70: <span class="hljs-attribute">icmp_seq</span>=0 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=37.361 ms<br>64 bytes <span class="hljs-keyword">from</span> 172.22.245.70: <span class="hljs-attribute">icmp_seq</span>=1 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=38.129 ms<br>64 bytes <span class="hljs-keyword">from</span> 172.22.245.70: <span class="hljs-attribute">icmp_seq</span>=2 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=37.569 ms<br></code></pre></td></tr></table></figure><br>To check out the system resolver settings, use: <code>scutil --dns</code>.<br>The Ubuntu machine can be queried with<br><code>dns-sd -G v4 server.beyond.corp</code> <code>dns-sd -G v4 zt-3513e8b98d.beyond.corp</code><br>The macOS machine be queried with<br><code>dns-sd -G v4 laptop.beyond.corp</code> <code>dns-sd -G v4 zt-eff05def90.beyond.corp</code></p><h4 id="Windows-2"><a href="#Windows-2" class="headerlink" title="Windows"></a>Windows</h4><p>Are you a Windows user? Does this work out of the box? Does nslookup behave properly? Let us know… feedback and pull requests welcome =)</p><h4 id="Serving-non-ZeroTier-records"><a href="#Serving-non-ZeroTier-records" class="headerlink" title="Serving non-ZeroTier records"></a>Serving non-ZeroTier records</h4><p><strong>NOTE</strong> this portion of the document is largely intended for advanced users who want to get more out of <code>zeronsd</code>‘s service.<br><code>zeronsd</code> will also serve non-zerotier records in two situations: It will forward <code>/etc/resolv.conf</code>‘s nameservers on a TLD mismatch. This behavior is similar to <code>dnsmasq</code>, a popular DNS server on Linux.<br>Additionally, to serve custom records you can supply the <code>-f</code> flag with a file in <a href="https://man7.org/linux/man-pages/man5/hosts.5.html">hosts format</a> it will service records from that file under the provided TLD, <em>merged in</em> with the zerotier nodes. Example below.<br><strong>NOTE</strong>: if you followed the steps above, you will want to <code>systemctl stop zeronsd-&lt;network id&gt;</code>, and <code>zeronsd unsupervise &lt;network id&gt;</code> your network, before continuing.<br>Make a file called <code>hosts</code> and put this in it:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">1.1.1.1 cloudflare-dns<br></code></pre></td></tr></table></figure><br>Then, let’s start a temporary server for now. We’ll just use the <code>start</code> subcommand of <code>zeronsd</code>. This will run in the foreground, so start a new terminal or <code>&amp;</code> it.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ zeronsd start -t /var/lib/zerotier-one/token -f ./hosts -d beyond.corp &lt;network <span class="hljs-built_in">id</span>&gt;<br>Welcome to ZeroNS!<br>Your IP is 1.2.3.4<br></code></pre></td></tr></table></figure><br>Finally, we can lookup <code>cloudflare-dns.beyond.corp</code> to find CloudFlare’s DNS server really really fast!<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ host cloudflare-dns.beyond.corp 1.2.3.4<br>cloudflare-dns.beyond.corp has address 1.1.1.1<br></code></pre></td></tr></table></figure></p><blockquote><p><strong>TIP</strong><br><a href="https://discuss.zerotier.com/search?q=dns">See community threads about DNS</a></p></blockquote><h2 id="VPN-Exit-Node"><a href="#VPN-Exit-Node" class="headerlink" title="VPN Exit Node"></a>VPN Exit Node</h2><p>Route all your Internet traffic through a ZeroTier node.</p><blockquote><p><strong>IN THIS TUTORIAL</strong></p><ul><li><a href="https://docs.zerotier.com/start">Create a ZeroTier Network</a></li><li><a href="https://docs.zerotier.com/exitnode#setup">Set up an <code>exit node</code></a> that handles all your internet traffic</li><li>Join the <code>exit node</code> and a personal node to your ZeroTier network</li><li>Tell your personal node to use your <code>exit node</code></li></ul></blockquote><p>ZeroTier creates imaginary LANs. Default route override means that computers on your imaginary LAN will be routing Internet traffic through it. Just like a real LAN, your imaginary LAN is going to now need a gateway. Setup here is almost identical to what you’d do to configure a NAT gateway for a conventional wired LAN.</p><h3 id="First-create-your-exit-node"><a href="#First-create-your-exit-node" class="headerlink" title="First, create your exit node"></a>First, create your exit node</h3><p>This is the node that will handle all of your internet traffic. It can be something as small as a $5 VPS or a Raspberry Pi.</p><ul><li>If you haven’t already, go <a href="https://docs.zerotier.com/start">create a network</a> and come back</li><li>Install ZeroTier on it</li><li>Join the exit node to your ZeroTier network:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo zerotier-cli <span class="hljs-built_in">join</span> &lt;nwid&gt;<br></code></pre></td></tr></table></figure></li></ul><h3 id="Enable-IPv4-Forwarding-on-the-exit-node"><a href="#Enable-IPv4-Forwarding-on-the-exit-node" class="headerlink" title="Enable IPv4 Forwarding on the exit node"></a>Enable IPv4 Forwarding on the exit node</h3><p>On the computer acting as the VPN exit node:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nano /etc/sysctl.conf<br></code></pre></td></tr></table></figure><br>Add the line:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">/etc/sysctl.conf<br>net.ipv4.ip_forward = 1<br></code></pre></td></tr></table></figure><br>Tell the kernel to reload settings:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo sysctl -p<br></code></pre></td></tr></table></figure><br>Check that settings were correctly applied:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo sysctl net.ipv4.ip_forward<br></code></pre></td></tr></table></figure><br>If you’ve joined (and authorized!) your exit node to your network then you are ready to begin configuring it. Start by setting a few environment variables that we will use later:<br>Get the name of your ZeroTier interface, it will start with <code>zt</code>:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ip <span class="hljs-built_in">link</span> show<br></code></pre></td></tr></table></figure><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 96:00:02:8d:28:c7 brd ff:ff:ff:ff:ff:ff<br>    altname enp1s0<br>3: zthnhhqofq: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 2800 qdisc fq_codel state UNKNOWN mode DEFAULT group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 86:61:c6:fe:ed:dc brd ff:ff:ff:ff:ff:ff<br></code></pre></td></tr></table></figure><br>In our case it was <code>zthnhhqofq</code>. Let’s set the environment variable:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> ZT_IF=zthnhhqofq<br></code></pre></td></tr></table></figure><br>Next, get the name of the regular WAN interface to the internet:<br>In our case it was <code>eth0</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> WAN_IF=eth0<br></code></pre></td></tr></table></figure><br>Enable NAT and IP masquerading:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo iptables -t nat -A POSTROUTING -o <span class="hljs-variable">$WAN_IF</span> -j MASQUERADE<br></code></pre></td></tr></table></figure><br>Allow traffic forwarding:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo iptables -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT<br></code></pre></td></tr></table></figure><br>Allow traffic forwarding from the ZeroTier interface to the WAN interface:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo iptables -A FORWARD -i <span class="hljs-variable">$ZT_IF</span> -o <span class="hljs-variable">$WAN_IF</span> -j ACCEPT<br></code></pre></td></tr></table></figure><br>Make <code>iptables</code> rules persist after reboot:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install iptables-persistent<br></code></pre></td></tr></table></figure><br>Save your new <code>iptables</code> rules:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo netfilter-persistent save<br></code></pre></td></tr></table></figure></p><blockquote><p><strong>RESTART</strong><br>At this point it would be a good idea to restart your exit node and verify that the routing rules have persisted.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo iptables-save<br>-----------------------------------------------------------------------------------------------<br>...<br><br>-A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT<br>-A FORWARD -i zthnhhqofq -o eth0 -j ACCEPT<br><br>...<br><br>-A POSTROUTING -o eth0 -j MASQUERADE<br><br>...<br></code></pre></td></tr></table></figure><p>Your exit node is complete, now we need to configure your network.</p><h3 id="Configure-your-network"><a href="#Configure-your-network" class="headerlink" title="Configure your network"></a>Configure your network</h3><p>Now that your exit node is set up we need to configure your ZeroTier network to advertise a Default Route so that other nodes know that the exit node can route traffic to the internet.<br>Central &gt; Network &gt;</p><h3 id="Tell-other-nodes-to-use-exit-node"><a href="#Tell-other-nodes-to-use-exit-node" class="headerlink" title="Tell other nodes to use exit node"></a>Tell other nodes to use exit node</h3><blockquote><p><strong>~/.BASHRC</strong><br>Try adding something like the following for simple tunnel on/off control:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros">tunnel()<br>&#123;<br> sudo zerotier-cli <span class="hljs-built_in">set</span> <span class="hljs-variable">$nwid</span> <span class="hljs-attribute">allowDefault</span>=1<br>&#125;<br><br>notunnel()<br>&#123;<br> sudo zerotier-cli <span class="hljs-built_in">set</span> <span class="hljs-variable">$nwid</span> <span class="hljs-attribute">allowDefault</span>=0<br>&#125;<br></code></pre></td></tr></table></figure></p></blockquote><h2 id="Cloud-Deployments"><a href="#Cloud-Deployments" class="headerlink" title="Cloud Deployments"></a>Cloud Deployments</h2><h3 id="Terraform"><a href="#Terraform" class="headerlink" title="Terraform"></a>Terraform</h3><blockquote><p><strong>ADVANCED</strong><br>For the multi-cloud edition of this guide, click <a href="https://docs.zerotier.com/terraform-multicloud">here</a></p></blockquote><h4 id="Welcome"><a href="#Welcome" class="headerlink" title="Welcome"></a>Welcome</h4><p>Managing large numbers of settings in a webUI can be a total bummer. It’d be much nicer if we could describe our ZeroTier networks and membership settings as code. That would let us keep them in version control, and integrate them into our software delivery pipelines.<br>Now we can!<br>Terraform allows us to talk to the ZeroTier Central API and describe our network infrastructure, as code. This tutorial will walk you though how to get started.<br>To follow along step by step, you will need:</p><ul><li>A <a href="https://github.com/">Github</a> account,</li><li>A <a href="https://my.zerotier.com/">ZeroTier Central</a> account,</li><li>A <a href="https://my.zerotier.com/">Terraform Cloud</a> account.</li></ul><p>It should take you about 10 minutes to through this tutorial. It will be done in browser without touching the command line at all.</p><h4 id="Import-the-Quickstart-repo"><a href="#Import-the-Quickstart-repo" class="headerlink" title="Import the Quickstart repo"></a>Import the Quickstart repo</h4><p>Use Github’s <a href="https://github.com/new/import">Import</a> feature to create a private copy of the <a href="https://github.com/zerotier/terraform-quickstart">ZeroTier Terraform Quickstart repo</a>. We will hook this up to a Terraform runner on <a href="https://app.terraform.io/">Terraform Cloud</a>. After that, we will use Github’s in-browser editing feature to drive the tutorial.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318180825.png" alt="20240318180825"></p><h4 id="Create-a-Terraform-workspace"><a href="#Create-a-Terraform-workspace" class="headerlink" title="Create a Terraform workspace"></a>Create a Terraform workspace</h4><p>Next, we create a Terraform workspace and attach it to our private Github repository. Be sure to select <strong><em>version control workflow</em></strong>, select the correct Github account, (we want the private copy, not the original), and give it a unique name.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318180949.png" alt="20240318180949"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181001.png" alt="20240318181001"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181011.png" alt="20240318181011"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181020.png" alt="20240318181020"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181029.png" alt="20240318181029"></p><h4 id="Create-a-Central-API-Token"><a href="#Create-a-Central-API-Token" class="headerlink" title="Create a Central API Token"></a>Create a Central API Token</h4><p>Next, we create an API token that Terraform will use to drive the ZeroTier Central API. Navigate to <code>Account</code> -&gt; <code>API Access Tokens</code>.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181104.png" alt="20240318181104"></p><h4 id="Add-token-as-a-Workspace-Environment-Variable"><a href="#Add-token-as-a-Workspace-Environment-Variable" class="headerlink" title="Add token as a Workspace Environment Variable"></a>Add token as a Workspace Environment Variable</h4><p>Add the token as an Environment Variable to our workspace. This will let the <a href="https://github.com/zerotier/terraform-provider-zerotier">ZeroTier Terraform Provider</a> authenticate to the API. The variable must be named <code>ZEROTIER_CENTRAL_TOKEN</code>. Be sure to check the <code>Sensitive</code> box.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181210.png" alt="20240318181210"></p><h4 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h4><p>This example is probably the simplest thing you can do with ZeroTier. It creates a single network, then joins two members. The <code>member_id</code> settings in the repository are made up, which is good enough to demonstrate how to drive the API with Terraform. Feel free to replace them with real Node IDs of any devices you may wish to join to the networks.<br>In your Github repo, click on <code>hello.tf</code>. There will be a little “edit” icon around the section with the code. Uncomment the Terraform resources and click the green “commit changes” button.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181312.png" alt="20240318181312"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181322.png" alt="20240318181322"><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs json">resource <span class="hljs-string">&quot;zerotier_network&quot;</span> <span class="hljs-string">&quot;hello&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  name        = <span class="hljs-string">&quot;hello&quot;</span><br>  description = <span class="hljs-string">&quot;Hello World&quot;</span><br>  assignment_pool <span class="hljs-punctuation">&#123;</span><br>    start = <span class="hljs-string">&quot;192.168.42.1&quot;</span><br>    end   = <span class="hljs-string">&quot;192.168.42.254&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  route <span class="hljs-punctuation">&#123;</span><br>    target = <span class="hljs-string">&quot;192.168.42.0/24&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br>resource <span class="hljs-string">&quot;zerotier_member&quot;</span> <span class="hljs-string">&quot;alice&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  name        = <span class="hljs-string">&quot;alice&quot;</span><br>  member_id   = <span class="hljs-string">&quot;a11c3411ce&quot;</span><br>  description = <span class="hljs-string">&quot;Alice&#x27;s laptop&quot;</span><br>  network_id  = zerotier_network.hello.id<br><span class="hljs-punctuation">&#125;</span><br><br>resource <span class="hljs-string">&quot;zerotier_member&quot;</span> <span class="hljs-string">&quot;bob&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  name        = <span class="hljs-string">&quot;bob&quot;</span><br>  member_id   = <span class="hljs-string">&quot;b0bd0bb0bb&quot;</span><br>  description = <span class="hljs-string">&quot;Bob&#x27;s laptop&quot;</span><br>  network_id  = zerotier_network.hello.id<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><br>Queue a plan then “Confirm and Apply”.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181358.png" alt="20240318181358"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181408.png" alt="20240318181408"><br>After Terraform applies the plan, check out the ZeroTier Cental webUI to confirm it was created.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181434.png" alt="20240318181434"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181445.png" alt="20240318181445"></p><h4 id="Bridging-Networks"><a href="#Bridging-Networks" class="headerlink" title="Bridging Networks"></a>Bridging Networks</h4><p>The next example manipulates the <code>allow_ethernet_bridging</code> settings on the Member objects. When running on machines with multiple physical Ethernet interfaces, ZeroTier can be configured to pass layer2 traffic such as ARP, NDP, multicast, mDNS, etc.<br>To make this work, you’ll need to go into your router’s OS and configure a bridge between a physical interface and the ZeroTier interface.<br>The <a href="https://registry.terraform.io/modules/zerotier/network/zerotier/">ZeroTier Network</a> Terraform module provides a slightly nicer interface, letting us use CIDRs for our subnets.<br>Repeat the steps from “Hello World” with <code>bridging.tf</code><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181548.png" alt="20240318181548"><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs json">module <span class="hljs-string">&quot;bridgenet&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  source      = <span class="hljs-string">&quot;zerotier/network/zerotier&quot;</span><br>  version     = <span class="hljs-string">&quot;1.0.0&quot;</span><br>  name        = <span class="hljs-string">&quot;bridgenet&quot;</span><br>  description = <span class="hljs-string">&quot;bridging example&quot;</span><br>  subnets     = <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;10.10.0.0/16&quot;</span><span class="hljs-punctuation">]</span><br>  flow_rules  = <span class="hljs-string">&quot;accept;&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><br>resource <span class="hljs-string">&quot;zerotier_member&quot;</span> <span class="hljs-string">&quot;router1&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  name                    = <span class="hljs-string">&quot;router1&quot;</span><br>  member_id               = <span class="hljs-string">&quot;71c71c71c1&quot;</span><br>  description             = <span class="hljs-string">&quot;Alice&#x27;s router&quot;</span><br>  ip_assignments          = <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;10.10.1.1&quot;</span><span class="hljs-punctuation">]</span><br>  allow_ethernet_bridging = <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  network_id              = module.bridgenet.id<br><span class="hljs-punctuation">&#125;</span><br><br>resource <span class="hljs-string">&quot;zerotier_member&quot;</span> <span class="hljs-string">&quot;router2&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  name                    = <span class="hljs-string">&quot;router2&quot;</span><br>  member_id               = <span class="hljs-string">&quot;71c71c71c2&quot;</span><br>  description             = <span class="hljs-string">&quot;Bob&#x27;s router&quot;</span><br>  ip_assignments          = <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;10.10.2.1&quot;</span><span class="hljs-punctuation">]</span><br>  allow_ethernet_bridging = <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  network_id              = module.bridgenet.id<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181612.png" alt="20240318181612"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181620.png" alt="20240318181620"><br>After Terraform applies the plan, check out the ZeroTier Cental webUI to confirm it was created.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181637.png" alt="20240318181637"></p><h4 id="Network-Segmentation"><a href="#Network-Segmentation" class="headerlink" title="Network Segmentation"></a>Network Segmentation</h4><p>The next example creates the networks, <code>red</code>, <code>green</code>, and <code>yellow</code>. We define two groups. The red team gets access to the <code>red</code> network, and the green team gets access to the green network. Red and green make <code>yellow</code>.<br>Repeat the steps from “Hello World” with <code>groups.tf</code><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181737.png" alt="20240318181737"><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs json">variable <span class="hljs-string">&quot;segments&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  default = <span class="hljs-punctuation">&#123;</span><br>    red = <span class="hljs-punctuation">&#123;</span><br>      description = <span class="hljs-string">&quot;red&quot;</span><br>      subnets     = <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;10.1.0.0/16&quot;</span><span class="hljs-punctuation">]</span><br>      flow_rules  = <span class="hljs-string">&quot;accept;&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>    green = <span class="hljs-punctuation">&#123;</span><br>      description = <span class="hljs-string">&quot;green&quot;</span><br>      subnets     = <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;10.2.0.0/16&quot;</span><span class="hljs-punctuation">]</span><br>      flow_rules  = <span class="hljs-string">&quot;accept;&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>    yellow = <span class="hljs-punctuation">&#123;</span><br>      description = <span class="hljs-string">&quot;yellow&quot;</span><br>      subnets     = <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;10.3.0.0/16&quot;</span><span class="hljs-punctuation">]</span><br>      flow_rules  = <span class="hljs-string">&quot;accept;&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br>variable <span class="hljs-string">&quot;members&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  default = <span class="hljs-punctuation">&#123;</span><br>    red = <span class="hljs-punctuation">&#123;</span><br>      eve = <span class="hljs-punctuation">&#123;</span><br>        description = <span class="hljs-string">&quot;Eve&#x27;s Laptop&quot;</span><br>        member_id   = <span class="hljs-string">&quot;34b34b34b3&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>      steve = <span class="hljs-punctuation">&#123;</span><br>        description = <span class="hljs-string">&quot;Steve&#x27;s Laptop&quot;</span><br>        member_id   = <span class="hljs-string">&quot;573b3573b3&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>    green = <span class="hljs-punctuation">&#123;</span><br>      cletus = <span class="hljs-punctuation">&#123;</span><br>        description = <span class="hljs-string">&quot;Cletus&#x27; Laptop&quot;</span><br>        member_id   = <span class="hljs-string">&quot;c133715b0b&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>      brandie = <span class="hljs-punctuation">&#123;</span><br>        description = <span class="hljs-string">&quot;Brandie&#x27;s Laptop&quot;</span><br>        member_id   = <span class="hljs-string">&quot;b33fb33fff&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br>module <span class="hljs-string">&quot;segments&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  for_each    = var.segments<br>  source      = <span class="hljs-string">&quot;zerotier/network/zerotier&quot;</span><br>  version     = <span class="hljs-string">&quot;1.0.0&quot;</span><br>  name        = each.key<br>  description = each.value.description<br>  subnets     = each.value.subnets<br>  flow_rules  = each.value.flow_rules<br><span class="hljs-punctuation">&#125;</span><br><br>resource <span class="hljs-string">&quot;zerotier_member&quot;</span> <span class="hljs-string">&quot;red&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  for_each   = <span class="hljs-punctuation">&#123;</span> for k<span class="hljs-punctuation">,</span> v in var.members.red <span class="hljs-punctuation">:</span> (k) =&gt; v <span class="hljs-punctuation">&#125;</span><br>  name       = each.key<br>  member_id  = each.value.member_id<br>  network_id = module.segments<span class="hljs-punctuation">[</span><span class="hljs-string">&quot;red&quot;</span><span class="hljs-punctuation">]</span>.id<br><span class="hljs-punctuation">&#125;</span><br><br>resource <span class="hljs-string">&quot;zerotier_member&quot;</span> <span class="hljs-string">&quot;green&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  for_each   = <span class="hljs-punctuation">&#123;</span> for k<span class="hljs-punctuation">,</span> v in var.members.green <span class="hljs-punctuation">:</span> (k) =&gt; v <span class="hljs-punctuation">&#125;</span><br>  name       = each.key<br>  member_id  = each.value.member_id<br>  network_id = module.segments<span class="hljs-punctuation">[</span><span class="hljs-string">&quot;green&quot;</span><span class="hljs-punctuation">]</span>.id<br><span class="hljs-punctuation">&#125;</span><br><br>resource <span class="hljs-string">&quot;zerotier_member&quot;</span> <span class="hljs-string">&quot;yellow&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  for_each   = <span class="hljs-punctuation">&#123;</span> for k<span class="hljs-punctuation">,</span> v in merge(var.members.red<span class="hljs-punctuation">,</span> var.members.green) <span class="hljs-punctuation">:</span> (k) =&gt; v <span class="hljs-punctuation">&#125;</span><br>  name       = each.key<br>  member_id  = each.value.member_id<br>  network_id = module.segments<span class="hljs-punctuation">[</span><span class="hljs-string">&quot;yellow&quot;</span><span class="hljs-punctuation">]</span>.id<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181809.png" alt="20240318181809"><br>After Terraform applies the plan, check out the ZeroTier Cental webUI to confirm it was created.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181827.png" alt="20240318181827"></p><h4 id="Many-to-Many"><a href="#Many-to-Many" class="headerlink" title="Many to Many"></a>Many to Many</h4><p>In the last example, show how to assign many members to many networks. This example used the Terraform <a href="https://www.terraform.io/docs/language/functions/setproduct.html">setproduct</a> function to find all possible combinations of two sets.</p><p>The <code>zerotier_identity</code> resource is a distant cousin of the Terraform <a href="https://registry.terraform.io/providers/hashicorp/tls/latest/docs/resources/private_key">tls_private_key</a> resource. This resource would normally be used to inject secrets into cloud instances via <code>cloudinit</code>. We encourage you to use the <a href="https://app.terraform.io/">Terraform Cloud</a> to keep your Terraform state safe.</p><p>Repeat the steps from “Hello World” with <code>many2many.tf</code><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182052.png" alt="20240318182052"><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs json">variable <span class="hljs-string">&quot;letters&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  default = <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;alfa&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;bravo&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;charlie&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br>variable <span class="hljs-string">&quot;shapes&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  default = <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;circle&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;square&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;diamond&quot;</span> <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br>resource <span class="hljs-string">&quot;zerotier_identity&quot;</span> <span class="hljs-string">&quot;letters&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  for_each = <span class="hljs-punctuation">&#123;</span> for i in var.letters <span class="hljs-punctuation">:</span> i =&gt; i <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br>module <span class="hljs-string">&quot;shapes&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  for_each    = <span class="hljs-punctuation">&#123;</span> for i<span class="hljs-punctuation">,</span> k in var.shapes <span class="hljs-punctuation">:</span> (k) =&gt; i <span class="hljs-punctuation">&#125;</span><br>  source      = <span class="hljs-string">&quot;zerotier/network/zerotier&quot;</span><br>  version     = <span class="hljs-string">&quot;1.0.0&quot;</span><br>  name        = each.key<br>  description = each.key<br>  subnets     = <span class="hljs-punctuation">[</span>cidrsubnet(<span class="hljs-string">&quot;10.11.0.0/16&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span> each.value)<span class="hljs-punctuation">]</span><br>  flow_rules  = <span class="hljs-string">&quot;accept;&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><br>resource <span class="hljs-string">&quot;zerotier_member&quot;</span> <span class="hljs-string">&quot;shape-letters&quot;</span> <span class="hljs-punctuation">&#123;</span><br>  for_each    = <span class="hljs-punctuation">&#123;</span> for i in setproduct(var.letters<span class="hljs-punctuation">,</span> keys(module.shapes)) <span class="hljs-punctuation">:</span> join(<span class="hljs-string">&quot;-&quot;</span><span class="hljs-punctuation">,</span> flatten(i)) =&gt; i <span class="hljs-punctuation">&#125;</span><br>  name        = each.key<br>  member_id   = zerotier_identity.letters<span class="hljs-punctuation">[</span>each.value<span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span>.id<br>  description = module.shapes<span class="hljs-punctuation">[</span>each.value<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span>.description<br>  network_id  = module.shapes<span class="hljs-punctuation">[</span>each.value<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span>.id<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182119.png" alt="20240318182119"><br>After Terraform applies the plan, check out the ZeroTier Cental webUI to confirm it was created.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182136.png" alt="20240318182136"></p><h4 id="Cleaning-up"><a href="#Cleaning-up" class="headerlink" title="Cleaning up"></a>Cleaning up</h4><p>When you’re done experimenting with ZeroTier and Terraform, tear everything down by queueing a destroy plan.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182157.png" alt="20240318182157"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182210.png" alt="20240318182210"></p><h4 id="That’s-all-folks"><a href="#That’s-all-folks" class="headerlink" title="That’s all folks"></a>That’s all folks</h4><p>If you like this tutorial, check out the <a href="https://docs.zerotier.com/terraform/multicloud-quickstart">ZeroTier Multicloud Terraform Quickstart</a> next!<br>-s</p><h3 id="cloud-init"><a href="#cloud-init" class="headerlink" title="cloud-init"></a>cloud-init</h3><h4 id="Set-up-ZeroTier-using-cloud-init"><a href="#Set-up-ZeroTier-using-cloud-init" class="headerlink" title="Set up ZeroTier using cloud-init"></a>Set up ZeroTier using <code>cloud-init</code></h4><h5 id="What-is-cloud-init"><a href="#What-is-cloud-init" class="headerlink" title="What is cloud-init?"></a>What is <code>cloud-init</code>?</h5><p>cloud-init is a convenient and cross-platform way to initialize cloud instances. It is supported by all major cloud providers. You can use it to configure OS settings, install packages, or even start up specific instances of ZeroTier.</p><h5 id="How-do-you-use-it"><a href="#How-do-you-use-it" class="headerlink" title="How do you use it?"></a>How do you use it?</h5><p>Typically a cloud-init file can be uploaded to a cloud provider or added as an additional payload via an API.</p><h5 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs conf">#cloud-config<br><br>hostname: &quot;devbox&quot;<br>users:<br>  - name: wrankles<br><br>shell: /bin/bash<br><br>disable_root: 1<br>ssh_pwauth:   0<br>packages:<br>  - htop<br>  - tcpdump<br><br>runcmd:<br>  - apt-get update<br>  #- mkdir -p /var/lib/zerotier-one<br>  #- echo &quot;1234567890:0:...&quot; &gt; /var/lib/zerotier-one/identity.secret<br>  #- echo &quot;1234567890:0:...&quot; &gt; /var/lib/zerotier-one/identity.public<br>  - curl -s https://install.zerotier.com | bash<br>  - zerotier-cli join cfb8bf9836c2fc3a<br>  - systemctl restart ssh<br></code></pre></td></tr></table></figure><h5 id="Pre-populate-ZeroTier-identities-optional"><a href="#Pre-populate-ZeroTier-identities-optional" class="headerlink" title="Pre-populate ZeroTier identities(optional)"></a>Pre-populate ZeroTier identities(optional)</h5><p>Uncomment the <code>runcmd</code> lines starting with <code>mkdir</code> and <code>echo</code> if you want to write known ZeroTier identities to disk before startup. This is useful if you’ve already authorized or scripted around a specific node ID and want it to start up the same each time.</p><blockquote><p><strong>CAUTION</strong><br>If you place your ZeroTier node’s secret key in your cloud init file it is possible for someone to impersonate your node if they get ahold of this cloud-init file.</p></blockquote><h5 id="Password-less-SSH-optional"><a href="#Password-less-SSH-optional" class="headerlink" title="Password-less SSH (optional)"></a>Password-less SSH (optional)</h5><p>It’s usually recommended that you disable the root account and disable password-based ssh authentication and rely solely on key-based authentication. <a href="https://www.digitalocean.com/community/tutorials/how-to-use-cloud-config-for-your-initial-server-setup">Digital Ocean has some really great documentation on the subject</a>.<br>To make getting into your cloud instance as easy as possible you can add entries to <code>authorized_keys</code>:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ssh">ssh-authorized-keys:<br>    - ssh-rsa AAAAB38fwi3756q238if75dh6awd476r3bg78f56ghfaa7fdh63qf5dq378f5632gha3875j3f498da7hfhjkfawejtfsktfr89ew4jftsjrf8t9rhg7tjser8tsre7yjgvased89rfdcsh67rewhg8tq7tsge546w4<br></code></pre></td></tr></table></figure><br>To make getting into other instances <em>from this instance</em> easier, you can add a pre-generated private key to <code>ssh_keys</code>:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ssh">ssh_deletekeys: false<br>ssh_keys:<br>    ed25519_private: |<br>        -----BEGIN OPENSSH PRIVATE KEY-----<br>        $#HYBES$Y%GW$Gfs9g8ES$Y%GW$Gfs9g867ZDI1NTE5AAAAIHQbjzWgsNOt/8gH+QI/Eob<br>        fs9g867q34tqGT$#HYBES$mZ+AW4OZPnTPI89ZPmVMLuayrD2cE86Z/il8b+867q34tqGT<br>        fs9g867q34ZDI1NTE5AAAAIHQbjzWgsNOt/8gH+QI/Eob6BES$Y%$#HYBES$Y%GW$Gfs9g<br>        fs9g867q34tqGT$#HYBES$YZDI1NTE5AAAAIHQbjzWgsNOt/8gH+QI/Eob6Z/8ZXbHHdGx<br>        fs9g867mZ+AW4OZPnTPI89ZPmVMLuayrD2cE86Z/il8b+gw3s9g867q4g<br>        -----END OPENSSH PRIVATE KEY-----<br><br>    ed25519_public: ssh-ed25519 AAAAB3NzaC1yc2EAAAABIwAAAQEAklOUpqxiX1nKhXpHAZsMciLq8V6RjsHDTYW7hdI4 devbox<br></code></pre></td></tr></table></figure><br><a href="https://wiki.archlinux.org/title/SSH_keys">Read more about SSH keys here</a></p><h2 id="Advanced-Networking"><a href="#Advanced-Networking" class="headerlink" title="Advanced Networking"></a>Advanced Networking</h2><h3 id="Multipath-1"><a href="#Multipath-1" class="headerlink" title="Multipath"></a>Multipath</h3><p>Multipath allows the simultaneous (or conditional) aggregation of multiple physical links into a bond for increased total throughput, load balancing, redundancy, and fault tolerance. There is a set of standard bonding policies available that can be used right out of the box with no configuration. These policies are inspired by <a href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">the policies offered by the Linux kernel</a>. A bonding policy can be used easily without specifying any additional parameters. For example:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs conf">Example local.conf<br>-------------------------------------------------------------------------------------<br>&#123; &quot;settings&quot;: &#123; &quot;defaultBondingPolicy&quot;: &quot;active-backup&quot; &#125; &#125;<br></code></pre></td></tr></table></figure></p><h4 id="Standard-policies"><a href="#Standard-policies" class="headerlink" title="Standard policies"></a>Standard policies</h4><ul><li><a href="https://docs.zerotier.com/multipath#active-backup">active-backup</a>: Use only one primary link at a time and failover to another designated link.</li><li><a href="https://docs.zerotier.com/multipath#broadcast">broadcast</a>: Duplicate traffic across all available links at all times.</li><li><a href="https://docs.zerotier.com/multipath#balance-rr">balance-rr</a>: Stripe packets across multiple links (not for use with TCP.)</li><li><a href="https://docs.zerotier.com/multipath#balance-xor">balance-xor</a>: Hash flows to specific links.</li><li><a href="https://docs.zerotier.com/multipath#balance-aware">balance-aware</a>: Auto-balance flows across links.</li></ul><h4 id="Custom-policies"><a href="#Custom-policies" class="headerlink" title="Custom policies"></a>Custom policies</h4><p>To customize a bonding policy simply specify a standard policy as <code>basePolicy</code> and override its parameters. Note that a modified custom policy <em>cannot</em> have the same name as a standard policy. (Note how we renamed the following example to <code>rapid-active-backup</code>). For example, to create a more rapid <code>active-backup</code> policy that will failover <code>1 second</code> after it detects a link failure:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs conf">local.conf<br>------------------------------------------------------------------------------------<br>&#123;<br>  &quot;settings&quot;:<br>  &#123;<br>    &quot;defaultBondingPolicy&quot;: &quot;rapid-active-backup&quot;,<br>    &quot;policies&quot;:<br>    &#123;<br>      &quot;rapid-active-backup&quot;:<br>      &#123;<br>        &quot;basePolicy&quot;: &quot;active-backup&quot;,<br>        &quot;failoverInterval&quot;: 1000<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br>You can only override parameters that are valid for the chosen <code>basePolicy</code>. The list below shows parameters that can apply to any policy. Parameters that are unique to a given policy type are described in that policy’s section.<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json">Example policy settings (not valid JSON)<br>------------------------------------------------------------------------------------<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;defaultBondingPolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rapid-active-backup&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;policies&quot;</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;rapid-active-backup&quot;</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;basePolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;active-backup&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;failoverInterval&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;upDelay&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-number">-65535</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;downDelay&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-number">-65535</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></p><h4 id="Physical-interfaces"><a href="#Physical-interfaces" class="headerlink" title="Physical interfaces"></a>Physical interfaces</h4><p>Bonds are composed of multiple links (known paths over system network interfaces). By default if no interfaces are specified ZeroTier will attempt to use all network interfaces, including your expensive wireless links. In order to avoid this you should tell ZeroTier which interfaces are okay to talk on and also under what conditions. If a set of links is defined, ZeroTier will use only those links and ignore everything else.<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs json">Example local.conf<span class="hljs-punctuation">:</span> To specify that ZeroTier should only use eth1 but then failover to eth2 and that it should prefer IPv4 over IPv6 except on eth2 where only IPv6 is allowed.<br>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;defaultBondingPolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rapid-active-backup&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;policies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;rapid-active-backup&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;basePolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;active-backup&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;failoverInterval&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;links&quot;</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;eth0&quot;</span><span class="hljs-punctuation">:</span><br>          <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;ipvPref&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">46</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;failoverTo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eth1&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;eth1&quot;</span><span class="hljs-punctuation">:</span><br>          <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;ipvPref&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">46</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;failoverTo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eth2&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;eth2&quot;</span><span class="hljs-punctuation">:</span><br>          <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;ipvPref&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></p><h4 id="Link-settings"><a href="#Link-settings" class="headerlink" title="Link settings"></a>Link settings</h4><p>The behavior of links can be changed by setting various properties:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json">Customizable link parameters (not valid JSON)<br>-------------------------------------------------------------------------------------<br>...<br><br><span class="hljs-attr">&quot;links&quot;</span><span class="hljs-punctuation">:</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;eth0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-comment">/* Network interface system name */</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;ipvPref&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-number">4</span><span class="hljs-punctuation">,</span><span class="hljs-number">6</span><span class="hljs-punctuation">,</span><span class="hljs-number">46</span><span class="hljs-punctuation">,</span><span class="hljs-number">64</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">/* (optional) IP version preference for paths on a link. */</span><br>    <span class="hljs-attr">&quot;capacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-number">-1000000</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">/* (optional) Arbitrary units of link &quot;capacity&quot;. Can be used to manually allocate traffic. */</span><br>    <span class="hljs-attr">&quot;failoverTo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;failoverInterfaceName&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">/* (optional) Which link should be used next after a failure of this link. */</span><br>    <span class="hljs-attr">&quot;mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;primary&quot;</span>|<span class="hljs-string">&quot;spare&quot;</span> <span class="hljs-comment">/* (optional) Whether this link is used by default or only after all other links fail. */</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  ...<br><span class="hljs-punctuation">&#125;</span><br><br>...<br></code></pre></td></tr></table></figure></p><h4 id="Spare-links"><a href="#Spare-links" class="headerlink" title="Spare links"></a>Spare links</h4><p>A warm spare is a link that is not actively used to process traffic until all other available links are down. Note however that some ambient probing traffic is still sent to guarantee its performance. Spare links are not available when using the <code>broadcast</code> policy. Cold spares are left as an exercise for the reader.<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">Example local.conf: To specify that traffic <span class="hljs-keyword">should </span><span class="hljs-keyword">be </span>hashed over two links eth0 <span class="hljs-keyword">and </span>eth1 <span class="hljs-keyword">and </span>that expensive_lte0 <span class="hljs-keyword">should </span>only <span class="hljs-keyword">be </span>used when the other two are down.<br>---------------------------------------------------------------------------------------------------------------------------------------------------<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;defaultBondingPolicy&quot;</span>: <span class="hljs-string">&quot;xor-with-a-spare&quot;</span>,<br>    <span class="hljs-string">&quot;policies&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;xor-with-a-spare&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;basePolicy&quot;</span>: <span class="hljs-string">&quot;balance-xor&quot;</span>,<br>        <span class="hljs-string">&quot;links&quot;</span>:<br>        &#123;<br>          <span class="hljs-string">&quot;eth0&quot;</span>:<br>          &#123;<br>            <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;primary&quot;</span><br>          &#125;,<br>          <span class="hljs-string">&quot;eth1&quot;</span>:<br>          &#123;<br>            <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;primary&quot;</span><br>          &#125;,<br>          <span class="hljs-string">&quot;expensive_lte0&quot;</span>:<br>          &#123;<br>            <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;spare&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h4 id="Peer-specific-bonds"><a href="#Peer-specific-bonds" class="headerlink" title="Peer-specific bonds"></a>Peer-specific bonds</h4><p>It is possible to use a policy for one peer and another policy for a different peer. For instance, if one were to want <code>active-backup</code> for all peers by default but for certain peers to be bonded with a custom load-balanced bond such as <code>my-custom-balance-xor</code> one could do the following:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs json">Example local.conf<br>-----------------------------------------------<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;defaultBondingPolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;active-backup&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;policies&quot;</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;my-custom-balance-xor&quot;</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;failoverInterval&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2000</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;upDelay&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5000</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;basePolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;balance-xor&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;peerSpecificBonds&quot;</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;f6203a2db3&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;my-custom-balance-xor&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;45b0301da2&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;my-custom-balance-xor&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;a92cb526fa&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;my-custom-balance-xor&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></p><h4 id="active-backup"><a href="#active-backup" class="headerlink" title="active-backup"></a>active-backup</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs json">Example local.conf<br><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;defaultBondingPolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;active-backup&quot;</span> <span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>Traffic is sent on only one link at any time. A different link becomes active if the current link fails. This mode provides fault tolerance with a nearly immediate failover depending on the <code>failoverInterval</code> you set. This mode does not increase total throughput. If no <code>primary</code> and <code>spare</code> links are defined ZeroTier will attempt to pick the best one.</p><ul><li><code>mode</code>: <code>primary|spare</code> Link option which specifies which link is the primary device. The specified device is intended to always be the active link while it is available. There are exceptions to this behavior when using different <code>linkSelectMethod</code> modes. There can only be one <code>primary</code> link in this bonding policy.</li><li><code>linkSelectMethod</code>: Specifies the selection policy for the active link during failure and/or recovery events. This is similar to the Linux Kernel’s <code>primary_reselect</code> option but with a minor extension:<ul><li><code>optimize</code>: <strong>(default if user provides no failover guidance)</strong> The primary link can change periodically if a superior link is detected.</li><li><code>always</code>: <strong>(default when links are explicitly specified)</strong>: Primary link regains status as active link whenever it comes back up.</li><li><code>better</code>: Primary link regains status as active link when it comes back up and (if) it is better than the currently-active link.</li><li><code>failure</code>: Primary link regains status as active link only if the currently-active link fails.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs conf">Example local.conf<br>------------------------------------------------------------------------------<br>&#123;<br>  &quot;settings&quot;:<br>  &#123;<br>    &quot;defaultBondingPolicy&quot;: &quot;custom-active-backup&quot;,<br>    &quot;custom-active-backup&quot;:<br>    &#123;<br>      &quot;basePolicy&quot;: &quot;active-backup&quot;,<br>      &quot;linkSelectMethod&quot;: &quot;always&quot;,<br>      &quot;failoverInterval&quot;: 5000,<br>      &quot;links&quot;:<br>      &#123;<br>        &quot;eth0&quot;: &#123; &quot;failoverTo&quot;: &quot;eth1&quot;, &quot;mode&quot;: &quot;primary&quot; &#125;,<br>        &quot;eth1&quot;: &#123; &quot;mode&quot;: &quot;spare&quot; &#125;,<br>        &quot;eth2&quot;: &#123; &quot;mode&quot;: &quot;spare&quot; &#125;,<br>        &quot;eth3&quot;: &#123; &quot;mode&quot;: &quot;spare&quot; &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="broadcast"><a href="#broadcast" class="headerlink" title="broadcast"></a>broadcast</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json">Example local.conf<br>-------------------------------------------------------<br><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;defaultBondingPolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;broadcast&quot;</span> <span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>Traffic is sent on <em>all</em> available links simultaneously. This mode provides fault tolerance and effectively immediate failover due to transmission redundancy. This mode is a poor utilization of throughput resources and will <strong>not</strong> increase throughput but can prevent packet loss during a link failure.</li></ul></li></ul><h4 id="balance-rr"><a href="#balance-rr" class="headerlink" title="balance-rr"></a>balance-rr</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json">Example local.conf<br>--------------------------------------------------------------------<br><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;defaultBondingPolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;balance-rr&quot;</span> <span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>Traffic is striped across multiple links. This mode offers partial fault tolerance immediately, full fault tolerance eventually. This policy is unaware of protocols and is primarily intended for use with protocols that are not sensitive to reordering delays. The only option available for this policy is <code>packetsPerLink</code> which specifies the number of packets to transmit via a link before moving to the next link in the round-robin sequence. When set to <code>0</code> a link is chosen at random for each outgoing packet (doing so would be inefficient). The default value is <code>64</code>, lower values can begin to add overhead to packet processing. This mode is <strong>not</strong> suitable for traffic that is sensitive to re-ordering such as TCP.</p><h4 id="balance-xor"><a href="#balance-xor" class="headerlink" title="balance-xor"></a>balance-xor</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json">Example local.conf<br>------------------------------------------------------------<br><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;defaultBondingPolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;balance-xor&quot;</span> <span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>Traffic is categorized into <em>flows</em> based on <em>source port</em>, <em>destination port</em>, and <em>protocol type</em> these flows are then hashed onto available links where they will persist for the duration of their life. Traffic that does not have an assigned port (such as ICMP pings) will be randomly distributed across links. This mode offers partial fault tolerance immediately, full fault tolerance eventually. This mode is suitable for traffic that is sensitive to re-ordering such as TCP.</p><h4 id="balance-aware"><a href="#balance-aware" class="headerlink" title="balance-aware"></a>balance-aware</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json">Example local.conf<br>------------------------------------------------------<br><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;defaultBondingPolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;balance-aware&quot;</span> <span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>This mode operates similarly to <code>balance-xor</code> in that it hashes flows onto specific links. However, it may reassign flows mid-conversation and perform other types of optimizations. This mode may surprise you more often than <code>balance-xor</code> by causing re-ordering delays for certain flows but it should lead to a better total experience when all flows are considered. This policy allows you to specify not only <a href="https://docs.zerotier.com/multipath#asymmetric-links">relative link capacities</a> but also a <a href="https://docs.zerotier.com/multipath#link-quality">notion of quality</a> expressed as a weighted vector with a sum of <code>1.0</code>. See below:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs json">Example local.conf<span class="hljs-punctuation">:</span> A maximum acceptable value for latency and packet delay variance are given along with weights that tell ZeroTier how important that limit is. Additionally<span class="hljs-punctuation">,</span> link capacities are given as hints to enable proportional traffic allocation.<br>------------------------------------------------------------------------------------------------------------------------------------------------------------------<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;defaultBondingPolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;custom-balance-aware&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;policies&quot;</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;custom-balance-aware&quot;</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;basePolicy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;balance-aware&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;failoverInterval&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5000</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;linkQuality&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;lat_max&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">400.0</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;pdv_max&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">20.0</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;lat_weight&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;pdv_weight&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0.5</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;links&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;wlan0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;capacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">250</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;eth0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;capacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000</span>  <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><br>In the above example if any links begin to show signs of saturation (for instance if latency increases beyond <code>400ms</code>) flows will be moved from it until it is no longer judged to be saturated.</p><h4 id="Link-Quality"><a href="#Link-Quality" class="headerlink" title="Link Quality"></a>Link Quality</h4><p>As seen in the <a href="https://docs.zerotier.com/multipath#balance-aware">balance-aware</a> example configuration, you can provide hints to ZeroTier as to when a link is no longer suitable for use. You can set limits on the following:</p><ul><li><code>lat_max</code>: Maximum (mean) latency observed over many samples</li><li><code>pdv_max</code>: Maximum packet delay variance (similar to jitter)<br>Then, weights must also be provided to tell ZeroTier how important your limits are (as a reminder, the weights must sum to <code>1.0</code>):<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-string">&quot;linkQuality&quot;</span>: &#123;<br>  <span class="hljs-string">&quot;lat_max&quot;</span> : 80.0,<br>  <span class="hljs-string">&quot;pdv_max&quot;</span> : 20.0,<br>  <span class="hljs-string">&quot;lat_weight&quot;</span> : 0.5,<br>  <span class="hljs-string">&quot;pdv_weight&quot;</span> : 0.5<br>&#125;<br></code></pre></td></tr></table></figure>If any one of these limits are violated ZeroTier will attempt to avoid assigning new flows to the link in question as well as begin moving flows from that link to other higher quality links. ZeroTier will first try to find a link that doesn’t violate any of your limits but if it is unable to do so it will pick the next best according to a quality ranking derived from your weights. There is no guarantee that links will be entirely avoided or that all of their flows will be moved if there are no better links to move to so these limits are merely strong suggestions to ZeroTier.<h4 id="Asymmetric-links"><a href="#Asymmetric-links" class="headerlink" title="Asymmetric links"></a>Asymmetric links</h4>Any set of physical links regardless of their relative performance may be combined using any of the policies. However if the relative performance among the links vary too wildly (for instance a fiber link and an LTE link) you may find that blindly striping or hashing traffic across them doesn’t turn out so well. For these scenarios it is recommended that you use <a href="https://docs.zerotier.com/multipath#balance-aware">balance-aware</a> and provide <code>capacity</code> and/or <code>linkQuality</code> hints to ZeroTier.<h5 id="Capacity"><a href="#Capacity" class="headerlink" title="Capacity"></a>Capacity</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs conf">Example capacities (not a valid config by itself)<br>------------------------------------------------------<br>&quot;links&quot;: &#123;<br>  &quot;wlan0&quot;: &#123; &quot;capacity&quot;: 250 &#125;,<br>  &quot;eth0&quot;: &#123; &quot;capacity&quot;: 1000  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>The term is meant to be a one-size-fits-all numerical value which represents the diameter of the pipe so to speak. That is, how much traffic it can process before it becomes clogged and congestion controls kick in. This will suggest to ZeroTier that it should assign traffic flows proportionally.<h5 id="Quality"><a href="#Quality" class="headerlink" title="Quality"></a>Quality</h5>Providing <a href="https://docs.zerotier.com/multipath#link-quality">quality</a> hints to ZeroTier can be done in conjunction with the aforementioned <code>capacity</code> property without issue. See the <a href="https://docs.zerotier.com/multipath#balance-aware">balance-aware</a> section for an example of how to do this.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs conf">Example local.conf: How to use arbitrary (but relative) capacity values<br>--------------------------------------------------------------------------<br>&#123;<br>  &quot;settings&quot;:<br>  &#123;<br>    &quot;defaultBondingPolicy&quot;: &quot;custom-balance-aware&quot;,<br>    &quot;policies&quot;:<br>    &#123;<br>      &quot;custom-balance-aware&quot;:<br>      &#123;<br>        &quot;basePolicy&quot;: &quot;balance-aware&quot;,<br>        &quot;links&quot;: &#123;<br>          &quot;eth0&quot;: &#123; &quot;capacity&quot;: 10000 &#125;,<br>          &quot;eth1&quot;: &#123; &quot;capacity&quot;: 1000  &#125;,<br>          &quot;eth2&quot;: &#123; &quot;capacity&quot;: 100   &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>The above configuration will roughly result in the following allocation:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">10000 + 1000 + 100 = 11100 total <span class="hljs-string">&quot;capacity units&quot;</span> across all links<br><br>eth0 10000 / 11100 = ~0.900 %<br>eth1 1000  / 11100 = ~0.090 %<br>eth2 100   / 11100 = ~0.009 %<br></code></pre></td></tr></table></figure>A good rule of thumb would be to express your known link speeds in units of <code>Mbit/s</code>. This isn’t strictly necessary as long as the quantities make sense relative to each other.<h4 id="Using-the-CLI"><a href="#Using-the-CLI" class="headerlink" title="Using the CLI"></a>Using the CLI</h4>Currently most configuration is handled via manual editing of each node’s <code>local.conf</code>. There are only a few available CLI commands.<br>To view bonds to all peers:<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">zerotier-cli bond list</span><br><span class="hljs-section">--------------------------------------------------------------</span><br><span class="hljs-code">    &lt;peer&gt;                        &lt;bondtype&gt;     &lt;links&gt;</span><br>2f33b459c1                       balance-xor         18/18<br>6af835ae71                     active-backup         2/2<br>77dcbe7120                     active-backup         5/5<br>cbae04eb89                     active-backup         5/5<br>bafe99feb9                     active-backup         3/3<br></code></pre></td></tr></table></figure><blockquote><p><strong>TIP</strong><br>If you’d like to ingest this data into your own monitoring solution use <code>zerotier-cli -j bond list</code> to emit a JSON blob instead.</p></blockquote></li></ul><p>To see the current state of a bond to a given peer:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">zerotier-cli bond 77dcbe7120 show<br>---------------------------------------------------------------------------------------------------------------------------------------------<br>Peer                   : 77dcbe7120<br>Bond                   : balance-rr<br>Link Select Method     : 0<br>Links                  : 4/4<br>Failover Interval (ms) : 500<br>Up Delay (ms)          : 0<br>Down Delay (ms)        : 0<br>Packets Per Link       : 64<br><br>idx                  interface                                  path               socket<br>----------------------------------------------------------------------------------------------------<br> 0:                     enp5s0                                192.168.88.155/57605 000055e03aa4d5a0<br> 1:                     enp5s0                                192.168.88.155/57605 000055e03aa4dc80<br> 9:            wlxc07a002fb470                                192.168.88.155/57605 000055e03aa4d440<br>10:            wlxc07a002fb470                                192.168.88.155/57605 000055e03aa4db20<br><br><br>idx     lat      pdv     plr     per    speed  alloc      rx_age      tx_age  eligible  bonded<br>----------------------------------------------------------------------------------------------------<br> 0:     0.00     0.00  0.0000  0.0000    1000   0.07          62          66         1       1<br> 1:    10.00    21.00  0.0000  0.0000    1000   0.04          61          66         1       1<br> 9:     6.00     1.00  0.0000  0.0000    5000   0.06         227         567         1       1<br>10:     0.00     0.00  0.0000  0.0000    5000   0.07          60          48         1       1<br></code></pre></td></tr></table></figure><br>The reported allocation percentages have an uncertainty value of <code>+/- 0.4%</code>.<br>To forcibly rotate to a different link in an <code>active-backup</code> bond:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">zerotier-cli bond 77dcbe7120 rotate<br>-------------------------------------------------------------------------------------------------------------------------<br>active <span class="hljs-built_in">link</span> rotated from 000055c8aa8392f0-enp5s0/104.175.36.67/9993 to 000055c8aa838210-enp5s0/104.175.36.67/9993<br></code></pre></td></tr></table></figure><br>To set a custom MTU for a bonded link:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">zerotier-cli bond setmtu 1300 enp5s0 192.168.88.155<br>---------------------------------------------------------------------------------------------------------<br>200 setmtu OK<br></code></pre></td></tr></table></figure></p><h3 id="Layer-2-Bridge"><a href="#Layer-2-Bridge" class="headerlink" title="Layer 2 Bridge"></a>Layer 2 Bridge</h3><p>Do you have devices that can’t run ZeroTier that you want to access remotely? You can use a small Linux PC as a bridge between ZeroTier and physical networks.</p><blockquote><p><strong>NOTE</strong><br>This topic is related to but different from using ZeroTier as a Layer 5 <a href="https://docs.zerotier.com/proxy">Service Proxy</a>.</p></blockquote><h4 id="Assumptions"><a href="#Assumptions" class="headerlink" title="Assumptions"></a>Assumptions</h4><ul><li>You’re doing this on your home network and can log in to your router and find the DHCP settings.</li><li>You have a keyboard, monitor, and ethernet cable plugged into your Pi. Chances are high we’ll break networking and lose access to the Pi.</li><li>You’re somewhat familiar with the command line and ssh.</li><li>We’re going to use systemd networking for this. You could probably adapt the concepts to a different Linux network configuration system if you have opinions about systemd.</li><li>We used a Raspberry Pi 2 while writing this, but a Pi 3 or 4 should work fine. Anything running a Debian 10+ based distro should be fine. It doesn’t have to be a Raspberry Pi, but some of these instructions might be Raspbian specific.</li></ul><h4 id="What-you’ll-need"><a href="#What-you’ll-need" class="headerlink" title="What you’ll need"></a>What you’ll need</h4><ul><li>Physical LAN Subnet</li><li>Physical LAN DHCP Range</li><li>ZeroTier Auto-Assign Range</li><li>Default Gateway IP Address (the router)</li><li>Bridge IP Address (will be statically assigned)</li><li>Create a new ZeroTier network and get the ID. Keep an old network around for secondary way to connect any devices already using ZeroTier.</li><li>The DHCP range and ZeroTier Auto-Assign range should be in the same subnet, but not overlap. You’d probably base this off what is already configured on your router.</li></ul><h5 id="An-example-plan"><a href="#An-example-plan" class="headerlink" title="An example plan"></a>An example plan</h5><div class="table-container"><table><thead><tr><th><strong>Name</strong></th><th><strong>Value</strong></th><th><strong>Referred to below as</strong></th></tr></thead><tbody><tr><td>Physical LAN Subnet</td><td>192.168.192.0/24</td><td></td></tr><tr><td>Physical LAN DHCP RANGE</td><td>192.168.192.65 through 192.168.192.126</td><td></td></tr><tr><td>ZeroTier Auto-Assign Range</td><td>192.168.192.129 through 192.168.192.190</td><td>$ZT_POOL</td></tr><tr><td>ZeroTier Managed Route</td><td>192.168.192.0/23</td><td>$ZT_ROUTE</td></tr><tr><td>Default Gateway IP Address</td><td>192.168.192.1</td><td>$GW_ADDR</td></tr><tr><td>Bridge IP Address</td><td>192.168.192.2/24 (or use DHCP)</td><td>$BR_ADDR</td></tr><tr><td>ZeroTier Network ID</td><td>d5e04297a19bbd70</td><td>$NETWORK_ID</td></tr><tr><td>ZeroTier Network Interface Name</td><td>zt3jnwghuq</td><td>$ZT_IF</td></tr></tbody></table></div><h4 id="Get-your-bridge-device-up-and-running"><a href="#Get-your-bridge-device-up-and-running" class="headerlink" title="Get your bridge device up and running"></a>Get your bridge device up and running</h4><h5 id="Follow-the-Raspberry-Pi-install-instructions"><a href="#Follow-the-Raspberry-Pi-install-instructions" class="headerlink" title="Follow the Raspberry Pi install instructions"></a>Follow the Raspberry Pi install instructions</h5><ul><li><a href="https://www.raspberrypi.org/downloads/raspbian/">Install Raspbian OS</a></li><li><a href="https://www.raspberrypi.org/documentation/remote-access/ssh/">Enable SSH</a></li></ul><h4 id="SSH-into-the-Pi"><a href="#SSH-into-the-Pi" class="headerlink" title="SSH into the Pi"></a>SSH into the Pi</h4><p>It’s easier to login via ssh now and copy/paste commands from the comfort of your own PC.<br>The DNS name might just work for you:<br><code>ssh pi@raspberrypi.local</code> Or <code>ssh pi@&lt;ip-address-of-pi&gt;</code></p><h4 id="Update-the-Operating-System"><a href="#Update-the-Operating-System" class="headerlink" title="Update the Operating System"></a>Update the Operating System</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt update &amp;&amp; sudo apt -y full-upgrade &amp;&amp; sudo reboot<br></code></pre></td></tr></table></figure><p>Log back in after it’s done</p><h4 id="Install-ZeroTier-1"><a href="#Install-ZeroTier-1" class="headerlink" title="Install ZeroTier"></a>Install ZeroTier</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://www.ZeroTier.com/download/<br>-------------------------------------------------------------------------<br>curl -s https://install.zerotier.com | sudo bash<br></code></pre></td></tr></table></figure><h4 id="Let’s-set-some-shell-variables-now"><a href="#Let’s-set-some-shell-variables-now" class="headerlink" title="Let’s set some shell variables now"></a>Let’s set some shell variables now</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">NETWORK_ID</span>=&lt;your-network-id&gt;<br><span class="hljs-attr">BR_IF</span>=<span class="hljs-string">&quot;br0&quot;</span><br><span class="hljs-attr">BR_ADDR</span>=&lt;your-bridge-address&gt;<br><span class="hljs-attr">GW_ADDR</span>=&lt;your-gateway-address&gt;<br></code></pre></td></tr></table></figure><h4 id="Join-ZeroTier-Network"><a href="#Join-ZeroTier-Network" class="headerlink" title="Join ZeroTier Network"></a>Join ZeroTier Network</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo zerotier-cli <span class="hljs-built_in">join</span> <span class="hljs-variable">$NETWORK_ID</span><br></code></pre></td></tr></table></figure><p>We don’t want ZeroTier to manage addresses or routes on <code>$ZT_IF</code>. We’re doing it statically below, on the bridge interface.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo zerotier-cli <span class="hljs-built_in">set</span> <span class="hljs-variable">$NETWORK_ID</span> allowManaged=0<br></code></pre></td></tr></table></figure><br>Set one more variable<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ZT_IF=&lt;your-zt-interface-name&gt;<br></code></pre></td></tr></table></figure><br>Copy the <code>dev</code> name from the <code>listnetworks</code> output for <code>$ZT_IF</code>. It will be something like: zt3jvirser</p><h4 id="Configure-the-device-in-ZeroTier-Central"><a href="#Configure-the-device-in-ZeroTier-Central" class="headerlink" title="Configure the device in ZeroTier Central"></a>Configure the device in ZeroTier Central</h4><ul><li>Go to the Members section of the Network</li><li>Open the Wrench Icon for advanced settings and check</li><li>Check Allow Bridging</li><li>Check Do Not Auto Assign</li><li>Authorize the member</li></ul><h4 id="Switch-to-systemd-networking"><a href="#Switch-to-systemd-networking" class="headerlink" title="Switch to systemd networking"></a>Switch to systemd networking</h4><p>Remove existing network stuff<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt remove --purge --auto-remove dhcpcd5 fake-hwclock ifupdown isc-dhcp-client isc-dhcp-common openresolv<br></code></pre></td></tr></table></figure><br>Enable systemd-networkd<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">ln</span> -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf;<br>sudo systemctl <span class="hljs-built_in">enable</span> systemd-networkd;<br>sudo systemctl <span class="hljs-built_in">enable</span> systemd-resolved;<br>sudo systemctl <span class="hljs-built_in">enable</span> systemd-timesyncd;<br></code></pre></td></tr></table></figure><br>Configure interfaces<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo zerotier-cli <span class="hljs-built_in">set</span> <span class="hljs-variable">$NETWORK_ID</span> allowManaged=0<br></code></pre></td></tr></table></figure><br>Write Network Configuration files. Puts ethernet and zerotier into the bridge and configures the bridge with a static IP. See below for DHCP configuration on the bridge.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF | sudo tee /etc/systemd/network/25-bridge-br0.network</span><br><span class="hljs-string">[Match]</span><br><span class="hljs-string">Name=$BR_IF</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Network]</span><br><span class="hljs-string">Address=$BR_ADDR</span><br><span class="hljs-string">Gateway=$GW_ADDR</span><br><span class="hljs-string">DNS=1.1.1.1</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF | sudo tee /etc/systemd/network/br0.netdev</span><br><span class="hljs-string">[NetDev]</span><br><span class="hljs-string">Name=$BR_IF</span><br><span class="hljs-string">Kind=bridge</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF | sudo tee /etc/systemd/network/25-bridge-br0-zt.network</span><br><span class="hljs-string">[Match]</span><br><span class="hljs-string">Name=$ZT_IF</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Network]</span><br><span class="hljs-string">Bridge=$BR_IF</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF | sudo tee /etc/systemd/network/25-bridge-br0-en.network</span><br><span class="hljs-string">[Match]</span><br><span class="hljs-string">Name=eth0 # might be en*</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Network]</span><br><span class="hljs-string">Bridge=$BR_IF</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><br>Review configuration<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tail</span> -n+0 /etc/systemd/network/*<br></code></pre></td></tr></table></figure><br>If needed, edit the files with the editor of your preference.<br>If it looks good:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo reboot<br></code></pre></td></tr></table></figure><br>You should be able to, from the physical LAN, connect to the Pi via <code>$BR_ADDR</code></p><h4 id="If-it-takes-a-long-time-waiting-for-the-network-during-boot"><a href="#If-it-takes-a-long-time-waiting-for-the-network-during-boot" class="headerlink" title="If it takes a long time waiting for the network during boot"></a>If it takes a long time waiting for the network during boot</h4><p>Sometimes the physical interface turns out to be a long “predictable interface name” like: “enb827eb0d4176”, sometimes it’s just <code>eth0</code>, depending on Raspbian version(???).<br><a href="https://wiki.debian.org/NetworkConfiguration#Network_Interface_Names">https://wiki.debian.org/NetworkConfiguration#Network_Interface_Names</a><br>Hook up a keyboard and monitor and check with ip addr then edit <code>/etc/systemd/network/25-bridge-br0-en.network</code> to match.</p><h4 id="Configure-ZeroTier-Network"><a href="#Configure-ZeroTier-Network" class="headerlink" title="Configure ZeroTier Network"></a>Configure ZeroTier Network</h4><p>At <code>my.zerotier.com/network/$NETWORK_ID</code>-&gt;<code>Settings</code>-&gt;<code>Advanced</code></p><ul><li>Delete the default Managed Route. Add the new Managed Route <code>$ZT_ROUTE</code></li><li>Change IPV4 Auto-Assign to Advanced</li><li>Remove existing Pool. Create new Pool with start and end from <code>$ZT_POOL</code></li><li>For documentation purposes, assign <code>$BR_ADDR</code> to the ZeroTier bridge member<br>It should be working now.</li></ul><h4 id="Next-steps"><a href="#Next-steps" class="headerlink" title="Next steps"></a>Next steps</h4><p>Either it worked, and you can ssh back in to <code>$BR_ADDR</code> after a minute, or it didn’t work and the Pi isn’t on the network anymore and you need to use the keyboard and monitor to figure out what went wrong.</p><blockquote><p><strong>TIP</strong><br>Make a backup of the sd card so you don’t have to repeat these steps</p></blockquote><h4 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h4><p>Configure bridge with DHCP<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF | sudo tee /etc/systemd/network/25-bridge-br0.network</span><br><span class="hljs-string">[Match]</span><br><span class="hljs-string">Name=$BR_IF</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Network]</span><br><span class="hljs-string">DHCP=yes</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure></p><h4 id="FAQ-1"><a href="#FAQ-1" class="headerlink" title="FAQ"></a>FAQ</h4><h5 id="I-can-ping-the-bridge-but-not-behind-it"><a href="#I-can-ping-the-bridge-but-not-behind-it" class="headerlink" title="I can ping the bridge, but not behind it"></a>I can ping the bridge, but not behind it</h5><p>Sometimes, iptables rules apply: <code>echo &quot;0&quot; &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</code> or <code>iptables -A FORWARD -p all -i br0 -j ACCEPT</code><br>See: <a href="https://serverfault.com/questions/162366/iptables-bridge-and-forward-chain">https://serverfault.com/questions/162366/iptables-bridge-and-forward-chain</a></p><h5 id="Why-is-the-Managed-Route-23-and-the-LAN-subnet-24"><a href="#Why-is-the-Managed-Route-23-and-the-LAN-subnet-24" class="headerlink" title="Why is the Managed Route /23 and the LAN subnet /24?"></a>Why is the Managed Route /23 and the LAN subnet /24?</h5><p>Say you have a laptop that is on the ZeroTier network and you bring it home. Now its WiFi address and ZeroTier address are in the same subnet. Which interface/address should your laptop use for internet access? <a href="https://en.wikipedia.org/wiki/Longest_prefix_match">https://en.wikipedia.org/wiki/Longest_prefix_match</a></p><h5 id="Why-is-an-app-on-my-phone-not-working-over-ZeroTier"><a href="#Why-is-an-app-on-my-phone-not-working-over-ZeroTier" class="headerlink" title="Why is an app on my phone not working over ZeroTier?"></a>Why is an app on my phone not working over ZeroTier?</h5><p>Unfortunately the iOS and Android VPN APIs won’t let ZeroTier use multicast/broadcast. These are typically how apps auto-discover services on the LAN. 😭 Stay tuned for an article on bridging a ZeroTier network and a WiFi access point.</p><h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><ul><li><a href="https://systemd.network/systemd.network.html">https://systemd.network/systemd.network.html</a></li><li><a href="https://hackaday.io/project/162164/instructions">https://hackaday.io/project/162164/instructions</a></li></ul><h3 id="Layer-5-Proxy-Pylon"><a href="#Layer-5-Proxy-Pylon" class="headerlink" title="Layer 5 Proxy (Pylon)"></a>Layer 5 Proxy (Pylon)</h3><p><a href="https://github.com/zerotier/pylon">zerotier/pylon</a> is a tool built using <a href="https://github.com/zerotier/libzt">libzt</a> that allows you to run a SOCKS5 Proxy that connects services and apps to and from your secure ZeroTier network without installing ZeroTier and without bringing up any new network interfaces. Pylon can be run as one of two personalities that can work alone or together depending on your needs:<br><strong>Name</strong>|<strong>What does this do</strong>|<strong>Is this a ZeroTier Node?</strong><br>——|——|——<br><code>pylon refract</code>    |This bridges traffic to and from your LAN    |Yes<br><code>pylon reflect</code>    |This relays traffic over <code>TCP/443</code>    |No<br>In a nutshell you run <code>pylon refract</code> on some physical device on your LAN. Then devices and services that cannot install ZeroTier will connect to it on a port that you specify. Now services or devices on your LAN can talk to things on your ZeroTier network and vice versa. You can optionally run a <code>pylon reflect</code> if you’re behind some <a href="https://docs.zerotier.com/nat">tricky NAT</a> and need to relay over TCP/443.<br>See the repo for more thorough instructions: <a href="https://github.com/zerotier/pylon">zerotier/pylon</a></p><blockquote><p><strong>NOTE</strong><br>This topic is related to but different from Bridging. Proxy mode is useful if you’re unable to install our normal client on your devices.</p></blockquote><h3 id="code-server-ZeroTier"><a href="#code-server-ZeroTier" class="headerlink" title="code-server + ZeroTier"></a>code-server + ZeroTier</h3><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318195025.png" alt="20240318195025"></p><h4 id="What"><a href="#What" class="headerlink" title="What"></a>What</h4><p><code>code-server</code> allows you to run an instance of VSCode in the browser and edit code on remote machines. Combining this with ZeroTier lets you do this securely across your virtual network. See their project page: <a href="https://github.com/coder/code-server">github.com/coder/code-server</a></p><h4 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -fsSL https://code-server.dev/install.sh | sh<br></code></pre></td></tr></table></figure><h4 id="Configure"><a href="#Configure" class="headerlink" title="Configure"></a>Configure</h4><p>By default <code>code-server</code> will listen on <code>0.0.0.0</code>. We of course do not want to do this since we’d like to only access it over our secure ZeroTier network. To do this, open the config file:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nano /home/<span class="hljs-variable">$USER</span>/.config/code-server/config.yaml<br></code></pre></td></tr></table></figure><br>Change your <code>bind-addr</code> to the ip address of the ZeroTier network interface for the network you’d like to access code-server over.<br>You can get this via <a href="https://my.zerotier.com/">Central</a> or from the <code>zerotier-cli</code>. For instance:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo zerotier-cli listnetworks<br>200 listnetworks &lt;nwid&gt; &lt;name&gt; &lt;mac&gt; &lt;status&gt; &lt;<span class="hljs-built_in">type</span>&gt; &lt;dev&gt; &lt;ZT assigned ips&gt;<br>200 listnetworks 8156abe27c21623c intranet.joseph.com 31:26:27:43:19:fb OK PRIVATE ztcjyorbnc fd80:76c1:124c:2268:1da9:9bf1:14d:ab3e/88,10.241.208.61/16<br></code></pre></td></tr></table></figure><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">bind-addr: 10.241.208.61:8080<br>auth: password<br>password: correcthorsebatterystaple<br>cert: <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure></p><h4 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">code-server<br></code></pre></td></tr></table></figure><h4 id="Access-Remotely"><a href="#Access-Remotely" class="headerlink" title="Access Remotely"></a>Access Remotely</h4><p>Now from another computer <em>that is also joined to the same ZeroTier network</em> open a browser and type in the node’s address and port that is running code-server, you should be prompted to enter your password:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318200012.png" alt="20240318200012"><br>You’re done!</p><blockquote><p><strong>CAUTION</strong><br>VS Code may state: <code>code-server is being accessed in an insecure context. Web views, the clipboard, and other functionality may not work as expected.</code>, this is true but as long as you’ve correctly set your <code>bind-addr</code> in the previous step your connection even over HTTP is secure since they are mediated over ZeroTier. Though we do recommend defense in depth so for sensitive situations we always suggest HTTPS.</p></blockquote><h3 id="Route-between-ZeroTier-and-Physical-Networks"><a href="#Route-between-ZeroTier-and-Physical-Networks" class="headerlink" title="Route between ZeroTier and Physical Networks"></a>Route between ZeroTier and Physical Networks</h3><p>This seems to be the simplest pattern for getting remote access to your LAN. It doesn’t require access to the LAN’s router or have some of the pitfalls of bridging. This requires a Linux PC or VM, something that runs iptables, on your LAN. A Raspberry Pi works. This is a NAT/Masquerade setup.<br>If you have a router that can run zerotier, you should use that instead of this article. Many router vendors and operating systems have zerotier packages.</p><blockquote><p><strong>POSSIBLE DISADVANTAGES</strong><br>No broadcast/multicast across networks (but the mobile OS’s don’t allow this anyways).<br>Can’t initiate connections from the LAN to an external ZeroTier client.</p></blockquote><h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><ul><li>Install ZeroTier</li><li>Add a managed route to the ZeroTier network (at my.zerotier.com)</li><li>Enable IP Forwarding</li><li>Configure iptables</li></ul><h4 id="Required-information"><a href="#Required-information" class="headerlink" title="Required information"></a>Required information</h4><p>For Example:</p><div class="table-container"><table><thead><tr><th><strong>Info</strong></th><th><strong>Example</strong></th><th><strong>Shorthand Name Below</strong></th></tr></thead><tbody><tr><td>ZeroTier Network ID</td><td>d5e04297a19bbd70</td><td>$NETWORK_ID</td></tr><tr><td>ZeroTier Interface Name</td><td>zt7nnig26</td><td>$ZT_IFACE</td></tr><tr><td>Physical Interface Name</td><td>eth0</td><td>$PHY_IFACE</td></tr><tr><td>ZeroTier subnet</td><td>172.27.0.0/16    </td></tr><tr><td>Physical subnet</td><td>192.168.100.0/24</td><td>$PHY_SUB</td></tr><tr><td>ZeroTier IP Address of “Router”</td><td>172.27.0.1</td><td>$ZT_ADDR</td></tr></tbody></table></div><h4 id="Install-ZeroTier-2"><a href="#Install-ZeroTier-2" class="headerlink" title="Install ZeroTier"></a>Install ZeroTier</h4><p><a href="https://www.zerotier.com/download/">https://www.zerotier.com/download/</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo zerotier-cli <span class="hljs-built_in">join</span> <span class="hljs-variable">$NETWORK_ID</span><br>sudo zerotier-cli listnetworks<br></code></pre></td></tr></table></figure><br>Authorize it at <code>my.zerotier.com/network/$NETWORK_ID</code><br>The listnetworks output has the ZeroTier Interface name under <code>&lt;dev&gt;</code></p><h4 id="Configure-the-ZeroTier-managed-route"><a href="#Configure-the-ZeroTier-managed-route" class="headerlink" title="Configure the ZeroTier managed route"></a>Configure the ZeroTier managed route</h4><p>At <code>my.zerotier.com/network/$NETWORK_ID</code>-&gt;<code>Settings</code>-&gt;<code>Managed Routes</code><br>This adds another route to every device joined to the ZeroTier network.</p><div class="table-container"><table><thead><tr><th><strong>Destination</strong></th><th><strong>(Via)</strong></th></tr></thead><tbody><tr><td>$PHY_SUB</td><td>$ZT_ADDR</td></tr></tbody></table></div><p>For example:</p><div class="table-container"><table><thead><tr><th><strong>Destination</strong></th><th><strong>(Via)</strong></th></tr></thead><tbody><tr><td>192.168.100.0/23</td><td>172.27.0.1</td></tr></tbody></table></div><p>Configure the destination route as slightly <strong>larger</strong> than the actual physical subnet, here <em>/23</em> instead of <em>/24</em> (a smaller number is a bigger subnet in this notation) This makes devices that are on both the physical and the ZeroTier network prefer the physical connection.</p><h4 id="Enable-IP-forwarding"><a href="#Enable-IP-forwarding" class="headerlink" title="Enable IP forwarding"></a>Enable IP forwarding</h4><p>This can vary depending on linux distribution. Typically:<br>Edit <code>/etc/sysctl.conf</code> to uncomment <code>net.ipv4.ip_forward</code>. This enables forwarding at boot.<br>To enable it now<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo sysctl -w net.ipv4.ip_forward=1<br></code></pre></td></tr></table></figure></p><h4 id="Configure-iptables"><a href="#Configure-iptables" class="headerlink" title="Configure iptables"></a>Configure iptables</h4><p>Assign some shell variables (personalize these)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">PHY_IFACE=eth0; ZT_IFACE=zt7nnig26<br></code></pre></td></tr></table></figure><br>Add rules to iptables<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo iptables -t nat -A POSTROUTING -o <span class="hljs-variable">$PHY_IFACE</span> -j MASQUERADE<br>sudo iptables -A FORWARD -i <span class="hljs-variable">$PHY_IFACE</span> -o <span class="hljs-variable">$ZT_IFACE</span> -m state --state RELATED,ESTABLISHED -j ACCEPT<br>sudo iptables -A FORWARD -i <span class="hljs-variable">$ZT_IFACE</span> -o <span class="hljs-variable">$PHY_IFACE</span> -j ACCEPT<br></code></pre></td></tr></table></figure><br>Save iptables rules for next boot<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt install iptables-persistent<br>sudo bash -c iptables-save &gt; /etc/iptables/rules.v4<br></code></pre></td></tr></table></figure></p><h4 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h4><ul><li>Turn off wifi on your phone</li><li>Join it to the zerotier network, authorize it</li><li>Try to access something on the physical LAN</li></ul><h3 id="Network-Microsegmentation"><a href="#Network-Microsegmentation" class="headerlink" title="Network Microsegmentation"></a>Network Microsegmentation</h3><h4 id="Create-a-netwrok-for-each-role"><a href="#Create-a-netwrok-for-each-role" class="headerlink" title="Create a netwrok for each role"></a>Create a netwrok for each role</h4><p>Devices can join multiple networks at once. Networks are free on my.zerotier.com. Each network can have its own <a href="https://docs.zerotier.com/rules">Network Flow Rules</a>. “Network A allows only RDP traffic.” for example.</p><h5 id="Pros"><a href="#Pros" class="headerlink" title="Pros"></a>Pros</h5><ul><li>Easy</li><li>Automatic authorization of nodes with SSO/OIDC</li></ul><h5 id="Cons"><a href="#Cons" class="headerlink" title="Cons"></a>Cons</h5><ul><li>Multiple sets of subnets, IP addresses, etc… to maintain. Can be automated with Terraform.</li><li>Mobile devices can connect to only 1 network at a time</li></ul><h5 id="Summary-1"><a href="#Summary-1" class="headerlink" title="Summary"></a>Summary</h5><ul><li>Create a ZeroTier network for each role: <em>Red, Green, and Blue</em>. Or: <em>Sales, HR, IT</em>. Or: <em>Dev, Prod, Staging</em>. Or: <em>Customer A, Customer B</em></li><li>Join shared resources to multiple networks</li><li>Join users to the networks they need access to<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319095759.png" alt="20240319095759"></li></ul><h4 id="ZeroTier-Network-Flow-Rules"><a href="#ZeroTier-Network-Flow-Rules" class="headerlink" title="ZeroTier Network Flow Rules"></a>ZeroTier Network Flow Rules</h4><p>Tag network members with roles.</p><h5 id="Pros-1"><a href="#Pros-1" class="headerlink" title="Pros"></a>Pros</h5><ul><li>Fine grained, low-level access control</li><li>One network config and set of members to maintain</li></ul><h5 id="Cons-1"><a href="#Cons-1" class="headerlink" title="Cons"></a>Cons</h5><ul><li>Tricky to build rule sets</li><li>Rules not integrated with OIDC yet</li></ul><h5 id="Summary-2"><a href="#Summary-2" class="headerlink" title="Summary"></a>Summary</h5><ul><li>Create a network</li><li>Use the Flow Rules to segment the network</li></ul><p>Here is the simplest possible <a href="https://docs.zerotier.com/rules">ZeroTier Flow Rules</a> example. More complex rules can be mixed in with these. See the docs or contact us for help.<br>Replace the default rules with:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">tag role <span class="hljs-built_in">id</span> 1<br>    default 0<br>    flag 0 red<br>    flag 1 green<br>    flag 2 blue<br>;<br><br>drop tand role 0;<br><br>accept;<br></code></pre></td></tr></table></figure><br>Devices will be able to talk only if they have at least one overlapping role. The tagging system is based on bitwise math, which we won’t try to explain here. Basically: Rename “red” “green” and “blue” with your real role names. Add more roles by adding flags in increasing order: <em>flag 3 yellow, flag 4 indigo</em><br>After saving a rule set with tags. A tag interface appears below:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319100037.png" alt="20240319100037"></p><h3 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h3><h4 id="How-to-characterize-NAT"><a href="#How-to-characterize-NAT" class="headerlink" title="How to characterize NAT"></a>How to characterize NAT</h4><p>When debugging it is often nice to be able to gather information about NAT type and behavior. ZeroTier does not use STUN (for various reasons), but many STUN implementations contain some helpful code for doing this. It’s helpful to use an external utility since it’s “out of band” and therefore independent of ZeroTier.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install stun<br>sudo stun stun.callwithus.com 0<br></code></pre></td></tr></table></figure><br>This will perform the basic NAT characterization test from the STUN RFC. The STUN server can be any public STUN server.<br>It will generate output like:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">STUN client version 0.96<br>running <span class="hljs-built_in">test</span> number 0<br>Primary: Independent Mapping, Port Dependent Filter, preserves ports, no hairpin<br>Return value is 0x000017<br></code></pre></td></tr></table></figure></p><h3 id="Integrating-with-Physical-Networks"><a href="#Integrating-with-Physical-Networks" class="headerlink" title="Integrating with Physical Networks"></a>Integrating with Physical Networks</h3><p>ZeroTier creates networks interfaces, IP addresses, and routes on your computers. Because of this, you can use all the standard networking tools and techniques with your ZeroTier networks.<br>There are 2 main ways to connect your ZeroTier networks to your Physical networks: Routing and Bridging. Yes, they are technically different things. Bridging has its downsides, including that it’s tricky to set up.</p><h4 id="Routing-or-Bridging"><a href="#Routing-or-Bridging" class="headerlink" title="Routing or Bridging?"></a>Routing or Bridging?</h4><p>Most of the time, choose routing.<br>Do you have devices that can’t install zerotier, use broadcast or multicast, and need to talk to ZeroTier nodes? Then consider bridging.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319110507.png" alt="20240319110507"></p><h4 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h4><p>There are many ways to set up routing.<br>We have only a <a href="https://docs.zerotier.com/route-between-phys-and-virt">Masquerade Tutorial</a> so far, but the steps are the same for any of these set ups; just skip the IPTables Masquerade step.<br>Here are some of the common examples:</p><h5 id="Router-can-run-ZeroTier"><a href="#Router-can-run-ZeroTier" class="headerlink" title="Router can run ZeroTier"></a>Router can run ZeroTier</h5><p>This is the best case. Since the router/firewall is the default gateway, no additional routing config needs to be done. It already knows the routes to the ZeroTier networks it’s joined to.<br>Some examples:</p><ul><li>Mikrotik</li><li>Teltonika Networks</li><li>OpenWRT</li><li>OPNsense</li></ul><p>If you aren’t already using existing routers, consider one of these!<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319110649.png" alt="20240319110649"></p><h5 id="Router-can’t-run-ZeroTier"><a href="#Router-can’t-run-ZeroTier" class="headerlink" title="Router can’t run ZeroTier"></a>Router can’t run ZeroTier</h5><p>You’ll have to run ZeroTier on a device or virtual machine in your LAN. You should use Linux if at all possible. This will act as the “router” between ZeroTier and Physical networks.</p><h5 id="Static-Routes-on-Gateway"><a href="#Static-Routes-on-Gateway" class="headerlink" title="Static Routes on Gateway"></a>Static Routes on Gateway</h5><p>Add a Static Route to your router/gateway:<br><code>[ZeroTier subnet] via [LAN IP of ZeroTier &quot;router&quot;]</code><br>For example:<br><code>10.147.20.0/24 via 10.0.0.2</code><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319110829.png" alt="20240319110829"></p><h5 id="Masquerade"><a href="#Masquerade" class="headerlink" title="Masquerade"></a>Masquerade</h5><p>This is the same method that your home router uses to route between Internet and your home LAN. See the <a href="https://docs.zerotier.com/route-between-phys-and-virt">Masquerade Tutorial</a><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319110923.png" alt="20240319110923"></p><h4 id="Bridging"><a href="#Bridging" class="headerlink" title="Bridging"></a>Bridging</h4><p>See the <a href="https://docs.zerotier.com/bridging">Bridging Tutorial</a><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319111011.png" alt="20240319111011"><br>Some things that use broadcast:</p><h5 id="Wake-on-LAN"><a href="#Wake-on-LAN" class="headerlink" title="Wake on LAN"></a>Wake on LAN</h5><p>Since ZeroTier is a program that runs on your computer, if the computer is off, it won’t be able to receive ZeroTier packets. Wake on LAN packets need to be on the physical network. You still might not need Bridging if this is your only requirement: Run ZeroTier on a different computer on your LAN, and send the WoL packet from that computer.</p><h5 id="Auto-discovery"><a href="#Auto-discovery" class="headerlink" title="Auto-discovery"></a>Auto-discovery</h5><p>Does your equipment come with a companion desktop or mobile application that auto-discovers the hardware on the network? This process usually uses broadcast. If the app lets you type in an IP address in the settings instead of using auto-discovery, that might be easier.<br>Mobile Operating Systems don’t let you do broadcast over a “VPN” connection. You need run a bridge wherever the equipment is, <em>and</em> where the phone or tablet is.</p><h5 id="Embedded-equipment"><a href="#Embedded-equipment" class="headerlink" title="Embedded equipment"></a>Embedded equipment</h5><ul><li>Industrial</li><li>Audio / Video / Lighting equipment</li><li>Cameras</li></ul><h2 id="Self-Hosting"><a href="#Self-Hosting" class="headerlink" title="Self-Hosting"></a>Self-Hosting</h2><p>Take control by self-hosting your own ZeroTier infrastructure.</p><h3 id="Network-Controller"><a href="#Network-Controller" class="headerlink" title="Network Controller"></a>Network Controller</h3><blockquote><p><strong>INFO</strong><br><a href="https://docs.zerotier.com/what-is-a-controller">Network Controller Reference Documentation</a></p></blockquote><h4 id="Tutorial"><a href="#Tutorial" class="headerlink" title="Tutorial"></a>Tutorial</h4><p>First, skim the <a href="https://github.com/zerotier/ZeroTierOne/tree/master/controller">README</a>.<br>We’re going to use <code>curl</code> to set up an example ZeroTier network. An easy way to get <code>curl</code> in Windows is to install <a href="https://git-scm.com/downloads">the latest version of Git</a>, which comes with bash, curl, and other tools.</p><blockquote><p><strong>OPENAPI</strong><br>The setup described here uses the local <a href="https://docs.zerotier.com/api/service">ZeroTierOne service API</a> to provision and manage networks. You can <a href="https://docs.zerotier.com/service/v1#tag/controller">browse</a> the OpenAPI docs for the local controller API for more detail on this interface.</p></blockquote><p>This is a low tech way to setup a controller for example purposes. You’d likely build yourself something fancier around this API.</p><h5 id="Authtoken"><a href="#Authtoken" class="headerlink" title="Authtoken"></a>Authtoken</h5><p>You’ll need to find the current local auth token on your system using the instructions in the <a href="https://docs.zerotier.com/api/tokens#zerotierone-service-token">API Tokens</a> guide.</p><h5 id="Get-your-Node-ID"><a href="#Get-your-Node-ID" class="headerlink" title="Get your Node ID"></a>Get your Node ID</h5><blockquote><p><strong>NOTE</strong><br>Network IDs are based on the Node ID of the Controller. Controllers are nodes! When you join a network, your node finds the controller like it does with other nodes: by its Node ID.</p></blockquote><h6 id="with-zerotier-cli"><a href="#with-zerotier-cli" class="headerlink" title="with zerotier-cli"></a>with zerotier-cli</h6><p>(may need sudo)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">zerotier-cli info<br></code></pre></td></tr></table></figure></p><h6 id="with-curl"><a href="#with-curl" class="headerlink" title="with curl"></a>with curl</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:9993/status&quot;</span> -H <span class="hljs-string">&quot;X-ZT1-AUTH: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><p>It’s the “Address” in the above’s output.<br>Let’s save the Node ID to an environment variable too:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">NODEID=your-node-id<br></code></pre></td></tr></table></figure><br>or try:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">NODEID=$(zerotier-cli info | <span class="hljs-built_in">cut</span> -d <span class="hljs-string">&quot; &quot;</span> -f 3)<br></code></pre></td></tr></table></figure></p><h5 id="Create-a-Network-1"><a href="#Create-a-Network-1" class="headerlink" title="Create a Network"></a>Create a Network</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X POST <span class="hljs-string">&quot;http://localhost:9993/controller/network/<span class="hljs-variable">$&#123;NODEID&#125;</span>______&quot;</span> -H <span class="hljs-string">&quot;X-ZT1-AUTH: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span> -d &#123;&#125;<br></code></pre></td></tr></table></figure><p>This should return JSON for a fresh network.</p><blockquote><p><strong>NOTE</strong><br>When you post to <code>/network/$&#123;NODEID&#125;______</code> the controller generates a random Network ID for you.<br>See the “id” of your newly created network.</p></blockquote><p>Let’s save the new Network ID to an environment variable<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">NWID=your-network-id<br></code></pre></td></tr></table></figure></p><h5 id="List-Networks"><a href="#List-Networks" class="headerlink" title="List Networks"></a>List Networks</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:9993/controller/network&quot;</span> -H <span class="hljs-string">&quot;X-ZT1-AUTH: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><p>This returns a list of Network IDs. It should include the ID returned by the create command we did in the previous step.</p><h5 id="Get-Network-Info"><a href="#Get-Network-Info" class="headerlink" title="Get Network Info"></a>Get Network Info</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:9993/controller/network/<span class="hljs-variable">$&#123;NWID&#125;</span>&quot;</span> -H <span class="hljs-string">&quot;X-ZT1-AUTH: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><h5 id="List-Network-Members"><a href="#List-Network-Members" class="headerlink" title="List Network Members"></a>List Network Members</h5><p>You’ll need another node to join your network first, or this will be empty. You can use a phone, or another PC, or a VM, or a VPS…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:9993/controller/network/<span class="hljs-variable">$&#123;NWID&#125;</span>/member&quot;</span> -H <span class="hljs-string">&quot;X-ZT1-AUTH: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><br>I guess you could join the controller node to its own network, for demonstration purposes.<br>Save the Node ID of one of your Network Members in an env var<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">MEMID=a-member<span class="hljs-string">&#x27;s-node-id</span><br></code></pre></td></tr></table></figure></p><h5 id="Get-Member-Info"><a href="#Get-Member-Info" class="headerlink" title="Get Member Info"></a>Get Member Info</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:9993/controller/network/<span class="hljs-variable">$&#123;NWID&#125;</span>/member/<span class="hljs-variable">$&#123;MEMID&#125;</span>&quot;</span> -H <span class="hljs-string">&quot;X-ZT1-AUTH: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><h5 id="Configure-the-Network"><a href="#Configure-the-Network" class="headerlink" title="Configure the Network"></a>Configure the Network</h5><p>For Nodes to talk, we need to add a Managed Route and IP Auto-Assign Range on the network. Let’s make it a Private network too. Prefer Private networks.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X POST <span class="hljs-string">&quot;http://localhost:9993/controller/network/<span class="hljs-variable">$&#123;NWID&#125;</span>&quot;</span> -H <span class="hljs-string">&quot;X-ZT1-AUTH: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span> \<br>    -d <span class="hljs-string">&#x27;&#123;&quot;ipAssignmentPools&quot;: [&#123;&quot;ipRangeStart&quot;: &quot;192.168.192.1&quot;, &quot;ipRangeEnd&quot;: &quot;192.168.192.254&quot;&#125;], &quot;routes&quot;: [&#123;&quot;target&quot;: &quot;192.168.192.0/24&quot;, &quot;via&quot;: null&#125;], &quot;v4AssignMode&quot;: &quot;zt&quot;, &quot;private&quot;: true &#125;&#x27;</span><br></code></pre></td></tr></table></figure></p><h5 id="Authorize-a-member"><a href="#Authorize-a-member" class="headerlink" title="Authorize a member"></a>Authorize a member</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X POST <span class="hljs-string">&quot;http://localhost:9993/controller/network/<span class="hljs-variable">$&#123;NWID&#125;</span>/member/<span class="hljs-variable">$&#123;MEMID&#125;</span>&quot;</span> -H <span class="hljs-string">&quot;X-ZT1-AUTH: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span> -d <span class="hljs-string">&#x27;&#123;&quot;authorized&quot;: true&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="Network-Info-Again"><a href="#Network-Info-Again" class="headerlink" title="Network Info Again"></a>Network Info Again</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:9993/controller/network/<span class="hljs-variable">$&#123;NWID&#125;</span>&quot;</span> -H <span class="hljs-string">&quot;X-ZT1-AUTH: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><h5 id="Member-Info-Again"><a href="#Member-Info-Again" class="headerlink" title="Member Info Again"></a>Member Info Again</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:9993/controller/network/<span class="hljs-variable">$&#123;NWID&#125;</span>/member/<span class="hljs-variable">$&#123;MEMID&#125;</span>&quot;</span> -H <span class="hljs-string">&quot;X-ZT1-AUTH: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><h5 id="Confirm-from-your-nodes"><a href="#Confirm-from-your-nodes" class="headerlink" title="Confirm from your nodes"></a>Confirm from your nodes</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo zerotier-cli listnetworks<br></code></pre></td></tr></table></figure><p>It should say “OK PRIVATE” and have an IP address.</p><h5 id="Deauthorize-Member"><a href="#Deauthorize-Member" class="headerlink" title="Deauthorize Member"></a>Deauthorize Member</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X POST <span class="hljs-string">&quot;http://localhost:9993/controller/network/<span class="hljs-variable">$&#123;NWID&#125;</span>/member/<span class="hljs-variable">$&#123;MEMID&#125;</span>&quot;</span> -H <span class="hljs-string">&quot;X-ZT1-AUTH: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span> -d <span class="hljs-string">&#x27;&#123;&quot;authorized&quot;: false&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="Delete-Member"><a href="#Delete-Member" class="headerlink" title="Delete Member"></a>Delete Member</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X DELETE <span class="hljs-string">&quot;http://localhost:9993/controller/network/<span class="hljs-variable">$&#123;NWID&#125;</span>/member/<span class="hljs-variable">$&#123;MEMID&#125;</span>&quot;</span> -H <span class="hljs-string">&quot;X-ZT1-AUTH: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p><strong>CAUTION</strong><br>You can “delete” a member, but they will show up in the output of “list member” again if the node is still online and trying to join. You should make sure to deauthorize before deleting.</p></blockquote><h5 id="Backup-your-controller"><a href="#Backup-your-controller" class="headerlink" title="Backup your controller"></a>Backup your controller</h5><p>If you want to keep these networks, copy the ZeroTier Home directory somewhere. Most importantly, the identity.secret and the controller.d directory.</p><h5 id="Clean-up-networks"><a href="#Clean-up-networks" class="headerlink" title="Clean up networks"></a>Clean up networks</h5><p>You may want to delete these networks now that you’re done testing. You could use the API to delete every network.<br>Or you can delete the controller.d directory.</p><h6 id="Linux-4"><a href="#Linux-4" class="headerlink" title="Linux"></a>Linux</h6><p>stop zerotier (If you’re ssh’d in over zerotier, this will break your connection):<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl stop zerotier-one<br></code></pre></td></tr></table></figure><br>delete controller configs:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /var/lib/zerotier-one/<br><span class="hljs-comment"># rm -rf ./controller.d/</span><br></code></pre></td></tr></table></figure><br>start zerotier:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl start zerotier-one<br></code></pre></td></tr></table></figure></p><h6 id="macOS-4"><a href="#macOS-4" class="headerlink" title="macOS"></a>macOS</h6><p>stop zerotier:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo launchctl unload /Library/LaunchDaemons/com.zerotier.one.plist<br></code></pre></td></tr></table></figure><br>delete controller configs:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-string">&quot;/Library/Application Support/ZeroTier/One&quot;</span><br><span class="hljs-comment"># sudo rm -rf ./controller.d</span><br></code></pre></td></tr></table></figure><br>start zerotier:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo launchctl load /Library/LaunchDaemons/com.zerotier.one.plist<br></code></pre></td></tr></table></figure></p><h3 id="Private-Root-Servers"><a href="#Private-Root-Servers" class="headerlink" title="Private Root Servers"></a>Private Root Servers</h3><h4 id="Creating-Your-Own-Roots-a-k-a-Moons"><a href="#Creating-Your-Own-Roots-a-k-a-Moons" class="headerlink" title="Creating Your Own Roots (a.k.a. Moons)"></a>Creating Your Own Roots (a.k.a. Moons)</h4><p>All ZeroTier nodes on a planet effectively inhabit a single data center. This makes it easy to directly connect devices anywhere, but it has the disadvantage of not working without an Internet connection. Network connections are far from perfectly reliable, and sometimes for security reasons a user may wish to “air gap” a set of nodes from the rest of the Internet entirely.<br>In 1.2.0 we introduced the ability to add your own user-defined roots. Since the data center we inhabit is the planet, a user-defined set of roots is called a <strong>moon</strong>. When a node “orbits” a moon, it adds the moon’s roots to its root server set. Nodes orbiting moons will still use planetary roots, but they’ll use the moon’s roots if they look faster or if nothing else is available.<br>The first step in creating a moon is to deploy a set of root servers. In most cases we recommend two. These are regular ZeroTier nodes, but ones that are always on and have static (physical) IP addresses. These static IPs could be global Internet IPs or physical intranet IPs that are only reachable internally. In the latter case your moon’s roots won’t work outside your office, but that doesn’t matter. Roaming nodes will just use planetary roots instead.<br>We recommend that root servers do not act as network controllers, join networks, or perform any other overlapping functions. They need good reliable network connections but otherwise require very little RAM, storage, or CPU. A root could be a small VM, VPS, or cloud instance, or a small device like a <a href="https://www.raspberrypi.org/">Raspberry Pi</a>. If you provision your roots as VMs, take care that they do not all reside on the same physical hardware. This would defeat the purpose of having two.<br>The next step is to create a world definition using <code>zerotier-idtool</code>. You will need the <code>identity.public</code> files from each of your root servers. Pick one root (doesn’t matter which) and run <code>zerotier-idtool initmoon &lt;identity.public of one root&gt; &gt;&gt;moon.json</code>. The <code>zerotier-idtool</code>command will output a JSON version of your world definition to <em>stdout</em>, so we redirect it to <code>moon.json</code>.<br>Examine this file. It will contain something like:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json"><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deadbeef00&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;objtype&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;world&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;roots&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;identity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deadbeef00:0:34031483094...&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;stableEndpoints&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;signingKey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;b324d84cec708d1b51d5ac03e75afba501a12e2124705ec34a614bf8f9b2c800f44d9824ad3ab2e3da1ac52ecb39ac052ce3f54e58d8944b52632eb6d671d0e0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;signingKey_SECRET&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ffc5dd0b2baf1c9b220d1c9cb39633f9e2151cf350a6d0e67c913f8952bafaf3671d2226388e1406e7670dc645851bf7d3643da701fd4599fedb9914c3918db3&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;updatesMustBeSignedBy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;b324d84cec708d1b51d5ac03e75afba501a12e2124705ec34a614bf8f9b2c800f44d9824ad3ab2e3da1ac52ecb39ac052ce3f54e58d8944b52632eb6d671d0e0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;worldType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;moon&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><br>The world ID is technically arbitrary and could be any random 64-bit value. By convention we use the address of one of the roots.<br>The world definition JSON file <strong>contains secrets</strong>, so it’s important to keep it in a safe place. The <code>signingKey_SECRET</code> is what will allow you to update your world definition automatically in the future.<br>Now add your other root(s) and define their stable endpoints. You’ll end up with something that looks like:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JSON"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deadbeef00&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;objtype&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;world&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;roots&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;identity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deadbeef00:0:34031483094...&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;stableEndpoints&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> <span class="hljs-string">&quot;10.0.0.2/9993&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;2001:abcd:abcd::1/9993&quot;</span> <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;identity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;feedbeef11:0:83588158384...&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;stableEndpoints&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> <span class="hljs-string">&quot;10.0.0.3/9993&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;2001:abcd:abcd::3/9993&quot;</span> <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;signingKey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;b324d84cec708d1b51d5ac03e75afba501a12e2124705ec34a614bf8f9b2c800f44d9824ad3ab2e3da1ac52ecb39ac052ce3f54e58d8944b52632eb6d671d0e0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;signingKey_SECRET&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ffc5dd0b2baf1c9b220d1c9cb39633f9e2151cf350a6d0e67c913f8952bafaf3671d2226388e1406e7670dc645851bf7d3643da701fd4599fedb9914c3918db3&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;updatesMustBeSignedBy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;b324d84cec708d1b51d5ac03e75afba501a12e2124705ec34a614bf8f9b2c800f44d9824ad3ab2e3da1ac52ecb39ac052ce3f54e58d8944b52632eb6d671d0e0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;worldType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;moon&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><br>The static IP addresses you use must be reachable from all the places you want these roots to serve. If you’re deploying these for use at a physical location, use internal IPs. If you want them to be usable off-site, use public IPs from your DMZ or host them at a cloud provider with a data center presence close to you. Low-cost cloud hosts that provide simple static direct IP addressing and dual-stack IPv4/IPv6 support like <a href="https://digitalocean.com/">Digital Ocean</a>, <a href="https://vultr.com/">Vultr</a>, and <a href="https://linode.com/">Linode</a> make ideal places to host roots. The lowest priced instances at these providers are more than sufficient in most cases.<br>The third step is to generate the actual signed world with <code>zerotier-idtool genmoon moon.json</code>. In this case this will generate a file called <code>000000deadbeef00.moon</code>. This does not contain secret keys but is signed by the secret from the JSON file.<br>Now go to your roots, create (if it does not exist) a subdirectory of their working directories (usually <code>/var/lib/zerotier-one</code> on Linux) called <code>moons.d</code>, and copy the signed moon file there. Now restart the roots and they should be ready.<br>You can add these roots to regular nodes in one of two ways: by placing the same world definition file in their <code>moons.d</code> directories or by using the zerotier-cli orbit command: <code>zerotier-cli orbit deadbeef00 deadbeef00</code>. The first argument is the world ID (which we can shorten by removing the two leading zeroes) and the second is the address of any of its roots. This will contact the root and obtain the full world definition from it if it’s online and reachable.<br>Once you’ve “orbited” your moon, try <code>zerotier-cli listpeers</code>. You should see the roots you’ve created listed as <code>MOON</code> instead of <code>LEAF</code>. They will now be used as alternative root servers.</p><h1 id="Development"><a href="#Development" class="headerlink" title="Development"></a>Development</h1><p>The ZeroTier agent and <a href="https://my.zerotier.com/">Central</a> both provide APIs that allow you to query information about your networks and peers, as well as managing the configuration and membership of your networks.</p><h2 id="Central-API"><a href="#Central-API" class="headerlink" title="Central API"></a>Central API</h2><p><a href="https://docs.zerotier.com/central">Central</a> is our hosted control plane for ZeroTierOne networks.<br>In addition to the web-based GUI, you can use the <a href="https://docs.zerotier.com/central/v1">Central API</a> to view and manage your networks. You will need an <a href="https://docs.zerotier.com/api/tokens#zerotier-central-token">API token</a> for access.<br>You can write your own client code to connect with Central using our <a href="https://docs.zerotier.com/api/central/examples">examples</a> as a starting point, or use an existing integration like our <a href="https://docs.zerotier.com/terraform">Terraform provider</a>.</p><h3 id="API-Reference-V1"><a href="#API-Reference-V1" class="headerlink" title="API Reference (V1)"></a>API Reference (V1)</h3><p><a href="https://docs.zerotier.com/central/v1/">https://docs.zerotier.com/central/v1/</a></p><h3 id="Central-APO-Examples"><a href="#Central-APO-Examples" class="headerlink" title="Central APO Examples"></a>Central APO Examples</h3><p>In the examples below use the following placeholder variables to match commonly-needed parameters:</p><ul><li>$ZT_TOKEN: an API token associated with an active account on <a href="https://my.zerotier.com/">Central</a></li><li>$NWID: an active network ID</li></ul><blockquote><p><strong>INFO</strong><br>See the <a href="https://docs.zerotier.com/api/tokens">Central API Tokens</a> guide for an explanation of how to create and manage API tokens.</p></blockquote><p><strong>Exporting Data from the Central API</strong><br>The examples below are intended to run in a system terminal, and require the following command-line tools:</p><ul><li><a href="https://curl.so/">curl</a></li><li><a href="https://jqlang.github.io/jq/">jq</a></li></ul><p>Each of them will fetch network information and produce CSV as output. You can then import that CSV into your choice of database, spreadsheet, or configuration-management tool(s).</p><h4 id="List-current-networks"><a href="#List-current-networks" class="headerlink" title="List current networks"></a>List current networks</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -s -H <span class="hljs-string">&quot;Authorization: token <span class="hljs-variable">$ZT_TOKEN</span>&quot;</span> \<br>  <span class="hljs-string">&quot;https://api.zerotier.com/api/v1/network&quot;</span> \<br>  | jq <span class="hljs-string">&#x27;.[] | [</span><br><span class="hljs-string">    .id,</span><br><span class="hljs-string">    .config.name,</span><br><span class="hljs-string">    .config.description,</span><br><span class="hljs-string">    .totalMemberCount,</span><br><span class="hljs-string">    .config.creationTime,</span><br><span class="hljs-string">    .config.ipAssignmentPools[0].ipRangeStart,</span><br><span class="hljs-string">    .config.ipAssignmentPools[0].ipRangeEnd</span><br><span class="hljs-string">  ]&#x27;</span> \<br>  | jq -rs <span class="hljs-string">&#x27;.[] | @csv&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="List-network-members"><a href="#List-network-members" class="headerlink" title="List network members"></a>List network members</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -H <span class="hljs-string">&quot;Authorization: token <span class="hljs-variable">$ZT_TOKEN</span>&quot;</span> \<br>  <span class="hljs-string">&quot;https://api.zerotier.com/api/v1/network/<span class="hljs-variable">$NWID</span>/member&quot;</span> \<br>  | jq <span class="hljs-string">&#x27;.[] | [</span><br><span class="hljs-string">    .id,</span><br><span class="hljs-string">    .lastSeen,</span><br><span class="hljs-string">    .physicalAddress,</span><br><span class="hljs-string">    .ipAssignments[0],</span><br><span class="hljs-string">    .name</span><br><span class="hljs-string">  ]&#x27;</span> \<br>  | jq -rs <span class="hljs-string">&#x27;.[] | @csv</span><br></code></pre></td></tr></table></figure><h2 id="Service-API"><a href="#Service-API" class="headerlink" title="Service API"></a>Service API</h2><p>The ZeroTierOne service provides an API which is used by the <a href="https://docs.zerotier.com/cli">ZeroTierOne CLI</a> and other clients to manage settings on your local instance of ZeroTier. This administration API is restricted to <code>localhost</code> by default, and requires authentication using an <a href="https://docs.zerotier.com/api/tokens#zerotierone-service-token">API token</a>.<br>Once you have your local token, you can access <a href="https://docs.zerotier.com/service/v1">local node, network, and peer information</a>, as well as configuring a <a href="https://docs.zerotier.com/controller">standalone controller</a>.</p><h3 id="API-Reference-V1-1"><a href="#API-Reference-V1-1" class="headerlink" title="API Reference (V1)"></a>API Reference (V1)</h3><p><a href="https://docs.zerotier.com/service/v1/">https://docs.zerotier.com/service/v1/</a></p><h2 id="Using-API-Token"><a href="#Using-API-Token" class="headerlink" title="Using API Token"></a>Using API Token</h2><p>Access to the ZeroTier APIs requires an authentication token. This guide describes the methods and tools needed to create and manage these tokens.</p><h4 id="ZeroTier-Central-Token"><a href="#ZeroTier-Central-Token" class="headerlink" title="ZeroTier Central Token"></a>ZeroTier Central Token</h4><p>To use the Central API, you need a token associated with your account. To create one, log into <a href="https://my.zerotier.com/">my.zerotier.com</a> and create a named token in the <a href="https://my.zerotier.com/account">Account</a> tab. Pick a memorable name that shows the intended use of the token: for example, “Terraform automation token” or “internal dev key”.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319140950.png" alt="20240319140950"><br>Each token you create is associated with your user account, so it will allow the same level of access to manage and query networks that you have when working in the Central UI.</p><blockquote><p><strong>CAUTION</strong><br>The token is displayed only once at the time you create it, so you should save it somewhere safe before clicking ‘Done’.</p></blockquote><h4 id="ZeroTierOne-Service-Token"><a href="#ZeroTierOne-Service-Token" class="headerlink" title="ZeroTierOne Service Token"></a>ZeroTierOne Service Token</h4><p>The local service API token is store in the <code>authtoken.secret</code> file in the ZeroTier service state directory. You’ll need it to make API calls to the local service.</p><blockquote><p><strong>NOTE</strong><br>ZeroTier generates the token at random the first time it starts. If you delete the file and restart the ZeroTierOne service a new token will be created, and the existing token will no longer be usable to access the API.</p></blockquote><p>You can store the current auth token value in an environment variable for use in scripting and local development using the following terminal commands:<br><em>Linux</em>: <code>TOKEN=$(sudo cat /var/lib/zerotier-one/authtoken.secret)</code><br><em>macOS</em>: <code>TOKEN=$(sudo cat &quot;/Library/Application Support/ZeroTier/One/authtoken.secret&quot;)</code><br><em>Windows</em>: <code>$env.TOKEN = Get-Content C:\ProgramData\ZeroTier\One\authtoken.secret</code></p><h2 id="Sockets-libzt"><a href="#Sockets-libzt" class="headerlink" title="Sockets(libzt)"></a>Sockets(libzt)</h2><p>Encrypted P2P connections for your app or service.<br>This guide explains how to use the ZeroTier SDK Socket API. It is meant to be read linearly and progresses from beginner topics to advanced topics. We will start by creating a simple <a href="https://docs.zerotier.com/sockets#pingable-node-part-1">pingable node</a> while skipping over most of the gritty details. Then we’ll move on to a full <a href="https://docs.zerotier.com/sockets#client-and-server-part-2">client-server socket application</a> where we will take the occasional tangent to learn more about how all of this works. Source code for the examples can be found here: <a href="https://github.com/zerotier/libzt/tree/main/examples">libzt/examples</a>. For API reference documentation see the sidebar to the left. To read more more about how ZeroTier works in general, see our <a href="https://docs.zerotier.com/zerotier/manual">Design Whitepaper</a>. If you find an error on this page or you just need help getting something to work please open a <a href="https://github.com/zerotier/libzt/issues">GitHub issue</a>.</p><h3 id="Install-1"><a href="#Install-1" class="headerlink" title="Install"></a>Install</h3><p><em>C/C++</em>: <code>brew install zerotier/tap/libzt</code><br><em>Rust</em>: <code># See https://crates.io/crates/libzt</code><br><em>Python</em>: <code>pip install libzt</code><br><em>C#</em>: <code>Install-Package ZeroTier.Sockets</code><br><em>Java</em>: <code>Install-Package ZeroTier.Sockets</code><br>Alternatively, build from source: <a href="https://www.github.com/zerotier/libzt">github.com/zerotier/libzt</a></p><blockquote><p><strong>INFO</strong><br>For the purposes of this guide it is recommended that you first <a href="https://my.zerotier.com/">create an account</a> and a private network to test on, but it is not strictly necessary if you’re comfortable joining public networks or setting up your own network controller.</p></blockquote><h3 id="Usage-summary"><a href="#Usage-summary" class="headerlink" title="Usage summary"></a>Usage summary</h3><p><em>C/C++</em>:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ZeroTierSockets.h&gt;</span></span><br><br><span class="hljs-comment">// ...</span><br>zts_node_start();<br>zts_net_join(<span class="hljs-number">0x1234567890abcdef</span>);<br><span class="hljs-comment">// ...</span><br><span class="hljs-type">int</span> s = zts_socket(ZTS_AF_INET, ZTS_SOCK_STREAM, <span class="hljs-number">0</span>);<br>zts_connect(s, in4, adddrlen);<br><span class="hljs-comment">// ...</span><br>zts_node_stop();<br></code></pre></td></tr></table></figure><br><em>Rust</em>:<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> libzt;<br><span class="hljs-keyword">use</span> libzt::tcp::&#123;TcpListener, TcpStream&#125;;<br><span class="hljs-comment">// ...</span><br><span class="hljs-keyword">let</span> <span class="hljs-variable">node</span> = libzt::node::ZeroTierNode &#123;&#125;;<br>node.<span class="hljs-title function_ invoke__">start</span>();<br>node.<span class="hljs-title function_ invoke__">net_join</span>(net_id);<br><span class="hljs-comment">// ...</span><br>TcpStream::<span class="hljs-title function_ invoke__">connect</span>(remote_addr);<br><span class="hljs-comment">// ...</span><br>node.<span class="hljs-title function_ invoke__">stop</span>();<br></code></pre></td></tr></table></figure><br><em>Python</em>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> libzt<br><br><span class="hljs-comment"># ...</span><br>node = libzt.ZeroTierNode()<br>node.node_start()<br><span class="hljs-comment"># ...</span><br>node.net_join(<span class="hljs-number">0x1234567890abcdef</span>)<br><span class="hljs-comment"># ...</span><br>client = libzt.socket(libzt.ZTS_AF_INET, libzt.ZTS_SOCK_STREAM, <span class="hljs-number">0</span>)<br>client.connect((remote_ip, remote_port))<br></code></pre></td></tr></table></figure><br><em>C#</em>:<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> ZeroTier;<br><span class="hljs-comment">// ...</span><br>ZeroTier.Core.Node node = <span class="hljs-keyword">new</span> ZeroTier.Core.Node();<br>node.Start();<br><span class="hljs-comment">// ...</span><br>node.Join(<span class="hljs-number">0x1234567890abcdef</span>);<br><span class="hljs-comment">// ...</span><br>ZeroTier.Sockets.Socket sender = <span class="hljs-keyword">new</span> ZeroTier.Sockets.Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);<br>sender.Connect(remoteServerEndPoint);<br><span class="hljs-comment">// ...</span><br>node.Stop();<br></code></pre></td></tr></table></figure><br><em>Java</em>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.zerotier.sockets.*;<br><br><span class="hljs-comment">// ...</span><br><span class="hljs-type">ZeroTierNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZeroTierNode</span>();<br>node.start();<br><span class="hljs-comment">// ...</span><br>node.join(<span class="hljs-number">0x1234567890abcdef</span>);<br><span class="hljs-comment">// ...</span><br><span class="hljs-type">ZeroTierSocket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZeroTierSocket</span>(remoteAddr, port);<br></code></pre></td></tr></table></figure></p><h3 id="Pingable-Node-Part1"><a href="#Pingable-Node-Part1" class="headerlink" title="Pingable Node (Part1)"></a>Pingable Node (Part1)</h3><p>To start things off we will:</p><ul><li>Set up a node</li><li>Join it to your network</li><li>Assign it a globally-available static IPv4 and/or IPv6 address</li><li>Ping it</li></ul><p>We’ll be skipping over a lot of details in this first example, but we’ll cover those in the <a href="https://docs.zerotier.com/sockets#client-and-server-part-2">next example</a>. It’s also worth noting that in this first example we will be using the sequential API for simplicity but there is an <a href="https://docs.zerotier.com/sockets#events">event</a> notification system that can be used as well.</p><h4 id="Starting-a-node"><a href="#Starting-a-node" class="headerlink" title="Starting a node"></a>Starting a node</h4><p>Starting a node is easy and if you don’t provide a configuration ZeroTier will generate a new identity automatically, but don’t worry about that yet:<br><em>C/C++</em>:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// No &quot;node object&quot; creation necessary in C</span><br>zts_node_start();<br></code></pre></td></tr></table></figure><br><em>Rust</em>:<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">node</span> = libzt::node::ZeroTierNode &#123;&#125;;<br>node.<span class="hljs-title function_ invoke__">start</span>();<br></code></pre></td></tr></table></figure><br><em>Python</em>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">node = libzt.ZeroTierNode()<br>node.start()<br></code></pre></td></tr></table></figure><br><em>C#</em>:<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c#">ZeroTier.Core.Node node = <span class="hljs-keyword">new</span> ZeroTier.Core.Node();<br>node.Start();<br></code></pre></td></tr></table></figure><br><em>Java</em>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ZeroTierNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZeroTierNode</span>();<br>node.start();<br></code></pre></td></tr></table></figure><br>Before we can join any networks or use sockets we need to know when the node has successfully come online. We will use a rather crude wait loop but as mentioned before, there are <a href="https://docs.zerotier.com/sockets#events">event</a>-based methods for accomplishing this that we will discuss later:<br><em>C/C++</em>:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> (! zts_node_is_online()) &#123;<br>  zts_util_delay(<span class="hljs-number">1000</span>);<br>&#125;<br></code></pre></td></tr></table></figure><br><em>Rust</em>:<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">while</span> !node.<span class="hljs-title function_ invoke__">is_online</span>() &#123;<br>    node.<span class="hljs-title function_ invoke__">delay</span>(<span class="hljs-number">1000</span>);<br>&#125;<br></code></pre></td></tr></table></figure><br><em>Python</em>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> node.is_online():<br>  time.sleep(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><br><em>C#</em>:<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-keyword">while</span> (! node.Online) &#123;<br>  Thread.Sleep(<span class="hljs-number">1000</span>);<br>&#125;<br></code></pre></td></tr></table></figure><br><em>Java</em>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">while</span> (! node.isOnline()) &#123;<br>  ZeroTierNative.zts_util_delay(<span class="hljs-number">1000</span>);<br>&#125;<br></code></pre></td></tr></table></figure><br>Once we’ve broken from this loop we can be confident that the node has a valid identity and has made contact with at least one root server. At this point let’s print our node’s identity. This is the <code>public short form</code> of your identity that you can share with people, we will discuss how to get the <code>secret</code> portion later on:<br><em>C/C++</em>: <code>printf(&quot;%llx\n&quot;, (long long int)zts_node_get_id());</code><br><em>Rust</em>: <code>println!(&quot;&#123;:#06x&#125;&quot;, node.id());</code><br><em>Python</em>: <code>print(node.get_id())</code><br><em>C#</em>: <code>Console.WriteLine(node.Id.ToString(&quot;x16&quot;));</code><br><em>Java</em>: <code>System.out.println(Long.toHexString(node.getId()));</code></p><h4 id="Join-a-network"><a href="#Join-a-network" class="headerlink" title="Join a network"></a>Join a network</h4><p>Now we’re ready to join a network:<br><em>C/C++</em>: <code>zts_net_join(0x1234567890abcdef);</code><br><em>Rust</em>: <code>node.net_join(0x1234567890abcdef);</code><br><em>Python</em>: <code>node.net_join(0x1234567890abcdef)</code><br><em>C#</em>: <code>node.Join(0x1234567890abcdef);</code><br><em>Java</em>: <code>node.join(0x1234567890abcdef);</code><br>The network join request will contact our network controllers (or yours!) and if the network is <code>public</code> your node will be allowed to join immediately. If however the network is <code>private</code> the node will not be allowed to join until the network owner authorizes the node.<br>A node is not assigned an IP address until it has successfully joined the network. This process usually takes a few seconds, thus your application must wait until the network config is received and it has been assigned an address:<br><em>C/C++</em>:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> (! zts_net_transport_is_ready(net_id)) &#123;<br>  zts_util_delay(<span class="hljs-number">1000</span>);<br>&#125;<br></code></pre></td></tr></table></figure><br><em>Rust</em>:<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">while</span> !node.<span class="hljs-title function_ invoke__">net_transport_is_ready</span>(net_id) &#123;<br>    node.<span class="hljs-title function_ invoke__">delay</span>(<span class="hljs-number">1000</span>);<br>&#125;<br></code></pre></td></tr></table></figure><br><em>Python</em>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> node.net_transport_is_ready(net_id):<br>  time.sleep(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><br><em>C#</em>:<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-keyword">while</span> (! node.IsNetworkTransportReady(networkId)) &#123;<br>  Thread.Sleep(<span class="hljs-number">1000</span>);<br>&#125;<br></code></pre></td></tr></table></figure><br><em>Java</em>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">while</span> (! node.isNetworkTransportReady(networkId)) &#123;<br>  ZeroTierNative.zts_util_delay(<span class="hljs-number">1000</span>);<br>&#125;<br></code></pre></td></tr></table></figure><br>The transport readiness check above essentially just makes sure we have been authorized on the network and that we also have an assigned address and a managed route.</p><h4 id="Getting-your-IP-address"><a href="#Getting-your-IP-address" class="headerlink" title="Getting your IP address"></a>Getting your IP address</h4><blockquote><p><strong>NOTE</strong><br>Currently, only one address of each family type may be assigned (per network) to a libzt node at any time. That means one IPv4 and one IPv6 address. This is a technical limitation that will be removed in future versions.</p></blockquote><p><em>C/C++</em>:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> ipstr[ZTS_IP_MAX_STR_LEN] = &#123; <span class="hljs-number">0</span> &#125;;<br>zts_addr_get_str(net_id, ZTS_AF_INET, ipstr, ZTS_IP_MAX_STR_LEN);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, ipstr);<br></code></pre></td></tr></table></figure><br><em>Rust</em>:<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">addr</span> = node.<span class="hljs-title function_ invoke__">addr_get</span>(net_id).<span class="hljs-title function_ invoke__">unwrap</span>();<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, addr);<br></code></pre></td></tr></table></figure><br><em>Python</em>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(node.addr_get_ipv4(net_id))<br><span class="hljs-built_in">print</span>(node.addr_get_ipv6(net_id))<br></code></pre></td></tr></table></figure><br><em>C#</em>:<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-keyword">foreach</span> (IPAddress addr <span class="hljs-keyword">in</span> node.GetNetworkAddresses(networkId)) &#123;<br>  Console.WriteLine(addr);<br>&#125;<br></code></pre></td></tr></table></figure><br><em>Java</em>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(node.getIPv4Address(networkId).getHostAddress());<br>System.out.println(node.getIPv6Address(networkId).getHostAddress());<br></code></pre></td></tr></table></figure><br>From another machine (or the same machine, whatever you’re into), use our regular client <a href="https://www.zerotier.com/download/">zerotier-one</a> (or another libzt instance) to join the same network and ping the address displayed by your new node above. You should see some jittery initial responses as our transport-triggered link is established and then once a VL2 P2P link is established the response time will stabilize.<br>🎉 Congratulations you’ve just done something cool, I guess. Ready for something with sockets?<br>Oh crap, I forgot. We need to stop the node when we’re done:<br><em>C/C++</em>: <code>zts_node_stop();</code><br><em>Rust</em>: <code>node.stop();</code><br><em>Python</em>: <code>node.stop()</code><br><em>C#</em>: <code>node.Stop()</code><br><em>Java</em>: <code>node.stop()</code><br>Full example source code can be found here: <a href="https://github.com/zerotier/libzt/tree/main/examples">libzt/examples</a></p><h3 id="Sockets"><a href="#Sockets" class="headerlink" title="Sockets"></a>Sockets</h3><blockquote><p><strong>TIP</strong><br>If you’re new to socket programming I highly recommend at least perusing <a href="https://beej.us/guide/bgnet/">Beej’s Guide to Network Programming</a>. This is the best reference material you’ll find on the subject. It greatly helped in my own personal understanding. A portion of our C API is merely redirected calls to <a href="https://savannah.nongnu.org/projects/lwip/">lwIP’s C API</a> and is thus directly compatible with what you’ll learn in his guide.</p></blockquote><p>Before we move onto the next section we need to quickly discuss how the socket API is structured. For each supported language ZeroTier provides a socket interface that attempts to be as idiomatic as possible. If you are using one of these non-C bindings the following text about the <code>C API</code> may not apply to you, but it’s still good to know. <a href="https://docs.zerotier.com/sockets#client-and-server-part-2">I don’t care about this</a><br>ZeroTier sockets can be controlled via <code>zts_bsd_</code> functions that operate nearly identically to normal BSD-style sockets, and <code>zts_</code> functions that provide simplified arguments and reduce the need to use things like <code>struct sockaddr</code>. These functions can be used on the same socket interchangeably without issue.<br>For instance:</p><ul><li><code>zts_bsd_connect()</code> will behave in the same way as an ordinary <code>connect()</code> call (but over ZeroTier of course)</li><li><code>zts_connect()</code> will perform a little magic behind the scenes to deal with transport-triggered link provisioning. (i.e. re-attempting for you)</li><li><code>zts_tcp_client()</code> will wrap all of the common socket calls (including a <code>zts_connect()</code>) into a single call.</li></ul><p>You are allowed to use each type of call and mix their usage among sockets as you please, as long as what you’re doing makes sense at the protocol level. For instance the following is legal:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> sock = zts_bsd_socket(ZTS_AF_INET, ZTS_SOCK_STREAM, <span class="hljs-number">0</span>);<br>zts_connect(sock, addr, addrlen);<br>zts_bsd_write(sock, buf, buflen);<br></code></pre></td></tr></table></figure></p><h3 id="Client-and-Server-Part2"><a href="#Client-and-Server-Part2" class="headerlink" title="Client and Server (Part2)"></a>Client and Server (Part2)</h3><p>In this section we will:</p><ul><li>Use most of the same setup code as the <a href="https://docs.zerotier.com/sockets#pingable-node-part-1">Pingable Node</a> example</li><li>Set up a TCP server and client</li><li>Send a short message between the two</li></ul><p>To see full source code of the following with proper error and exception handling, see <a href="https://github.com/zerotier/libzt/tree/main/examples">libzt/examples</a> and <a href="https://github.com/zerotier/libzt/tree/main/test">libzt/test</a>.<br>Let’s start our node:<br><em>C/C++</em>:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c">zts_init_from_storage(storage_path);<br><br>zts_node_start();<br><br><span class="hljs-keyword">while</span> (! zts_node_is_online()) &#123;<br>  zts_util_delay(<span class="hljs-number">1000</span>);<br>&#125;<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Node ID: %llx\n&quot;</span>, zts_node_get_id());<br><br>zts_net_join(net_id);<br><br><span class="hljs-keyword">while</span> (! zts_net_transport_is_ready(net_id)) &#123;<br>  zts_util_delay(<span class="hljs-number">1000</span>);<br>&#125;<br><br><span class="hljs-type">char</span> ipstr[ZTS_IP_MAX_STR_LEN] = &#123; <span class="hljs-number">0</span> &#125;;<br>zts_addr_get_str(net_id, family, ipstr, ZTS_IP_MAX_STR_LEN);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;IP address: %s\n&quot;</span>, net_id, ipstr);<br></code></pre></td></tr></table></figure><br><em>Rust</em>:<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">node</span> = libzt::node::ZeroTierNode &#123;&#125;;<br>node.<span class="hljs-title function_ invoke__">init_from_storage</span>(&amp;storage_path);<br><br>node.<span class="hljs-title function_ invoke__">start</span>();<br><br><span class="hljs-keyword">while</span> !node.<span class="hljs-title function_ invoke__">is_online</span>() &#123;<br>    node.<span class="hljs-title function_ invoke__">delay</span>(<span class="hljs-number">1000</span>);<br>&#125;<br><br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Node ID = &#123;:#06x&#125;&quot;</span>, node.<span class="hljs-title function_ invoke__">id</span>());<br><br>node.<span class="hljs-title function_ invoke__">net_join</span>(net_id);<br><br><span class="hljs-keyword">while</span> !node.<span class="hljs-title function_ invoke__">net_transport_is_ready</span>(net_id) &#123;<br>    node.<span class="hljs-title function_ invoke__">delay</span>(<span class="hljs-number">1000</span>);<br>&#125;<br><span class="hljs-keyword">let</span> <span class="hljs-variable">addr</span> = node.<span class="hljs-title function_ invoke__">addr_get</span>(net_id).<span class="hljs-title function_ invoke__">unwrap</span>();<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;IP address: &#123;&#125;&quot;</span>, addr);<br></code></pre></td></tr></table></figure><br><em>Python</em>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">node = libzt.ZeroTierNode()<br>node.init_from_storage(storage_path)<br><br>node.node_start()<br><br><span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> node.node_is_online():<br>  time.sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Node ID:&quot;</span>, node.node_id())<br><br>node.net_join(net_id)<br><br><span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> node.net_transport_is_ready(net_id):<br>  time.sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;IP address: &quot;</span>, node.addr_get_ipv4(net_id))<br></code></pre></td></tr></table></figure><br><em>C#</em>:<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c#">node = <span class="hljs-keyword">new</span> ZeroTier.Core.Node();<br>node.InitFromStorage(configFilePath);<br><br>node.Start();<br><br><span class="hljs-keyword">while</span> (! node.Online) &#123;<br>  Thread.Sleep(<span class="hljs-number">1000</span>);<br>&#125;<br><br>Console.WriteLine(<span class="hljs-string">&quot;Node ID:&quot;</span> + node.Id)<br><br>node.Join(networkId);<br><br><span class="hljs-keyword">while</span> (! node.IsNetworkTransportReady(networkId)) &#123;<br>  Thread.Sleep(<span class="hljs-number">1000</span>);<br>&#125;<br><br><span class="hljs-keyword">foreach</span> (IPAddress addr <span class="hljs-keyword">in</span> node.GetNetworkAddresses(networkId)) &#123;<br>  Console.WriteLine(<span class="hljs-string">&quot;IP address: &quot;</span> + addr);<br>&#125;<br></code></pre></td></tr></table></figure><br><em>Java</em>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ZeroTierNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZeroTierNode</span>();<br>node.initFromStorage(storagePath);<br><br>node.start();<br><br><span class="hljs-keyword">while</span> (! node.isOnline()) &#123;<br>  ZeroTierNative.zts_util_delay(<span class="hljs-number">1000</span>);<br>&#125;<br><br>System.out.println(<span class="hljs-string">&quot;Node ID: &quot;</span> + Long.toHexString(node.getId()));<br><br>node.join(networkId);<br><br><span class="hljs-keyword">while</span> (! node.isNetworkTransportReady(networkId)) &#123;<br>  ZeroTierNative.zts_util_delay(<span class="hljs-number">1000</span>);<br>&#125;<br><br>System.out.println(<span class="hljs-string">&quot;IP address: &quot;</span> + node.getIPv4Address(networkId).getHostAddress());<br></code></pre></td></tr></table></figure><br>Notice that in the above code we use a new type of initialization function. In this case we are using a location on storage to retrieve and store our identities. We do this since we don’t want to generate a unique identity for each application run. It’s computationally-expensive and wasteful, think of the tardigrades.</p><h4 id="TCP-Server"><a href="#TCP-Server" class="headerlink" title="TCP Server"></a>TCP Server</h4><p>Below is a simple blocking server that will open a listening socket, wait for a message and print what it receives. To see full source code of the following with proper error and exception handling, see <a href="https://github.com/zerotier/libzt/tree/main/examples">libzt/examples</a> and<a href="https://github.com/zerotier/libzt/tree/main/test">libzt/test</a>.<br><em>C/C++</em>:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> remote_addr[ZTS_INET6_ADDRSTRLEN] = &#123; <span class="hljs-number">0</span> &#125;;<br><span class="hljs-type">int</span> remote_port = <span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> len = ZTS_INET6_ADDRSTRLEN;<br><br><span class="hljs-comment">// Set up listen socket</span><br><span class="hljs-comment">// Note: We could also use standard zts_bsd_socket, zts_bsd_bind, etc</span><br><span class="hljs-type">int</span> fd = zts_tcp_server(local_addr, <span class="hljs-number">8000</span>, remote_addr, len, &amp;remote_port)<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Accepted connection from %s:%d\n&quot;</span>, remote_addr, remote_port);<br><br><span class="hljs-comment">// RX</span><br><span class="hljs-type">char</span> recvBuf[<span class="hljs-number">128</span>] = &#123; <span class="hljs-number">0</span> &#125;;<br>zts_read(fd, recvBuf, <span class="hljs-keyword">sizeof</span>(recvBuf));<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;RX: %s\n&quot;</span>, recvBuf);<br><br><span class="hljs-comment">// Cleanup</span><br>zts_close(fd);<br>zts_node_stop();<br></code></pre></td></tr></table></figure><br><em>Rust</em>:<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// Set up listen socket</span><br><span class="hljs-keyword">let</span> <span class="hljs-variable">listener</span> = TcpListener::<span class="hljs-title function_ invoke__">bind</span>(<span class="hljs-string">&quot;0.0.0.0:8000&quot;</span>).<span class="hljs-title function_ invoke__">unwrap</span>();<br><span class="hljs-keyword">for</span> <span class="hljs-variable">stream</span> <span class="hljs-keyword">in</span> listener.<span class="hljs-title function_ invoke__">incoming</span>() &#123;<br>    <span class="hljs-keyword">match</span> stream &#123;<br>        <span class="hljs-title function_ invoke__">Ok</span>(stream) =&gt; &#123;<br>            <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Accepted connection from: &#123;&#125;&quot;</span>, stream.<span class="hljs-title function_ invoke__">peer_addr</span>().<span class="hljs-title function_ invoke__">unwrap</span>());<br>            thread::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">move</span> || &#123;<br>                <span class="hljs-title function_ invoke__">handle_client</span>(stream)<br>            &#125;);<br>        &#125;<br>        <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; &#123;<br>            <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Error: &#123;&#125;&quot;</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-title function_ invoke__">drop</span>(listener);<br></code></pre></td></tr></table></figure><br><em>Python</em>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Set up listen socket</span><br>serv = libzt.socket(libzt.ZTS_AF_INET, libzt.ZTS_SOCK_STREAM, <span class="hljs-number">0</span>)<br>serv.bind((<span class="hljs-string">&quot;0.0.0.0&quot;</span>, <span class="hljs-number">8000</span>))<br>serv.listen(<span class="hljs-number">1</span>)<br>conn, addr = serv.accept()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Accepted connection from: &quot;</span>, addr)<br><br><span class="hljs-comment"># RX</span><br>data = conn.recv(<span class="hljs-number">128</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;RX: &quot;</span>, data)<br><br><span class="hljs-comment"># Cleanup</span><br>conn.close()<br>node.node_stop()<br></code></pre></td></tr></table></figure><br><em>C#</em>:<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-comment">// Set up listen socket</span><br>ZeroTier.Sockets.Socket listener =<br>  <span class="hljs-keyword">new</span> ZeroTier.Sockets.Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);<br>listener.Bind(localEndPoint);<br>listener.Listen(<span class="hljs-number">1</span>);<br>ZeroTier.Sockets.Socket handler;<br>handler = listener.Accept();<br>Console.WriteLine(<span class="hljs-string">&quot;Accepted connection from: &quot;</span> + handler.RemoteEndPoint.ToString());<br><br><span class="hljs-comment">// RX</span><br><span class="hljs-built_in">string</span> data = <span class="hljs-literal">null</span>;<br><span class="hljs-built_in">byte</span>[] bytes = <span class="hljs-keyword">new</span> Byte[<span class="hljs-number">128</span>];<br><span class="hljs-built_in">int</span> bytesReceived = handler.Receive(bytes);<br>data = Encoding.ASCII.GetString(bytes, <span class="hljs-number">0</span>, bytesReceived);<br>Console.WriteLine(<span class="hljs-string">&quot;RX: &quot;</span> + data);<br><br><span class="hljs-comment">// Cleanup</span><br>handler.Shutdown(SocketShutdown.Both);<br>handler.Close();<br>node.Stop();<br></code></pre></td></tr></table></figure><br><em>Java</em>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Set up listen socket</span><br><span class="hljs-type">ZeroTierServerSocket</span> <span class="hljs-variable">listener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZeroTierServerSocket</span>(port);<br><span class="hljs-type">ZeroTierSocket</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> listener.accept();<br><span class="hljs-type">ZeroTierInputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> conn.getInputStream();<br><span class="hljs-type">DataInputStream</span> <span class="hljs-variable">dataInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataInputStream</span>(inputStream);<br><br><span class="hljs-comment">// RX</span><br><span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> dataInputStream.readUTF();<br>System.out.println(<span class="hljs-string">&quot;RX: &quot;</span> + message);<br><br><span class="hljs-comment">// Cleanup</span><br>listener.close();<br>conn.close();<br>node.stop();<br></code></pre></td></tr></table></figure></p><h4 id="TCP-Client"><a href="#TCP-Client" class="headerlink" title="TCP Client"></a>TCP Client</h4><p>Below is a simple client that will connect to a remote host and send a message. To see full source code of the following with proper error and exception handling, see <a href="https://github.com/zerotier/libzt/tree/main/examples">libzt/examples</a> and <a href="https://github.com/zerotier/libzt/tree/main/test">libzt/test</a>.<br><em>C/C++</em>:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span>* msgStr = (<span class="hljs-type">char</span>*)<span class="hljs-string">&quot;Hello, network!&quot;</span>;<br><span class="hljs-type">int</span> bytes = <span class="hljs-number">0</span>, fd;<br><br><span class="hljs-comment">// Set up connection socket</span><br><span class="hljs-comment">// Note: We could also use standard zts_bsd_socket, zts_bsd_connect, etc</span><br>fd = zts_tcp_client(remote_addr, remote_port);<br><br><span class="hljs-comment">// TX</span><br>zts_write(fd, msgStr, <span class="hljs-built_in">strlen</span>(msgStr))<br><br><span class="hljs-comment">// Cleanup</span><br>zts_close(fd);<br>zts_node_stop();<br></code></pre></td></tr></table></figure><br><em>Rust</em>:<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// Set up connection socket</span><br><span class="hljs-keyword">match</span> TcpStream::<span class="hljs-title function_ invoke__">connect</span>(remote_addr) &#123;<br>    <span class="hljs-title function_ invoke__">Ok</span>(<span class="hljs-keyword">mut</span> stream) =&gt; &#123;<br>        <span class="hljs-comment">// TX</span><br>        <span class="hljs-keyword">let</span> <span class="hljs-variable">msg</span> = <span class="hljs-string">b&quot;Hello, network!&quot;</span>;<br>        stream.<span class="hljs-title function_ invoke__">write</span>(msg).<span class="hljs-title function_ invoke__">unwrap</span>();<br>    &#125;<br>    <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; &#123;<br>        <span class="hljs-comment">// Failed to connect</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br><em>Python</em>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Set up connection socket</span><br>client = libzt.socket(libzt.ZTS_AF_INET, libzt.ZTS_SOCK_STREAM, <span class="hljs-number">0</span>)<br>client.connect((remote_ip, remote_port))<br><br><span class="hljs-comment"># TX</span><br>data = <span class="hljs-string">&quot;Hello, network!&quot;</span><br>client.send(data.encode(<span class="hljs-string">&quot;utf-8&quot;</span>))<br><br><span class="hljs-comment"># Cleanup</span><br>client.close()<br>node.node_stop()<br></code></pre></td></tr></table></figure><br><em>C#</em>:<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-comment">// Set up connection socket</span><br><span class="hljs-built_in">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[<span class="hljs-number">128</span>];<br>ZeroTier.Sockets.Socket sender =<br>  <span class="hljs-keyword">new</span> ZeroTier.Sockets.Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);<br>sender.Connect(remoteServerEndPoint);<br><br><span class="hljs-comment">// TX</span><br><span class="hljs-built_in">byte</span>[] msg = Encoding.ASCII.GetBytes(<span class="hljs-string">&quot;Hello, network!&quot;</span>);<br><span class="hljs-built_in">int</span> bytesSent = sender.Send(msg);<br><br><span class="hljs-comment">// Cleanup</span><br>sender.Shutdown(SocketShutdown.Both);<br>sender.Close();<br>node.Stop();<br></code></pre></td></tr></table></figure><br><em>Java</em>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Set up connection socket</span><br><span class="hljs-type">ZeroTierSocket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZeroTierSocket</span>(remoteAddr, port);<br><span class="hljs-type">ZeroTierOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> socket.getOutputStream();<br><span class="hljs-type">DataOutputStream</span> <span class="hljs-variable">dataOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataOutputStream</span>(outputStream);<br><br><span class="hljs-comment">// TX</span><br>dataOutputStream.writeUTF(<span class="hljs-string">&quot;Hello, network!&quot;</span>);<br><br><span class="hljs-comment">// Cleanup</span><br>socket.close();<br>node.stop();<br></code></pre></td></tr></table></figure></p><h1 id="OS-Platform-Notes"><a href="#OS-Platform-Notes" class="headerlink" title="OS / Platform Notes"></a>OS / Platform Notes</h1><h2 id="Linux-5"><a href="#Linux-5" class="headerlink" title="Linux"></a>Linux</h2><h3 id="Linux-FAQ"><a href="#Linux-FAQ" class="headerlink" title="Linux FAQ"></a>Linux FAQ</h3><h3 id="Snap-Package"><a href="#Snap-Package" class="headerlink" title="Snap Package"></a>Snap Package</h3><h3 id="Docker-1"><a href="#Docker-1" class="headerlink" title="Docker"></a>Docker</h3><h3 id="Layer-2-Bridge-1"><a href="#Layer-2-Bridge-1" class="headerlink" title="Layer 2 Bridge"></a>Layer 2 Bridge</h3><h3 id="Amazon-VPC-Gateway"><a href="#Amazon-VPC-Gateway" class="headerlink" title="Amazon VPC Gateway"></a>Amazon VPC Gateway</h3><h3 id="NAT-1"><a href="#NAT-1" class="headerlink" title="NAT"></a>NAT</h3><h3 id="6PLANE-with-Docker"><a href="#6PLANE-with-Docker" class="headerlink" title="6PLANE with Docker"></a>6PLANE with Docker</h3><h3 id="code-server-ZeroTier-1"><a href="#code-server-ZeroTier-1" class="headerlink" title="code-server + ZeroTier"></a>code-server + ZeroTier</h3><h3 id="cloud-init-1"><a href="#cloud-init-1" class="headerlink" title="cloud-init"></a>cloud-init</h3><h3 id="Route-between-ZeroTier-and-Physical-Networks-1"><a href="#Route-between-ZeroTier-and-Physical-Networks-1" class="headerlink" title="Route between ZeroTier and Physical Networks"></a>Route between ZeroTier and Physical Networks</h3><h2 id="macOS-5"><a href="#macOS-5" class="headerlink" title="macOS"></a>macOS</h2><h3 id="macOS-FAQ"><a href="#macOS-FAQ" class="headerlink" title="macOS FAQ"></a>macOS FAQ</h3><h2 id="Windows-3"><a href="#Windows-3" class="headerlink" title="Windows"></a>Windows</h2><h3 id="Windows-FAQ"><a href="#Windows-FAQ" class="headerlink" title="Windows FAQ"></a>Windows FAQ</h3><h3 id="Chocolatey"><a href="#Chocolatey" class="headerlink" title="Chocolatey"></a>Chocolatey</h3><h3 id="WinGet"><a href="#WinGet" class="headerlink" title="WinGet"></a>WinGet</h3><h3 id="LAN-Game-Announcements"><a href="#LAN-Game-Announcements" class="headerlink" title="LAN Game Announcements"></a>LAN Game Announcements</h3><h3 id="Unknown-Node-ID"><a href="#Unknown-Node-ID" class="headerlink" title="Unknown Node ID"></a>Unknown Node ID</h3><h2 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h2><h3 id="Android-FAQ"><a href="#Android-FAQ" class="headerlink" title="Android FAQ"></a>Android FAQ</h3><h2 id="iOS-iPadOS"><a href="#iOS-iPadOS" class="headerlink" title="iOS / iPadOS"></a>iOS / iPadOS</h2><h3 id="iOS-or-iPadOS-FAQ"><a href="#iOS-or-iPadOS-FAQ" class="headerlink" title="iOS or iPadOS FAQ"></a>iOS or iPadOS FAQ</h3><h2 id="Routers"><a href="#Routers" class="headerlink" title="Routers"></a>Routers</h2><h3 id="Router-Config-Tips"><a href="#Router-Config-Tips" class="headerlink" title="Router Config Tips"></a>Router Config Tips</h3><h3 id="Corporate-Firewalls"><a href="#Corporate-Firewalls" class="headerlink" title="Corporate Firewalls"></a>Corporate Firewalls</h3><h3 id="Teltonika-Networks"><a href="#Teltonika-Networks" class="headerlink" title="Teltonika Networks"></a>Teltonika Networks</h3><h3 id="Mikro-Tik"><a href="#Mikro-Tik" class="headerlink" title="Mikro Tik"></a>Mikro Tik</h3><h3 id="OpenWRT"><a href="#OpenWRT" class="headerlink" title="OpenWRT"></a>OpenWRT</h3><h3 id="OPNsense"><a href="#OPNsense" class="headerlink" title="OPNsense"></a>OPNsense</h3><h3 id="Ubiquiti"><a href="#Ubiquiti" class="headerlink" title="Ubiquiti"></a>Ubiquiti</h3><h3 id="Route-between-ZeroTier-and-Physical-Networks-2"><a href="#Route-between-ZeroTier-and-Physical-Networks-2" class="headerlink" title="Route between ZeroTier and Physical Networks"></a>Route between ZeroTier and Physical Networks</h3><h2 id="NAS"><a href="#NAS" class="headerlink" title="NAS"></a>NAS</h2><h3 id="FreeNAS"><a href="#FreeNAS" class="headerlink" title="FreeNAS"></a>FreeNAS</h3><h3 id="ASUSTOR"><a href="#ASUSTOR" class="headerlink" title="ASUSTOR"></a>ASUSTOR</h3><h3 id="QNAP"><a href="#QNAP" class="headerlink" title="QNAP"></a>QNAP</h3><h3 id="Synology"><a href="#Synology" class="headerlink" title="Synology"></a>Synology</h3><h3 id="Western-Digital"><a href="#Western-Digital" class="headerlink" title="Western Digital"></a>Western Digital</h3><h2 id="IoT"><a href="#IoT" class="headerlink" title="IoT"></a>IoT</h2><h3 id="Low-Bandwidth-Mode"><a href="#Low-Bandwidth-Mode" class="headerlink" title="Low Bandwidth Mode"></a>Low Bandwidth Mode</h3><h3 id="OS-and-Device-Compatibility"><a href="#OS-and-Device-Compatibility" class="headerlink" title="OS and Device Compatibility"></a>OS and Device Compatibility</h3><h3 id="Layer-2-Bridge-2"><a href="#Layer-2-Bridge-2" class="headerlink" title="Layer 2 Bridge"></a>Layer 2 Bridge</h3><h3 id="Layer-5-Proxy-Pylon-1"><a href="#Layer-5-Proxy-Pylon-1" class="headerlink" title="Layer 5 Proxy (Pylon)"></a>Layer 5 Proxy (Pylon)</h3><h3 id="Security-1"><a href="#Security-1" class="headerlink" title="Security"></a>Security</h3><h3 id="Route-between-ZeroTier-and-Physical-Networks-3"><a href="#Route-between-ZeroTier-and-Physical-Networks-3" class="headerlink" title="Route between ZeroTier and Physical Networks"></a>Route between ZeroTier and Physical Networks</h3><h2 id="FreeBSD"><a href="#FreeBSD" class="headerlink" title="FreeBSD"></a>FreeBSD</h2><h3 id="FreeBSD-FAQ"><a href="#FreeBSD-FAQ" class="headerlink" title="FreeBSD FAQ"></a>FreeBSD FAQ</h3><h1 id="Service-Providers"><a href="#Service-Providers" class="headerlink" title="Service Providers"></a>Service Providers</h1><h2 id="Rules-FAQ"><a href="#Rules-FAQ" class="headerlink" title="Rules FAQ"></a>Rules FAQ</h2><h2 id="Security-2"><a href="#Security-2" class="headerlink" title="Security"></a>Security</h2><h2 id="SSO-OIDC-1"><a href="#SSO-OIDC-1" class="headerlink" title="SSO / OIDC"></a>SSO / OIDC</h2><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://docs.zerotier.com/&quot;&gt;&lt;strong&gt;ZeroTier Documentation&lt;/strong&gt;&lt;/a&gt;&lt;br&gt;</summary>
    
    
    
    <category term="Document" scheme="http://shenguosai.github.io/categories/Document/"/>
    
    
    <category term="网络" scheme="http://shenguosai.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>小米Note刷机过程记录</title>
    <link href="http://shenguosai.github.io/2024/03/04/%E5%B0%8F%E7%B1%B3Note%E5%88%B7%E6%9C%BA%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/"/>
    <id>http://shenguosai.github.io/2024/03/04/%E5%B0%8F%E7%B1%B3Note%E5%88%B7%E6%9C%BA%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/</id>
    <published>2024-03-04T03:10:07.000Z</published>
    <updated>2024-03-13T00:56:24.648Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h2><p>查了一下订单，2015年5月回国的时候给爸爸和我买了两台小米Note，应该用了没有多久就出问题了一直闲置在家。上网查了一下回收价只有2元，所以就像改造一下看能不能当个简单的服务器来使用。</p><h2 id="2-准备"><a href="#2-准备" class="headerlink" title="2. 准备"></a>2. 准备</h2><h3 id="2-1-小米手机助手"><a href="#2-1-小米手机助手" class="headerlink" title="2.1 小米手机助手"></a>2.1 小米手机助手</h3><p>近些年一直都没有关注小米，上网一查发现小米官网已经不开放手机助手的下载了，在网上找到这么一个网页:<a href="https://miuiver.com/mi-phone-assistant/">MiPhoneAssistant 小米手机助手下载合集</a>。<br>留个底:<br>由于小米助手官方已经很久没更新了，最近一次更新是 2021-10-28，所以强烈不建议在这之后发布的手机和 MIUI 版本上使用，大概率会有适配兼容问题，备份恢复功能很可能不能按预期工作，它只适合在老机型和 MIUI 老版本上使用！</p><p>下面是小米助手官方下载地址，版本由新到旧排列，可按个人喜好或需要选择。<br><a href="https://miuirom.xiaomi.com/rom/u1106245679/4.2.1028.10/MiAssistant-4.2.1028.10.zip">https://miuirom.xiaomi.com/rom/u1106245679/4.2.1028.10/MiAssistant-4.2.1028.10.zip</a><br><a href="https://miuirom.xiaomi.com/rom/u1106245679/3.2.522.32/MiAssistant-3.2.522.32.zip">https://miuirom.xiaomi.com/rom/u1106245679/3.2.522.32/MiAssistant-3.2.522.32.zip</a><br><a href="https://miuirom.xiaomi.com/rom/u491047765/2.3.0.4071/mipctoolexe-2.3.0.4071.exe">https://miuirom.xiaomi.com/rom/u491047765/2.3.0.4071/mipctoolexe-2.3.0.4071.exe</a><br><a href="https://miuirom.xiaomi.com/rom/u491047765/2.3.0.3101/mipctoolexe-2.3.0.3101.exe">https://miuirom.xiaomi.com/rom/u491047765/2.3.0.3101/mipctoolexe-2.3.0.3101.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.3.0.1031_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.3.0.1031_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.7241_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.7241_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.6261_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.6261_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.4091_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.4091_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.3171_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.3171_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.2131_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.2131_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.1301_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.1301_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.1.0.12251_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.1.0.12251_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.1.0.11211_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.1.0.11211_2717.exe</a></p><p>文件 MD5 校验值如下。<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dns">b9aaa49dd92a828179b4994b1eb82136  MiAssistant-<span class="hljs-number">3.2.522</span>.<span class="hljs-number">32</span>.zip<br><span class="hljs-number">7</span>bc76814006a340667dbe72669c66e1f  MiAssistant-<span class="hljs-number">4.2.1028</span>.<span class="hljs-number">10</span>.zip<br>b4ebf49b441a3f4997fc1ac<span class="hljs-number">4a82486a5</span>  mipctoolexe-<span class="hljs-number">2</span>.<span class="hljs-number">3.0.3101</span>.exe<br>d274427550884f389c7e417a13bfd3c1  mipctoolexe-<span class="hljs-number">2</span>.<span class="hljs-number">3.0.4071</span>.exe<br>d4580a3adff0db692f7a0420b568499f  MiSetup2.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">11211_2717</span>.exe<br><span class="hljs-number">936</span>fc4c41e247baf21528e13e26e577e  MiSetup2.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">12251_2717</span>.exe<br><span class="hljs-number">8251</span>f9670237d91f22cc70fa<span class="hljs-number">8f910086</span>  MiSetup2.<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1301_2717</span>.exe<br><span class="hljs-number">80</span>a68985a0d063d32d7884d008a0a71e  MiSetup2.<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2131_2717</span>.exe<br><span class="hljs-number">98</span>c7c5185ee0cd2f1940fcc<span class="hljs-number">8a0f95f99</span>  MiSetup2.<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3171_2717</span>.exe<br>e1073d32737075b51709c9a2b1c0cc99  MiSetup2.<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4091_2717</span>.exe<br>aea5d32a8c4839fc35a2ed4fbb53e70f  MiSetup2.<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6261_2717</span>.exe<br><span class="hljs-number">62d</span>3bd3427038a67ea8772972da1f82f  MiSetup2.<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">7241_2717</span>.exe<br><span class="hljs-number">539</span>cd92545f27978e2fe29aae<span class="hljs-number">527d4b2</span>  MiSetup2.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1031_2717</span>.exe<br></code></pre></td></tr></table></figure></p><p>尝试了一下上面下载地址的前4个还可以下载，但是后面的已经无法打开了，会提示<code>403 Forbidden</code>。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-背景&quot;&gt;&lt;a href=&quot;#1-背景&quot; class=&quot;headerlink&quot; title=&quot;1. 背景&quot;&gt;&lt;/a&gt;1. 背景&lt;/h2&gt;&lt;p&gt;查了一下订单，2015年5月回国的时候给爸爸和我买了两台小米Note，应该用了没有多久就出问题了一直闲置在家。上网查了一</summary>
      
    
    
    
    <category term="Note" scheme="http://shenguosai.github.io/categories/Note/"/>
    
    <category term="Phone" scheme="http://shenguosai.github.io/categories/Note/Phone/"/>
    
    
    <category term="折腾" scheme="http://shenguosai.github.io/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>部署 Windows RDS 远程桌面服务器(一)</title>
    <link href="http://shenguosai.github.io/2024/03/02/%E9%83%A8%E7%BD%B2-Windows-RDS-%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%9C%8D%E5%8A%A1-%E4%B8%80/"/>
    <id>http://shenguosai.github.io/2024/03/02/%E9%83%A8%E7%BD%B2-Windows-RDS-%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%9C%8D%E5%8A%A1-%E4%B8%80/</id>
    <published>2024-03-02T13:22:01.000Z</published>
    <updated>2024-03-02T14:52:26.518Z</updated>
    
    <content type="html"><![CDATA[<p>转自<a href="https://www.cnblogs.com/heavyhe/p/4547058.html">RD网关部署说明</a>，留待以后部署自己的远程桌面网关。</p><p>——-<em>开始正文</em>——-<br><span id="more"></span></p><h2 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h2><p>实现通过RD网关服务器实现外网访问内网的远程桌面。</p><h3 id="1-1-远程桌面网关"><a href="#1-1-远程桌面网关" class="headerlink" title="1.1 远程桌面网关"></a>1.1 远程桌面网关</h3><p>远程桌面网关（RD 网关）是一项角色服务，使授权远程用户可以从任何连接到 Internet 并且可以运行远程桌面连接 (RDC) 客户端的设备连接到内部企业网络或专用网络上的资源。网络资源可以是远程桌面会话主机（RD 会话主机）服务器、运行 RemoteApp 程序的RD 会话主机服务器或启用了远程桌面的计算机。<br>RD 网关使用 HTTPS 上的远程桌面协议 (RDP) 在 Internet 上的远程用户与运行其生产力应用程序的内部网络资源之间建立安全的加密连接。</p><h3 id="1-2-为什么使用远程桌面网关？"><a href="#1-2-为什么使用远程桌面网关？" class="headerlink" title="1.2 为什么使用远程桌面网关？"></a>1.2 为什么使用远程桌面网关？</h3><p><strong>RD 网关有很多优点，其中包括:</strong><br>通过 RD 网关，远程用户可以使用加密连接，<strong>通过 Internet 连接到内部网络资源，而不必配置虚拟专用网络 (VPN) 连接。</strong><br>RD 网关提供全面的安全配置模型，使您可以控制对特定内部网络资源的访问。<strong>RD 网关提供点对点的 RDP 连接，而不是允许远程用户访问所有内部网络资源。</strong><br>通过 RD 网关，大多数远程用户可以连接到在专用网络中的防火墙后面或跨网络地址转换程序 (NAT) 托管的内部网络资源。在此方案中，<strong>通过 RD 网关，不必对 RD 网关服务器或客户端执行其他配置。</strong><br>在此版本的 Windows Server 之前，采用安全措施来阻止远程用户跨防火墙和 NAT 连接到内部网络资源。这是由于出于网络安全考虑，通常阻止端口 3389（用于 RDP 连接的端口）。RD 网关使用 HTTP 安全套接字层/传输层安全 (SSL/TLS) 隧道将 RDP 通信传输到端口 443。由于大多数公司打开端口 443 来支持 Internet 连接，所以，RD 网关利用此网络设计提供跨多个防火墙的远程访问连接。<br>通过远程桌面网关管理器可以配置授权策略，以定义远程用户要连接到内部网络资源必须满足的条件。例如，可以指定：<br>可以连接到内部网络资源的用户（即，可以连接的用户组）。<br>用户可以连接到的网络资源（计算机组）。<br>客户端计算机是否必须是 Active Directory 安全组的成员。<br>是否允许设备的重定向。<br>客户端需要使用智能卡身份验证还是密码身份验证，还是可以使用任一方法。<br>可以将 RD 网关服务器和远程桌面服务客户端配置为使用网络访问保护 (NAP) 来进一步增强安全性。NAP 是 Windows Server® 2008 R2、Windows Server® 2008、Windows® 7、Windows Vista® 和 Windows(R) XP Service Pack 3 中包含的运行状况策略创建、强制和补救技术。通过 NAP，系统管理员可以强制运行状况要求，可以包括软件要求、安全更新要求、所需的计算机配置以及其他设置。</p><p><strong>note备注</strong><br>如果 RD 网关强制 NAP，则运行 Windows Server 2008 R2 或 Windows Server 2008 的计算机不能作为 NAP 客户端使用。如果 RD 网关强制 NAP，则仅运行 Windows 7、Windows Vista 或 Windows XP SP3 的计算机可以作为 NAP 客户端使用。<br>有关如何将 RD 网关配置为使用 NAP 对连接到 RD 网关服务器的远程桌面服务客户端强制运行状况策略的信息，请参阅 Windows Server 2008 R2 技术中心上的”远程桌面服务”页。 <a href="http://go.microsoft.com/fwlink/?linkid=140433">http://go.microsoft.com/fwlink/?linkid=140433（可能为英文网页）</a>。<br>可以将 RD 网关服务器与 Microsoft Internet Security and Acceleration (ISA) 服务器一起使用来提高安全性。在此方案中，可以在专用网络中（而不是在外围网络中）托管 RD 网关服务器，且可以在外围网络中托管 ISA 服务器。远程桌面服务客户端与 ISA 服务器之间的安全套接字层 (SSL) 连接可以在连接到 Internet 的 ISA 服务器上终止。<br>有关如何将 ISA 服务器配置为 RD 网关服务器方案的 SSL 终结设备的信息，请参阅 Windows Server 2008 R2 技术中心上的”远程桌面服务”页。 <a href="http://go.microsoft.com/fwlink/?linkid=140433">http://go.microsoft.com/fwlink/?linkid=140433（可能为英文网页）</a>。<br>远程桌面网关管理器提供的工具帮助您监视 RD 网关服务器状态和事件。通过使用远程桌面网关管理器，可以指定为了进行审核要监视的事件（例如尝试连接到 RD 网关服务器不成功）。</p><h3 id="1-3-配置远程桌面网关"><a href="#1-3-配置远程桌面网关" class="headerlink" title="1.3 配置远程桌面网关"></a>1.3 配置远程桌面网关</h3><p>此清单列出了要成功地为 RD 网关核心方案配置 RD 网关需要完成的任务。通过此方案，可以配置 RD 网关服务器，使远程用户可以通过 RD 网关服务器，从 Internet 访问内部公司网络资源或专用网络资源。在此方案中，内部网络资源可以是远程桌面会话主机（RD 会话主机）服务器、运行 RemoteApp 程序的RD 会话主机服务器或启用了远程桌面的计算机。<br><strong>配置步骤</strong>|………………………………<br>——|——<br>安装远程桌面网关角色服务。|<br>获取 RD 网关服务器的证书。|<br>创建远程桌面连接授权策略(RD CAP)。|<br>创建远程桌面资源授权策略(RD RAP)。|<br>配置 RD 网关的远程桌面服务客户端。|</p><p>有关 RD 网关的详细信息，请参见 Windows Server 2008 R2 TechCenter 上的远程桌面服务页。 <a href="http://go.microsoft.com/fwlink/?LinkId=140433">http://go.microsoft.com/fwlink/?LinkId=140433</a>。</p><h3 id="1-4-安装远程桌面网关的先决条件"><a href="#1-4-安装远程桌面网关的先决条件" class="headerlink" title="1.4 安装远程桌面网关的先决条件"></a>1.4 安装远程桌面网关的先决条件</h3><p><strong>若要正常使用 RD 网关，必须满足下列先决条件：</strong><br><em>必须拥有安装了 Windows Server 2008 R2 的服务器。</em><br>在您要配置的 RD 网关服务器上具有<em>本地”管理员”组成员身份</em>（或同等身份），是完成此过程的最低要求。 查看有关使用适当帐户和组成员关系的详细信息，请访问本地默认组和域默认组。 <a href="http://go.microsoft.com/fwlink/?LinkId=83477">http://go.microsoft.com/fwlink/?LinkId=83477（可能为英文链接）</a>。<br><em>必须为 RD 网关服务器获取安全套接字层 (SSL) 证书</em>（如果还没有该证书）。默认情况下，在 RD 网关 服务器上，Internet 信息服务 (IIS) 服务使用传输层安全 (TLS) 1.0 对通过 Internet 在客户端与 RD 网关服务器之间进行的通信加密。若要正常使用 TLS，必须在 RD 网关服务器上安装 SSL 证书。<br><strong>note备注</strong><br>如果可以使用其他方法获取符合 RD 网关的要求的外部信任证书，则不需要在组织中部署证书颁发机构 (CA) 基础结构。如果您的公司没有独立 CA 或企业 CA，并且您没有受信任公用 CA 颁发的兼容证书，则可以为 RD 网关服务器创建并导入自签名证书，以便进行技术评估和测试。有关详细信息，请参阅为远程桌面网关服务器创建自签名证书。<br>有关 RD 网关 的证书要求以及如何获取并安装证书的信息，请参阅获取远程桌面网关服务器的证书。<br><em>如果配置的 RD 网关授权策略要求客户端计算机上的用户是 Active Directory 安全组的成员，才能连接到 RD 网关服务器，则 RD 网关服务器必须也是 Active Directory 域的成员。</em><br><strong>角色、角色服务和功能的依存关系</strong><br>若要正常使用 RD 网关，要求安装并运行多个角色服务和功能。使用服务器管理器安装 RD 网关角色服务时，将自动安装并启动下列附加的角色、角色服务和功能（如果尚未安装）：<br><em>HTTP 代理上的远程过程调用 (RPC)</em><br><em>Web 服务器 (IIS) [Internet 信息服务]</em><br><em>若要正常使用 HTTP 代理上的 RPC 功能，必须安装并运行 IIS。</em><br><strong>网络策略和访问服务</strong><br>还可以将 RD 网关配置为使用另一台运行网络策略服务器 (NPS) 服务的服务器上存储的远程桌面连接授权策略 (RD CAP)。这样，您将使用运行 NPS 的服务器（以前称为远程身份验证拨入用户服务 (RADIUS) 服务器）来集中存储、管理和验证RD CAP。如果已为远程访问方案（例如 VPN 和拨号网络）部署了运行 NPS 的服务器，则对 RD 网关方案同样使用这个现有的运行 NPS 的服务器，可以增强您的部署。</p><h2 id="2-实验环境"><a href="#2-实验环境" class="headerlink" title="2. 实验环境"></a>2. 实验环境</h2><h3 id="2-1-实验环境"><a href="#2-1-实验环境" class="headerlink" title="2.1 实验环境"></a>2.1 实验环境</h3><div class="table-container"><table><thead><tr><th>服务器名称</th><th>系统</th><th>功能</th><th>备注</th></tr></thead><tbody><tr><td>AD<br>192.168.10.1</td><td>Windows Server 2012</td><td>AD域服务，AD证书服务</td><td>VMHost上虚机</td></tr><tr><td>RD<br>192.168.10.14<br>10.0.1.1</td><td>Windows Server 2012</td><td>RD网关服务器</td><td>VMHost上虚机</td></tr><tr><td><del>RD01</del><br><del>192.168.0.15</del><br><del>10.0.1.3</del></td><td><del>Windows Server 2012</del></td><td><del>RD网关服务器</del></td><td><del>VMHost上虚机</del></td></tr><tr><td>Win-TTLSA6FVTKG<br>192.168.10.22</td><td>Windows 7 32 sp1</td><td>远程桌面</td><td>VMHost上虚机</td></tr><tr><td>Win-J3SKRGLCDLT<br>10.0.1.2</td><td>Windows 7 32 sp1</td><td>客户端</td><td>VMHost3上虚机</td></tr></tbody></table></div><h3 id="2-2-拓扑图"><a href="#2-2-拓扑图" class="headerlink" title="2.2 拓扑图"></a>2.2 拓扑图</h3><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221216.png" alt="20240302221216"></p><h2 id="3-实验步骤"><a href="#3-实验步骤" class="headerlink" title="3. 实验步骤"></a>3. 实验步骤</h2><h3 id="3-1-AD-证书服务安装与配置"><a href="#3-1-AD-证书服务安装与配置" class="headerlink" title="3.1 AD 证书服务安装与配置"></a>3.1 AD 证书服务安装与配置</h3><h4 id="3-1-1-添加-ADCS-角色和功能"><a href="#3-1-1-添加-ADCS-角色和功能" class="headerlink" title="3.1.1 添加 ADCS 角色和功能"></a>3.1.1 添加 ADCS 角色和功能</h4><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221315.png" alt="20240302221315"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221323.png" alt="20240302221323"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221333.png" alt="20240302221333"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221351.png" alt="20240302221351"></p><h4 id="3-1-2-ADCS-配置"><a href="#3-1-2-ADCS-配置" class="headerlink" title="3.1.2 ADCS 配置"></a>3.1.2 ADCS 配置</h4><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221411.png" alt="20240302221411"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221424.png" alt="20240302221424"><br>此处要选【企业 CA】<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221510.png" alt="20240302221510"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221523.png" alt="20240302221523"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221541.png" alt="20240302221541"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221551.png" alt="20240302221551"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221600.png" alt="20240302221600"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221611.png" alt="20240302221611"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221621.png" alt="20240302221621"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221634.png" alt="20240302221634"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221642.png" alt="20240302221642"></p><h4 id="3-1-3-创建针对计算机的证书模板"><a href="#3-1-3-创建针对计算机的证书模板" class="headerlink" title="3.1.3 创建针对计算机的证书模板"></a>3.1.3 创建针对计算机的证书模板</h4><p>在 AD 中，创建证书模板。<br>【服务器管理器】-【工具】-【证书颁发机构】。<br>右键【证书模板】-【新建】-【要颁发的证书模板】。<br>  (1) 右击【证书模板】-【管理】- 右击【计算机】-【复制模板】，在【常规】tab 定义模板名称，在【使用者名称】选择【在请求中提供】，点击【应用】-【确定】<br>  (2) 右键【证书模板】-【新建】-【要颁发的证书模板】，选择模板名称为步骤 (1) 中创建的模板，点击确定。</p><h3 id="3-2-安装远程桌面网关服务"><a href="#3-2-安装远程桌面网关服务" class="headerlink" title="3.2 安装远程桌面网关服务"></a>3.2 安装远程桌面网关服务</h3><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222203.png" alt="20240302222203"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222213.png" alt="20240302222213"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222228.png" alt="20240302222228"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222238.png" alt="20240302222238"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222251.png" alt="20240302222251"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222301.png" alt="20240302222301"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222312.png" alt="20240302222312"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222323.png" alt="20240302222323"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222332.png" alt="20240302222332"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222347.png" alt="20240302222347"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222355.png" alt="20240302222355"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222405.png" alt="20240302222405"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222413.png" alt="20240302222413"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222425.png" alt="20240302222425"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222432.png" alt="20240302222432"></p><h3 id="3-3-配置远程桌面网关服务器"><a href="#3-3-配置远程桌面网关服务器" class="headerlink" title="3.3 配置远程桌面网关服务器"></a>3.3 配置远程桌面网关服务器</h3><p>以下所有配置均在 RD 网关服务器上进行。</p><h4 id="3-3-1-证书"><a href="#3-3-1-证书" class="headerlink" title="3.3.1 证书"></a>3.3.1 证书</h4><p>在【控制台】完成申请证书的相关操作。证书已由前面的ADCS证书服务配置完成。<br>申请完证书后。<br>首先，要对RD网关服务器进行导入证书。<br>其次，要把证书保存到本地硬盘，再拷贝到客户端进行安装，可进行静默安装。</p><h5 id="3-3-1-1-申请证书"><a href="#3-3-1-1-申请证书" class="headerlink" title="3.3.1.1 申请证书"></a>3.3.1.1 申请证书</h5><p>【开始】-【运行】 mmc<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222633.png" alt="20240302222633"><br>【文件】-【添加/删除管理单元】，选择【证书】，点击【添加】。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222718.png" alt="20240302222718"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222727.png" alt="20240302222727"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222738.png" alt="20240302222738"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222745.png" alt="20240302222745"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222751.png" alt="20240302222751"><br>右键【个人】-【证书】-【所有任务】-【申请新证书】<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222827.png" alt="20240302222827"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222837.png" alt="20240302222837"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222847.png" alt="20240302222847"><br>点击下一步<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222907.png" alt="20240302222907"><br>选择新创建的模板下的【注册此证书需要详细信息。单击这里以配置设置】，弹出如下窗口<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223005.png" alt="20240302223005"><br>在类型处选择【公用名】，在值处填写路由器的外网地址，点击【添加】按钮，点击【应用】-【确定】<br>证书申请完成。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223129.png" alt="20240302223129"></p><h5 id="3-3-1-2-导出证书"><a href="#3-3-1-2-导出证书" class="headerlink" title="3.3.1.2 导出证书"></a>3.3.1.2 导出证书</h5><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223156.png" alt="20240302223156"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223207.png" alt="20240302223207"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223216.png" alt="20240302223216"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223225.png" alt="20240302223225"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223233.png" alt="20240302223233"><br>将导出的证书拷贝到客户端进行安装。</p><h5 id="3-3-1-3-导入证书"><a href="#3-3-1-3-导入证书" class="headerlink" title="3.3.1.3 导入证书"></a>3.3.1.3 导入证书</h5><p>【开始】-【运行】输入【tsgateway.msc】调用 RD 网关管理器。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223350.png" alt="20240302223350"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223401.png" alt="20240302223401"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223410.png" alt="20240302223410"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223418.png" alt="20240302223418"></p><h4 id="3-3-2-策略"><a href="#3-3-2-策略" class="headerlink" title="3.3.2 策略"></a>3.3.2 策略</h4><h5 id="3-3-2-1-创建策略"><a href="#3-3-2-1-创建策略" class="headerlink" title="3.3.2.1 创建策略"></a>3.3.2.1 创建策略</h5><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223507.png" alt="20240302223507"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223515.png" alt="20240302223515"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223524.png" alt="20240302223524"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223534.png" alt="20240302223534"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223543.png" alt="20240302223543"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223554.png" alt="20240302223554"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223608.png" alt="20240302223608"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223617.png" alt="20240302223617"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223627.png" alt="20240302223627"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223649.png" alt="20240302223649"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223657.png" alt="20240302223657"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223718.png" alt="20240302223718"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223726.png" alt="20240302223726"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223734.png" alt="20240302223734"></p><h3 id="3-4-客户端配置"><a href="#3-4-客户端配置" class="headerlink" title="3.4 客户端配置"></a>3.4 客户端配置</h3><h4 id="3-4-1-导入证书"><a href="#3-4-1-导入证书" class="headerlink" title="3.4.1 导入证书"></a>3.4.1 导入证书</h4><p>从 RD 网关上拷贝导出的证书文件到客户端，双击进行安装。</p><h4 id="3-4-2-Host-文件修改"><a href="#3-4-2-Host-文件修改" class="headerlink" title="3.4.2 Host 文件修改"></a>3.4.2 Host 文件修改</h4><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223915.png" alt="20240302223915"></p><h4 id="3-4-3-mstsc-设置"><a href="#3-4-3-mstsc-设置" class="headerlink" title="3.4.3 mstsc 设置"></a>3.4.3 mstsc 设置</h4><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223942.png" alt="20240302223942"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223952.png" alt="20240302223952"></p><h3 id="3-5-测试远程桌面登录"><a href="#3-5-测试远程桌面登录" class="headerlink" title="3.5 测试远程桌面登录"></a>3.5 测试远程桌面登录</h3><h3 id="3-6-RD-网关服务器场"><a href="#3-6-RD-网关服务器场" class="headerlink" title="3.6 RD 网关服务器场"></a>3.6 RD 网关服务器场</h3><h2 id="4-参考资料"><a href="#4-参考资料" class="headerlink" title="4. 参考资料"></a>4. 参考资料</h2><p><a href="http://wangchunhai.blog.51cto.com/225186/1139388">http://wangchunhai.blog.51cto.com/225186/1139388</a></p><p>证书服务安装<br><a href="http://lixun.blog.51cto.com/4198640/942447">http://lixun.blog.51cto.com/4198640/942447</a></p><p>证书<br><a href="http://technet.microsoft.com/zh-cn/library/cc725949(v=ws.10).aspx">http://technet.microsoft.com/zh-cn/library/cc725949(v=ws.10).aspx</a></p><p><a href="http://technet.microsoft.com/zh-cn/library/cc725706(v=ws.10).aspx">http://technet.microsoft.com/zh-cn/library/cc725706(v=ws.10).aspx</a></p><p>配置远程桌面网关服务器<br><a href="http://technet.microsoft.com/zh-cn/library/cc754191(v=ws.10).aspx">http://technet.microsoft.com/zh-cn/library/cc754191(v=ws.10).aspx</a></p><p>TMG发布远程桌面网关服务器<br><a href="http://hi.baidu.com/comet82/item/e62dc17664760f480c0a0701">http://hi.baidu.com/comet82/item/e62dc17664760f480c0a0701</a></p><p>安装ADCS<br><a href="http://yuelei.blog.51cto.com/202879/309092/">http://yuelei.blog.51cto.com/202879/309092/</a></p><p>配置CA证书<br><a href="http://235898457.blog.51cto.com/512763/307612">http://235898457.blog.51cto.com/512763/307612</a></p><p>RD网关负载均衡<br><a href="http://blog.sina.com.cn/s/blog_643754960101b79n.html">http://blog.sina.com.cn/s/blog_643754960101b79n.html</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;转自&lt;a href=&quot;https://www.cnblogs.com/heavyhe/p/4547058.html&quot;&gt;RD网关部署说明&lt;/a&gt;，留待以后部署自己的远程桌面网关。&lt;/p&gt;
&lt;p&gt;——-&lt;em&gt;开始正文&lt;/em&gt;——-&lt;br&gt;</summary>
    
    
    
    <category term="Tutorial" scheme="http://shenguosai.github.io/categories/Tutorial/"/>
    
    
    <category term="Windows" scheme="http://shenguosai.github.io/tags/Windows/"/>
    
  </entry>
  
  <entry>
    <title>部署 Windows RDS 远程桌面服务(二)</title>
    <link href="http://shenguosai.github.io/2024/03/02/%E9%83%A8%E7%BD%B2-Windows-RDS-%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%9C%8D%E5%8A%A1-%E4%BA%8C/"/>
    <id>http://shenguosai.github.io/2024/03/02/%E9%83%A8%E7%BD%B2-Windows-RDS-%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%9C%8D%E5%8A%A1-%E4%BA%8C/</id>
    <published>2024-03-02T12:35:58.000Z</published>
    <updated>2024-03-02T14:52:37.505Z</updated>
    
    <content type="html"><![CDATA[<p>转自<a href="https://blog.csdn.net/m0_70919503/article/details/134965019">超详细的 部署Windows RDS 远程桌面服务来啦！！！确定不来看一下嘛~</a>，留待以后部署自己的远程桌面网关。</p><p>——-<em>开始正文</em>——-<br><span id="more"></span><br>用 Windows Server 2016 操作系统来完成 RDS 的部署，包括添加远程桌面服务角色，创建会话集合，发布 Remote App 程序，以及测试访问 Remote App 程序。<br>首先准备两台部署好域环境的虚拟机: Windows Server 2016 和 Windows 7</p><h3 id="添加远程桌面服务角色"><a href="#添加远程桌面服务角色" class="headerlink" title="添加远程桌面服务角色"></a>添加远程桌面服务角色</h3><p>打开 Windows Server 2016:<br>    (1) 点进服务器管理器，点击“添加角色和功能”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302204322.png" alt="20240302204322"><br>    (2) 在安装类型选择“远程桌面服务安装”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302204403.png" alt="20240302204403"><br>    (3) 在“选择部署类型”窗口中选择“标准部署”按键，后“下一步”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302204503.png" alt="20240302204503"><br>    (4) 在“选择部署方案”窗口中，选择“基于会话的桌面部署”按键，后“下一步”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302204559.png" alt="20240302204559"><br>    (5) 系统会自动安装和配置必需的角色服务，直接“下一步”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302204643.png" alt="20240302204643"><br>    (6) 依次指定下面三个服务所在的服务器，在“指定 RD 连接代理服务器”窗口中，将服务器池中的当前服务器添加到右侧窗格中，后“下一步”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302204837.png" alt="20240302204837"><br>    (7) 选择服务器池中的当前的服务器后，双击添加到右侧窗格中，后“下一步”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205006.png" alt="20240302205006"><br>    (8) 选择服务器池中的当前的服务器后，双击添加到右侧窗格中，后“下一步”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205108.png" alt="20240302205108"><br>    (9) 选择“需要时自动启动目标服务器”后，单击“部署”按键<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205210.png" alt="20240302205210"><br>    (10) 安装过程中系统自动重启，重新后会自动完成剩下的安装任务<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205308.png" alt="20240302205308"><br>登录自己的域账号<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205410.png" alt="20240302205410"></p><h3 id="创建会话集合"><a href="#创建会话集合" class="headerlink" title="创建会话集合"></a>创建会话集合</h3><pre><code>(1) 打开“服务器管理器”窗口，在左侧窗格单击刚安装好的“远程桌面服务”，在中间窗格选择“概述”选项，在右侧窗格单击“创建会话合集”![20240302205757](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205757.png)(2) 在“开始之前”窗口中，直接“下一步”(3) 自己取一个便于识别的名称后，单击“下一步”![20240302205902](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205902.png)(4) 将服务器池中的目标服务双击添加至右侧窗格中后，单击“下一步”![20240302205959](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205959.png)(5) 此页面可以点击“添加”按键可以添加需要授权的用户组，我们此处直接“下一步”![20240302210101](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210101.png)(6) 在“指定用户配置文件磁盘”窗口中，输入用户配置文件所在的位置后，单击“下一步”![20240302210201](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210201.png)(7) 确认信息无误后，单击“创建”![20240302210228](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210228.png)(8) 创建成功后单击“关闭”按键![20240302210300](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210300.png)</code></pre><h3 id="发布-Remote-App-程序"><a href="#发布-Remote-App-程序" class="headerlink" title="发布 Remote App 程序"></a>发布 Remote App 程序</h3><pre><code>(1) 打开“服务器管理器”窗口，单击左侧窗格“远程桌面服务”，在中间窗格单击刚创建的集合名称，单击“发布 Remote App 程序”![20240302210553](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210553.png)(2) 选择要发布集合的应用程序，咱选择发布自带的“画图”![20240302210640](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210640.png)(3) 确认要发布的 Remote App 程序列表是否正确，正确就单击“发布”按键![20240302210731](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210731.png)(4) 发布“画图”完成![20240302210802](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210802.png)</code></pre><h3 id="AD-服务端新建用户"><a href="#AD-服务端新建用户" class="headerlink" title="AD 服务端新建用户"></a>AD 服务端新建用户</h3><pre><code>(1) 打开“AD 用户和计算机”窗口![20240302210852](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210852.png)(2) 设置用户登录名称![20240302210913](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210913.png)(3) 设置用户登录密码![20240302210937](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210937.png)</code></pre><h3 id="访问-Remote-App-程序-测试"><a href="#访问-Remote-App-程序-测试" class="headerlink" title="访问 Remote App 程序(测试)"></a>访问 Remote App 程序(测试)</h3><p>进入 Windows 7 (客户端):<br>    (1) 在 Web 浏览器地址栏输入 URL: “<a href="http://FQDN/rdweb”，在打开的页面中单击“继续浏览此网站”">http://FQDN/rdweb”，在打开的页面中单击“继续浏览此网站”</a><br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211135.png" alt="20240302211135"><br>    (2) 输入”服务端域名\刚刚新建的用户的名字”，和登录密码后，点击“登录”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211242.png" alt="20240302211242"><br>        登录成功后出现“画图”程序图表即代表发布成功<br>        <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211336.png" alt="20240302211336"><br>    (3) 单击程序图标，在浏览器底部弹出的对话框单击“打开”按键<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211436.png" alt="20240302211436"><br>    (4) 点击“连接”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211505.png" alt="20240302211505"><br>    (5) 输入账号和登录密码<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211534.png" alt="20240302211534"><br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211551.png" alt="20240302211551"></p><p>以上便是所有内容，欢迎大家前来借鉴！</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;转自&lt;a href=&quot;https://blog.csdn.net/m0_70919503/article/details/134965019&quot;&gt;超详细的 部署Windows RDS 远程桌面服务来啦！！！确定不来看一下嘛~&lt;/a&gt;，留待以后部署自己的远程桌面网关。&lt;/p&gt;
&lt;p&gt;——-&lt;em&gt;开始正文&lt;/em&gt;——-&lt;br&gt;</summary>
    
    
    
    <category term="Tutorial" scheme="http://shenguosai.github.io/categories/Tutorial/"/>
    
    
    <category term="Windows" scheme="http://shenguosai.github.io/tags/Windows/"/>
    
  </entry>
  
  <entry>
    <title>使用PS在5寸相纸上排版1寸证件照</title>
    <link href="http://shenguosai.github.io/2024/02/28/%E4%BD%BF%E7%94%A8PS%E5%9C%A85%E5%AF%B8%E7%9B%B8%E7%BA%B8%E4%B8%8A%E6%8E%92%E7%89%881%E5%AF%B8%E8%AF%81%E4%BB%B6%E7%85%A7/"/>
    <id>http://shenguosai.github.io/2024/02/28/%E4%BD%BF%E7%94%A8PS%E5%9C%A85%E5%AF%B8%E7%9B%B8%E7%BA%B8%E4%B8%8A%E6%8E%92%E7%89%881%E5%AF%B8%E8%AF%81%E4%BB%B6%E7%85%A7/</id>
    <published>2024-02-28T12:31:05.000Z</published>
    <updated>2024-02-28T12:31:05.715Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/spoiler.css&quot; type=&quot;text/css&quot;&gt;&lt;script src=&quot;/js/spoiler.js&quot; type=&quot;text/javascript&quot; async&gt;&lt;/script&gt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Windows11 激活方法</title>
    <link href="http://shenguosai.github.io/2024/02/26/Windows11-%E6%BF%80%E6%B4%BB%E6%96%B9%E6%B3%95/"/>
    <id>http://shenguosai.github.io/2024/02/26/Windows11-%E6%BF%80%E6%B4%BB%E6%96%B9%E6%B3%95/</id>
    <published>2024-02-26T02:47:23.000Z</published>
    <updated>2024-02-26T03:02:59.738Z</updated>
    
    <content type="html"><![CDATA[<p>今天将笔记本自带的 win11 家庭版升级到专业版时无意中在知乎中找到了一个方法，一试还真的有效，因为远程运行了一个网站的程序，不知道自己的电脑是不是成为别人的肉鸡了，但是激活方式确实是有效的。风险性后面再研究吧。<br><span id="more"></span></p><h3 id="两个激活秘钥"><a href="#两个激活秘钥" class="headerlink" title="两个激活秘钥"></a>两个激活秘钥</h3><pre><code class="lang-J8WVF-9X3GM-4WVYC-VDHQG-42CXT```">```7Y64F-88DCY-Y6WTC-H33D2-64QHF</code></pre><p>我使用的是第一个，第二个是否有效没有验证。</p><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><ol><li>右键“此电脑”，依次点击“属性” =&gt; “产品秘钥和激活” =&gt; “更改产品秘钥”，输入上述秘钥；</li><li>win + R，输入powershell，回车。在弹窗中输入命令:<code>irm massgrave.dev/get.ps1 | iex</code></li><li>会弹出下面的窗口<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240226105515.png" alt="20240226105515"><br>简单解释一下: 按1，Windows永久激活；按2，office永久激活；按3，Windows激活到2038年；按4，180天的kms激活工具；……</li><li>然后重复1就会看到“已激活”字样。</li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;今天将笔记本自带的 win11 家庭版升级到专业版时无意中在知乎中找到了一个方法，一试还真的有效，因为远程运行了一个网站的程序，不知道自己的电脑是不是成为别人的肉鸡了，但是激活方式确实是有效的。风险性后面再研究吧。&lt;br&gt;</summary>
    
    
    
    <category term="Note" scheme="http://shenguosai.github.io/categories/Note/"/>
    
    <category term="Windows" scheme="http://shenguosai.github.io/categories/Note/Windows/"/>
    
    
  </entry>
  
  <entry>
    <title>使用curl命令行工具查询本地公网IP地址</title>
    <link href="http://shenguosai.github.io/2024/02/04/%E4%BD%BF%E7%94%A8curl%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E6%9F%A5%E8%AF%A2%E6%9C%AC%E5%9C%B0%E5%85%AC%E7%BD%91IP%E5%9C%B0%E5%9D%80/"/>
    <id>http://shenguosai.github.io/2024/02/04/%E4%BD%BF%E7%94%A8curl%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E6%9F%A5%E8%AF%A2%E6%9C%AC%E5%9C%B0%E5%85%AC%E7%BD%91IP%E5%9C%B0%E5%9D%80/</id>
    <published>2024-02-04T01:46:39.000Z</published>
    <updated>2024-03-02T14:54:57.450Z</updated>
    
    <content type="html"><![CDATA[<p>在 Linux 中 curl 是一个利用 URL 规则在命令行下工作的文件传输工具，同时也可以查询本机公网 IP 地址，具体使用方法如下:<br><span id="more"></span></p><ol><li>使用<code>curl ipinfo.io</code>查询:<br><pre>curl ipinfo.io</pre><br>返回值<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"> [root@MiWiFi-R3D-srv ~]<span class="hljs-comment"># curl ipinfo.io</span><br>&#123;<br> <span class="hljs-string">&quot;ip&quot;</span>: <span class="hljs-string">&quot;1.203.179.218&quot;</span>,// 此处是本机公网ip地址<br> <span class="hljs-string">&quot;city&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,// 城市名<br> <span class="hljs-string">&quot;region&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,// 区域名<br> <span class="hljs-string">&quot;country&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,// 国家代号<br> <span class="hljs-string">&quot;loc&quot;</span>: <span class="hljs-string">&quot;39.9075,116.3972&quot;</span>,// 经纬度坐标<br> <span class="hljs-string">&quot;org&quot;</span>: <span class="hljs-string">&quot;AS4847 China Networks Inter-Exchange&quot;</span>,// 运营商信息<br> <span class="hljs-string">&quot;timezone&quot;</span>: <span class="hljs-string">&quot;Asia/Shanghai&quot;</span>,// 时区<br> <span class="hljs-string">&quot;readme&quot;</span>: <span class="hljs-string">&quot;https://ipinfo.io/missingauth&quot;</span>//提示ipinfo.io官网地址<br>&#125;<br></code></pre></td></tr></table></figure></li><li>使用<code>curl ifconfig.me</code>查询<br><pre>curl ifconfig.me</pre><br>返回值<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@MiWiFi-R3D-srv ~]<span class="hljs-comment"># curl ifconfig.me</span><br>1.203.179.218 //只显示本机公网IP地址<br>[root@MiWiFi-R3D-srv ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure></li><li>使用<code>ipinfo.io</code>加<code>ip</code>地址，可查血这个 ip 的信息<br><pre>curl ipinfo.io/192.168.32.84</pre><br>返回值<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"> [root@MiWiFi-R3D-srv ~]<span class="hljs-comment"># curl  ipinfo.io/103.208.15.138</span><br>&#123;<br> <span class="hljs-string">&quot;ip&quot;</span>: <span class="hljs-string">&quot;103.208.15.138&quot;</span>,//被查询的IP地址<br> <span class="hljs-string">&quot;city&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,//所属城市<br> <span class="hljs-string">&quot;region&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,//所属区域<br> <span class="hljs-string">&quot;country&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,//国家代码<br> <span class="hljs-string">&quot;loc&quot;</span>: <span class="hljs-string">&quot;39.9075,116.3972&quot;</span>,//经纬度坐标<br> <span class="hljs-string">&quot;org&quot;</span>: <span class="hljs-string">&quot;AS9808 China Mobile Communications Group Co., Ltd.&quot;</span>,//运营商信息<br> <span class="hljs-string">&quot;timezone&quot;</span>: <span class="hljs-string">&quot;Asia/Shanghai&quot;</span>,//时区<br> <span class="hljs-string">&quot;readme&quot;</span>: <span class="hljs-string">&quot;https://ipinfo.io/missingauth&quot;</span>//ipinfo.io官网地址<br>&#125;<br></code></pre></td></tr></table></figure></li><li>此命令在 Windows 的命令提示符中也可以使用<br>使用方法如下:<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function"> C:\<span class="hljs-title">Users</span>\<span class="hljs-title">User</span>&gt;<span class="hljs-title">curl</span> <span class="hljs-title">ipinfo.io</span></span><br><span class="hljs-function">&#123;</span><br><span class="hljs-function"> &quot;<span class="hljs-title">ip</span>&quot;: &quot;1.203.179.218&quot;,</span><br><span class="hljs-function"> &quot;<span class="hljs-title">city</span>&quot;: &quot;<span class="hljs-title">Beijing</span>&quot;,</span><br><span class="hljs-function"> &quot;<span class="hljs-title">region</span>&quot;: &quot;<span class="hljs-title">Beijing</span>&quot;,</span><br><span class="hljs-function"> &quot;<span class="hljs-title">country</span>&quot;: &quot;<span class="hljs-title">CN</span>&quot;,</span><br><span class="hljs-function"> &quot;<span class="hljs-title">loc</span>&quot;: &quot;39.9075,116.3972&quot;,</span><br><span class="hljs-function"> &quot;<span class="hljs-title">org</span>&quot;: &quot;<span class="hljs-title">AS4847</span> <span class="hljs-title">China</span> <span class="hljs-title">Networks</span> <span class="hljs-title">Inter</span>-<span class="hljs-title">Exchange</span>&quot;,</span><br><span class="hljs-function"> &quot;<span class="hljs-title">timezone</span>&quot;: &quot;<span class="hljs-title">Asia</span>/<span class="hljs-title">Shanghai</span>&quot;,</span><br><span class="hljs-function"> &quot;<span class="hljs-title">readme</span>&quot;: &quot;<span class="hljs-title">https</span>://<span class="hljs-title">ipinfo.io</span>/<span class="hljs-title">missingauth</span>&quot;</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure></li><li>最简单的是使用 <a href="https://ip138.com/">https://ip138.com/</a> 网址进行本机公网IP地址查询<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240204101450.png" alt="20240204101450"></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;在 Linux 中 curl 是一个利用 URL 规则在命令行下工作的文件传输工具，同时也可以查询本机公网 IP 地址，具体使用方法如下:&lt;br&gt;</summary>
    
    
    
    <category term="Note" scheme="http://shenguosai.github.io/categories/Note/"/>
    
    <category term="Linux" scheme="http://shenguosai.github.io/categories/Note/Linux/"/>
    
    
    <category term="Linux" scheme="http://shenguosai.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>关于半导体工艺中电容器件</title>
    <link href="http://shenguosai.github.io/2024/02/01/%E5%85%B3%E4%BA%8E%E5%8D%8A%E5%AF%BC%E4%BD%93%E5%B7%A5%E8%89%BA%E4%B8%AD%E7%94%B5%E5%AE%B9%E5%99%A8%E4%BB%B6/"/>
    <id>http://shenguosai.github.io/2024/02/01/%E5%85%B3%E4%BA%8E%E5%8D%8A%E5%AF%BC%E4%BD%93%E5%B7%A5%E8%89%BA%E4%B8%AD%E7%94%B5%E5%AE%B9%E5%99%A8%E4%BB%B6/</id>
    <published>2024-02-01T09:15:36.000Z</published>
    <updated>2024-03-02T14:55:50.742Z</updated>
    
    <content type="html"><![CDATA[<p>半导体设计中常用的电容有: MIM, MOM, Varactor, NCAP, N/P MOS<br><span id="more"></span></p><h3 id="MIM"><a href="#MIM" class="headerlink" title="MIM"></a>MIM</h3><p>MIM 电容是利用异层金属制备:</p><ol><li>是使用特殊H -K 材料制作的高密度电容，比较薄，耐击穿性不好，比较贵，增加了新的工艺，需要额外的 mask(MIM 层间金属介质层)。</li><li>逻辑电路中本身存在较多的金属层，可以将奇数层金属连接在一起，偶数层金属连接在一起，形成层间 MIM 电容，但是层间距离比较大，一次电容密度比较小。</li><li>寄生电容大。</li></ol><h3 id="MOM"><a href="#MOM" class="headerlink" title="MOM"></a>MOM</h3><p>同层金属插指形成:</p><ol><li>比较占面积；</li><li>容值高；</li><li>工艺兼容，单独划分区域即可；</li><li>寄生电容小；</li><li>28nm 以下工艺固定使用 MOM 。</li></ol><h3 id="Varactor"><a href="#Varactor" class="headerlink" title="Varactor"></a>Varactor</h3><p>Poly-oxide-NWell，S/D NP+ 作为bulk，是一种电压控制的电容，电容是反偏积累工作状态，其电容与电压的关系完全取决于 NWell 掺杂浓度梯度，工艺难度较大。<br>Varactor 一般操作在 accumulation (积累)区，C-V 曲线较线性，常用在需要电压调整电容的控制回路中。</p><p>在 Psub 的工艺中，Varactor 和 NCAP 是坐在 NWell 中，S/D 是 N+ 重掺杂作为BULK，当 GATE 和 BULK 压差越大时，沟道积累负电荷越多，相当于 GATE 和 BULK 这两个极板离得越近，电容越大。</p><h3 id="NCAP"><a href="#NCAP" class="headerlink" title="NCAP"></a>NCAP</h3><h3 id="N-P-MOS-Poly-cap"><a href="#N-P-MOS-Poly-cap" class="headerlink" title="N/P MOS(Poly cap)"></a>N/P MOS(Poly cap)</h3><p>MOS 电容，对比 Varactor NWell 情况，Poly Cap 使用 PMOS。所以 S/D 使用 PP+ 而不是 NP+。<br>MOS Cap 一般操作在 inversion (反型)区， C-V 曲线不线性且陡峭，通常用在固定 Gate Voltage 做稳压电容。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;半导体设计中常用的电容有: MIM, MOM, Varactor, NCAP, N/P MOS&lt;br&gt;</summary>
    
    
    
    <category term="Knowledge Share" scheme="http://shenguosai.github.io/categories/Knowledge-Share/"/>
    
    
    <category term="Semicondcutor" scheme="http://shenguosai.github.io/tags/Semicondcutor/"/>
    
    <category term="Device" scheme="http://shenguosai.github.io/tags/Device/"/>
    
  </entry>
  
  <entry>
    <title>EDA工具使用备忘</title>
    <link href="http://shenguosai.github.io/2024/02/01/EDA%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E5%A4%87%E5%BF%98/"/>
    <id>http://shenguosai.github.io/2024/02/01/EDA%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E5%A4%87%E5%BF%98/</id>
    <published>2024-02-01T00:49:38.000Z</published>
    <updated>2024-03-04T03:12:15.320Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Cadence"><a href="#Cadence" class="headerlink" title="Cadence"></a>Cadence</h2><h4 id="Virtuoso"><a href="#Virtuoso" class="headerlink" title="Virtuoso"></a>Virtuoso</h4><ol><li>.cdsinit: 负责Cadence软件的初始化配置，包括加载快捷方式、嵌入Calibre软件接口等。<span id="more"></span><ul><li>示例存放目录:<code>Candence安装目录/tools/dfII/samples/local/cdsinit</code></li><li>读取顺序: <blockquote><p><em><font color="#d3d3d3">Cadence安装目录</font></em>/tools/dfII/samples/local/cdsinit =&gt; <em><font color="#d3d3d3">用户home目录</font></em>/.cdsinit =&gt; <em><font color="#d3d3d3">virtuoso启动目录</font></em>/.cdsinit</p></blockquote></li><li>设置默认读取的display.drf文件:    <pre>drLoadDrf(<em>filePath</em>)</pre></li><li>设置默认快捷键文件:<ul><li>添加单个快捷键文件 <pre>load("/home/IC/Desktop/workspace/analog_ic/set_env/bindKeys_ICSkillSharing.il")</pre></li><li>添加多个快捷键文件 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs skill">let((bindKeyFileList file path saveSkillPath)<br>    bindKeyFileList = &#x27;(<br>        &quot;leBindKeys.il&quot;<br>        &quot;schBindKey.il&quot;<br>        &quot;bindKeys_ICSkillSharing.il&quot;<br>    )<br>)<br>; This is the path that is searched for the files<br>    path = strcat(<br>; If you want to add another path add it here as a string<br>        &quot;. ~/home/IC/Desktop/workspace/analog_ic/set_env &quot;<br>        prependInstallPath(&quot;local&quot;)<br>        prependInstallPath(&quot;samples/local&quot;)<br>    )<br>saveSkillPath = getSkillPath()<br>saveSkillPath(path)<br><br>foreach(file bindKeyFileList<br>    if(isFile(file) then<br>        loadi(file)<br>    )<br>)<br>setSkillPath(saveSkillPath)<br></code></pre></td></tr></table></figure></li></ul></li><li>快捷键设置:<ul><li>设置快捷键“0”消除高亮net|按“0”后鼠标点击欲消除的net: <pre>hiSetBindKey("Schematics" "<Key>0" "geEnterDeleteNetProbe()")</pre></li><li>设置快捷键“-”消除所有高亮net:  <pre>hiSetBindkey("Schematics" "<Key>-" "geDeleteAllProbe(getCurrentWindow() t)")</pre></li><li>设置快捷键“F6”打开Library Manager(启动Virtuoso后): <pre>hiSetBindKey("Command Interpreter" "<Key>F6" "ddsOpenLibManager()")</pre></li><li>设置快捷键“Shift+S”在上层schematic界面下编辑Symbol: <pre>hiSetBindKey("Schematics" "Shift<Ket>S" "schHiEditInPlace()")</pre></li><li>设置仿真结果默认存放目录为“/DATA/shenguosai/simulasion”: <pre>envSetVal("asimenv.startup" "projectDir" 'string "/DATA/shenguosai/simulasion")</pre></li><li>调用其它软件接口:<ul><li>Calibre<br><pre>load(“<em>Calibre_install_dir</em>/lib/calibre.skl”)</li><li>HSPICE<br><pre>load(“<em>HSPICE_install_dir</em>/interface/HSPICE.ile”)</li></ul></li></ul></li></ul></li><li><p>.cdsenv: 包含了Cadence软件的变量设置，用户通过对变量赋值，改变软件设置。</p><ul><li>示例存放目录: <code>Candence安装目录/tools/dfII/samples/.cdsenv</code></li><li>读取顺序: <blockquote><p><em><font color="#d3d3d3">Cadence安装目录</font></em>/tools/dfII/samples/.cdsenv =&gt; <em><font color="#d3d3d3">用户home目录</font></em>/.cdsenv =&gt; <em><font color="#d3d3d3">virtuoso启动目录</font></em>/.cdsenv</p></blockquote></li><li>设置仿真结果显示有效位数:(示例文件中有，通过搜索改变赋值即可,以下同)   <pre>auCore.misc labelDigits int 6</pre></li><li>改变仿真结果保存路径:   <pre>asimenv.startup projectDir string" ./simulation"</pre></li><li>按Library名称设置仿真结果保存路径:<br>   <pre>asimenv.startup appendLibNameToProjectDir boolean t</li><li>设置原理图和版图中的 label 默认字体改为 roman:   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs skill">schematic createLabelFontStyle cyclic &quot;roman&quot;<br>layout labelFontStyle cyclic &quot;roman&quot;<br></code></pre></td></tr></table></figure></li><li>设置版图网格点默认值:视工艺而定   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs skill">layout xSnapSpacing float 0.005<br>layout ySnapSpacing float 0.005<br></code></pre></td></tr></table></figure></li><li>设置仿真波形与坐标显示:   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs skill">viva.graph  titleFont  string  &quot;Default,14,-1,5,75,0,0,0,0,0&quot;<br>viva.rectGraph    background  string  &quot;white&quot;<br>viva.axis     font   string   &quot;Default,14,-1,5,75,0,0,0,0,0&quot;<br>viva.horizMarker font    string   &quot;Default,14,-1,5,75,0,0,0,0,0&quot;<br>viva.vertMarker     font    string   &quot;Default,14,-1,5,75,0,0,0,0,0&quot;<br>viva.referenceLineMarker    font  string    &quot;Default,14,-1,5,75,0,0,0,0,0&quot;<br>...<br>viva.trace  lineThickness  string  &quot;Thick&quot;<br>viva.trace  lineStyle  string  &quot;solid&quot;<br>wavescan.trace  lineThickness  string  &quot;Thick&quot;<br>wavescan.trace  lineStyle  string  &quot;solid&quot;<br></code></pre></td></tr></table></figure>   其中<code>viva.axis font string &quot;Defaut,14,-1,5,75,0,0,0,0,0&quot;</code>中的 14 为字号；75 为颜色深度，可以理解为是否加粗，取值在0-99之间。<blockquote><p><b>注意</b>:仿真波形显示方法会与 PDK 中环境变量设置和 display.drf 文件中的设置有关，如果按照上面的方法设置完后不能达到实际效果，首先考虑是否是 PDK 自带脚本加载了其它软件变量或者使用的 display.drf 文件中做了相应修改，如果发现有问题可以修改 PDK 中环境变量或者 display.drf 文件的相应设置。</p></blockquote></li><li><p>实现在 Library Manager 界面双击 view 以只读方式打开:<br>   <pre>cdsLibManager.main dblClickEditCellView boolean nil</pre></p><blockquote><p><b>特别注意</b>: 可能按照上面的方法设置完.cdsenv文件之后，发现设置并未生效，这时候需要注意一个问题，<b>Cadence每次启动时都会加载 .cdsinit 文件，然而对于 .cdsenv 文件并非如此，而且 .cdsenv文件中的变量值会被覆盖，具体软件加载 .cdsenv 文件的顺序需要再用户的环境变量设置文件中定义。</b>一般叫做 .bashrc (使用 export 定义环境变量)或者 .cshrc (使用 setenv 定义环境变量)。</p></blockquote>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 加载软件启动目录下的 .cdsenv 文件</span><br><span class="hljs-built_in">export</span> CDS_LOAD_ENV = CWD(setenv CDS_LOAD_ENV CWD)<br><br><span class="hljs-comment"># 首先加载用户主目录下的 .cdsenv 文件，然后加载软件启动目录下的 .cdsenv 文件。</span><br><span class="hljs-built_in">export</span> CDS_LOAD_ENV = addCWD(setenv CDS_LOAD_ENV addCWD)<br></code></pre></td></tr></table></figure></li></ul></li><li>display.drf: 一般在工艺库中会有初始化的显示文件。这里面会有电路的连线粗细及颜色，器件的一些显示，版图layout里面的layer颜色等等，还有ADE波形图里面的线的属性。总之就是显示相关的一些设置。<ul><li>文件的修改保存: 当修改过显示后，每次退出 virtuoso 会显示一个保存显示信息，这里输入名称，比如display_1.drf，这个文件默认保存在打开 virtuoso 的文件夹下面。</li><li>默认文件的设置: 在.cdsinit 文件里添加载入命令 <code>drLoadDrf(filepath)</code> 。</li></ul></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Cadence&quot;&gt;&lt;a href=&quot;#Cadence&quot; class=&quot;headerlink&quot; title=&quot;Cadence&quot;&gt;&lt;/a&gt;Cadence&lt;/h2&gt;&lt;h4 id=&quot;Virtuoso&quot;&gt;&lt;a href=&quot;#Virtuoso&quot; class=&quot;headerlink&quot; title=&quot;Virtuoso&quot;&gt;&lt;/a&gt;Virtuoso&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;.cdsinit: 负责Cadence软件的初始化配置，包括加载快捷方式、嵌入Calibre软件接口等。</summary>
    
    
    
    <category term="Semiconductor" scheme="http://shenguosai.github.io/categories/Semiconductor/"/>
    
    <category term="EDA" scheme="http://shenguosai.github.io/categories/Semiconductor/EDA/"/>
    
    
    <category term="Semiconductor" scheme="http://shenguosai.github.io/tags/Semiconductor/"/>
    
    <category term="EDA" scheme="http://shenguosai.github.io/tags/EDA/"/>
    
    <category term="Note" scheme="http://shenguosai.github.io/tags/Note/"/>
    
  </entry>
  
  <entry>
    <title>Work Logs--20240130</title>
    <link href="http://shenguosai.github.io/2024/01/30/Work-Logs-20240130/"/>
    <id>http://shenguosai.github.io/2024/01/30/Work-Logs-20240130/</id>
    <published>2024-01-30T10:00:00.000Z</published>
    <updated>2024-03-04T03:11:53.077Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉, 这个密码看着不太对, 请再试试." data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容.">  <script id="hbeData" type="hbeData" data-hmacdigest="5739de8e3d71c055e58a569ca60b511c2b242b4f62e7f8ef726a877df399fe99">ae118af9461036e20f25663a30e189738734b433ecdcc685de42ade449b792d34bc8972806baa92858fa8c8179cc4f0cdad51b0f6d2e4688d806e1d895f634ddc3219fc23abbb5e49b2a3b0254457461a9e56f5091442fae415b599f95777f53349b5ac9c312d9f9d1912e24590acb55e898248e5f1fb86dc1d9976c1c1e6c8ecd7887d313f4407fbe3c890889a2d2809bb4758b29849793363c11583b4ca9bd52f72d00646e0765e1deeb8257354e35b1486ec2c81c151f323ad47e25a5e4315e22752ae0d2bfa35030b1a4e4583373bb896c9c8e403d683847dfb63251a37ec83a411798f3e5da471901e0e75c29d8526668ce930203040fb45b7a3abcfd0f8c6e7a9a4e5f98f3395df187c21d636068f229d5c8b395c18f8265282919c244768268b328a0bd57b7ee4b3e76cb5b28625e4e939ec5d6ecb65d2ca8523376c4592766e9db5ef914b28bf52d8f8da6f727399c1a18b17876a14384f9c261d3c5b759d348832ba1417bff6c76555f73eadcfaffc3b1a3abb843912f66af9d2a5b00ede719066e499430f7e50114340cbf3c75fb0ef70b9a1d4c86826bfa0781236e611b03a8ebcf1207b5b47df022246c0085c6059afa63923b1d45bdec7f9ab8947d88036ed0107701dd4f4291ac9470b2af4614d23d8045a187b285b6bc121e2acf1bb2a44364e5cf755a60373d2f8e5ded8d8db377615c9b0203c29acfeedd37fb156660cf1a53d18241591597c786a86d969c3c7a811f0c8717f05c19479049568ed0620f2f36dce1f152e6cdf018e92a83e25231b517276a373014e5565f163758a0c4db9a918d4fe28b67bc9071bcafb3d2390a2c2d82371af2c25514751b26bc9f4ec9524b8dab4768dced72cac7f6ae464856ccfa7f34a7a0213b3d5f483b45dcac301082978dab8f5563113abc0bbfaa833d9ab970256ceb1ca5c91694e00cbb0134e140cd275ae703dac5afb36a86887aaf1774f2a755a11c396d61199f7d095b66758afd2caf2e297fcdc7414746b9d0d03e81cf8f559def35d02a3c8741178e83bd555e2e04737264968684480f0a8de04fa62c10d3f5c2876b95d178c5f013145ff4f35fd973e116237d8be6f3f26f7f8bd75e5eda1fa9c11ebf07a67074aace6210aa67cf0c5a64b427164e0ea05ac09bad3ddfb405d6b241e7c53823a616a6b2f167a7833bd965acc604c2970c64f0ea5edaf412d45d0394087d88089ee6c3a4050168a5084bd8840ab440c638c844d51a8103fbf187c1e941b1cc51429a5ca7fc5f374658faa23281f71fd83bd8c68550745906892866b4c9423b8222f13bab6dfb92f8c10bdf02bdd512c4fc1b703ccb58561db74eba8928159e73270a8ee46cceeb78f9fdd4b87c5e4209708c49b91797385f6d605f24028f1d9bffd39a172d01f3e8aa34631d1d46a45738ad9c55b4bf8d88fa9d5d35c4c0aefc68ca58621b504766c7ac570454c194f5cf596fb001ccac9f0219d3fc9a5e4d3f9a726f81b3bcd36e7108648a29edf58b54c629089d7c596cf791d68b9cc61966fb4db2e1071e6901e344b963ae3bbae40edeb781ba09b342c893f2b7c3ee147d36f5b3d42b0b273b462f133d9ea9e0e30997d8f652dab9ef73309d76067493a7846299022842c25bcaa1adf43d36394147c0a5005f04370698fca5ae7ecc01626410e8a9117113fc197bae4baaebf7b30c23ae7f963549cfd73309cf5d9646384b470ad81c8430c5174661e92f9da039762e2fabc2ba41971043b7b181b6196190b8014884121888a9dae4bca885ef5c087d3609667f5c7c687aa31656600898c3b84567725dc845a10064c40757b1dbfb446e8099bcaf806346654bc50b5c6a9bb7cc7e6eca4e8f94b996fe111d917c58f9ee42579bcd9ae30c0b3e8a9ff7cdf1b90f9ab142d8f0c80330a121284bf04149f9b4ea66b423a55681185ca92fcc9a5dea85dd00d69e51a8b7c40e1406ea08333f60d55eb3f04afc33b2fb25100bc097682f2eb6b862ae2071aef4788dfdc588d178ab3fe3e3f31d3e9f42a27aa25e7201c54cf4fc64bda222b647b360d6229c80a06007a992e58075b55ed4fd613df85abe361a62d736a6563d78c2d494b1fd12e82c36cdb71bce46d41b90cb87575ffb395de1a785a98fcb6402b02a0118d23a91432b8fb90df5637e3a9386e19d9c7792445a601ac5050f7942270ff2e244d8a338eabccc4673fee1e2101edfba447bafbd147e1bf355db687b</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">您好, 这里需要密码.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">有东西被加密了, 请输入密码查看.</summary>
    
    
    
    <category term="Projects" scheme="http://shenguosai.github.io/categories/Projects/"/>
    
    <category term="CXT2503S" scheme="http://shenguosai.github.io/categories/Projects/CXT2503S/"/>
    
    
    <category term="WorkLogs" scheme="http://shenguosai.github.io/tags/WorkLogs/"/>
    
    <category term="Swiching Regulator" scheme="http://shenguosai.github.io/tags/Swiching-Regulator/"/>
    
    <category term="Buck-Boost" scheme="http://shenguosai.github.io/tags/Buck-Boost/"/>
    
  </entry>
  
  <entry>
    <title>浅谈几种带宽与增益</title>
    <link href="http://shenguosai.github.io/2024/01/10/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8D%E5%B8%A6%E5%AE%BD%E4%B8%8E%E5%A2%9E%E7%9B%8A/"/>
    <id>http://shenguosai.github.io/2024/01/10/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8D%E5%B8%A6%E5%AE%BD%E4%B8%8E%E5%A2%9E%E7%9B%8A/</id>
    <published>2024-01-10T07:02:38.000Z</published>
    <updated>2024-01-10T08:49:57.248Z</updated>
    
    <content type="html"><![CDATA[<p>今天记录一下闭环增益、开环增益、环路增益，以及3dB带宽、单位增益带宽(UGB)、增益带宽积(GBW)。<br><span id="more"></span></p><h2 id="关于增益"><a href="#关于增益" class="headerlink" title="关于增益"></a>关于增益</h2><h3 id="闭环增益"><a href="#闭环增益" class="headerlink" title="闭环增益"></a>闭环增益</h3><p>对于一个闭环反馈系统，如下图:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240110153857.png" alt="20240110153857"><br>闭环增益即传输函数为: $\frac{Y(s)}{X(s)}=\frac{H(s)}{1+\beta H(s)}$, 是 $\frac{开环增益}{1+环路增益}$。</p><h3 id="开环增益"><a href="#开环增益" class="headerlink" title="开环增益"></a>开环增益</h3><p>从上面图中可知，开环增益就是去除反馈对系统的作用，看运放的增益。</p><h3 id="环路增益"><a href="#环路增益" class="headerlink" title="环路增益"></a>环路增益</h3><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240110154642.png" alt="20240110154642"><br>如图所示，输入置0，断开环路。<br>环路增益$\frac{V_F}{V_t}=\beta A$<br>根据巴克豪森判据判断系统是否稳定，所以仿真都是用stb仿环路稳定性，看<b>环路增益波特图</b>而不是看开环增益或者闭环增益。</p><p>那为什么到运放看稳定性就说开环增益了呢？<br>对于单个运放来说，由于运放一般工作在负反馈系统中，开环增益就相当于反馈系数为1的环路增益，所以到运放会说开环增益，其实还是在说环路增益。</p><p>那为什么说运放仿开环增益相位裕度够了就代表其接成反馈系统是稳定的呢？<br>拉扎维的10.2节完美解释了这个问题:<br>运放开环增益相当于反馈系数为1的环路增益:在反馈系统里，反馈系数最大为1，就是接成单位增益负反馈形势。这种情况下，系统的环路增益波特图与运放的完全重合，即相位裕度一样，所以可以稳定。<br>对于其它反馈系数小于1的系统来说，环路增益为$\beta A$，不管$\beta$如何变，环路增益的波特图中，极点的位置与运放极点位置一样，不会变，所以相频曲线没有任何改变。但是由于$\beta &lt;1$，幅频曲线下移，增益交点提前，相位裕度只会越来越大。<br>综上，运放单独仿真与它接在负反馈系统里相比，相位裕度是最差的情况了，即当反馈变弱时，结果是系统更稳定。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240110161104.png" alt="20240110161104"></p><h2 id="关于带宽"><a href="#关于带宽" class="headerlink" title="关于带宽"></a>关于带宽</h2><h3 id="3dB带宽"><a href="#3dB带宽" class="headerlink" title="3dB带宽"></a>3dB带宽</h3><p>3dB带宽就是运放的主极点处所对应的频率，幅度上对应比低频增益下降3个dB处。<br>推导:<br>运放传递函数:$A_v(s)=\frac{A_v(0)}{(1+s/\omega _0)(1+s/\omega _1)(1+s/\omega _2)···}$</p><p>假设次极点离主极点很远很远，那么在主极点$s=\omega _0$处，有:<br>$A_v(\omega _0)=20log(\frac{A_v(0)}{1+\omega _0/\omega _0})=20log(\frac{A_v(0))}{2}=20logA_v(0)-20log(2)\approx 20logA_v(0)-3dB$</p><p>所以叫做3dB带宽。</p><h3 id="单位增益带宽"><a href="#单位增益带宽" class="headerlink" title="单位增益带宽"></a>单位增益带宽</h3><p>顾名思义，就是运放$\frac{开环增益}{闭环负反馈系统环路增益}=1$时对应的频率。<br>为了推导方便，假设只有一个极点的运放，那么在它的单位增益带宽处，有:<br>$A_v(\omega _{UGB})=\frac{A_v(0)}{1+\frac{\omega _{UGB}}{\omega _0}}=1$<br>可得，$\omega _{UGB}=A_v(0)*\omega _0$</p><p>这里有一个结论: 闭环系统的3dB带宽等于环路增益的党委增益带宽。单位增益负反馈系统的3dB带宽等于该系统中所使用的运放的单位增益带宽。<br>推导:负反馈想要稳定，即相位裕度达到60°，单位增益带宽内一定只有一个极点。只看单位增益带宽内的情况，那么有:<br>环路增益: $\beta A(s)=\frac{\beta A_0}{1+\frac{s}{\omega _0}}$<br>闭环系统传输函数: $\frac{Y(s)}{X(s)}=\frac{A(s)}{1+\beta A(s)}=\frac{\frac{A_0}{1+\beta A_0}}{1+\frac{s}{(1+\beta A_0)\omega _0}}$<br>所以就闭环系统传输函数3dB带宽<b>(不是环路增益，是传输函数)</b>是$\omega _0<em>\beta A_0$，环路增益的单位增益带宽也是$\omega _0</em>\beta A_0$。<br>当系统为单位增益负反馈系统时，即反馈因子是1，系统3dB带宽是$\omega _0<em>A_0$,运放单位增益带宽也是$\omega _0</em>A_0$。</p><h3 id="增益带宽积-GBW"><a href="#增益带宽积-GBW" class="headerlink" title="增益带宽积(GBW)"></a>增益带宽积(GBW)</h3><p>增益与带宽的乘积。<br>重要结论:在单极点系统中，GBW是不变的，等于单位增益带宽，等于低频增益3dB带宽。因为只有一个极点的时候，极点之后，带宽每增大10倍，增益下降20dB，20dB就是10倍，一个增大十倍，一个减小十倍，自然不变。<br>结合单位增益带宽中的结论推导部分，可见，闭环系统传输函数的增益带宽积与开环的增益带宽积相等。(再次强调:是传输函数的增益带宽积，不是环路增益中的增益带宽积)<br>$A_0<em>\omega _0=\frac{A_0}{1+\beta A_0}</em>(1+\beta A_0)*\omega _0$</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;今天记录一下闭环增益、开环增益、环路增益，以及3dB带宽、单位增益带宽(UGB)、增益带宽积(GBW)。&lt;br&gt;</summary>
    
    
    
    <category term="Semiconductor" scheme="http://shenguosai.github.io/categories/Semiconductor/"/>
    
    <category term="Analog" scheme="http://shenguosai.github.io/categories/Semiconductor/Analog/"/>
    
    
    <category term="反馈" scheme="http://shenguosai.github.io/tags/%E5%8F%8D%E9%A6%88/"/>
    
  </entry>
  
  <entry>
    <title>TVBox的安装与使用</title>
    <link href="http://shenguosai.github.io/2024/01/05/TVBox%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
    <id>http://shenguosai.github.io/2024/01/05/TVBox%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/</id>
    <published>2024-01-05T00:48:22.000Z</published>
    <updated>2024-01-31T08:41:55.813Z</updated>
    
    <content type="html"><![CDATA[<p><a href="/download/TVBox_takagen99_20231231-1656.apk">apk下载</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;/download/TVBox_takagen99_20231231-1656.apk&quot;&gt;apk下载&lt;/a&gt;&lt;/p&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/spoiler.css&quot; type=&quot;text/css&quot;&gt;&lt;scrip</summary>
      
    
    
    
    <category term="Tutorial" scheme="http://shenguosai.github.io/categories/Tutorial/"/>
    
    <category term="TV-Software" scheme="http://shenguosai.github.io/categories/Tutorial/TV-Software/"/>
    
    <category term="TVBox" scheme="http://shenguosai.github.io/categories/Tutorial/TV-Software/TVBox/"/>
    
    
    <category term="Life" scheme="http://shenguosai.github.io/tags/Life/"/>
    
  </entry>
  
  <entry>
    <title>Cadence使用Calibre进行后仿</title>
    <link href="http://shenguosai.github.io/2023/12/18/Cadence%E4%BD%BF%E7%94%A8Calibre%E8%BF%9B%E8%A1%8C%E5%90%8E%E4%BB%BF/"/>
    <id>http://shenguosai.github.io/2023/12/18/Cadence%E4%BD%BF%E7%94%A8Calibre%E8%BF%9B%E8%A1%8C%E5%90%8E%E4%BB%BF/</id>
    <published>2023-12-18T05:50:59.000Z</published>
    <updated>2024-01-31T03:02:31.009Z</updated>
    
    <content type="html"><![CDATA[<ol><li>通过 Virtuoso 的 Layout XL =&gt; Calibre =&gt; Run PEX 进入 Calibre PEX，并将工艺厂提供的 xRC(Rule) 文件设置好 Calibre PEX。<span id="more"></span></li><li>为了减少寄生参数，以及提高后仿效率，建议在 Calibre PEX =&gt; PEX Options =&gt; Netlist =&gt; Reduction and CC 中将 Enable MinRes reduction 和 Enable MinCap Reduction 选中，并在 COMBINE 和 REMOVE 后的框中填写所需数值，一般 Cap 的 Combine 为 0.5fF，Remove 为 0.1fF。Res 的 Combine 为 1Ω，Remove 为 0.1Ω。</li><li>在 Outputs 选项中，Outputs =&gt; Netlist 框中，Format 选 CALIBREVIEW(可增加 Geometry 可在 PEX 运行完后弹出寄生参数的总结)，Use Names From : SCHEMATIC 。</li><li>点击 Run PEX 开始寄生参数提取，之后进入 Calibre View Setup 界面。</li><li>Calibre View Setup 设置中，Output 选项填被提取寄生参数的 library，Calibre View Type 选择 masklayout 意味着直接以 layout 的摆放位置提取寄生参数，选择 Schematic 意味着以 schematic 的位置生成寄生参数，建议选择 schematic，这可以在后仿中如前仿一样直接查看 schematic 的电路仿真信息，Create Terminal =&gt; if matching terminal exists on symbol，Device Placement =&gt; Layout Location，设置完毕，点击 OK 。</li><li>提取寄生参数完毕后，如果有错误可能是 calibre 中部分线短路了，手动改正即可，可通过 calibre view type 更改类型为 masklayout 可以避免这种错误，但是后仿不能通过直接点击。</li><li>在 testbench 中新建 config view，将 config 中的 view to use 更改为提取的寄生参数 calibre，加入 calibre 提取出来的参数，同时 ADE L =&gt; Setup =&gt; Design 更改类型为 config，即可开始后仿。</li><li>仿真结束后，可以直接在 schematic 中查看信号线。</li></ol><p>生成 calibre 耗费时间过长，可以直接更改 calibre view type 为 masklayout，但是此种方法对于查看结果没那么方便。<br>或者直接在 pex 设置中，Output =&gt; Netlist =&gt; Format 更改为 SPECTRE 生成网表。</p><ol><li>该方法生成的网表不一定能直接用于 spectre 仿真，需要先将该网表的 pin 顺序更正。更改方法为，首先需要先用前仿电路跑一次仿真生成网表，然后在 simulation 这个文件夹中找到 input.scs 的网表，将该网表中的 pin 复制到后仿的网表中。</li><li>后仿生成的网表更改完毕，在 testbench 中新建 config view，将 config 中的 view to use 更改为 Specify SPICE Source File，同时选择后仿的网表即可，这就是用网表仿真，速度快，但是不方便查看信号，但是利于排除寄生电容，需要排除哪项将其注释即可。</li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;ol&gt;
&lt;li&gt;通过 Virtuoso 的 Layout XL =&amp;gt; Calibre =&amp;gt; Run PEX 进入 Calibre PEX，并将工艺厂提供的 xRC(Rule) 文件设置好 Calibre PEX。</summary>
    
    
    
    <category term="Semiconductor" scheme="http://shenguosai.github.io/categories/Semiconductor/"/>
    
    <category term="post-sim" scheme="http://shenguosai.github.io/categories/Semiconductor/post-sim/"/>
    
    <category term="EDA" scheme="http://shenguosai.github.io/categories/Semiconductor/EDA/"/>
    
    
    <category term="Calibre" scheme="http://shenguosai.github.io/tags/Calibre/"/>
    
  </entry>
  
  <entry>
    <title>在Windows11中找回照片查看器打开图片</title>
    <link href="http://shenguosai.github.io/2023/12/12/%E5%9C%A8Windows11%E4%B8%AD%E6%89%BE%E5%9B%9E%E7%85%A7%E7%89%87%E6%9F%A5%E7%9C%8B%E5%99%A8%E6%89%93%E5%BC%80%E5%9B%BE%E7%89%87/"/>
    <id>http://shenguosai.github.io/2023/12/12/%E5%9C%A8Windows11%E4%B8%AD%E6%89%BE%E5%9B%9E%E7%85%A7%E7%89%87%E6%9F%A5%E7%9C%8B%E5%99%A8%E6%89%93%E5%BC%80%E5%9B%BE%E7%89%87/</id>
    <published>2023-12-12T15:41:05.000Z</published>
    <updated>2023-12-12T16:06:21.443Z</updated>
    
    <content type="html"><![CDATA[<ol><li>使用快捷键<code>Win + R</code>打开运行窗口， 输入<code>regedit</code>命令回车打开注册表<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20231212234749.png" alt="20231212234749"><span id="more"></span></li><li>找到<code>HKEY_LOCAL_MACHINE</code> -&gt; <code>SOFTWARE</code>-&gt;<code>Microsoft</code> -&gt; <code>Windows Photo Viewer</code> -&gt; <code>Capabilities</code> -&gt; <code>FileAssociations</code>，右键=&gt;新建=&gt;字符串值，名称填写<code>.jpg</code>，数值填写<code>PhotoViewer.FileAssoc.Tiff</code>，同理添加 <code>.png</code>  <code>.jpeg</code>，数值相同。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20231212234917.png" alt="20231212234917"></li><li>添加之后就可以使用Windows照片查看器看图。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20231212235008.png" alt="20231212235008"></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;ol&gt;
&lt;li&gt;使用快捷键&lt;code&gt;Win + R&lt;/code&gt;打开运行窗口， 输入&lt;code&gt;regedit&lt;/code&gt;命令回车打开注册表&lt;br&gt;&lt;img src=&quot;https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20231212234749.png&quot; alt=&quot;20231212234749&quot;&gt;</summary>
    
    
    
    <category term="Note" scheme="http://shenguosai.github.io/categories/Note/"/>
    
    <category term="Windows" scheme="http://shenguosai.github.io/categories/Note/Windows/"/>
    
    
  </entry>
  
  <entry>
    <title>smic工艺中带有ckt后缀的器件</title>
    <link href="http://shenguosai.github.io/2023/12/08/smic%E5%B7%A5%E8%89%BA%E4%B8%AD%E5%B8%A6%E6%9C%89ckt%E5%90%8E%E7%BC%80%E7%9A%84%E5%99%A8%E4%BB%B6/"/>
    <id>http://shenguosai.github.io/2023/12/08/smic%E5%B7%A5%E8%89%BA%E4%B8%AD%E5%B8%A6%E6%9C%89ckt%E5%90%8E%E7%BC%80%E7%9A%84%E5%99%A8%E4%BB%B6/</id>
    <published>2023-12-08T06:16:14.000Z</published>
    <updated>2024-01-10T07:20:43.247Z</updated>
    
    <content type="html"><![CDATA[<p>在SMIC的PDK中存在后面带ckt和不带ckt的PDK，其中不带ckt的器件模型是bsim4，而带ckt的器件模型是subckt。网上查询，subckt就是sub circuit，即子电路的意思。<br>查询并猜想如下:<br>不带ckt: 类理想器件，即只针对此种器件建模；<br>带ckt: 考虑其内部构造所产生的各种寄生成分，并且包含寄生器件参数随电路参数的变化</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在SMIC的PDK中存在后面带ckt和不带ckt的PDK，其中不带ckt的器件模型是bsim4，而带ckt的器件模型是subckt。网上查询，subckt就是sub circuit，即子电路的意思。&lt;br&gt;查询并猜想如下:&lt;br&gt;不带ckt: 类理想器件，即只针对此种器件建</summary>
      
    
    
    
    <category term="Semiconductor" scheme="http://shenguosai.github.io/categories/Semiconductor/"/>
    
    <category term="Process" scheme="http://shenguosai.github.io/categories/Semiconductor/Process/"/>
    
    
    <category term="工艺" scheme="http://shenguosai.github.io/tags/%E5%B7%A5%E8%89%BA/"/>
    
  </entry>
  
  <entry>
    <title>VIM学习笔记--状态行</title>
    <link href="http://shenguosai.github.io/2023/12/06/VIM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%8A%B6%E6%80%81%E8%A1%8C/"/>
    <id>http://shenguosai.github.io/2023/12/06/VIM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%8A%B6%E6%80%81%E8%A1%8C/</id>
    <published>2023-12-06T15:33:25.000Z</published>
    <updated>2023-12-12T15:54:28.260Z</updated>
    
    <content type="html"><![CDATA[<center>状态行参数列表</center><div class="table-container"><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>%(…%)</td><td>定义一个项目</td></tr><tr><td>%{n}*</td><td>%对其余的行使用高亮显示组<code>User n</code>，知道另一个<code>%n*</code>。数字<code>n</code> 必须从<code>1</code>到<code>9</code>。用<code>%*</code>或<code>%0*</code>可以恢复正常的高亮显示。</td></tr><tr><td>%&lt;</td><td>如果状态行过长，在何处换行。缺省是在开头。</td></tr><tr><td>%=</td><td>左对齐和右对齐之间的分割点。</td></tr><tr><td>%</td><td>字符<code>%</code></td></tr><tr><td>%B</td><td>光标下字符的十六进制形式。</td></tr><tr><td>%F</td><td>缓冲区的文件完整路径。</td></tr><tr><td>%H</td><td>如果为帮助缓冲区则显示为<code>HLP</code>。</td></tr><tr><td>%L</td><td>缓冲区中的行数。</td></tr><tr><td>%M</td><td>如果缓冲区修改过则显示未<code>+</code>。</td></tr><tr><td>%N</td><td>打印机页号。</td></tr><tr><td>%O</td><td>以十六进制方式显示文件中的字符偏移。</td></tr><tr><td>%P</td><td>文件中光标前的<code>%</code>。</td></tr><tr><td>%R</td><td>如果缓冲区只读则为<code>RO</code>。</td></tr><tr><td>%V</td><td>列数。如果与<code>%c</code>相同则为空字符。</td></tr><tr><td>%W</td><td>如果窗口为预览窗口则为<code>PRV</code>。</td></tr><tr><td>%Y</td><td>缓冲区的文件类型，如 vim。</td></tr><tr><td>%a</td><td>如果编辑多行文本，这个字行串就是<code>(&#123;current&#125; of &#123;arguments&#125;)</code>，例如: <code>(5 of 18)</code>。如果在命令行中只有一行，这个字符串为空。</td></tr><tr><td>%b</td><td>光标下的字符的十进制表示形式。</td></tr><tr><td>%c</td><td>列号。</td></tr><tr><td>%f</td><td>缓冲区的文件路径。</td></tr><tr><td>%h</td><td>如果为帮助缓冲区显示为<code>[Help]</code>。</td></tr><tr><td>%l</td><td>行号。</td></tr><tr><td>%m</td><td>如果缓冲区已修改则表示为<code>[+]</code>。</td></tr><tr><td>%n</td><td>缓冲区号。</td></tr><tr><td>%o</td><td>在光标前的字符数(包括光标下的字符)。</td></tr><tr><td>%p</td><td>文件中所在行的百分比。</td></tr><tr><td>%r</td><td>如果缓冲区为只读则表示为<code>[RO]</code>。</td></tr><tr><td>%t</td><td>文件名(无路径)。</td></tr><tr><td>%v</td><td>虚列号。</td></tr><tr><td>%w</td><td>如果为预览窗口则显示为<code>[Preview]</code>。</td></tr><tr><td>%y</td><td>缓冲区的文件类型，如<code>[vim]</code>。</td></tr><tr><td>%{expr}</td><td>表达式的结果。</td></tr></tbody></table></div><span id="more"></span><p>例:<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">:<span class="hljs-keyword">set</span> statusline=%F%<span class="hljs-keyword">m</span>%r%h%<span class="hljs-keyword">w</span>\ [FORMAT=%&#123;&amp;ff&#125;]\ [TYPE=%Y]\ [POS=%<span class="hljs-number">04</span><span class="hljs-keyword">l</span>,%<span class="hljs-number">04</span>v][%<span class="hljs-keyword">p</span>%%]\ [LEN=%L]<br></code></pre></td></tr></table></figure></p><p>定义显示颜色<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">:<span class="hljs-keyword">set</span> statusline=%<span class="hljs-number">2</span>*%n%<span class="hljs-keyword">m</span>%r%h%<span class="hljs-keyword">w</span>%*\ %F\ %<span class="hljs-number">1</span>*[FORMAT=%<span class="hljs-number">2</span>*%&#123;&amp;ff&#125;:%&#123;&amp;fenc!=<span class="hljs-string">&#x27;&#x27;</span>?&amp;fenc:&amp;enc&#125;%<span class="hljs-number">1</span>*]\ [TYPE=%<span class="hljs-number">2</span>*%Y%<span class="hljs-number">1</span>*]\ [COL=%<span class="hljs-number">2</span>*%<span class="hljs-number">03</span>v%<span class="hljs-number">1</span>*]\ [ROW=%<span class="hljs-number">2</span>*%<span class="hljs-number">03</span><span class="hljs-keyword">l</span>%<span class="hljs-number">1</span>*/%<span class="hljs-number">3</span>*%L(%<span class="hljs-keyword">p</span>%%)%<span class="hljs-number">1</span>*]\<br></code></pre></td></tr></table></figure></p><p>自定义高亮显示颜色<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">hi</span> User1 guifg=gray<br><span class="hljs-keyword">hi</span> User2 guifg=<span class="hljs-keyword">red</span><br><span class="hljs-keyword">hi</span> User3 guifg=white<br></code></pre></td></tr></table></figure></p><p>还可以通过在<code>.vimrc</code>文件中包括以下命令，使状态行根据状态的不同，显示不同的颜色。<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">function!</span> <span class="hljs-title">InsertStatuslineColor</span><span class="hljs-params">(mode)</span><br><span class="hljs-keyword">if</span> <span class="hljs-variable">a:mode</span> == <span class="hljs-string">&#x27;i&#x27;</span><br>  <span class="hljs-keyword">hi</span> statusline guibg=peru<br><span class="hljs-keyword">elseif</span> <span class="hljs-variable">a:mode</span> == <span class="hljs-string">&#x27;r&#x27;</span><br>  <span class="hljs-keyword">hi</span> statusline guibg=blue<br><span class="hljs-keyword">else</span><br>  <span class="hljs-keyword">hi</span> statusline guibg=black<br><span class="hljs-keyword">endif</span><br><span class="hljs-keyword">endfunction</span><br><span class="hljs-keyword">au</span> InsertEnter * <span class="hljs-keyword">call</span> InsertStatuslineColor(<span class="hljs-variable">v:insertmode</span>)<br><span class="hljs-keyword">au</span> InsertLeave * <span class="hljs-keyword">hi</span> statusline guibg=orange guifg=white<br><span class="hljs-keyword">hi</span> statusline guibg=black<br></code></pre></td></tr></table></figure></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;center&gt;状态行参数列表&lt;/center&gt;

&lt;div class=&quot;table-container&quot;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;参数&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;%(…%)&lt;/td&gt;
&lt;td&gt;定义一个项目&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%{n}*&lt;/td&gt;
&lt;td&gt;%对其余的行使用高亮显示组&lt;code&gt;User n&lt;/code&gt;，知道另一个&lt;code&gt;%n*&lt;/code&gt;。数字&lt;code&gt;n&lt;/code&gt; 必须从&lt;code&gt;1&lt;/code&gt;到&lt;code&gt;9&lt;/code&gt;。用&lt;code&gt;%*&lt;/code&gt;或&lt;code&gt;%0*&lt;/code&gt;可以恢复正常的高亮显示。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%&amp;lt;&lt;/td&gt;
&lt;td&gt;如果状态行过长，在何处换行。缺省是在开头。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%=&lt;/td&gt;
&lt;td&gt;左对齐和右对齐之间的分割点。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%&lt;/td&gt;
&lt;td&gt;字符&lt;code&gt;%&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%B&lt;/td&gt;
&lt;td&gt;光标下字符的十六进制形式。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%F&lt;/td&gt;
&lt;td&gt;缓冲区的文件完整路径。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%H&lt;/td&gt;
&lt;td&gt;如果为帮助缓冲区则显示为&lt;code&gt;HLP&lt;/code&gt;。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%L&lt;/td&gt;
&lt;td&gt;缓冲区中的行数。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%M&lt;/td&gt;
&lt;td&gt;如果缓冲区修改过则显示未&lt;code&gt;+&lt;/code&gt;。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%N&lt;/td&gt;
&lt;td&gt;打印机页号。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%O&lt;/td&gt;
&lt;td&gt;以十六进制方式显示文件中的字符偏移。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%P&lt;/td&gt;
&lt;td&gt;文件中光标前的&lt;code&gt;%&lt;/code&gt;。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%R&lt;/td&gt;
&lt;td&gt;如果缓冲区只读则为&lt;code&gt;RO&lt;/code&gt;。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%V&lt;/td&gt;
&lt;td&gt;列数。如果与&lt;code&gt;%c&lt;/code&gt;相同则为空字符。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%W&lt;/td&gt;
&lt;td&gt;如果窗口为预览窗口则为&lt;code&gt;PRV&lt;/code&gt;。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%Y&lt;/td&gt;
&lt;td&gt;缓冲区的文件类型，如 vim。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%a&lt;/td&gt;
&lt;td&gt;如果编辑多行文本，这个字行串就是&lt;code&gt;(&amp;#123;current&amp;#125; of &amp;#123;arguments&amp;#125;)&lt;/code&gt;，例如: &lt;code&gt;(5 of 18)&lt;/code&gt;。如果在命令行中只有一行，这个字符串为空。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%b&lt;/td&gt;
&lt;td&gt;光标下的字符的十进制表示形式。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%c&lt;/td&gt;
&lt;td&gt;列号。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%f&lt;/td&gt;
&lt;td&gt;缓冲区的文件路径。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%h&lt;/td&gt;
&lt;td&gt;如果为帮助缓冲区显示为&lt;code&gt;[Help]&lt;/code&gt;。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%l&lt;/td&gt;
&lt;td&gt;行号。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%m&lt;/td&gt;
&lt;td&gt;如果缓冲区已修改则表示为&lt;code&gt;[+]&lt;/code&gt;。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%n&lt;/td&gt;
&lt;td&gt;缓冲区号。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%o&lt;/td&gt;
&lt;td&gt;在光标前的字符数(包括光标下的字符)。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%p&lt;/td&gt;
&lt;td&gt;文件中所在行的百分比。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%r&lt;/td&gt;
&lt;td&gt;如果缓冲区为只读则表示为&lt;code&gt;[RO]&lt;/code&gt;。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%t&lt;/td&gt;
&lt;td&gt;文件名(无路径)。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%v&lt;/td&gt;
&lt;td&gt;虚列号。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%w&lt;/td&gt;
&lt;td&gt;如果为预览窗口则显示为&lt;code&gt;[Preview]&lt;/code&gt;。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%y&lt;/td&gt;
&lt;td&gt;缓冲区的文件类型，如&lt;code&gt;[vim]&lt;/code&gt;。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%{expr}&lt;/td&gt;
&lt;td&gt;表达式的结果。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="Note" scheme="http://shenguosai.github.io/categories/Note/"/>
    
    <category term="vim" scheme="http://shenguosai.github.io/categories/Note/vim/"/>
    
    
  </entry>
  
  <entry>
    <title>Adobe Acrobat XI Pro 11.0.23下载及激活</title>
    <link href="http://shenguosai.github.io/2023/12/05/Adobe-Acrobat-XI-Pro-11-0-23%E4%B8%8B%E8%BD%BD%E5%8F%8A%E6%BF%80%E6%B4%BB/"/>
    <id>http://shenguosai.github.io/2023/12/05/Adobe-Acrobat-XI-Pro-11-0-23%E4%B8%8B%E8%BD%BD%E5%8F%8A%E6%BF%80%E6%B4%BB/</id>
    <published>2023-12-05T05:33:35.000Z</published>
    <updated>2024-01-05T02:01:11.329Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Adobe Acrobat XI Pro 是一个著名的功能性程序，用于舒适地处理各种 PDF 文件，它将为您提供以专业水平创建和编辑高质量 PDF 文件的机会。 Acrobat XI Pro 包含高级功能，可以轻松打开许多其他管理功能，具有用户友好的界面。在创建 PDF 文件并在以后进行处理时，Adobe Acrobat 变得绝对不可替代。</p><p>Adobe Acrobat XI Pro 包含提供额外互操作性的智能功能。简单，快速，专业。将包括文档，电子表格，电子邮件，图像，视频，3D图形和地图在内的多种内容组合到一个压缩的结构化PDF包中。在查看共享的文档时进行协作。创建交互式表格并快速收集数据。保护和控制有价值的信息。</p><p>体验 Adobe®Acrobat®Dynamic PDF 技术创建和共享下一代 PDF 的强大功能。通过电子文档审阅，可填写的 PDF 表单和 Acrobat 服务与同行，客户和合作伙伴进行协作。将多种文件类型组合成一个无缝组织的专业质量 PDF 包。设置密码和权限以保护文档。内容丰富，使您的文档更具吸引力。</p><p>Adobe Acrobat XI Pro 是理想的工具，可轻松，快速，专业地处理各种 PDF 文件。<br><span id="more"></span></p><h2 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h2><ul><li>1.3GHz或更快的处理器</li><li>Microsoft Windows XP，Service Pack 3 (32位) 或 Service Pack 2 (64位)；<br>Windows Server 2003 R2 (32位和64位)；<br>Windows Server 2008 或 2008 R2 (32位和64位)；<br>Windows 7 (32位何64位)；<br>Windows 8 (32位和64位)。</li><li>512 MB RAM (推荐1GB)</li><li>1.85 GB 可用硬盘空间</li><li>1024 x 768 屏幕分辨率</li><li>视频硬件加速(可选)</li></ul><p><b> 注意 </b>: 对于64位版本的Windows Server 2003 R2 和 Windows XP (带Service Pack 2)，需要 <code>Microsoft Update KB930627</code></p><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p><a href="magnet:?xt=urn:btih:2A0D5EE6129F2C24A2AC94A4C0ADC880CE99A1A0&amp;tr=http%3A%2F%2Fbt4.t-ru.org%2Fann%3Fmagnet&amp;dn=Adobe%20Acrobat%20XI%20Pro%20v11.0.23%20Final%20%5B2017%2CMl%5CRus%5D">Adobe Acrobat XI Pro v11.0.23 Final MI</a><br>　　　　|—adobe.snr.patch.v2.0-painter<br>　　　　|—amtemu.v0.9.2.win-painter<br>　　　　|—Serial_Keygen X-FORCE<br>　　　　|—2A0D5EE6129F2C24A2AC94A4C0ADC880CE99A1A0.torrent<br>　　　　|—About the program.txt<br>　　　　|—AcrobatPro_11_Web_WWMUI.exe<br>　　　　|—AcrobatUpd11023.msp<br>　　　　|—Лечение.txt</p><h2 id="安装及激活"><a href="#安装及激活" class="headerlink" title="安装及激活"></a>安装及激活</h2><ol><li>断开互联网连接。</li><li>双击运行安装程序<code>AcrobatPro_11_Web_WWMUI.exe</code>，在安装程序窗口选择<code>使用试用版或订阅</code>。</li><li>安装程序(此时安装好的 Adobe Acrobat XI 为 11.0.0版本，可直接转向 5 )。</li><li>双击运行安装文件<code>AcrobatUpd11023.msp</code>，重新启动计算机(如有需要)。此程序安装好后版本升至 11.0.23。</li><li>激活:<ul><li>方式一:使用adobe.snr.patch.v2.0-painter<ul><li>将修补程序<code>adobe.snr.patch.v2.0-painter.exe</code>复制到包含已安装程序的文件夹中(一般情况为:<code>C:\Program Files (x86)\Adobe\Acrobat 11.0\Acrobat</code>)，然后以管理员身份运行。</li><li>从下拉菜单中选择<code>Adobe Acrobat XI Pro(32-bit)</code>，然后点击<code>Patch</code>。</li></ul></li><li>方式二:使用amtemu.v0.9.2.win-painter<ul><li>将修补程序<code>amtemu.v0.9.2-painter.exe</code>复制到包含已安装程序的文件夹中(一般情况为:<code>C:\Program Files (x86)\Adobe\Acrobat 11.0\Acrobat</code>)，然后以管理员身份运行。</li><li>从下拉菜单中选择<code>Adobe Acrobat XI</code>，然后单击<code>Install</code>。</li><li>如果需要，在打开的窗口中转到软件安装位置，然后选择<code>amtlib.dll</code>文件，等待软件被激活。</li></ul></li></ul></li><li>激活完成，打开网络连接。</li></ol><h2 id="关于闪退原因及解决办法"><a href="#关于闪退原因及解决办法" class="headerlink" title="关于闪退原因及解决办法"></a>关于闪退原因及解决办法</h2><p>在上述安装及激活完成后，Adobe Acrobat XI Pro会出现闪退问题，原因是联机版权校验问题，更多深层次的原理这里不做过多讨论，本文主要讲解如何避免闪退。既然原因找到了，就可以从以下方面着手进行处理：阻拦该软件进行联网校验即可。办法很多，这里提供两种稍微容易操作的方法进行说明。</p><ol><li>域名欺骗，添加伪造的host解析条目<br>Acrobat 校验的域名为: acroipm.adobe.com，因此只要将该域名定位到一个假的 IP 地址即可。最简单的办法就是在<code>C:\Windows\System32\drivers\etc\host</code>文件中添加条目:<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span> acroipm.adobe.com<br></code></pre></td></tr></table></figure><b>注意</b>&gt;: 编辑host需要管理员权限</li><li>阻断Acrobat主程序联网<br>这里使用windows自带防火墙进行阻断。具体操作步骤如下:<br><code>开始 -&gt; 设置 -&gt; 更新与安全</code>，打开更新与安全设置，点击 <code>Windows 安全中心</code>，点击打开<code>防火墙和网络保护</code>界面，点击<code>高级设置</code>，在<code>高级设置</code>界面中选择<code>出站规则</code>然后点击<code>新建规则</code>创建出站规则，在弹出的新建规则向导界面中，选择要创建的规则类型为<code>程序</code>，然后点击<code>下一步</code>选择指定的程序路径<code>C:\Program Files (x86)\Adobe\Acrobat 11.0\Acrobat\Acrobat.exe</code>，然后点击<code>下一步</code>，在操作类型界面选择<code>阻止连接</code>，点击<code>下一步</code>，在选择何时应用规则的界面选择所有的场景并点击<code>下一步</code>，在命名界面中填写<code>名称</code>及<code>描述</code>，然后点击完成即可。<br><b>注意</b>: 本方法的前提是要保障 Windows Defender 防火墙对三个应用区域(域网络、专用网络、公用网络)都已经启用。</li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;Adobe Acrobat XI Pro 是一个著名的功能性程序，用于舒适地处理各种 PDF 文件，它将为您提供以专业水平创建和编辑高质量 PDF 文件的机会。 Acrobat XI Pro 包含高级功能，可以轻松打开许多其他管理功能，具有用户友好的界面。在创建 PDF 文件并在以后进行处理时，Adobe Acrobat 变得绝对不可替代。&lt;/p&gt;
&lt;p&gt;Adobe Acrobat XI Pro 包含提供额外互操作性的智能功能。简单，快速，专业。将包括文档，电子表格，电子邮件，图像，视频，3D图形和地图在内的多种内容组合到一个压缩的结构化PDF包中。在查看共享的文档时进行协作。创建交互式表格并快速收集数据。保护和控制有价值的信息。&lt;/p&gt;
&lt;p&gt;体验 Adobe®Acrobat®Dynamic PDF 技术创建和共享下一代 PDF 的强大功能。通过电子文档审阅，可填写的 PDF 表单和 Acrobat 服务与同行，客户和合作伙伴进行协作。将多种文件类型组合成一个无缝组织的专业质量 PDF 包。设置密码和权限以保护文档。内容丰富，使您的文档更具吸引力。&lt;/p&gt;
&lt;p&gt;Adobe Acrobat XI Pro 是理想的工具，可轻松，快速，专业地处理各种 PDF 文件。&lt;br&gt;</summary>
    
    
    
    <category term="Tutorial" scheme="http://shenguosai.github.io/categories/Tutorial/"/>
    
    <category term="Win-Software" scheme="http://shenguosai.github.io/categories/Tutorial/Win-Software/"/>
    
    <category term="Adobe" scheme="http://shenguosai.github.io/categories/Tutorial/Win-Software/Adobe/"/>
    
    
  </entry>
  
  <entry>
    <title>使用命令行抽取寄生(Calibre)</title>
    <link href="http://shenguosai.github.io/2023/12/03/%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%8A%BD%E5%8F%96%E5%AF%84%E7%94%9F-Calibre/"/>
    <id>http://shenguosai.github.io/2023/12/03/%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%8A%BD%E5%8F%96%E5%AF%84%E7%94%9F-Calibre/</id>
    <published>2023-12-03T15:12:02.000Z</published>
    <updated>2023-12-03T15:16:48.215Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fortran">% calibre -lvs -hier -auto rule.<span class="hljs-keyword">file</span><br>% calibre -xrc -pdb -rcc -xcell cell.<span class="hljs-keyword">file</span> rule.<span class="hljs-keyword">file</span><br>% calibre -xrc -<span class="hljs-keyword">fmt</span> -<span class="hljs-built_in">all</span> -xcell cell.<span class="hljs-keyword">file</span> rule.<span class="hljs-keyword">file</span><br></code></pre></td></tr></table></figure><p>rule.file 中应指定layout(gds)的路径及文件名<br><a href="https://www.engr.colostate.edu/ECE571/class_materials/xcalibre_instructions.htm">Instructions for Extracting Parasitics for your Layout using xCalibre Tool</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight fortran&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span cla</summary>
      
    
    
    
    <category term="Semiconductor" scheme="http://shenguosai.github.io/categories/Semiconductor/"/>
    
    <category term="post-sim" scheme="http://shenguosai.github.io/categories/Semiconductor/post-sim/"/>
    
    <category term="EDA" scheme="http://shenguosai.github.io/categories/Semiconductor/EDA/"/>
    
    
  </entry>
  
</feed>
