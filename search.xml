<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Adobe Acrobat XI Pro 11.0.23下载及激活</title>
    <url>/2023/12/05/Adobe-Acrobat-XI-Pro-11-0-23%E4%B8%8B%E8%BD%BD%E5%8F%8A%E6%BF%80%E6%B4%BB/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Adobe Acrobat XI Pro 是一个著名的功能性程序，用于舒适地处理各种 PDF 文件，它将为您提供以专业水平创建和编辑高质量 PDF 文件的机会。 Acrobat XI Pro 包含高级功能，可以轻松打开许多其他管理功能，具有用户友好的界面。在创建 PDF 文件并在以后进行处理时，Adobe Acrobat 变得绝对不可替代。</p>
<p>Adobe Acrobat XI Pro 包含提供额外互操作性的智能功能。简单，快速，专业。将包括文档，电子表格，电子邮件，图像，视频，3D图形和地图在内的多种内容组合到一个压缩的结构化PDF包中。在查看共享的文档时进行协作。创建交互式表格并快速收集数据。保护和控制有价值的信息。</p>
<p>体验 Adobe®Acrobat®Dynamic PDF 技术创建和共享下一代 PDF 的强大功能。通过电子文档审阅，可填写的 PDF 表单和 Acrobat 服务与同行，客户和合作伙伴进行协作。将多种文件类型组合成一个无缝组织的专业质量 PDF 包。设置密码和权限以保护文档。内容丰富，使您的文档更具吸引力。</p>
<p>Adobe Acrobat XI Pro 是理想的工具，可轻松，快速，专业地处理各种 PDF 文件。<br><span id="more"></span></p>
<h2 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h2><ul>
<li>1.3GHz或更快的处理器</li>
<li>Microsoft Windows XP，Service Pack 3 (32位) 或 Service Pack 2 (64位)；<br>Windows Server 2003 R2 (32位和64位)；<br>Windows Server 2008 或 2008 R2 (32位和64位)；<br>Windows 7 (32位何64位)；<br>Windows 8 (32位和64位)。</li>
<li>512 MB RAM (推荐1GB)</li>
<li>1.85 GB 可用硬盘空间</li>
<li>1024 x 768 屏幕分辨率</li>
<li>视频硬件加速(可选)</li>
</ul>
<p><b> 注意 </b>: 对于64位版本的Windows Server 2003 R2 和 Windows XP (带Service Pack 2)，需要 <code>Microsoft Update KB930627</code></p>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p><a href="magnet:?xt=urn:btih:2A0D5EE6129F2C24A2AC94A4C0ADC880CE99A1A0&amp;tr=http%3A%2F%2Fbt4.t-ru.org%2Fann%3Fmagnet&amp;dn=Adobe%20Acrobat%20XI%20Pro%20v11.0.23%20Final%20%5B2017%2CMl%5CRus%5D">Adobe Acrobat XI Pro v11.0.23 Final MI</a><br>　　　　|—adobe.snr.patch.v2.0-painter<br>　　　　|—amtemu.v0.9.2.win-painter<br>　　　　|—Serial_Keygen X-FORCE<br>　　　　|—2A0D5EE6129F2C24A2AC94A4C0ADC880CE99A1A0.torrent<br>　　　　|—About the program.txt<br>　　　　|—AcrobatPro_11_Web_WWMUI.exe<br>　　　　|—AcrobatUpd11023.msp<br>　　　　|—Лечение.txt</p>
<h2 id="安装及激活"><a href="#安装及激活" class="headerlink" title="安装及激活"></a>安装及激活</h2><ol>
<li>断开互联网连接。</li>
<li>双击运行安装程序<code>AcrobatPro_11_Web_WWMUI.exe</code>，在安装程序窗口选择<code>使用试用版或订阅</code>。</li>
<li>安装程序(此时安装好的 Adobe Acrobat XI 为 11.0.0版本，可直接转向 5 )。</li>
<li>双击运行安装文件<code>AcrobatUpd11023.msp</code>，重新启动计算机(如有需要)。此程序安装好后版本升至 11.0.23。</li>
<li>激活:<ul>
<li>方式一:使用adobe.snr.patch.v2.0-painter<ul>
<li>将修补程序<code>adobe.snr.patch.v2.0-painter.exe</code>复制到包含已安装程序的文件夹中(一般情况为:<code>C:\Program Files (x86)\Adobe\Acrobat 11.0\Acrobat</code>)，然后以管理员身份运行。</li>
<li>从下拉菜单中选择<code>Adobe Acrobat XI Pro(32-bit)</code>，然后点击<code>Patch</code>。</li>
</ul>
</li>
<li>方式二:使用amtemu.v0.9.2.win-painter<ul>
<li>将修补程序<code>amtemu.v0.9.2-painter.exe</code>复制到包含已安装程序的文件夹中(一般情况为:<code>C:\Program Files (x86)\Adobe\Acrobat 11.0\Acrobat</code>)，然后以管理员身份运行。</li>
<li>从下拉菜单中选择<code>Adobe Acrobat XI</code>，然后单击<code>Install</code>。</li>
<li>如果需要，在打开的窗口中转到软件安装位置，然后选择<code>amtlib.dll</code>文件，等待软件被激活。</li>
</ul>
</li>
</ul>
</li>
<li>激活完成，打开网络连接。</li>
</ol>
<h2 id="关于闪退原因及解决办法"><a href="#关于闪退原因及解决办法" class="headerlink" title="关于闪退原因及解决办法"></a>关于闪退原因及解决办法</h2><p>在上述安装及激活完成后，Adobe Acrobat XI Pro会出现闪退问题，原因是联机版权校验问题，更多深层次的原理这里不做过多讨论，本文主要讲解如何避免闪退。既然原因找到了，就可以从以下方面着手进行处理：阻拦该软件进行联网校验即可。办法很多，这里提供两种稍微容易操作的方法进行说明。</p>
<ol>
<li>域名欺骗，添加伪造的host解析条目<br>Acrobat 校验的域名为: acroipm.adobe.com，因此只要将该域名定位到一个假的 IP 地址即可。最简单的办法就是在<code>C:\Windows\System32\drivers\etc\host</code>文件中添加条目:<pre><code>127.0.0.1 acroipm.adobe.com
</code></pre><b>注意</b>&gt;: 编辑host需要管理员权限</li>
<li>阻断Acrobat主程序联网<br>这里使用windows自带防火墙进行阻断。具体操作步骤如下:<br><code>开始 -&gt; 设置 -&gt; 更新与安全</code>，打开更新与安全设置，点击 <code>Windows 安全中心</code>，点击打开<code>防火墙和网络保护</code>界面，点击<code>高级设置</code>，在<code>高级设置</code>界面中选择<code>出站规则</code>然后点击<code>新建规则</code>创建出站规则，在弹出的新建规则向导界面中，选择要创建的规则类型为<code>程序</code>，然后点击<code>下一步</code>选择指定的程序路径<code>C:\Program Files (x86)\Adobe\Acrobat 11.0\Acrobat\Acrobat.exe</code>，然后点击<code>下一步</code>，在操作类型界面选择<code>阻止连接</code>，点击<code>下一步</code>，在选择何时应用规则的界面选择所有的场景并点击<code>下一步</code>，在命名界面中填写<code>名称</code>及<code>描述</code>，然后点击完成即可。<br><b>注意</b>: 本方法的前提是要保障 Windows Defender 防火墙对三个应用区域(域网络、专用网络、公用网络)都已经启用。</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>Adobe</tag>
      </tags>
  </entry>
  <entry>
    <title>Cadence使用Calibre进行后仿</title>
    <url>/2023/12/18/Cadence%E4%BD%BF%E7%94%A8Calibre%E8%BF%9B%E8%A1%8C%E5%90%8E%E4%BB%BF/</url>
    <content><![CDATA[<ol>
<li>通过 Virtuoso 的 Layout XL =&gt; Calibre =&gt; Run PEX 进入 Calibre PEX，并将工艺厂提供的 xRC(Rule) 文件设置好 Calibre PEX。<span id="more"></span></li>
<li>为了减少寄生参数，以及提高后仿效率，建议在 Calibre PEX =&gt; PEX Options =&gt; Netlist =&gt; Reduction and CC 中将 Enable MinRes reduction 和 Enable MinCap Reduction 选中，并在 COMBINE 和 REMOVE 后的框中填写所需数值，一般 Cap 的 Combine 为 0.5fF，Remove 为 0.1fF。Res 的 Combine 为 1Ω，Remove 为 0.1Ω。</li>
<li>在 Outputs 选项中，Outputs =&gt; Netlist 框中，Format 选 CALIBREVIEW(可增加 Geometry 可在 PEX 运行完后弹出寄生参数的总结)，Use Names From : SCHEMATIC 。</li>
<li>点击 Run PEX 开始寄生参数提取，之后进入 Calibre View Setup 界面。</li>
<li>Calibre View Setup 设置中，Output 选项填被提取寄生参数的 library，Calibre View Type 选择 masklayout 意味着直接以 layout 的摆放位置提取寄生参数，选择 Schematic 意味着以 schematic 的位置生成寄生参数，建议选择 schematic，这可以在后仿中如前仿一样直接查看 schematic 的电路仿真信息，Create Terminal =&gt; if matching terminal exists on symbol，Device Placement =&gt; Layout Location，设置完毕，点击 OK 。</li>
<li>提取寄生参数完毕后，如果有错误可能是 calibre 中部分线短路了，手动改正即可，可通过 calibre view type 更改类型为 masklayout 可以避免这种错误，但是后仿不能通过直接点击。</li>
<li>在 testbench 中新建 config view，将 config 中的 view to use 更改为提取的寄生参数 calibre，加入 calibre 提取出来的参数，同时 ADE L =&gt; Setup =&gt; Design 更改类型为 config，即可开始后仿。</li>
<li>仿真结束后，可以直接在 schematic 中查看信号线。</li>
</ol>
<p>生成 calibre 耗费时间过长，可以直接更改 calibre view type 为 masklayout，但是此种方法对于查看结果没那么方便。<br>或者直接在 pex 设置中，Output =&gt; Netlist =&gt; Format 更改为 SPECTRE 生成网表。</p>
<ol>
<li>该方法生成的网表不一定能直接用于 spectre 仿真，需要先将该网表的 pin 顺序更正。更改方法为，首先需要先用前仿电路跑一次仿真生成网表，然后在 simulation 这个文件夹中找到 input.scs 的网表，将该网表中的 pin 复制到后仿的网表中。</li>
<li>后仿生成的网表更改完毕，在 testbench 中新建 config view，将 config 中的 view to use 更改为 Specify SPICE Source File，同时选择后仿的网表即可，这就是用网表仿真，速度快，但是不方便查看信号，但是利于排除寄生电容，需要排除哪项将其注释即可。</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>半导体专业</category>
        <category>EDA工具</category>
      </categories>
      <tags>
        <tag>Calibre</tag>
      </tags>
  </entry>
  <entry>
    <title>Diary</title>
    <url>/2023/08/10/Diary/</url>
    <content><![CDATA[<h2 id="2023年8月14日-晴空万里-人到中年"><a href="#2023年8月14日-晴空万里-人到中年" class="headerlink" title="2023年8月14日  晴空万里  人到中年"></a>2023年8月14日  晴空万里  人到中年</h2><p>今天又来到北京出差，早晨6点20出发，坐7点53分的G202经过3个多小时的颠簸，来到了首都的北京南站。<br>在北京南站坐上出租车，在下出租车的时候出了一点插曲，出租车司机停在了公司院区大门旁边的自行车道上，开门的时候没有注意观察，正好有一辆自行车逆行而过，擦到了出租车门。出租车司机还是很亲切的，让我走就可以，但是在我的坚持下最终还是给了司机师傅50元的赔偿。临行时在想：这点赔偿可能也不足以弥补司机师傅的损失，但为了自己的过失而进行补偿，心情还是蛮放松的。<br>从日本回国已过7年，逐渐的适应了中国的生活。也开始慢慢地理解了自己祖国的人们那种浮躁心态的来源，在一个14亿人口的大国，就生存本身而言，身边的每个人都是竞争对手。所以大家必须在有限的资源中为自己争取，这就是为何大家要插队，为何大家说话声音大，时刻像在争吵……<br>进入园区宾馆办完入住手续，正好12点多，去2楼吃了午饭，在房间休息了一会就去了办公室，匆匆一下午感觉什么都没有做。在晚饭的时候正好和领导聊了一会，感觉最近他又有一些心灰意冷，不再像上次那样意气风发。在日本也换过工作，现在是回国后找的第二份工作，这位领导身上有一种我一直想有却又达不到的特质，性格直率鲜明，但也并不缺迂回，但是主流还是向前冲的，头脑敏捷却没有城府，没有城府用在成年人身上可能有些贬义，也许这种性格的人不屑于城府。晚饭过后跟我讲了他们前一个项目如何与公司对赌然后最终失败，结果赔上了一年的奖金。我也挺喜欢这种意气风发，不顾后果的对赌，也许这就是赌博使人上瘾的原因所在吧。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
  </entry>
  <entry>
    <title>EDA工具使用备忘</title>
    <url>/2024/02/01/EDA%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E5%A4%87%E5%BF%98/</url>
    <content><![CDATA[<h2 id="Cadence"><a href="#Cadence" class="headerlink" title="Cadence"></a>Cadence</h2><h4 id="Virtuoso"><a href="#Virtuoso" class="headerlink" title="Virtuoso"></a>Virtuoso</h4><ol>
<li><p>.cdsinit: 负责Cadence软件的初始化配置，包括加载快捷方式、嵌入Calibre软件接口等。</p>
<span id="more"></span>
<ul>
<li>示例存放目录:<code>Candence安装目录/tools/dfII/samples/local/cdsinit</code></li>
<li>读取顺序: <blockquote>
<p><em><font color="#d3d3d3">Cadence安装目录</font></em>/tools/dfII/samples/local/cdsinit =&gt; <em><font color="#d3d3d3">用户home目录</font></em>/.cdsinit =&gt; <em><font color="#d3d3d3">virtuoso启动目录</font></em>/.cdsinit</p>
</blockquote>
</li>
<li>设置默认读取的display.drf文件:    <pre>drLoadDrf(<em>filePath</em>)</pre></li>
<li><p>设置默认快捷键文件:</p>
<ul>
<li>添加单个快捷键文件 <pre>load("/home/IC/Desktop/workspace/analog_ic/set_env/bindKeys_ICSkillSharing.il")</pre></li>
<li><p>添加多个快捷键文件</p>
<pre><code class="lang-skill"> let((bindKeyFileList file path saveSkillPath)
     bindKeyFileList = &#39;(
         &quot;leBindKeys.il&quot;
         &quot;schBindKey.il&quot;
         &quot;bindKeys_ICSkillSharing.il&quot;
     )
 )
 ; This is the path that is searched for the files
     path = strcat(
 ; If you want to add another path add it here as a string
         &quot;. ~/home/IC/Desktop/workspace/analog_ic/set_env &quot;
         prependInstallPath(&quot;local&quot;)
         prependInstallPath(&quot;samples/local&quot;)
     )
 saveSkillPath = getSkillPath()
 saveSkillPath(path)

 foreach(file bindKeyFileList
     if(isFile(file) then
         loadi(file)
     )
 )
 setSkillPath(saveSkillPath)
</code></pre>
</li>
</ul>
</li>
<li>快捷键设置:<ul>
<li>设置快捷键“0”消除高亮net|按“0”后鼠标点击欲消除的net: <pre>hiSetBindKey("Schematics" "<Key>0" "geEnterDeleteNetProbe()")</pre></li>
<li>设置快捷键“-”消除所有高亮net:  <pre>hiSetBindkey("Schematics" "<Key>-" "geDeleteAllProbe(getCurrentWindow() t)")</pre></li>
<li>设置快捷键“F6”打开Library Manager(启动Virtuoso后): <pre>hiSetBindKey("Command Interpreter" "<Key>F6" "ddsOpenLibManager()")</pre></li>
<li>设置快捷键“Shift+S”在上层schematic界面下编辑Symbol: <pre>hiSetBindKey("Schematics" "Shift<Ket>S" "schHiEditInPlace()")</pre></li>
<li>设置仿真结果默认存放目录为“/DATA/shenguosai/simulasion”: <pre>envSetVal("asimenv.startup" "projectDir" 'string "/DATA/shenguosai/simulasion")</pre></li>
<li>调用其它软件接口:<ul>
<li>Calibre<br><pre>load(“<em>Calibre_install_dir</em>/lib/calibre.skl”)</li>
<li>HSPICE<br><pre>load(“<em>HSPICE_install_dir</em>/interface/HSPICE.ile”)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>.cdsenv: 包含了Cadence软件的变量设置，用户通过对变量赋值，改变软件设置。</p>
<ul>
<li>示例存放目录: <code>Candence安装目录/tools/dfII/samples/.cdsenv</code></li>
<li>读取顺序: <blockquote>
<p><em><font color="#d3d3d3">Cadence安装目录</font></em>/tools/dfII/samples/.cdsenv =&gt; <em><font color="#d3d3d3">用户home目录</font></em>/.cdsenv =&gt; <em><font color="#d3d3d3">virtuoso启动目录</font></em>/.cdsenv</p>
</blockquote>
</li>
<li>设置仿真结果显示有效位数:(示例文件中有，通过搜索改变赋值即可,以下同)   <pre>auCore.misc labelDigits int 6</pre></li>
<li>改变仿真结果保存路径:   <pre>asimenv.startup projectDir string" ./simulation"</pre></li>
<li>按Library名称设置仿真结果保存路径:<br>   <pre>asimenv.startup appendLibNameToProjectDir boolean t</li>
<li>设置原理图和版图中的 label 默认字体改为 roman:<pre><code class="lang-skill">   schematic createLabelFontStyle cyclic &quot;roman&quot;
   layout labelFontStyle cyclic &quot;roman&quot;
</code></pre>
</li>
<li>设置版图网格点默认值:视工艺而定<pre><code class="lang-skill">   layout xSnapSpacing float 0.005
   layout ySnapSpacing float 0.005
</code></pre>
</li>
<li>设置仿真波形与坐标显示:<pre><code class="lang-skill">   viva.graph  titleFont  string  &quot;Default,14,-1,5,75,0,0,0,0,0&quot;
   viva.rectGraph    background  string  &quot;white&quot;
   viva.axis     font   string   &quot;Default,14,-1,5,75,0,0,0,0,0&quot;
   viva.horizMarker font    string   &quot;Default,14,-1,5,75,0,0,0,0,0&quot;
   viva.vertMarker     font    string   &quot;Default,14,-1,5,75,0,0,0,0,0&quot;
   viva.referenceLineMarker    font  string    &quot;Default,14,-1,5,75,0,0,0,0,0&quot;
   ...
   viva.trace  lineThickness  string  &quot;Thick&quot;
   viva.trace  lineStyle  string  &quot;solid&quot;
   wavescan.trace  lineThickness  string  &quot;Thick&quot;
   wavescan.trace  lineStyle  string  &quot;solid&quot;
</code></pre>
   其中<code>viva.axis font string &quot;Defaut,14,-1,5,75,0,0,0,0,0&quot;</code>中的 14 为字号；75 为颜色深度，可以理解为是否加粗，取值在0-99之间。<blockquote>
<p><b>注意</b>:仿真波形显示方法会与 PDK 中环境变量设置和 display.drf 文件中的设置有关，如果按照上面的方法设置完后不能达到实际效果，首先考虑是否是 PDK 自带脚本加载了其它软件变量或者使用的 display.drf 文件中做了相应修改，如果发现有问题可以修改 PDK 中环境变量或者 display.drf 文件的相应设置。</p>
</blockquote>
</li>
<li><p>实现在 Library Manager 界面双击 view 以只读方式打开:<br>   <pre>cdsLibManager.main dblClickEditCellView boolean nil</pre></p>
<blockquote>
<p><b>特别注意</b>: 可能按照上面的方法设置完.cdsenv文件之后，发现设置并未生效，这时候需要注意一个问题，<b>Cadence每次启动时都会加载 .cdsinit 文件，然而对于 .cdsenv 文件并非如此，而且 .cdsenv文件中的变量值会被覆盖，具体软件加载 .cdsenv 文件的顺序需要再用户的环境变量设置文件中定义。</b>一般叫做 .bashrc (使用 export 定义环境变量)或者 .cshrc (使用 setenv 定义环境变量)。</p>
</blockquote>
<pre><code class="lang-bash">   # 加载软件启动目录下的 .cdsenv 文件
   export CDS_LOAD_ENV = CWD(setenv CDS_LOAD_ENV CWD)

   # 首先加载用户主目录下的 .cdsenv 文件，然后加载软件启动目录下的 .cdsenv 文件。
   export CDS_LOAD_ENV = addCWD(setenv CDS_LOAD_ENV addCWD)
</code></pre>
</li>
</ul>
</li>
<li>display.drf: 一般在工艺库中会有初始化的显示文件。这里面会有电路的连线粗细及颜色，器件的一些显示，版图layout里面的layer颜色等等，还有ADE波形图里面的线的属性。总之就是显示相关的一些设置。<ul>
<li>文件的修改保存: 当修改过显示后，每次退出 virtuoso 会显示一个保存显示信息，这里输入名称，比如display_1.drf，这个文件默认保存在打开 virtuoso 的文件夹下面。</li>
<li>默认文件的设置: 在.cdsinit 文件里添加载入命令 <code>drLoadDrf(filepath)</code> 。</li>
</ul>
</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>半导体专业</category>
        <category>EDA工具</category>
      </categories>
      <tags>
        <tag>Virtuoso</tag>
      </tags>
  </entry>
  <entry>
    <title>Elecom MR-C18BK 读卡器</title>
    <url>/2023/09/13/Elecom-MR-C18BK-%E8%AF%BB%E5%8D%A1%E5%99%A8/</url>
    <content><![CDATA[<p>这两天帮父亲新接手的球馆弄监控，花了一番功夫终于把已经停产的十几年前的监控摄像头搞定，发现里面的TF卡却坏掉了。于是在京东上买了BanQ的Joy联名TF卡，买来之后插上读卡器发现无法识别，申请换新之后还是无法识别，这才开始怀疑自己的读卡器是不是有问题。但是前两天刚试过家里的4G的TF卡读取是没有问题的。<br>于是从同事那里借来较新的读卡器发现成功读出来了，就怀疑自己应该也是十几年前买的读卡器是不是不支持大容量TF卡，于是到主页上查找了一番，发现Micro SD卡容量最大支持到16GB。<br><span id="more"></span><br><br><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230913194643.png" alt="20230913194643"><br><br><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230913194802.png" alt="20230913194802"><br><br><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230913194820.png" alt="20230913194820"><br><br></p>
<p><a href="https://www2.elecom.co.jp/data-media/memory-rw/mr-c18/">商品说明链接</a></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>设备及使用</category>
      </categories>
      <tags>
        <tag>监控</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7 安装docker和docker-compose</title>
    <url>/2024/03/25/CentOS-7-%E5%AE%89%E8%A3%85docker%E5%92%8Cdocker-compose/</url>
    <content><![CDATA[<h1 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h1><p>更新 <code>yum</code></p>
<pre><code class="lang-bash">yum update
</code></pre>
<p>安装配置时的依赖包</p>
<pre><code class="lang-bash">yum install -y yum-utils device-mapper-persistent-data lvm2
</code></pre>
<span id="more"></span>
<p>配置阿里云的<code>yum</code>源</p>
<pre><code class="lang-bash">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre>
<p>查看仓库中所有的docker版本</p>
<pre><code class="lang-bash">yum list docker-ce --showduplicates | sort -r
</code></pre>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240325151136.png" alt="20240325151136"><br>默认使用<code>yum install docker-ce</code>安装最新版的docker，当然也可以指定安装特定的版本</p>
<pre><code class="lang-bash">yum install docker-ce-24.0* -y
</code></pre>
<p>验证是否安装成功</p>
<pre><code class="lang-bash">docker --version
</code></pre>
<p>或者</p>
<pre><code class="lang-bash">docker -v
</code></pre>
<h1 id="安装-Docker-compose"><a href="#安装-Docker-compose" class="headerlink" title="安装 Docker-compose"></a>安装 Docker-compose</h1><p>国外源安装:</p>
<pre><code class="lang-bash">curl -SL https://github.com/docker/compose/releases/download/v2.26.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose
</code></pre>
<p>国内源安装:</p>
<pre><code class="lang-bash">curl -SL https://get.daocloud.io/docker/compose/releases/download/v2.26.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose
</code></pre>
<p>赋予可执行权限:</p>
<pre><code class="lang-bash">chmod +x /usr/local/bin/docker-compose
</code></pre>
<p>验证是否安装成功:</p>
<pre><code class="lang-bash">docker compose version
</code></pre>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>在自己搭建的hexo博客上发布文章</title>
    <url>/2023/11/13/Hexo%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0/</url>
    <content><![CDATA[<ol>
<li>在<code>/source/_posts</code>目录下建立<code>.md</code>文件并撰写内容；<br>编辑文章时要在第一行中加上<code>title</code>，如果不按此格式来写的话在<code>hexo</code>博客中就会显示这篇文章没有名字。<span id="more"></span>
```</li>
</ol>
<hr>
<h2 id="title-文章题目"><a href="#title-文章题目" class="headerlink" title="title: 文章题目"></a>title: 文章题目</h2><pre><code>2. 命名完成后，将终端当前目录更改为```/source/_posts
</code></pre><p>   输入<code>hexo g</code>(完整命令为<code>hexo generate</code>)，生成静态文件；<br>   输入<code>hexo s</code>(完整命令为<code>hexo server</code>)，启动local服务器，主要用于本地预览。完成后打开浏览器输入<a href="">http://localhost:4000</a>，就会发现多了刚才写的那篇博客。<br>   输入<code>hexo d</code>(完整命令为<code>hexo deploy</code>)，将本地文件发布到github仓库上。</p>
<ol>
<li>每次对hexo博客上的<code>.md</code>文件进行更改后都要重复步骤2，这样更改的内容才能在hexo博客上显示。</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo字数统计与阅读统计</title>
    <url>/2023/11/20/Hexo%E5%AD%97%E6%95%B0%E7%BB%9F%E8%AE%A1%E4%B8%8E%E9%98%85%E8%AF%BB%E7%BB%9F%E8%AE%A1/</url>
    <content><![CDATA[<ol>
<li>安装<code>hexo-wordcount</code>插件<br><code>npm install hexo-wordcount --save</code></li>
<li>安装<code>hexo-symbols-count-time</code>插件<br><code>npm install hexo-symbols-count-time --save</code></li>
<li>安装<code>eslint</code><br><code>npm install eslint --save</code><span id="more"></span></li>
<li>在hexo配置文件中添加<code>symbols_count_time</code>配置语句<pre><code>symbols_count_time:
 symbols: true               # 文字字数统计
 time: true                  # 文章阅读时长
 total_symbols: true         # 站点总字数统计
 total_time: true            # 站点总阅读时长
 exclude_codeblock: false    # 排除代码字数统计
</code></pre></li>
<li>在主题配置文件中添加<code>symbols_count_time</code>配置语句<pre><code>symbols_count_time:
 separated_meta: true        # 是否另起一行(true的话不和发表时间等同一行)
 item_text_post: true        # 首页文章统计数量前是否显示文字描述(本文字数、阅读时长)
 item_text_total: false      # 页面底部统计数量前是否显示文字描述(站点总字数、站点阅读时长)
 awl: 4                      # Average Word Lenth
 wpm: 275                    # Words Per Minute（每分钟阅读词数
 suffix: mins.
</code></pre></li>
<li>在主题配置文件中配置wordcount<pre><code>post_wordcount:          # 字数统计
 item_text: true         # 是否显示文字
 wordcount: true         # 显示字数
 min2read: true          # 显示阅读时间
 totalcount: true        # 显示总数
 seperated_meta: true    # 是否分开
</code></pre></li>
</ol>
<p>设置完成！</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo搭建个人博客挂载Github(未完)</title>
    <url>/2023/11/13/Hexo%E6%90%AD%E5%BB%BA%E7%A7%81%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%8C%82%E8%BD%BDgithub/</url>
    <content><![CDATA[<h1 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h1><h2 id="1-Git"><a href="#1-Git" class="headerlink" title="1.Git"></a>1.Git</h2><p><a href="https://git-scm.com/downloads">Git官网下载</a><br>下载完成后，双击安装包，选项全部默认，一路Next安装完成。<br>测试安装成功，输入<code>git --version</code>显示版本信息即可。</p>
<pre><code class="lang-bash">shenguosai@LAPTOP-FBGFH99L ~$ git --version
git version 2.37.1
</code></pre>
<span id="more"></span>
<h2 id="2-Node-js"><a href="#2-Node-js" class="headerlink" title="2.Node.js"></a>2.Node.js</h2><p><a href="https://nodejs.org/zh-cn/">Node官网下载</a><br>下载完成后，双击安装包，选项全部默认，一路Next安装完成。<br>测试安装成功，输入<code>node -v</code>显示版本信息即可。</p>
<pre><code class="lang-bash">shenguosai@LAPTOP-FBGFH99L ~$ node -v
v18.15.0
</code></pre>
<h2 id="3-Gitee或GitHub-目前只成功挂载GitHub-2023-8-3"><a href="#3-Gitee或GitHub-目前只成功挂载GitHub-2023-8-3" class="headerlink" title="3.Gitee或GitHub(目前只成功挂载GitHub@2023/8/3)"></a>3.Gitee或GitHub(目前只成功挂载GitHub@2023/8/3)</h2><p>准备Gitee或GitHub账号，这个是用来托管的，可以不需要自己的服务器和域名就可以拥有自己的博客。<br><a href="https://gitee.com/">Gitee官网</a><br><a href="https://github.com/">GitHub官网</a><br>注册完成后，创建一个仓库，然后就可以将hexo挂载到这个仓库中了。<br>创建仓库的时候用 <em>YourName.github.io</em> 或 <em>YourNama.gitee.io</em> ，这样后面托管的域名比较好记。</p>
<h1 id="二、博客搭建"><a href="#二、博客搭建" class="headerlink" title="二、博客搭建"></a>二、博客搭建</h1><h2 id="1-Hexo下载"><a href="#1-Hexo下载" class="headerlink" title="1.Hexo下载"></a>1.Hexo下载</h2><p>新建一个文件夹作为博客的顶级目录。<br>打开cmd，进入到新建的文件夹目录，输入<code>npm install hexo-cli -g</code>以安装hexo。</p>
<h2 id="2-Hexo初始化"><a href="#2-Hexo初始化" class="headerlink" title="2.Hexo初始化"></a>2.Hexo初始化</h2><p>安装完成后，输入<code>hexo init blog</code>进行初始化。<br>注：blog就是<b><font color="red">步骤1</font></b>中新建的目录。<br>初始化后，文件夹下就会有下方形式的目录结构。<br><em><font color="grey" size=1 >设置好图床后添加</font></em><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/image-20230807153014796.png" alt="image-20230807153014796"></p>
<h2 id="3-启动博客"><a href="#3-启动博客" class="headerlink" title="3.启动博客"></a>3.启动博客</h2><p>使用终端将目录进入到blog下</p>
<pre><code>shenguosai@LAPTOP-FBGFH99L /mnt/d/99_Git/blog$ la
total 245
drwxrwxr-x    1 shenguos 197121           0 Aug  2 18:38 .
drwxrwxr-x    1 shenguos 197121           0 Aug  2 15:13 ..
drwxrwxr-x    1 shenguos 197121           0 Aug  3 00:39 .deploy_git
drwxrwxr-x    1 shenguos 197121           0 Aug  2 15:14 .github
-rw-rw-r--    1 shenguos 197121          82 Aug  2 15:14 .gitignore
-rw-rw-r--    1 shenguos 197121           0 Aug  2 15:14 _config.landscape.yml
-rw-rw-r--    1 shenguos 197121        2582 Aug  3 00:01 _config.yml
-rwxrwxr-x    1 shenguos 197121      352551 Aug  3 00:38 db.json
drwxrwxr-x    1 shenguos 197121           0 Aug  2 15:34 node_modules
-rwxrwxr-x    1 shenguos 197121       92731 Aug  2 15:34 package-lock.json
-rw-rw-r--    1 shenguos 197121         655 Aug  2 15:34 package.json
drwxrwxr-x    1 shenguos 197121           0 Aug  3 00:08 public
drwxrwxr-x    1 shenguos 197121           0 Aug  2 15:14 scaffolds
drwxrwxr-x    1 shenguos 197121           0 Aug  2 15:14 source
drwxrwxr-x    1 shenguos 197121           0 Aug  2 23:53 themes
shenguosai@LAPTOP-FBGFH99L /mnt/d/99_Git/blog$ hexo s
INFO  Validating config
INFO  Start processing
INFO  Hexo is running at http://localhost:4000/ . Press Ctrl+C to stop.
</code></pre><p>本地静态网页就启动了，在浏览器输入<a href="http://localhost:4000/">http://localhost:4000/</a>就能看到如下网页。<br><em><font color="grey" size=1 >设置好图床后添加</font></em></p>
<h1 id="三、挂载到GitHub上"><a href="#三、挂载到GitHub上" class="headerlink" title="三、挂载到GitHub上"></a>三、挂载到GitHub上</h1><h2 id="1-挂载须知"><a href="#1-挂载须知" class="headerlink" title="1.挂载须知"></a>1.挂载须知</h2><h3 id="a-git配置"><a href="#a-git配置" class="headerlink" title="a) git配置"></a>a) git配置</h3><pre><code class="lang-bash">git config --global user.name &quot;shenguosai&quot;  //用户名
git config --global user.email &quot;xxx@xx.com&quot;  //邮箱
</code></pre>
<p>用户名和邮箱根据注册github的信息自行修改。</p>
<h3 id="b-SSH密钥"><a href="#b-SSH密钥" class="headerlink" title="b) SSH密钥"></a>b) SSH密钥</h3><p>挂载到GitHub上时，为了方便，我们要创建<code>ssh</code>密钥，使用ssh连接更为方便的推送。<br>方法：<code>ssh-keygen -C &quot;xxxx@xxx.com&quot;</code>就会生成密钥，Linux用户在<code>~/.ssh/</code>中，Windows用户在<code>C:/Users/xxx/.ssh/</code>中。<br>在github上绑定公钥:<code>Settings-&gt;SSH and GPG keys-&gt;SSH keys-&gt;New SSH key</code><br>将生成的<code>id_rsa.pub</code>中的文本内容复制到<code>Key</code>框中，点击<code>Add SSH key</code>。<br><em><font color="grey" size=1 >此处说明需要添加图片，设置好图床后添加。</font></em><br>输入<code>ssh -T git@github.com</code>，如果如下所示，出现你的用户名即配置成功。</p>
<pre><code class="lang-bash">shenguosai@LAPTOP-FBGFH99L /mnt/d/99_Git/blog$ ssh -T git@github.com
X11 forwarding request failed on channel 0
Hi shenguosai! You&#39;ve successfully authenticated, but GitHub does not provide shell access.
</code></pre>
<h3 id="c-Token"><a href="#c-Token" class="headerlink" title="c) Token"></a>c) Token</h3><h2 id="2-开始挂载"><a href="#2-开始挂载" class="headerlink" title="2.开始挂载"></a>2.开始挂载</h2><p>打开博客目录下的<code>.config.yml</code>(hexo的配置文件)，下拉到最下方。</p>
<pre><code>deploy:
  type: git
  repo: https://ghp_xxxxxx@github.com/shenguosai/shenguosai.github.io.git
  branch: master
</code></pre><p><code>ghp_xxxxxx</code>即使上面申请的token。<br>然后输入<code>hexo cl</code>清除缓存，完成代码为<code>hexo clean</code>。<br>清除缓存后输入<code>hexo g</code>生成静态网页，然后输入<code>hexo d</code>推送到<strong>GitHub</strong>。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo设置博客文章加密</title>
    <url>/2023/08/10/Hexo%E8%AE%BE%E7%BD%AE%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86/</url>
    <content><![CDATA[<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>Hexo搭配使用<a href="https://www.npmjs.com/package/hexo-blog-encrypt">hexo-blog-encrypt</a>插件可以写一些比较私密的博客，通过密码验证的方式让其他人不能随意浏览。</p>
<h1 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h1><p>在<code>blog\</code>目录运行以下代码：</p>
<pre><code class="lang-bash">npm install hexo-blog-encrypt
</code></pre>
<span id="more"></span>
<h1 id="一般配置"><a href="#一般配置" class="headerlink" title="一般配置"></a>一般配置</h1><ol>
<li>在根目录的配置文件<code>_config.yml</code>中添加以下代码：<pre><code class="lang-yml">encrypt:
enable: true
</code></pre>
</li>
<li>设置加密之后，需要在新建博文时在文章头部添加加密的信息设置：<br>```config</li>
</ol>
<hr>
<p>title: Hexo设置博客文章加密<br>date: 1691646835000<br>tags:<br>categories:<br>password: </p>
<h2 id="message"><a href="#message" class="headerlink" title="message: "></a>message: </h2><pre><code>```password```: 密码。
```message```：输入密码界面的提示说明。

# 针对Tag的加密
将以下代码复制到根目录下的```_config.yml```:
```yml
encrypt: #hexo-blog-encrypt
  enable: true
  abstract: 有东西被加密了, 请输入密码查看.
  message: 您好, 这里需要密码.
  tags:
  - &#123;name: TagName1, password: 密码A&#125;
  - &#123;name: TagName2, password: 密码B&#125;
  wrong_pass_message: 抱歉, 这个密码看着不太对, 请再试试.
  wrong_hash_message: 抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容.
</code></pre><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>SPICE简史</title>
    <url>/2023/09/04/SPICE%E7%AE%80%E5%8F%B2/</url>
    <content><![CDATA[<p>　　如今，SPICE广泛应用在仿真模拟电路(运放、基准、电源、AD/DA等)，混合信号电路(PLL、SRAM/DRAM，高速接口)，精确数字电路(延时、时序、功耗、漏电流等)，建立SoC的时序及功耗单元库，分析系统级的信号完整性，等等。<br>作为最早的电子设计自动化软件，它今天仍然是最重要的软件之一。可以说，没有SPICE，就没有电子设计自动化这个产业，也就没有今天的半导体工业。它的市场超过上亿美元。所有这一切，都是从1970年加州大学伯克利分校电机工程系的一堂课开始的。<br><span id="more"></span></p>
<h2 id="SPICE的诞生"><a href="#SPICE的诞生" class="headerlink" title="SPICE的诞生"></a>SPICE的诞生</h2><p>　　时间回到1970年，在加州大学伯克利分校电机工程与计算机科学系(UC Berkeley, Dept. EECS)，Ron Rohrer教授给7个研究生上“电路综合”课。Rohrer教授那时刚刚从仙童半导体公司(Fairchild Semiconductor)返回伯克利，没有时间准备教材。所以，在第一堂课，他就宣布：学生们一起写一个电路仿真程序。他跟系里管教学的助人Don Peterson教授达成一个协议：只要Peterson教授认可学生们写的仿真程序，他们就全部通过。否则的话，他们就全部不及格。这七个学生中有一个还是从机械系来的。他感到十分委屈：教授啊，俺啥电路都不会，俺就是来学电路的。这倒好，电路没学到，反而要去写电路仿真程序。这可咋办啊？Rohrer教授想了想，说没关系。虽然电路你不懂，但你的数值分析不是很厉害吗？OK，你就负责解方程这块吧。最后的结果证明了恰恰是学生们自己开发的解稀疏矩阵的模块是一个亮点，它使得可处理的电路规模成倍的增大。为什么这么说呢？如果你学过数值方法，你就知道一般解方程组用的是高斯消元法。它的时间复杂度是$O^{(n*3)}$。也就是说，电路规模增大一倍，你的运算时间就要增大到8倍。当时的电路仿真程序最多可以仿真10个晶体管。超过这个数，不是你的预算被烧没了，就是你的耐心被耗没了。但是，学生们注意到从电路搭出来的矩阵有个特点，就是它的稀疏性。一个电路矩阵里很多元素都是0(意味着两个电路节点之间没有连接关系)。既然是0，那就没有必要去存储和计算它了。这样一来，存储量和计算量大大减少了。<br>　　很多SPICE里面的基本要素都来自于Rohrer教授指导的这一堂电路分析课的项目，包括上面讲到的解稀疏矩阵的模块，还有隐式积分算法的使用使得瞬态分析更加稳定。并且，程序里加入了自带的半导体器件模型，用户只要给出一组模型参数，用不着自己提供器件模型的FORTRAN模块了。<br>这7个学生推举Laurence Nagel为代表，由他负责向Peterson教授汇报结果。这个结果就是CANCER。没错，它的意思就是“癌症”。它是“不包括辐射的非线性电路计算机分析”(“Computer Analysis of Nonlinear Circuits, Excluding Radiation”)的缩写。不要忘了，这是在一个叛逆的时代。当时绝大部分的电路分析软件来自于大公司与政府/军方的合同开发。在冷战和核威胁的环境下，政府/军方要求这些软件都具有分析电路抗辐射的能力。伯克利是反战的大本营，学生们自己开发的程序当然要跟政府/军方的要求对着干了。<br>有同学可能会问：为什么要开发一个电路仿真程序？呵呵，要知道在这之前，人们分析电路，要么是用笔和纸，要么就要搭电路板(Bread Board)。Peterson教授就被学生们称之为“信封教授”，因为他认为电路分析用个信封的背面来做就足够了。但随着电路规模的增大，用笔纸变得越来越不可能，搭电路板又不能精确反应芯片上的电路特性，而且费用也越来越高。因此，用软件来做仿真就变得日益迫切了。<br>　　当课程结束，Nagel向Peterson教授汇报CANCER之后，Peterson教授给予了认可。学生们都通过了！CANCER成了Nagel的硕士论文课题。它在伯克利被很多本科生及研究生使用，并且给了大量的建议去改进它。呵呵，都说学生是最好的“小白鼠”，这话果然不假(再插一段话：基于这堂课的巨大成功，Rohrer教授后来又用同样的办法试了几堂课，但都失败了。他自己总结说，是因为有Nagel，伯克利的那堂课才成功了。所以，如果没有Rohrer教授那样的功力和Nagel那样天分的学生，SPICE也不可能从一堂课里诞生出来。)<br>　　到了1971年的秋天，Nagel在伯克利又开始了他的博士生生活，这一回是在Peterson教授的指导下了。(在这之前，Rohrer教授离开了伯克利到工业界去发展。原因嘛，据说Rohrer教授与Peterson教授在是否要公开CANCER的源代码上有不同意见。Rohrer教授后来又回到了学术界，在卡内基-梅隆大学(CMU)做教授，并指导开发了AWE，这是后话。)<br>　　Peterson教授给Nagel的第一个任务是给程序起个新名字。确实，CANCER太难听了，谁都不喜欢。Nagel花了天知道多长时间才想出来这样好听的，也就是我们现在还在用的名字：SPICE(Simulation Program with Integrated Circuit Emphasis)。(所以，如果你要写一个新程序，创建一个新公司，生一个小孩，一定要给他/她起个好听的名字。)<br>　　1971年被正式认定为SPICE诞生的年份。</p>
<div>
    <center>
    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230901155141.png"
         alt="加载错误"
         style="zoom:100%">
    <br>
    Laurence Nagel当年在伯克利的照片
    </center>
</div>
<br>
<div>
    <center>
    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230901155358.png"
         alt="加载错误"
         style="zoom:100%">
    <br>
    Ron Rohere教授
    </center>
</div>
<br>
<div>
    <center>
    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230901155442.png"
         alt="加载错误"
         style="zoom:100%">
    <br>
    Don Peterson教授
    </center>
</div>
<br>
　　SPICE还是开源代码的先驱。当时也有开源代码，但都没有太大的商业价值。SPICE就不同了。有人已经看到它的商业价值，但Peterson教授坚持要把代码开源(我们都得真心的感谢Peterson教授)。任何人只要花20美元的手续费，就可以得到SPICE的源代码(当然，在冷战时期，SPICE被禁止出口到政府认为的“共产国家)。有人会问，那这样一来，伯克利是不是损失了一大笔钱呢？事实并非如此。伯克利的SPICE帮助数字设备公司(DEC)卖出了很多台VAX机。反过来，DEC给伯克利电子系捐赠了1800万美元(这可是二十年年的数目，考虑到通货膨胀，你可以想象现在值多少钱)。这么多钱可不是一个学校卖代码能获得的。所以，做好事终究还是会得到好报的。

## SPICE2和SPICE3
　　在70年代初期，伯克利电子系用的计算机是CDC6400大型机，它的运算能力相当于286(时钟频率是10MHz，可它的成本是六百万美元。再看看今天你手中的iphone，它的时钟频率超过1GHz，成本不到600美元——这是100万倍性价比的差别！)分给每个学生的主内存白天为256KB。到了晚上人少，你就可得到384KB。运行一个不算太大的电路仿真，用Nagel的话说，就像把你11码大的脚穿进婴儿的鞋里——你得想尽一切办法节省内存。能仿真的最大的电路规模也就是25个双极型晶体管(相当于50个电路节点)。而且，那时候SPICE还只有双极型晶体管模型。71年的秋季，从贝尔实验室来到伯克利的David Hodges教授带来了第一个MOSFET模型：Shichman-Hodges模型。如果你用过SPICE(并且年头足够多的话)，你应该知道这就是Level1 MOSFET模型。它是所有MOSFET模型的鼻祖。
　　1975年Nagel从伯克利博士毕业。他的论文 ***“SPICE2:A COMPUTER PROGRAM TO SIMULATE SEMICONDUCTOR CIRCUITS”***，成为了EDA行业被引用最多的文章。
　　SPICE2这个版本基本上奠定了今天电路仿真程序的基石，其中包括：改进的节点分析法(Modified Nodal Analysis)，稀疏矩阵解法(Sparse Matrix Solver)，牛顿-拉夫逊迭代(Newton-Raphson Iteration)，隐形数值积分(Implicit Numerical Integration)，动态步长的瞬态分析(Dynamic Time Step Control)，局部截断误差(Local Truncation Error)，等等——说太多技术细节了，还是接着讲故事吧。
<div>
    <center>
    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230901165841.png"
         alt="加载错误"
         style="zoom:100%">
    <br>
    Nagel博士论文的封面
    </center>
</div>
<br>

　　下载这篇论文：[SPICE2:A COMPUTER PROGRAM TO SIMULATE SEMICONDUCTOR CIRCUITS](https://www2.eecs.berkeley.edu/Pubs/TechRpts/1975/9602.html)
　　如果你想了解SPICE的核心秘密，就下载一份好好读读吧！
　　最早的SPICE2没有用户界面。它的运行是批处理方式。也就是说，你准备好了你的电路描述和仿真命令，就把它们提交给主机系统里。然后呢？然后你就可以回家了。因为你的几十(百)个同事也在做着同样的事情。所以，等第二天早上上了班再看结果吧！
　　SPICE2的输入是用打卡。你可能会问：什么是打卡啊？呵呵，祝贺你年纪够小。对那些年过半百的人，最初接触到的计算机输入界面就是像下面这样的卡：

<div>
    <center>
    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230901171423.png"
         alt="加载错误"
         style="zoom:100%">
    <br>
    IBM Punch Card
    </center>
</div>

<p>　　你把你的电路描述及仿真命令打在一叠这样的卡上，然后放到读卡机里。你可能听说过SPICE的输入叫“SPICE DECK”，这个名字就是从这叠卡来的。<br>　　SPICE2的输出是行打印机。是的，就是用下面这样的打印机打出仿真结果在纸上(想象一下那时消耗了多少纸张)。</p>
<div>
    <center>
    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230901172227.png"
         alt="加载错误"
         style="zoom:100%">
    <br>
    Fujitsu FACOM 655B Line Printer
    </center>
</div>

<p>　　你也可以打印输入输出的信号波形。每个波形是用不同的字符画的。像下面这样(看着是不是很粗糙呀)：</p>
<div align="center">
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230901172528.png">
</div>

<p>　　有同学读SPICE手册时会看到一个奇怪的选项叫“NOPAGE”。这是因为SPICE的输出在页与页之间的折线处会加入一个分页符，流出空白。这个选项就是要求不要停止打印的。这样一来，波形就不会因为换页而在页与页之间断掉了。随着行打印机的消失，这个选择项也进入了历史。<br>后来SPICE2的输入/输出也进化成了文件输入/出。像下面这样：</p>
<div align="center">
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/111.png">
</div>

<p>　　Nagel毕业后去了贝尔实验室。从此以后，SPICE2的改进就由Nagel的室友，Ellis Cohen，继续进行下去。Ellis是个计算机编程能手。用当时周围学生的话说，他就是一个长成人形的计算机。是他(以及后来的Andrei Vladimirescu和Sally Liu)把学校里开发的程序SPICE改造成了实用的SPICE2G6。在SPICE的早期开发中，他是个无名英雄。今天工业界里的很多商业SPICE就是基于SPICE2G6开发出来的。<br>　　到了八十年代，SPICE2已经遍及了各个大学。但它的问题也显现了出来：FORTRAN代码太难维护，加新的器件模型需要改动的地方太多，等等。在此同时，C作为一种新的程序语言正方兴未艾。于是，用C语言重新写SPICE就被提到了议事日程上来。这个任务被伯克利的Thomas Quarles在89年完成了。比起SPICE2来，SPICE3增加了用户界面，你可以使用命令，甚至命令串来控制程序。另外，还增加了图形界面看波形。更重要的是，SPICE3的程序构架更加清晰，更加模块化。维护及修改起来更加容易。八十年代也是计算机硬件突飞猛进的时代：大型机(mainframe)被工作站(workstation)取代。UNIX及架构在它上面的C-shell和X-window成为软件开发及应用的基本框架。另外，个人电脑(PC)也越来越普及。这些都为SPICE的广泛应用打下了坚实的基础。</p>
<div>
    <center>
    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230901180559.png"
         alt="加载错误"
         style="zoom:100%">
    <br>
    Quarles论文封面
    </center>
</div>

<p>　　同样，你可以用这里的链接下载 <a href="http://www.eecs.berkeley.edu/Pubs/TechRpts/1989/ERL-89-46.pdf">Quarles的论文</a>。<br>　　下面是SPICE3(版本3f5)的执行语句，注意它是交互式的。每一个“Spice<number>-&gt;”后面是一个spice3的命令。不如“source”就是把电路读入，“run”就是运行，“display”就是显示，“quit”就是退出。</p>
<div align="center">
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/222.png">
</div>

<p>　　SPICE3自带了一个图形模块nutmeg。下面是nutmeg显示的波形，是不是比SPICE2的行打印的字符波形好看多了？</p>
<div align="center">
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/333.png">
</div>

<p>　　自从上世纪90年代后，学术界SPICE的发展基本就停止在SPICE3f5这个版本了。这是不是意味着SPICE停滞不前了呢？非也。至少在两个方向上SPICE还在一直发展：一个是器件模型(特别是MOSFET模型)，另一个是商业SPICE程序。(这里值得提一下，有一批SPICE的爱好者及高校把SPICE3f5接过来，并整合了其它几个开源软件(xspice, cider, gss, adms 等)，建成了ngspice。Ngspice也在缓慢的进化着，但比起商业SPICE进化的速度慢多了。你可以在 <a href="https://sourceforge.net/">sourceforce</a> 上找到 ngspice，也可以去 <a href="https://ngspice.sourceforge.io/index.html">ngspice</a> 的主页上去查看。</p>
<h2 id="SPICE中器件模型的演变"><a href="#SPICE中器件模型的演变" class="headerlink" title="SPICE中器件模型的演变"></a>SPICE中器件模型的演变</h2><p>　　SPICE里面自带了很多模型。像无源元件电阻、电容、电感等等，以及有源器件二极管、双极管等。但花样最多的、变化最频繁的、复杂度最高的，当属MOSFET的模型了。这主要是因为从七八十年代以后，MOSFET的工艺因为它的低功耗，高集成度而变成了主流。那时候还是个半导体工业百花争鸣的年代。很多半导体公司如雨后春笋般的冒出来(就像现在的社交媒体公司一样)。几乎每一家公司都在工艺及器件上有点自己的绝活，所以集成电路公司大多是个独立器件制造商(IDM)。这就造成了MOSFET的模型也层出不穷。谁家的SPICE支持的MOSFET模型越多，谁的SPICE用户群就越大。<br>　　前面我们说过SPICE2中加上了MOSFET Level1的模型。等到SPICE3出来的时候，里面已经加入了Level2及Level3模型。到了九十年代，又加入了著名的BSIM(Berkeley Short-channel IGFET Model)模型。可以这样说，现在所有的Foundry用的模型都来自于BSIM家族。为什么在众多MOSFET模型中BSIM胜出了呢？<br>　　我们知道，SPICE是用来解含有非线性器件的电路方程的。解非线性方程的一个有效方法就是牛顿迭代—把非线性方程在某个点给它线性化，然后逐次逼近最终解。这个过程有点像两个宇航飞船对接—如果对方的接口在你的左边，你就往左偏一下。如果你偏多了，对方的接口在你的右边了，你就再稍往右偏点，知道最后两个接口对准锁定。但这里面又个要求：就是非线性曲线的一阶导数要连续。如果不连续的话，就好像喝醉酒的人来控制飞船对接，忽左忽右，或者根本就掉过头来，布置东南西北，上下左右了，如何能对接上呢？不幸的是，很多早期的MOSFET模型(包括Level1、2、3)都有这个问题—模型的电流曲线的一阶导数在工作区域内不连续。这是因为人为的把器件分成了不同的工作区域。不同区之间能保证电流连续已经不错了，哪还去管它的导数呢！这样做的后果就像管对接的人喝醉了酒，没法瞄准目标，最后导致SPICE不收敛　(Non-convergence)，或时间步长太小(Time Step Too Small—这有很大可能也是不收敛造成的)。<br>　　早期的BSIM模型还保留了工作区的概念。但在不同的区域之间加入了平滑过渡曲线，以保证电流曲线及其一阶导数的连续性。在它后来的版本中，就彻底抛弃了工作区域的观念—干脆只用一个(连续且可导)曲线来代表整个工作区域里的特性。这就从根本上解决了不连续的问题。BSIM家族中最成功的代表是BSIM3v3(HSPICE中的Level49)和BSIM4v5(HSPICE中的Level54)。从此以后，再也没有其他的模型能出其右。它们俩也是工业界的MOSFET器件模型标准。BSIM3v3跨越了亚微米的工艺(0.3微米至0.13微米，大致从1993年到2000年)，BSIM4跨越了深亚微米到纳米的工艺(90纳米至20纳米，大致从2002年到2012年)。<br>　　你可能会问：这么好的器件模型是谁做的？猜一下—对了，还是伯克利。是伯克利电子系器件模型小组。它的掌门人就是胡正明教授(Pref. Chenmin Hu)。</p>
<div align="center">
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230903215808.png">
</div>
<br>
　　今天的SPICE开发者要感谢胡教授。如果BSIM不是工业标准，那你就得像HSPICE一样加几十上百个MOSFET模型。不光工作量大，容易出错，还有很多内部的模型人家还不愿意给你呢(参见下面Smart-Spice的故事)。而现在，你只要加一、二个开源的BSIM标准模型就可以覆盖绝大部分用户了。<br>
　　有同学要问：现在的最新工艺不是已经到了16纳米、14纳米，以致10纳米，那这些工艺的器件结构与模型又是什么呢？答案已经有了：还是胡教授的小组开发的FinFET(也叫3维FET)模型。实际上，早在99年胡教授就发表了FinFET的文章。因此他也被称作FinFET之父。他同时是美国和中国的科学院士。同学，如果你的一生中能达到以上其中的任何一项，是不是就可以笑傲江湖了呢?<br>
　　就像半导体工艺由简到繁的过程一样，MOS器件模型也从Level1的几个公式/几十行代码，发展到BSIM的几百个公式/上万行代码。这里值得提出的一点，与BSIM3/BSIM4模型不同的是，FinFET模型不是用C语言，而是用Verilog-A语言写的。这直接导致了把它加到SPICE3中的困难。虽然很多商业SPICE已经支持Verilog-A，但现在开源的SPICE3却还没有做到(这里插一句：基于SPICE3的ngspice当中包含了支持Verilog-A的开源编译器ADMS。但要做到完全自动编译FinFET模型这样重量级的模块还有一段路要走)。也就是说，虽然FinFET模型是开源的，但现在它的仿真载体并不开源。这种现象与早期的SPICE研发反了过来。现在学术界落到了工业界的后面。看到这儿，学术界的同学是不是要深思一下呢?

## 商业SPICE的演变
　　前面我们提到当CANCER出来的时候就有人意识到了它的商业价值。毫无疑问，SPICE的出世必定会有人把它商业化。事实却是如此。八九十年代是商业SPICE出现的高峰期。至少有几十个SPICE的变种冒出来。有的获得了巨大成功，有的毫无声息的消失了，有的还在惨淡经营着。同学，如果你想创业，这里面有太多的经验和教训了。
#### HSIPCE
　　先来说说HSPICE，记得我们前面讲过的批处理运行吧。在当时的大公司里，这是电路仿真标准的运行方式，但这么做的效率太低了。设计者需要尽量短的时间看到仿真结果，然后修改电路参数再做仿真。如此多次以达到最佳结果。有两个孪生兄弟Shawn Hailey及Kim Hailey，当时都在AMD做设计，看到了这里面的问题。与其让几百个客户排队等一个银行柜员，为什么不让每一个客户都有一个柜员呢？问题就是商机。他们决定跳出来开自己的公司。于是78年，Meta-Software成立了，他们把改进的SPICE变种取名为HSPICE(你现在明白了吧，为什么要以H开头？这可是兄弟俩姓的第一个字母)。他们把SPICE2从大型机移植到了VAX小型机上，后来又移植到Sun工作站上。就这样，借着计算机硬件改朝换代的东风，越来越多的公司开始使用HSPICE了。直到如今，这个HSPICE成了工业界的“金标准”。只要你做个仿真器，人们一定会跟HSPICE比结果的。而且，在SPICE前面加一个字母成了时尚。到今天，有人开玩笑说A-SPICE到Z-SPICE都已经被人用过了(当然，HSPICE仍然是最出名的)。
　　有人可能会问：要是我当时也把SPICE移植到小型机上，我是不是也可以成功？呵呵，成功的要素有很多，光用一条是远远不够的。比如说用户的反馈就是相当重要的一条。举个例子，HSPICE是第一个把器件模型库卡(.LIB)和结果测量卡(.MEASURE)做进去的。像这样的例子还有很多。这些虽然不是什么革命性的技术创新，但它们很实用，能大大提高用户的使用效率。甚至某些时候，对用户来说，这样的小改进比创新的算法更重要。
　　前面我们提到了七八十年代有很多的MOSFET器件模型。HSPICE把能拿到的器件模型都收进去了。所以，HSPICE的MOSFET器件模型是最全的(不信的话，你就去拿本HSPICE的MOSFET模型手册读一下--注意，它是一本独立的手册。也就是说，光是它里面的七八十个MOSFET模型就是一本书了)。但这样还不够，Meta还开发了自己的MOSFET模型：Level28.他们跟用户的工艺线紧密联系。在工艺线流片之前，相应的器件模型参数已由芯片加工厂(Foundry)提供给芯片设计者了。如果你是设计者，你还能不用它吗？这样做的结果直接导致了HSPICE用户群急速的扩大。就像滚雪球一样，一旦超过了临界质量(critical mass),它自己就会越滚越大。据Meta-Software的人说，在公司巅峰的时候，它们的销售员就是一台传真机。你只要把传真机号码告诉客户，他们就把订单发来啦(那时候的钱真好赚啊，当然公司里肯定不止一台传真机)。从78年成立到96年这18年期间，公司一共卖出了一万一千多套HSPICE，它的年成长率达到了25%~30%。
　　1996年Meta-Software被Avant收购，到2001年，Avant又被Synopsys收购。关于Avant的故事有很多。这个公司(包括它的头儿 Jerry Hsu)就像EDA业界的一匹黑马。它的故事足可以写另一个长篇了。
　　Meta-Software兄弟中的老大，Shawn Hailey，已于2011年去世。在此之前，他把自己的名字改成了Ashawna Hailey。
<div align="center">
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230903224801.png">
</div>
<br>

#### PSICE
　　PSPICE像HSPICE一样，PSPICE的故事也跟它的名字有关。首先，这第一个字母“P”并不是其创始人的名字。事实上，创始人的名字Wolfram Blume里面根本没有字母“P”。那这字母“P”到底是什么依稀呢？对了，它就是PC。PSPICE的发展跟PC的发展是密不可分的。但这并不是PSPICE的初衷。
　　时间回到1984年，那时Wolfram Blume从加州理工(CalTech)毕业加入南加州一家半导体公司。工作中，他听到很多抱怨，说公司内部的SPICE速度太慢了。这位老兄也不含糊，立马对其SPICE来了一个详尽的分析。结果发现，大部分时间花在了算MOSFET模型的方程上(记得前面我们讲的MOSFET的复杂性吧)。他一想，如果能用硬件来并行处理这些方程，岂不就可以加快仿真速度了吗？(呵呵，又是一个看到商机的主)？恰恰那个时候英特尔推出了支持硬件并行的8085/8086/8087.说干就干，这位老哥创立了MicroSim公司。又是在这时，IBM推出了基于Intel芯片的IBM-PC。另一个机会又来了：只要把SPICE从大型机上移植到PC上就行了。这事儿比起第一个事儿简单太多了。可是，人们当时认为PC就是个游戏机而已，没人拿它来做什么正经事儿(呵呵，看看现在不还是这样吗？)。所以，这个老哥并没有把这第二件事看得太重，而是集中绝大部分精力和资源去做硬件并行。
　　当时的IBM-PC有640KB内存。最大的数组只允许64KB内存。而SPICE是用一个巨长的数组来存储所有的数据。把SPICE的数据放到IBM-PC的结构，用这位老哥的话说，就像把一只鲸鱼塞进一个金鱼缸里。但他们做到了(中间略去他们N个睡不着的工作之夜)。并行硬件的确加快了方程的处理，可他们也快没钱了。这位老兄忽然想到，咱不是把SPICE移植到PC上了吗？咱就先卖着这个软件，用卖它的钱继续开发咱得并行硬件。就这样，PSPICE就开始在PC上出现了。
　　最初这位老兄是想卖硬件加速器的PSPICE版本，可结果恰恰相反，两年后，纯软件的PSPICE卖出去一千多套，而硬件加速器只卖了两套。到这时候，这位老兄也明白了，做硬件吃力不讨好，市场并不需要。他把卖出去的两套硬件加速器又自己买了回来(当然又半卖半送给人家N套纯软件的版本)。
　　同学你看，一个高新复杂的技术并不一定会做出一个卖座的产品。反过来，一个貌似简单的技术可能很受市场的欢迎。另外，PSPICE虽然不是赚钱最多的，但它的用户数绝对是最大的(遍及全世界五大洲)。你可以下载一个免费的PSPICE用。当然，只限于十个晶体管。但这对一般学生的学习来讲，大部分情况下已经够用了(想一想当年的大型机也就只能算这么多)。你如果在网上搜一搜，就会发现阿拉伯语(以及其它语言)的PSPICE的教材。你如果是在校生的话，很可能也在用PSPICE。

<div>
    <center>
    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/444.png"
         alt="加载错误"
         style="zoom:100%">
    <br>
    PSPICE第二版封面
    </center>
</div>

<p>　　MicroSim在1998年被OrCAD收购，OrCAD在2000年又被Cadence收购。</p>
<h2 id="Spectre"><a href="#Spectre" class="headerlink" title="Spectre"></a>Spectre</h2><p>　　话说89年，伯克利毕业了最后一批做SPICE研究的学生。其中一个叫Ken Kundent。Ken非常有才气，他在伯克利的研究成果后来成为了安捷伦的微波仿真软件。同时他的傲气也不小。在加入Cadence后，他看到HSPICE卖的很火，就决定做个新的仿真工具去取代它。这就是Spectre。据说他用了两个星期就写出了第一个版本(呵呵，不愧是伯克利SPICE大本营出来的)。SPECTRE比HSPICE要快两三倍，还具有更高的精度及更好的收敛性。但它并没能取代HSPICE。为什么呢？一个原因是兼容性。SPECTRE的输入格式跟HSPICE有很大不同。Ken计算机编程的功底很深，他设计的Spectre的输入格式像C语言一样。虽然从计算机语言角度看，Spectre的输入比HSPICE的输入更规范，但SPICE的用户是电路设计者，他们才不管你的语言多么优美，只要好用就行。另外，如果你是个电路设计者，花了几年功夫好不容易才学会了一种语言格式，用它已经写了成百上千个电路网表，而且它们都工作的好好的，为什么要去换成另外一个呢？另外，还有一个重要的原因，就是用户对HSPICE的信赖。这种信赖不是一时半会儿就能建立起来的。它是经过几十年，成千上万遍仿真，几百次tape-out(流片)才能形成的。怎么能说换就换呢。<br>　　Ken琢磨着，既然更快更好还没办法取代SPICE，那我们就得做点SPICE没有的东西。做什么呢？恰好在九十年代中期，一种标准的设计语言VHDL开始向模拟电路扩展，这就是VHDL-AMS(VHDL的模拟电路及数模混合电路描述语言)。(这里再插一句，最早的数模混合电路描述语言是MAST，它是Analog公司的仿真器Saber里面使用的。VHDL-AMS是基于欧洲Anacad公司开发的HDL-A语言发展而来的。后来Anacad的仿真器成为Mentor的Eldo)。但当时还没有Verilog的AMS扩展(原因是VHDL主要在欧洲使用。而Verilog主要在美国使用)。Ken就想，好吧，我们也来做个标准的设计语言到Spectre里。这就是Verilog-AMS(Verilog的模拟电路及数模混合电路描述语言)。不过这事儿说起来容易做起来难。首先，既然你是标准，那就要大伙儿都同意。让大伙儿都同意的事是要花时间的，没那么快。其次更重要的，是你要让模拟电路设计者来学习并使用这个语言。这可是比登天还难的事儿。如果你是一个模拟电路设计者，你想想你在学校的课本上看到的是运放的电路还是它的描述语言？当然是电路了。至少到今天为止，还没有一本模拟电路的教科书是只用描述语言的。你再看看数字电路的教材，几乎全部都是VHDL或Verilog描述语言(呵呵，如果你还用晶体管来设计数字电路，那你的年龄够大了)。另外，当你做模拟设计的时候，你是在搭晶体管电路呢，还是在写描述语言？对模拟电路设计者来说，用语言而不用电路来做设计是不可想象的。反过来，对数字电路设计者来说，用电路而不用语言来做设计也是不可想象的。<br>　　Spectre-AMS做出来后，Ken发现当时的感兴趣者寥寥无几(呵呵，这哥们专找硬骨头啃)。那怎么办？在公司做产品是要卖钱的。Ken有点儿绝望了。这时，他想到了回去做他在学校的老本行：射频电路仿真。至少这个功能别的SPICE还没有。他把这个想法告诉了当时Cadence的市场经理Jim Hogan。Jim做了个市场调查。那时射频电路设计市场几乎不存在，只有几家做镓砷电路的算搭点边。当Jim把这调查结果告诉Ken，Ken也无可奈何的耸耸肩。Jim对Ken看了好一会儿，说，管它呢，你就做去吧。谁知道这一次却是歪打正着了。九十年代中后期正是无线通信市场腾飞的时候。很多在学校用Spectre-RF的毕业生加入了新的做射频电路芯片的设计公司。这些公司必须要用Spectre-RF做射频仿真。而Spectre-RF是Spectre的一个选项。因此，Spectre也就借着Spectre-RF的东风开始流行起来了。后来，HSPICE和Smart-Spice也跟风在自己的SPICE中加进了RF的选项。这也算是Spectre对SPICE的功能扩展做的贡献吧。</p>
<div>
    <center>
    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230903235201.png"
         alt="加载错误"
         style="zoom:100%">
    <br>
    Ken Kundent
    </center>
</div>

<h4 id="Smart-Spice"><a href="#Smart-Spice" class="headerlink" title="Smart Spice"></a>Smart Spice</h4><p>　　Smart-Spice是Silvaco公司的产品。说道Silvaco，就不得不说它的创始人Ivan Pesic。Ivan来自黑山共和国(Montenegro，欧洲巴尔干半岛的一个小国家)。像所有第三世界国家的穷学生一样，通过自己的勤奋努力来到美国。来美国之后，他先开了一家修车店。知道攒够了钱，才在1984年成立了Silvaco。他有一个儿子，可能是年幼时受了老爸的修车店的熏陶，决定长大了当个汽车修理工。因此学习也不上进。怎么让这小子好好学习呢？简单。有一天，老Ivan把儿子带到了圣荷塞（SanJose，硅谷一大城市）一个最破的修车厂的马路对面，对儿子说：你就坐在这儿，看看汽车修理工一天的工作是什么样的。自从那一天结束以后，儿子的学习成绩就全变成A了。<br>　　说到Ivan Pesic，我们还不得不说他打官司的故事。Silvaco的历史上与N家公司打过官司(而且大部分都赢了)。在此我们只讲讲与Meta-Software(后被Avant并购)的官司。话说八十年代末到九十年代初，Meta-Software和它的HSPICE如日中天，这其中它自己的Level28模型起了重要作用。Silvaco最初的产品是TCAD(Technology CAD)，并不是SPICE。这时它也准备开发自己的Smart-Spice，但它拿不到HSPICE的Level28模型。怎么办？Silvaco采用了一个瞒天过海的迂回战术。Silvaco有个不错的模型参数提取软件叫Utmost。它就找到Meta-Software说，你看，如果把你们的Level28模型公式放到我们的Utmost中，就会有更多的用户用你们的HSPICE。Meta一想也对，就把Level28模型给了Silvaco。没成想，过了两年，Silvaco自己的Smart-Spice出来了，而且里面还带着Level28模型。这下Meta-Software气坏了。就把Silvaco告上了法庭。也就在这个前后，Avant并购了Meta-Software。但Avant只看到了HSPICE这只下金蛋的鸡，却忽略了Meta-Software跟Silvaco的官司。也许是因为Avant恰恰正在和Cadence打着一场更大的官司，从而忽略了这个小案子。不管是什么原因，当法庭开庭要宣判的那一天，Avant居然没有人出庭。这下法官可气坏了。好啊，竟然藐视本法庭，来啊，判Avant输，并赔Silvaco两千万！本来Silvaco上庭前战战兢兢的，盼望着和解就不错了。这下倒好，不光不用和解了，还得了一大笔钱。呵呵，人们都说国外重视知识产权。这种重视其实是来自于众多这样的动不动就成败上千万的官司。所以同学，如果你是学理工出身的，那你不妨去学学法律。如果你是学文科出身的，那你不妨去学学理工。估摸着在不久的将来，国内这样的涉及知识产权的大官司也会越来越多。作为一个懂高科技的律师(或者一个懂知识产权法律的工程师)会很抢手的。<br>　　但是，一个公司如果光靠打官司，那也是赢得不了客户的。说实话，Smart-Spice做得还是蛮不错的，价格又便宜。Smart-Spice还是第一个“基于使用时间许可证”(use-time based license)的工具。这对许多小公司或个人用户是个好消息。如果你没几万美元去买高大上的商业SPICE，或者你就只需要跑几次仿真，那就可以最少花十几美元用Smart-Spice完成你要做的事。这就像买车还是租车一样。卖车店能赚钱，租车店也会有很多顾客的。这不也是一个很好的商业模式吗？<br>　　Ivan Pesic于2012年因癌症在日本去世。如今，他本来想当汽车修理工的儿子已经继承了老爸的事业，接替掌管Silvaco了。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230904002306.png" alt="20230904002306"></p>
<h4 id="Aeolus-AS"><a href="#Aeolus-AS" class="headerlink" title="Aeolus-AS"></a>Aeolus-AS</h4><p>　　我们应该感到骄傲—这是我们中国本土的SPICE。虽然名字叫起来很拗口。光从名字上也看不出这是SPICE。它是由华大九天开发的。至于为什么起这样一个名字，还是请华大的刘总来解答吧。本人并没有用过这个工具。下面的几句话是从华大的网页上摘下来的，也算给他们做个广告吧。“它是新一代高速高精度并行晶体管级电路仿真工具，能够在保持高精度的前提下突破目前验证大规模电路所遇到的容量、速度瓶颈。Aeolus-AS能够处理上千万个元器件规模的设计，仿真速度也比上一代晶体管级电路仿真工具有大幅提升，同时支持多核并行。”<br>　　还有一类是工业界但非商业(也就是不拿出来卖的)SPICE，通常它们都是公司内部开发使用的。一般只有拥有Fab的大公司(像Intel、前Infenion、前Motorola、Fujitsu等)才能负担得起一个开发团队。这种公司内部的SPICE基本都会有自己的器件模型。在这里我们就不多说了。</p>
<h2 id="SPICE的变异与进化"><a href="#SPICE的变异与进化" class="headerlink" title="SPICE的变异与进化"></a>SPICE的变异与进化</h2><h4 id="SPICE的变异与进化-1"><a href="#SPICE的变异与进化-1" class="headerlink" title="SPICE的变异与进化"></a>SPICE的变异与进化</h4><p>　　SPICE最初是用来做小型电路仿真的。电路中的元器件数也就几十最多到几百个。随着电路规模越做越大，电路种类越来越多，人们会问：SPICE能不能跑得更快一些，能运行的电路更大一些？自然而然的，SPICE的变种就出现了。我们在这儿讲三个方面：第一是快速仿真；第二是数模混合仿真；第三是扩展应用。<br>　　先说说快速仿真(fast SPICE)。这也是市场最大，发展最多的一块儿。因为SPICE是把整个电路放到一个矩阵中来解。人们就想能不能把电路分成小块单独解，然后再把各块之间连接起来，这样不就快了吗？的确，对数字电路，确实可以用分割的方法。因为数字电路的信号是有方向的，我们可以在没有直流通路的地方把它分开(例如在两个串联的反相器中间)。另外就是数字信号是离散的，我们可以把它分成几段。分的段越大，时间步长也就能越大，需要解的次数就少了(当然结果也就没那么精确了)。还有就是器件模型。我们前面讲过如今的mosfet模型非常复杂，要花很多时间去算，那能不能把它简化呢？可以。事实证明对数字电路以及数模混合电路(像PLL、Memory、Serdes)来说，用表格模型(table model)来代替复杂的方程模型是个不错的选择。通过这些简化，快速仿真可以比原来的SPICE快几十到上百倍，而精度是在SPICE的5%~10%之内。像EPIC的PowerMill(后来成为Synopsys的NanoSim)，Anagram的ADM(后来成为Avant的StarSim)，Celestry(后来成为Cadence)的UltraSim，Nassda(后来成为Synopsys)的HSIM，等等。最近比较流行的是Magma(现在是Synopsys)的FineSim，BDA(现在是Mentor)的AFS，Proplus的NanoSpice。<br>　　其次来说说数模混合仿真。当一个系统中既有模拟电路，又有数字电路，人么自然就会想到把SPICE和数字仿真器(如Synopsys的VerilogVCS、Cadence的NC、Mentor的ModelSim)连在一起运行。SPICE去算模拟电路部分，数字仿真器去算数字电路部分，它们之间用数模/模数转换器(AD/DA)连接。注意这种运行方式跟上面的快速仿真不同。这样的混合仿真需要两个仿真器。而且这样的构架有缺点。主要的问题是数模转换没有一个标准。市面上有很多SPICE以及Verilog仿真工具，每一个工具的转换界面都不一样，这就造成混合仿真的界面非常复杂。因此，最近发展的混合仿真都采用数模一体化的构架，大大简化了转换界面，而且用户只需要再一个环境下就可以进行混合仿真。这样的工具有Cadence的Virtuoso-AMS、Synopsys的HSIM-plusHDL、Silvaco的Harmony、华大的Aeolus-ADS等。<br>　　最后再来说说SPICE的扩展应用。虽说SPICE是针对集成电路(IC)开发的，但它的应用已扩展到系统级(System Level)，主要是电路板(PCB)级的仿真。那系统级仿真与集成电路仿真有何区别呢？它们不都是电路吗？呵呵，没错，它们都是电路，但区别还是蛮大的。主要是它们的规模与尺寸的不同。我们知道，集成电路是集成在芯片上的。其器件尺寸现在已做到纳米级。而系统的尺寸还在毫米、厘米甚至米的数量级。学过电磁的同学都知道，当器件的尺寸大于信号波长的时候，就要考虑分布的场效应了。拿一段导线做例子。一段在芯片上的导线，你可以把它看做一个电阻。而一段电路板上的导线，你就必须用传输线(Transmission Line)来代表它，否则误差就太大了。如果信号的频率再高，那就要用S参数了(S-Parameter)。因此，电路仿真发展出一大分支，这就是所谓的“信号完整性”工具。像Agilent的ADS、Mentor的HyperLynx以及Cadence的OrCAD和Allegro</p>
<h4 id="SPICE今后的道路"><a href="#SPICE今后的道路" class="headerlink" title="SPICE今后的道路"></a>SPICE今后的道路</h4><p>　　从70年代初到如今的四十多年里，SPICE从只能仿真十几个节点/器件到今天可以仿真上百万个节点/器件的电路，这是一个非常惊人的成就。但这个成就的主要原因是摩尔定律。前面我们讲述过自从90年代中期，SPICE本身就没有太大的变化了。这怪就怪(不，应该是感谢才对)SPICE的先驱们。他们奠定了一个坚实的基础，使得我们后面的人都没什么可做的了。的确，要改变SPICE的基石，例如改进的节点分析法(Modified Nodal Analysis)，稀疏矩阵解法(Sparse Metrix Solver)，牛顿-拉夫逊迭代(Newton-Raphson Iteration)，隐形数值积分(Implicit Numberical Integration)，等等，确实不容易。说到底，SPICE是一个解非线性常微分方程的工具。你要想从根本上有个革命性的改变，那你还是从数学上着手吧。<br>　　SPICE是一个非常通用的工具。虽然集成电路是它的着重点，但我们看到它也被广泛应用到了系统级、电源级甚至延伸到了不同领域的仿真。我们前面讲到了数模混合(Mixed-Signal)，但它还是在电路的范畴内。可不可以把它扩展到其他领域(Mixed-Domain/Multiple Discipline)，比如机械、热力甚至生物领域？答案是可以的。例如，在电路领域中，我们解的是跨过两个节点的电压和通过一个支路的电流。而在机械领域中，我们解的是两个点的位置和力。从早期Saber的MAST语言，到现在的工业标准Verilog-AMS和VHDL-AMS都已经支持不同领域的描述。这就给跨领域的仿真带来了可能。虽然Verilog-AMS还没有被模拟电路设计者广泛采用，但它很可能先从另一个地方发扬光大。比如，微机电系统(MEMS)很有可能是下一个大的应用领域。<br>　　另一方面，虽然SPICE可以解很多类型的电路，但它的运算速度也因此受到了制约。每一种电路都有它自己的特点，比如数字电路信号的离散型，存储器(RAM)结构的重复性，等等。我们可以在SPICE的基础上，利用这些电路的特点来开发特制的“SPICE”以提高仿真的效率。前面说的快速SPICE仿真工具就属于这一类。它们的通用性不如SPICE，但它们针对某一类电路的仿真效率是非常高的。<br>　　最后一方面，我们从SPICE的发展可以清晰的看到，软件的发展是与硬件的发展密不可分的。现在的处理器基本上都是多核、多线程的，新一代的商业SPICE也利用了这些新的处理器架构。最新的图形处理器(GPU)更是达到了上百个核，上万个线程。并行的开发工具像开放计算语言(OpenCL)，CUDA也逐渐成熟。高性能计算(HPC)以及云计算也在日益普及。SPICE能否利用这些新的环境来提高仿真效率呢？呵呵，这个问题就需要你来解答了。<br>下面的图给出了主要SPICE的发展过程。其中的代号如下：</p>
<p><style><br>    tr td,th{<br>        border:2px solid lightgrey;<br>    }<br>    .mt{<br>        border-collapse: collapse;<br>    }
</style></p>
<table class="mt">
    <tr>
        <th>代号</th>
        <td>UCB</td>
        <td>gEDA</td>
        <td>Meta</td>
        <td>SNPS</td>
        <td>μSIM</td>
        <td>CDN</td>
        <td>MENT</td>
    </tr>
    <tr>
        <th>意义</th>
        <td>伯克利</td>
        <td>GNU EDA</td>
        <td>Meta-Software</td>
        <td>Synopsys</td>
        <td>MicroSIM</td>
        <td>Cadence</td>
        <td>Mentor</td>
    </tr>
</table>

<div align="center">
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230904094920.png">
</div>

<p>　　下面的图给出了主要快速仿真工具的发展过程，“+”代表并购。<br>　　注意这些快速仿真工具都是商业化的。目前还没有一个开源的快速仿真工具具有像伯克利SPICE那样广泛的影响力。</p>
<div align="center">
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230904144358.png">
</div>

<p>　　哪里可以找到SPICE仿真模型？<br>　　寻找SPICE模型最好的方法就是去浏览厂商或是制造商的网页。下面列出的是部分最常用的并且在其网站上提供SPICE模型的芯片制造商。<br>|<center>厂商</center>|<center>描述</center>|<br>|——|——|<br>|Analog Devices <img width=420/> |放大器和比较器、AD/DA、嵌入式处理与DSP、MEMS和传感器、RF/IF组件、开关/多路复用器、模拟微控制器、接口、电源与温度管理|<br>|Analog and RF Models|模拟与射频模型|<br>|Apex Microtechnology|线性放大器、PWM放大器|<br>|Christophe Basso|开关电源|<br>|Coilcraft, Inc.|功率磁技术、射频电感、EMI/RFI滤波器、宽带磁技术|<br>|Directed Energy|二极管、开关模式MOSFETs、HF/VHF线性MOSFET、MOSFET驱动IC|<br>|Duncan Amps|放大器、真空管|<br>|Fairchild Semiconductors|放大器与比较器、二极管与整流二极管、接口、数字逻辑设备、信号转换、电压频率转换器、微控制器、光电管、开关、功率控制器、功率驱动器、晶体管、滤波器、稳压器|<br>|Infineon Technologies AG|光纤、微控制器、功率半导体、小型信号离散原件|<br>|International Rectifier|HEXFET功率MOSFET、二极管、桥、晶闸管、继电器、高压IC、只能功率模块、只能功率开关、HiRel功率MOSFETs、HiRel高压门驱动器|<br>|Kemet|含有铝、陶瓷和钽的表面覆盖电容器与含有陶瓷和钽的贴片电容|<br>|Linear Technology|信号调理、数据转换、功率管理、接口、高频率与光学|<br>|Maxim|放大器与比较器、模拟开关与多路复用器、时钟、计数器、继电器线路、振荡器、RTC、数据转换器、采样与保持、数字电势剂、光纤通信、滤波器(模拟)、高频ASIC、热插拔与功率开关、接口与互联、内存：暂时、非暂时、多功能、温度管理、传感器、传感器调理、电压参考、无线、射频与电缆|<br>|National Semiconductor|放大器、功率管理、温度传感器、接口、LVDS、以太网、USB技术、Micro SMD|<br>|ON Semiconductor|功率管理、放大器、比较器、模拟开关、晶闸管、二极管、整流器、双极性晶体管、FET、标准逻辑、差分逻辑|<br>|Philips|模拟/线性、音频、汽车、连接器、数据/媒体/视频处理、离散、显示器、接口与控制、逻辑、微控制器、功率与功率管理、射频、传感器|<br>|Polyfet|Polyfet晶体管|<br>|Protek|瞬态电压抑止|<br>|SMPS Power Supplies|开关电源仿真|<br>|Supertex|混和信号半导体、高压接口产品|<br>|ST Microelectronics|放大器与线性IC、模拟与混和信号IC、二极管、EMI滤波与调理、逻辑、信号开关、内存、微控制器、电源管理、保护设备、传感器、智能卡IC、晶闸管与交流开关、晶体管|<br>|Texas Instruments|缓冲器、驱动器与收发器、触发器、锁存存器、门、计数器、解码器/编码器/多路复用器、数字比较器|<br>|Tyco Electronics(前身Amp)|电磁元件、无源元件、电源、射频与微波产品|<br>|Vishay|模拟开关、电容、二极管、电感、集成模块、功率IC、LED、功率MOSFET、电阻以及热敏电阻的制造商。|<br>|Zetex|直流—直流变换控制器、参考电压源、电流监控、电机控制、Acoustar™声音解决方案、线性稳压器|</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>半导体专业</category>
        <category>EDA工具</category>
      </categories>
      <tags>
        <tag>Spice</tag>
      </tags>
  </entry>
  <entry>
    <title>Sublime Text (Build 4169) 注册方法</title>
    <url>/2023/12/03/Sublime-Text-Build-4169-%E6%B3%A8%E5%86%8C%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>截止2023年12月2日，最新版本是<a href="https://www.sublimetext.com/">Sublime Text 4 (Build 4169)</a>。<br>注册方法如下:</p>
<ul>
<li>安装软件:<ul>
<li>去官方网站下载并安装，<a href="https://www.sublimetext.com/">Sublime Text - Text Editing, Done Right</a></li>
</ul>
</li>
<li>修改sublime的执行文件:<ul>
<li>使用16进制编辑器或打开<a href="https://hexed.it/">https://hexed.it</a></li>
<li>点击“打开文件”打开 Sublime Text 安装目录下的 sublime_text.exe</li>
<li>在右边的“搜索”中输入<code>807805000f94c1</code>并按回车键</li>
<li>将搜索方案中的“启用替换”选中，在“替换为”中输入<code>c64005014885c9</code>即可</li>
<li>点击“另存为”，保存修改后的文件到本地，将文件名设定为 sublime_text.exe</li>
<li>进入安装目录，备份原 sublime_text.exe 文件(如修改为 sublime_text_bak20231202.exe )</li>
<li>将修改后刚刚保存到本地的 sublime_text.exe 复制到原 Sublime Text 4 的安装目录中</li>
</ul>
</li>
</ul>
<span id="more"></span>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20231203005935.png" alt="20231203005935"></p>
<p>如此便成功激活了，可以发现原来标题栏中的 “Unregistered” 变为了 “ADMIN”<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20231203010151.png" alt="20231203010151"></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>Sublime</tag>
      </tags>
  </entry>
  <entry>
    <title>TVBox的安装与使用</title>
    <url>/2024/01/05/TVBox%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<p><a href="/download/TVBox_takagen99_20231231-1656.apk">apk下载</a></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>TVBox</tag>
      </tags>
  </entry>
  <entry>
    <title>VIM学习笔记--状态行</title>
    <url>/2023/12/06/VIM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%8A%B6%E6%80%81%E8%A1%8C/</url>
    <content><![CDATA[<center>状态行参数列表</center>

<div class="table-container">
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(…%)</td>
<td>定义一个项目</td>
</tr>
<tr>
<td>%{n}*</td>
<td>%对其余的行使用高亮显示组<code>User n</code>，知道另一个<code>%n*</code>。数字<code>n</code> 必须从<code>1</code>到<code>9</code>。用<code>%*</code>或<code>%0*</code>可以恢复正常的高亮显示。</td>
</tr>
<tr>
<td>%&lt;</td>
<td>如果状态行过长，在何处换行。缺省是在开头。</td>
</tr>
<tr>
<td>%=</td>
<td>左对齐和右对齐之间的分割点。</td>
</tr>
<tr>
<td>%</td>
<td>字符<code>%</code></td>
</tr>
<tr>
<td>%B</td>
<td>光标下字符的十六进制形式。</td>
</tr>
<tr>
<td>%F</td>
<td>缓冲区的文件完整路径。</td>
</tr>
<tr>
<td>%H</td>
<td>如果为帮助缓冲区则显示为<code>HLP</code>。</td>
</tr>
<tr>
<td>%L</td>
<td>缓冲区中的行数。</td>
</tr>
<tr>
<td>%M</td>
<td>如果缓冲区修改过则显示未<code>+</code>。</td>
</tr>
<tr>
<td>%N</td>
<td>打印机页号。</td>
</tr>
<tr>
<td>%O</td>
<td>以十六进制方式显示文件中的字符偏移。</td>
</tr>
<tr>
<td>%P</td>
<td>文件中光标前的<code>%</code>。</td>
</tr>
<tr>
<td>%R</td>
<td>如果缓冲区只读则为<code>RO</code>。</td>
</tr>
<tr>
<td>%V</td>
<td>列数。如果与<code>%c</code>相同则为空字符。</td>
</tr>
<tr>
<td>%W</td>
<td>如果窗口为预览窗口则为<code>PRV</code>。</td>
</tr>
<tr>
<td>%Y</td>
<td>缓冲区的文件类型，如 vim。</td>
</tr>
<tr>
<td>%a</td>
<td>如果编辑多行文本，这个字行串就是<code>(&#123;current&#125; of &#123;arguments&#125;)</code>，例如: <code>(5 of 18)</code>。如果在命令行中只有一行，这个字符串为空。</td>
</tr>
<tr>
<td>%b</td>
<td>光标下的字符的十进制表示形式。</td>
</tr>
<tr>
<td>%c</td>
<td>列号。</td>
</tr>
<tr>
<td>%f</td>
<td>缓冲区的文件路径。</td>
</tr>
<tr>
<td>%h</td>
<td>如果为帮助缓冲区显示为<code>[Help]</code>。</td>
</tr>
<tr>
<td>%l</td>
<td>行号。</td>
</tr>
<tr>
<td>%m</td>
<td>如果缓冲区已修改则表示为<code>[+]</code>。</td>
</tr>
<tr>
<td>%n</td>
<td>缓冲区号。</td>
</tr>
<tr>
<td>%o</td>
<td>在光标前的字符数(包括光标下的字符)。</td>
</tr>
<tr>
<td>%p</td>
<td>文件中所在行的百分比。</td>
</tr>
<tr>
<td>%r</td>
<td>如果缓冲区为只读则表示为<code>[RO]</code>。</td>
</tr>
<tr>
<td>%t</td>
<td>文件名(无路径)。</td>
</tr>
<tr>
<td>%v</td>
<td>虚列号。</td>
</tr>
<tr>
<td>%w</td>
<td>如果为预览窗口则显示为<code>[Preview]</code>。</td>
</tr>
<tr>
<td>%y</td>
<td>缓冲区的文件类型，如<code>[vim]</code>。</td>
</tr>
<tr>
<td>%{expr}</td>
<td>表达式的结果。</td>
</tr>
</tbody>
</table>
</div>
<span id="more"></span>
<p>例:</p>
<pre><code class="lang-vim">:set statusline=%F%m%r%h%w\ [FORMAT=%&#123;&amp;ff&#125;]\ [TYPE=%Y]\ [POS=%04l,%04v][%p%%]\ [LEN=%L]
</code></pre>
<p>定义显示颜色</p>
<pre><code class="lang-vim">:set statusline=%2*%n%m%r%h%w%*\ %F\ %1*[FORMAT=%2*%&#123;&amp;ff&#125;:%&#123;&amp;fenc!=&#39;&#39;?&amp;fenc:&amp;enc&#125;%1*]\ [TYPE=%2*%Y%1*]\ [COL=%2*%03v%1*]\ [ROW=%2*%03l%1*/%3*%L(%p%%)%1*]\
</code></pre>
<p>自定义高亮显示颜色</p>
<pre><code class="lang-vim">hi User1 guifg=gray
hi User2 guifg=red
hi User3 guifg=white
</code></pre>
<p>还可以通过在<code>.vimrc</code>文件中包括以下命令，使状态行根据状态的不同，显示不同的颜色。</p>
<pre><code class="lang-vim">function! InsertStatuslineColor(mode)
if a:mode == &#39;i&#39;
  hi statusline guibg=peru
elseif a:mode == &#39;r&#39;
  hi statusline guibg=blue
else
  hi statusline guibg=black
endif
endfunction
au InsertEnter * call InsertStatuslineColor(v:insertmode)
au InsertLeave * hi statusline guibg=orange guifg=white
hi statusline guibg=black
</code></pre>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>VIM</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu系统搭建FTP服务器</title>
    <url>/2023/08/07/Ubuntu%E7%B3%BB%E7%BB%9F%E6%90%AD%E5%BB%BAFTP%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    <content><![CDATA[<p><code>Ubuntu发行版本：20.04.6 LTS</code></p>
<h2 id="安装-vsftpd-软件包"><a href="#安装-vsftpd-软件包" class="headerlink" title="安装 vsftpd 软件包"></a>安装 <a href="https://so.csdn.net/so/search?q=vsftpd&amp;spm=1001.2101.3001.7020">vsftpd</a> 软件包</h2><pre><code class="lang-bash">sudo apt-get update
sudo apt-get install vsftp
</code></pre>
<span id="more"></span>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230807224413.png" alt="20230807224413"><br>查看版本确认是否安装成功：<code>vsftpd -v</code><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230807224623.png" alt="20230807224623"></p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>在终端打开vsftpd配置文件：</p>
<pre><code class="lang-bash">sudo vim /etc/vsftpd.conf
</code></pre>
<p>修改配置如下：</p>
<pre><code class="lang-conf">anonymous_enable=NO             #禁止匿名用户
local_enable=YES                #允许本地用户访问
chroot_local_user=YES           #防止FTP用户访问其主目录之外的任何文件
write_enable=YES                #上传与删除文件及文件夹权限

allow_writeable_chroot=YES      #允许用户在FTP根目录下创建和修改文件夹及文件
port_enable=YES                 #开启主动模式
pasv_enable=YES                 #开启被动模式
#设置FTP端口范围，以便在打开了防火墙的情况下开放对应端口
pasv_min_port=39000
pasv_max_port=40000
</code></pre>
<p>保存文件，并重启vsftpd服务，使更改生效。</p>
<pre><code class="lang-bash">sudo systemctl restart vsftpd
</code></pre>
<h2 id="防火墙设置"><a href="#防火墙设置" class="headerlink" title="防火墙设置"></a>防火墙设置</h2><p>如果是VPS要在网页控制面板中开启相应端口。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230808003301.png" alt="20230808003301"><br>防火墙打开FTP服务所需端口号。</p>
<h2 id="添加FTP用户"><a href="#添加FTP用户" class="headerlink" title="添加FTP用户"></a>添加FTP用户</h2><p>创建名为guest的用户并设置密码：</p>
<pre><code class="lang-bash">sudo useradd -d /home/ftp -s /bin/bash guest      #新建ftp用户,-d:指定目录，-s：指定shell
sudo passwd guest       #新建ftp用户密码
</code></pre>
<p>记得要将用户登录所在的文件夹的权限赋予ftp用户，否则无法进行上传和删除。</p>
<h2 id="附录1：主动模式与被动模式的区别"><a href="#附录1：主动模式与被动模式的区别" class="headerlink" title="附录1：主动模式与被动模式的区别"></a>附录1：主动模式与被动模式的区别</h2><h4 id="1-FTP有控制连接和数据连接"><a href="#1-FTP有控制连接和数据连接" class="headerlink" title="1.FTP有控制连接和数据连接"></a>1.FTP有控制连接和数据连接</h4><p>控制连接标准端口为21，用于发送FTP命令信息。<br>数据连接标准端口为20，用于上传、下载数据。<br>FTP协议与其它协议不同之处就在于客户端访问FTP服务器需要建立两个TCP连接，一个用来传输FTP命令，一个用来传输数据。</p>
<h4 id="2-PORT-主动-模式"><a href="#2-PORT-主动-模式" class="headerlink" title="2.PORT(主动)模式"></a>2.PORT(主动)模式</h4><p>所谓主动模式，是指FTP服务器主动去连接客户端的数据端口来传输数据。<br>第一步：客户端提交PORT命令访问服务端的21端口，并分配一个数据端口监听(1027端口)；<br>第二步：服务器返回确认；<br>第三步：FTP服务器向客户端发送TCP连接请求，目标端口为1027，源端口为20。建立起传输数据的连接。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/Port_Mode.jpg" alt="Port_Mode"></p>
<h4 id="3-PASV-被动-模式"><a href="#3-PASV-被动-模式" class="headerlink" title="3.PASV(被动)模式"></a>3.PASV(被动)模式</h4><p>所谓被动模式，是指FTP服务器“被动”等待客户端来连接自己的数据端口。<br>第一步：客户端的命令端口与服务器的命令端口建立连接，并发送命令“PAVS”；<br>第二步：服务器返回命令“PORT 2024”告诉客户端服务器用来监听数据连接的端口；<br>第三步：客户端初始化一个从自己的数据端口到服务器指定的数据端口的数据连接；<br>第四步：服务器给客户端的数据端口返回一个“ACK”响应。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/PASV_Mode.jpg" alt="PASV_Mode"></p>
<h2 id="附录2：vsftpd配置文件翻译"><a href="#附录2：vsftpd配置文件翻译" class="headerlink" title="附录2：vsftpd配置文件翻译"></a>附录2：vsftpd配置文件翻译</h2><pre><code class="lang-conf"># 示例配置文件，地址： /etc/vsftpd.conf
#
# vsftpd的默认编译设置比较谨慎，这个示例文件会放宽一些限制，使ftp服务更加易用。
# 同时建议查看vsftpd.conf.5文件以了解所有编译默认值。
#
# 特别提醒：这个示例文件并不包含vsftpd选项的所有内容，建议阅读vsftpd.conf.5手册页以充分了解vsftpd的功能。
#
#
# 
# 用来设置vsftpd是否以独立守护进程运行。
# 如果设置为&quot;listen=YES&quot;，则表示vsftpd将作为独立守护进程运行；
# 如果设置为&quot;listen=NO&quot;，则表示vsftpd将不会以独立守护进程运行，而是通过inetd或者initscript启动。
listen=NO
#
# 设置vsftpd是否启用IPv6监听。
# 如果设置为&quot;listen_ipv6=YES&quot;，则表示vsftpd将启用IPv6监听；
# 如果设置为&quot;listen_ipv6=NO&quot;，则表示vsftpd将不会启用IPv6监听。
# 默认情况下，IPv6监听地址为&quot;::&quot;，同时可以接受IPv6和IPv4客户端的连接。
# 如果你只需要监听IPv4或IPv6地址，则不需要同时启用两种监听，如果你需要同时监听特定的IPv4和IPv6地址，则需要运行两个vsftpd实例，并使用两个不同的配置文件来进行配置。
listen_ipv6=YES
#
# 设置是否允许匿名FTP登录。
anonymous_enable=NO
#
# 设置是否允许本地用户登录FTP服务器。
local_enable=YES
#
# 设置是否允许FTP用户执行写入操作。
# write_enable=YES
#
# 设置本地用户的默认umask值。
# umask是一个三位八进制数，用来控制新建文件或目录的访问权限。
# 在FTP服务器中，local_umask选项用来设置本地用户上传文件或创建目录时的默认权限。
# 默认情况下，local_umask的值为077，表示新建的文件或目录权限为只有所有者可读、可写、可执行，其他用户无权访问。
# 如果你的用户希望默认权限为所有者可读、可写、可执行，其他用户可读、可执行，则可以将local_umask的值设置为022。
local_umask=022
#
# 设置是否允许匿名FTP用户上传文件。
# 如果将该选项的注释去掉（即将“#”删去），并将其值设置为YES，则表示允许匿名FTP用户上传文件。
# 但是，这个选项只有在全局写入权限被激活时才会生效。此外，你还需要创建一个由FTP用户可写的目录，以便匿名FTP用户可以上传文件。
# 需要注意的是，开启匿名FTP用户上传文件功能可能存在一定的安全风险，因此需要谨慎使用。
# anon_upload_enable=YES
#
# 设置是否允许匿名FTP用户创建新目录。
# 如果将该选项的注释去掉（即将“#”删去），并将其值设置为YES，则表示允许匿名FTP用户创建新目录。
# 需要注意的是，开启匿名FTP用户创建新目录功能可能存在一定的安全风险，因此需要谨慎使用。
# anon_mkdir_write_enable=YES
#
# 这段配置文件是用来设置是否启用目录消息功能。
# 如果设置为YES，则表示启用目录消息功能。当远程用户进入某个目录时，会显示该目录的消息。
dirmessage_enable=YES
#
# 设置是否启用本地时间功能。
# 启用本地时间功能后，vsftpd将会在目录列表中显示本地时间而非GMT时间。
use_localtime=YES
#
# 启用上传和下载日志记录功能。
# 启用该功能后，vsftpd会记录每个用户的上传和下载操作，并将其记录到指定的日志文件中。
xferlog_enable=YES
#
# 设置数据传输的端口号。
# 将其值设置为YES，则表示数据传输使用的端口号为20。
connect_from_port_20=YES
#
# 设置匿名用户上传的文件的所有者。
# 设置为YES，则表示上传的文件将会被转换为指定用户的所有权。
# chown_uploads=YES
# 设置为指定的用户名。
# chown_username=whoever
#
# 设置vsftpd日志文件的路径。该路径必须具有可写权限，并且对于vsftpd进程来说，必须具有可访问权限。
# xferlog_file=/var/log/vsftpd.log
#
# 设置vsftpd日志文件的格式。设备为YES则存储为标准ftpd xferlog格式。
# xferlog_std_format=YES
#
# 设置vsftpd空闲会话超时的时间（以秒为单位）。
# idle_session_timeout=600
#
# 设置vsftpd数据连接超时的时间（以秒为单位）。
# data_connection_timeout=120
#
# vsftpd建议在系统中定义一个唯一的用户，供FTP服务器使用，作为完全隔离和无特权的用户。
# nopriv_user选项可以用来指定该用户的用户名。
# nopriv_user=ftpsecure
#
# 用于启用异步ABOR请求的识别。
# 异步ABOR请求是一种FTP客户端请求，用于取消当前正在进行的数据传输操作。
# 启用该选项可以提高FTP服务器的性能，但也会增加安全风险。因为异步ABOR请求的代码比较复杂，可能会被黑客利用进行恶意攻击。
# 所以，如果安全性是首要考虑因素，则不建议启用该选项。
# async_abor_enable=YES
#
# 用于控制FTP服务器是否启用ASCII模式下的文件转换功能。
# 默认情况下，FTP服务器会假装允许ASCII模式，但实际上会忽略该请求。
# 如果需要启用ASCII模式下的文件转换功能，则可以将ascii_upload_enable和ascii_download_enable选项的注释去掉，并将它们的值设置为YES。
# 在ASCII模式下，FTP服务器会将文本文件中的换行符和回车符进行转换，以便在不同操作系统之间进行传输。
# 但是，需要注意的是，ASCII模式下可能存在一些安全风险。例如，攻击者可以利用SIZE命令在ASCII模式下发送一个超大文件名，导致FTP服务器崩溃。
# 因此，建议谨慎使用ASCII模式，并确保FTP服务器已经做好了相应的安全措施。
# ascii_upload_enable=YES
# ascii_download_enable=YES
#
# vsftpd的登录横幅的设置，你可以理解为登录成功后的欢迎词。
# ftpd_banner=Welcome to blah FTP service.
#
# 设备是否拒绝匿名电子邮件地址
# 有助于减轻利用匿名访问FTP服务器进行的拒绝服务（DoS）攻击。如果检测到被禁止的电子邮件地址，服务器将拒绝该用户的访问。
# deny_email_enable=YES
# 如果启用了拒绝匿名电子邮件地址的选项，则通过从指定的文件“/etc/vsftpd.banned_emails”读取被禁止的电子邮件地址列表。
# banned_email_file=/etc/vsftpd.banned_emails
#
# 设备限制本地用户仅访问其home目录。
# 如果启用，则本地用户将仅访问其home目录和其子目录，无法访问其他目录。
# chroot_local_user=YES
#
# 是否允许本地用户，是否将本地用户限制在其主目录中，如果设置为YES，则不会将列在chroot_list_file中的用户限制在其主目录中。
# chroot_local_user=YES
# 是否启用chroot_list_file列表，用于指定哪些用户不应该被限制在主目录中。
# chroot_list_enable=YES
# 指定了chroot_list_file列表的路径和名称。一行一个用户名。
# chroot_list_file=/etc/vsftpd.chroot_list
#
# 否启用ls命令的递归选项“-R”，该选项可以在列出目录内容时递归地列出子目录。
# 默认情况下，该选项被禁用以避免远程用户在大型站点上引起过多的I/O。
# ls_recurse_enable=YES
#
# 自定义配置：
#
# 指定了一个空目录作为安全chroot() jail。
# 在某些情况下，vsftpd不需要访问文件系统，因此可以将FTP用户限制在这个空目录中，以增强安全性。该目录应该为空，并且不应该被FTP用户写入。
secure_chroot_dir=/var/run/vsftpd/empty
#
# 指定vsftpd将使用的PAM服务的名称。
# 默认情况下，pam_service_name的值为“vsftpd”，这意味着vsftpd将使用名为“vsftpd”的PAM服务来进行认证。
# 如果需要使用其他的PAM服务，可以修改该选项的值。
pam_service_name=vsftpd
#
# 用于指定在SSL加密连接中使用的RSA证书的位置。
# 通过设置rsa_cert_file和rsa_private_key_file选项来指定RSA证书和私钥的位置。
# 其中，rsa_cert_file选项用于指定证书文件的位置，而rsa_private_key_file选项用于指定私钥文件的位置。
rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key
# 是否启用SSL加密连接。
ssl_enable=NO
#
# 指定是否在vsftpd中使用UTF-8编码的文件系统。
# utf8_filesystem=YES
</code></pre>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>FTP</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows11 激活方法</title>
    <url>/2024/02/26/Windows11-%E6%BF%80%E6%B4%BB%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>今天将笔记本自带的 win11 家庭版升级到专业版时无意中在知乎中找到了一个方法，一试还真的有效，因为远程运行了一个网站的程序，不知道自己的电脑是不是成为别人的肉鸡了，但是激活方式确实是有效的。风险性后面再研究吧。<br><span id="more"></span></p>
<h3 id="两个激活秘钥"><a href="#两个激活秘钥" class="headerlink" title="两个激活秘钥"></a>两个激活秘钥</h3><pre><code class="lang-J8WVF-9X3GM-4WVYC-VDHQG-42CXT```">```7Y64F-88DCY-Y6WTC-H33D2-64QHF
</code></pre>
<p>我使用的是第一个，第二个是否有效没有验证。</p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><ol>
<li>右键“此电脑”，依次点击“属性” =&gt; “产品秘钥和激活” =&gt; “更改产品秘钥”，输入上述秘钥；</li>
<li>win + R，输入powershell，回车。在弹窗中输入命令:<code>irm massgrave.dev/get.ps1 | iex</code></li>
<li>会弹出下面的窗口<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240226105515.png" alt="20240226105515"><br>简单解释一下: 按1，Windows永久激活；按2，office永久激活；按3，Windows激活到2038年；按4，180天的kms激活工具；……</li>
<li>然后重复1就会看到“已激活”字样。</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>Work Logs--20240130</title>
    <url>/2024/01/30/Work-Logs-20240130/</url>
    <content><![CDATA[<h2 id="完成项"><a href="#完成项" class="headerlink" title="完成项"></a>完成项</h2><ol>
<li>VOL_GEN3电路功能分析:</li>
<li>POWER_SEL_CTRL逻辑分析</li>
<li>部分电源域及启动时序分析<ul>
<li>VIN启动 =&gt; VDD_1和VDD_2紧跟着启动(不需要EN信号的使能)，但启动不完全；</li>
<li>EN=H =&gt; C144_PLUS(VOL_GEN3的输出也是BG模块的电源)启动 =&gt; BG输出开始启动，初始阶段只有0.8V(大约持续100us，参数待调)左右，之后缓慢上升 =&gt; 稳定于1.2V之后BG输出GOOD信号并配置VLO_GEN3使其完全启动；</li>
<li>逻辑部分EN起主导作用，并在DC内部穿插多个模块，需要整理；</li>
<li>非EN控制直接启动部分需列表。</li>
</ul>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240131101346.png" alt="20240131101346"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240131101405.png" alt="20240131101405"></p>
<h2 id="次日计划"><a href="#次日计划" class="headerlink" title="次日计划"></a>次日计划</h2><p>按照正常启动时POWER_SEL的控制逻辑A0A1时序 00=&gt;10=&gt;11 来进行内部参数调整，争取完成此模块的设计。</p>
<ul>
<li>注: A0A1 无 01 逻辑，因为 EN=H 后 A0 马上变 H，而 A1 则需要等到 BG 模块的输出 GOOD 信号变 H，EN=L 时 BG 模块不允许启动。</li>
</ul>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>半导体专业</category>
        <category>模拟电路</category>
      </categories>
      <tags>
        <tag>开关电源</tag>
      </tags>
  </entry>
  <entry>
    <title>smic工艺中带有ckt后缀的器件</title>
    <url>/2023/12/08/smic%E5%B7%A5%E8%89%BA%E4%B8%AD%E5%B8%A6%E6%9C%89ckt%E5%90%8E%E7%BC%80%E7%9A%84%E5%99%A8%E4%BB%B6/</url>
    <content><![CDATA[<p>在SMIC的PDK中存在后面带ckt和不带ckt的PDK，其中不带ckt的器件模型是bsim4，而带ckt的器件模型是subckt。网上查询，subckt就是sub circuit，即子电路的意思。<br>查询并猜想如下:<br>不带ckt: 类理想器件，即只针对此种器件建模；<br>带ckt: 考虑其内部构造所产生的各种寄生成分，并且包含寄生器件参数随电路参数的变化</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>半导体专业</category>
        <category>Fab</category>
      </categories>
      <tags>
        <tag>PDK</tag>
      </tags>
  </entry>
  <entry>
    <title>《我叫赵甲第》片尾名言及经典台词</title>
    <url>/2023/08/19/%E3%80%8A%E6%88%91%E5%8F%AB%E8%B5%B5%E7%94%B2%E7%AC%AC%E3%80%8B%E7%89%87%E5%B0%BE%E5%90%8D%E8%A8%80/</url>
    <content><![CDATA[<h1 id="片尾名言"><a href="#片尾名言" class="headerlink" title="片尾名言"></a>片尾名言</h1><h4 id="第1集"><a href="#第1集" class="headerlink" title="第1集"></a>第1集</h4><blockquote>
<p>生活的道路是自由美好的，可是我们迷了路，贪婪毒害了任性，用仇恨分割了世界。</p>
<p><p align="right"> ——查理·卓别林《大独裁者》</p>
<h4 id="第2集"><a href="#第2集" class="headerlink" title="第2集"></a>第2集</h4><p>一切都是瞬息，一切都将会过去，而那过去了的，就会成为亲切的怀恋。</p>
<p><p align="right"> ——亚历山大·普希金《假如生活欺骗了你》</p>
<h4 id="第3集"><a href="#第3集" class="headerlink" title="第3集"></a>第3集</h4><p>我姑且举灰黑的手装作喝干一杯酒，我将在不知道时候的时候独立远行。</p>
<p><p align="right"> ——鲁迅《野草》</p>
<h4 id="第4集"><a href="#第4集" class="headerlink" title="第4集"></a>第4集</h4><p>一旦走进深处，人与人就是相互的迷宫。</p>
<p><p align="right"> ——史铁生《活出爱》<br><span id="more"></span></p>
<h4 id="第5集"><a href="#第5集" class="headerlink" title="第5集"></a>第5集</h4><p>爱情是叹息吹起的一阵烟。</p>
<p><p align="right"> ——威廉·莎士比亚《罗密欧与朱丽叶》</p>
<h4 id="第6集"><a href="#第6集" class="headerlink" title="第6集"></a>第6集</h4><p>当我猜到谜底，才发现，一切都已过去，岁月早已换了谜题。</p>
<p><p align="right"> ——席慕蓉《谜题》</p>
<h4 id="第7集"><a href="#第7集" class="headerlink" title="第7集"></a>第7集</h4><p>即使一切都已发生过，我也习惯了，不再流泪。</p>
<p><p align="right"> ——舒婷《路遇》</p>
<h4 id="第8集"><a href="#第8集" class="headerlink" title="第8集"></a>第8集</h4><p>孤独的人有他们自己的泥沼。</p>
<p><p align="right"> ——张爱玲《年轻的时候》</p>
<h4 id="第9集"><a href="#第9集" class="headerlink" title="第9集"></a>第9集</h4><p>有生命的种子绝不会悲观、叹气，它相信有了阻力才有磨炼。</p>
<p><p align="right"> ——夏衍《种子的力》</p>
<h4 id="第10集"><a href="#第10集" class="headerlink" title="第10集"></a>第10集</h4><p><b><font color="red">我们飞翔得越高，我们在那些不能飞翔得人眼中的形象越是渺小。</font></b></p>
<p><p align="right"> ——费里德里希·尼采《查拉图斯特拉如是说》</p>
<h4 id="第11集"><a href="#第11集" class="headerlink" title="第11集"></a>第11集</h4><p>纵使黑暗吞噬了一切，太阳还可以重新回来。</p>
<p><p align="right"> ——汪国真《只要明天还在》</p>
<h4 id="第12集"><a href="#第12集" class="headerlink" title="第12集"></a>第12集</h4><p>我们的心是一座宝库，一下子倒空了，就会破产。</p>
<p><p align="right"> ——奥诺雷·德·巴尔扎克《高老头》</p>
<h4 id="第13集"><a href="#第13集" class="headerlink" title="第13集"></a>第13集</h4><p><b><font color="red">人总是倾向于把自己生活的小圈子看作是世界的中心，并把自己特殊的个人生活当做宇宙的法则。</font></b></p>
<p><p align="right"> ——恩斯特·卡希尔《人论》</p>
<h4 id="第14集"><a href="#第14集" class="headerlink" title="第14集"></a>第14集</h4><p>从前有个古老的故事，一个猎人得到了无上的光荣和尊严，但他却长时间遇到极大的困难和生命的危险。</p>
<p><p align="right"> ——汉斯·安徒生《光荣的荆棘路》</p>
<h4 id="第15集"><a href="#第15集" class="headerlink" title="第15集"></a>第15集</h4><p>弓在紧张状态的顶点马上将直射出，最沉重而又最自由的一箭。</p>
<p><p align="right"> ——阿尔贝·加缪《适度与过度》</p>
<h4 id="第16集"><a href="#第16集" class="headerlink" title="第16集"></a>第16集</h4><p>我想无论是写作还是人生，正确的出发都是走进窄门，不要被宽阔的大门所迷惑，那里面的路没有多长。</p>
<p><p align="right"> ——余华《兄弟》</p>
<h4 id="第17集"><a href="#第17集" class="headerlink" title="第17集"></a>第17集</h4><p>未来不同于过去之处，在于它明确地留给人类充足的选择和行动的空间。</p>
<p><p align="right"> ——齐格蒙特·鲍曼《自由》</p>
<h4 id="第18集"><a href="#第18集" class="headerlink" title="第18集"></a>第18集</h4><p>要像一座卓立的塔，绝不因为暴雨而倾斜。</p>
<p><p align="right"> ——但丁·阿利吉耶里《神曲》</p>
<h4 id="第19集"><a href="#第19集" class="headerlink" title="第19集"></a>第19集</h4><p>你看不见你自己，你看见的只是你的影子。</p>
<p><p align="right"> ——泰戈尔《飞鸟集》</p>
<h4 id="第20集"><a href="#第20集" class="headerlink" title="第20集"></a>第20集</h4><p>君子成人之美，不成人之恶，小人反是。</p>
<p><p align="right"> ——孔子《论语》</p>
<h4 id="第21集"><a href="#第21集" class="headerlink" title="第21集"></a>第21集</h4><p>唯一能自慰的是，我们曾真诚而充满激情地在这个世界上生活过，竭尽全力的劳动过，并不计代价地将自己的血汗献给了不死的人类之树。</p>
<p><p align="right"> ——路遥《平凡的世界》</p>
<h4 id="第22集"><a href="#第22集" class="headerlink" title="第22集"></a>第22集</h4><p>一个不成熟的人的标志，是他愿意为了某个理由而轰轰烈烈的死去；而一个成熟的人的标志，是他愿意为了某个理由而谦恭的活下去。</p>
<p><p align="right"> ——杰罗姆·塞林格《麦田里的守望者》</p>
<h4 id="第23集"><a href="#第23集" class="headerlink" title="第23集"></a>第23集</h4><p>忘却了的梦，日后也无法重温。</p>
<p><p align="right"> ——川端康成《千只鹤》</p>
<h4 id="第24集"><a href="#第24集" class="headerlink" title="第24集"></a>第24集</h4><p>死并非生的对立面，而是作为生的一部分永存。</p>
<p><p align="right"> ——村上春树《挪威的森林》</p>
<h4 id="第25集"><a href="#第25集" class="headerlink" title="第25集"></a>第25集</h4><p>天亮的日子多着呢，太阳不过是一个晓星。</p>
<p><p align="right"> ——亨利·梭罗《瓦尔登湖》</p>
<h4 id="第26集"><a href="#第26集" class="headerlink" title="第26集"></a>第26集</h4><p>沙漠很美，是因为有个地方藏着一口井。</p>
<p><p align="right"> ——安托万·埃克苏佩里《小王子》</p>
<h4 id="第27集"><a href="#第27集" class="headerlink" title="第27集"></a>第27集</h4><p>我相信那一切都是种子，只有经过埋葬，才有生机。</p>
<p><p align="right"> ——顾城《给我的尊师安徒生》</p>
<h4 id="第28集"><a href="#第28集" class="headerlink" title="第28集"></a>第28集</h4><p>一个人自身能够成为什么样的人，取决于他在生命旅途中所遭遇到的他人以及召唤着他的信念。</p>
<p><p align="right"> ——卡尔·雅斯贝尔斯《时代的精神状况》</p>
<h4 id="第29集"><a href="#第29集" class="headerlink" title="第29集"></a>第29集</h4><p>生命对每个人都提出了问题，他必须通过对自己生命的理解来回答生命的提问。</p>
<p><p align="right"> ——维克多·弗兰克尔《活出生命的意义》</p>
<h4 id="第30集"><a href="#第30集" class="headerlink" title="第30集"></a>第30集</h4><p>人们所走的道路会预示某种结局。这就是说，如果他们坚持走他们的道路，他们就一定会到达那种结局。</p>
<p><p align="right"> ——查尔斯·狄更斯《圣诞颂歌》</p>
</blockquote>
<h1 id="经典台词"><a href="#经典台词" class="headerlink" title="经典台词"></a>经典台词</h1><blockquote>
<p><b><font color="red">人必有所执，方能有所成。</font></b></p>
</blockquote>
<p>说说为什么抽烟，为了等一个劝我戒烟的女人。</p>
<blockquote>
<p>争取不要错过谁，错过的，就尽量去祝福。</p>
</blockquote>
<p>人生为棋我为卒，行动虽慢，命运多舛，可谁曾见我后腿半步？</p>
<blockquote>
<p>一个人在山脚喊得再起劲，山腰和山头上的人都懒得理会。</p>
</blockquote>
<p>耿直其实很多时候也是一种变相的圆融，成本低，收益却不低，是聪明人才知道的诀窍。</p>
<blockquote>
<p>多读书，是腹有诗书气自华，看人待物能多几分透彻；多识人，是以人为镜，能够多自省自知。</p>
</blockquote>
<p>任何一个好的作品，都只是作者在讲一个故事。任何一部被后来者冠上伟大的作品，都是一群好事者在挖掘作者自己都不懂的东西。</p>
<blockquote>
<p>如果你是一个好人，那你也要知道世上总有没你好的坏人，你得保护好自己。不能把所有人都想象得太美好。付出没有回报，好心被误解，都不要对生活失去信心。<br>如果你是一个坏人，那你也要相信世上总有一种东西叫良心，要相信报应。<br>如果你是一个男人，就要知道女人的善良，珍惜她们的青春。<br>如果你是一个女人，就要懂得男人的不易，理解他们的奔波。<br>如果你是一个孩子，期待着精彩人生，请不要急着长大。<br>如果你是一个老人，见多了风霜险恶，请不要把慈悲麻木。<br>如果你是一个功成名就的夫人，请尊重人生。</p>
</blockquote>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>文学爱好</category>
        <category>名言名句</category>
      </categories>
      <tags>
        <tag>影视剧名言</tag>
      </tags>
  </entry>
  <entry>
    <title>使用curl命令行工具查询本地公网IP地址</title>
    <url>/2024/02/04/%E4%BD%BF%E7%94%A8curl%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E6%9F%A5%E8%AF%A2%E6%9C%AC%E5%9C%B0%E5%85%AC%E7%BD%91IP%E5%9C%B0%E5%9D%80/</url>
    <content><![CDATA[<p>在 Linux 中 curl 是一个利用 URL 规则在命令行下工作的文件传输工具，同时也可以查询本机公网 IP 地址，具体使用方法如下:<br><span id="more"></span></p>
<ol>
<li>使用<code>curl ipinfo.io</code>查询:<br><pre>curl ipinfo.io</pre><br>返回值<pre><code class="lang-bash"> [root@MiWiFi-R3D-srv ~]# curl ipinfo.io
&#123;
 &quot;ip&quot;: &quot;1.203.179.218&quot;,// 此处是本机公网ip地址
 &quot;city&quot;: &quot;Beijing&quot;,// 城市名
 &quot;region&quot;: &quot;Beijing&quot;,// 区域名
 &quot;country&quot;: &quot;CN&quot;,// 国家代号
 &quot;loc&quot;: &quot;39.9075,116.3972&quot;,// 经纬度坐标
 &quot;org&quot;: &quot;AS4847 China Networks Inter-Exchange&quot;,// 运营商信息
 &quot;timezone&quot;: &quot;Asia/Shanghai&quot;,// 时区
 &quot;readme&quot;: &quot;https://ipinfo.io/missingauth&quot;//提示ipinfo.io官网地址
&#125;
</code></pre>
</li>
<li>使用<code>curl ifconfig.me</code>查询<br><pre>curl ifconfig.me</pre><br>返回值<pre><code class="lang-bash">[root@MiWiFi-R3D-srv ~]# curl ifconfig.me
1.203.179.218 //只显示本机公网IP地址
[root@MiWiFi-R3D-srv ~]#
</code></pre>
</li>
<li>使用<code>ipinfo.io</code>加<code>ip</code>地址，可查血这个 ip 的信息<br><pre>curl ipinfo.io/192.168.32.84</pre><br>返回值<pre><code class="lang-bash"> [root@MiWiFi-R3D-srv ~]# curl  ipinfo.io/103.208.15.138
&#123;
 &quot;ip&quot;: &quot;103.208.15.138&quot;,//被查询的IP地址
 &quot;city&quot;: &quot;Beijing&quot;,//所属城市
 &quot;region&quot;: &quot;Beijing&quot;,//所属区域
 &quot;country&quot;: &quot;CN&quot;,//国家代码
 &quot;loc&quot;: &quot;39.9075,116.3972&quot;,//经纬度坐标
 &quot;org&quot;: &quot;AS9808 China Mobile Communications Group Co., Ltd.&quot;,//运营商信息
 &quot;timezone&quot;: &quot;Asia/Shanghai&quot;,//时区
 &quot;readme&quot;: &quot;https://ipinfo.io/missingauth&quot;//ipinfo.io官网地址
&#125;
</code></pre>
</li>
<li>此命令在 Windows 的命令提示符中也可以使用<br>使用方法如下:<pre><code class="lang-cmd"> C:\Users\User&gt;curl ipinfo.io
&#123;
 &quot;ip&quot;: &quot;1.203.179.218&quot;,
 &quot;city&quot;: &quot;Beijing&quot;,
 &quot;region&quot;: &quot;Beijing&quot;,
 &quot;country&quot;: &quot;CN&quot;,
 &quot;loc&quot;: &quot;39.9075,116.3972&quot;,
 &quot;org&quot;: &quot;AS4847 China Networks Inter-Exchange&quot;,
 &quot;timezone&quot;: &quot;Asia/Shanghai&quot;,
 &quot;readme&quot;: &quot;https://ipinfo.io/missingauth&quot;
&#125;
</code></pre>
</li>
<li>最简单的是使用 <a href="https://ip138.com/">https://ip138.com/</a> 网址进行本机公网IP地址查询<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240204101450.png" alt="20240204101450"></li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>使用命令行抽取寄生(Calibre)</title>
    <url>/2023/12/03/%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%8A%BD%E5%8F%96%E5%AF%84%E7%94%9F-Calibre/</url>
    <content><![CDATA[<pre><code>% calibre -lvs -hier -auto rule.file
% calibre -xrc -pdb -rcc -xcell cell.file rule.file
% calibre -xrc -fmt -all -xcell cell.file rule.file
</code></pre><p>rule.file 中应指定layout(gds)的路径及文件名<br><a href="https://www.engr.colostate.edu/ECE571/class_materials/xcalibre_instructions.htm">Instructions for Extracting Parasitics for your Layout using xCalibre Tool</a></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>半导体专业</category>
        <category>EDA工具</category>
      </categories>
      <tags>
        <tag>Calibre</tag>
      </tags>
  </entry>
  <entry>
    <title>使用端口映射实现局域网内打印机远程打印</title>
    <url>/2024/03/12/%E4%BD%BF%E7%94%A8%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E5%AE%9E%E7%8E%B0%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85%E6%89%93%E5%8D%B0%E6%9C%BA%E8%BF%9C%E7%A8%8B%E6%89%93%E5%8D%B0/</url>
    <content><![CDATA[<p>打印机是现在办公设备必不可少的工具，我们常常需要使用打印机复印或打印各种文件资料，尤其对一些正在加班且不能在家陪伴孩子写作业的父母来说，学会远程打印的方法十分必要。<br>打印机种类: 激光打印机<br>打印机型号: DCP-B7520DW<br>目前这款打印机不支持远程打印，所以需要将打印端口映射到外网才能实现远程打印。<br>局域网内电脑系统: Windows 10<br>远程打印电脑系统: Windows 11<br><span id="more"></span><br>电脑进行远程打印可以用一下两种方法:</p>
<ol>
<li>使用zerotier将主路由加入到虚拟局域网中，这样家中所有设备都可以通过虚拟局域网进行访问，此种方式如能将手机也加入到zerotier的虚拟局域网中亦可以实现手机端的远程打印。</li>
<li>将打印机数据传输端口通过路由器进行端口映射来实现，此种方法目前还未能实现手机端的远程打印。<br>下面详细讲述第2中方法的实现步骤:<h4 id="一、设置映射"><a href="#一、设置映射" class="headerlink" title="一、设置映射"></a>一、设置映射</h4>首先保证局域网内能正常打印，进入<strong>控制面板</strong>——<strong>设备和打印机</strong>；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312160611.png" alt="20240312160611"><br>找到对应的打印机，右键<strong>打印机属性</strong>；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312160725.png" alt="20240312160725"><br>选择<strong>端口</strong>，找到对应的打印机，点击<strong>配置端口</strong>；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312160925.png" alt="20240312160925"><br>查看打印机的IP地址和端口号；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312161050.png" alt="20240312161050"><br>这个地方有一个问题，我的打印机原来默认是LPR协议，端口应该是515；现在我将它改成的Raw协议，Raw协议默认使用9100，9101，9102端口，这里选择默认的9100端口。<br>然后将你所使用的端口，这里是9100通过路由器的设置映射到外网，我家里使用的是华为的AX3 Pro路由器，设置界面如下，外部端口填写你想设置的端口即可(1~65535):<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312161449.png" alt="20240312161449"><br>点击保存即设置成功。<h4 id="二、远程打印电脑的设置"><a href="#二、远程打印电脑的设置" class="headerlink" title="二、远程打印电脑的设置"></a>二、远程打印电脑的设置</h4>点击<strong>开始</strong>——<strong>设置</strong>——选择<strong>蓝牙和其他设备</strong>——点击<strong>打印机和扫描仪</strong><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312162315.png" alt="20240312162315"><br>点击<strong>打印机和扫描仪</strong>——点击<strong>添加设备</strong><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312162447.png" alt="20240312162447"><br>点击<strong>手动添加</strong>——选择<strong>通过手动设置添加本地打印机或网络打印机</strong>，<strong>下一步</strong>；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312162952.png" alt="20240312162952"><br>选择<strong>创建新端口</strong>，端口类型选择<strong>Standard TCP/IP Port</strong>，下一步；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312163246.png" alt="20240312163246"><br><strong>主机名或IP地址</strong>和<strong>端口名称</strong>，填写自己的公网IP或域名地址。(由于现在供应商提供的公网IP是会变的，所以建议使用DDNS在此处填写自己的DDNS域名。)<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312164131.png" alt="20240312164131"><br>设置类型选择<strong>自定义</strong>，点击<strong>设置</strong>，<strong>原始设置</strong>里的<strong>端口号</strong>填入上面映射到外网的外部端口号，<strong>确定</strong>然后<strong>下一步</strong>；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312165944.png" alt="20240312165944"><br>然后就是安装驱动程序，点击<strong>从磁盘安装</strong>，<strong>制造商文件复制来源</strong>选择对应打印机驱动的安装目录里，这里要求选择<code>.inf</code>文件。<br>我这边驱动目录下的路径是<code>D:\51_Installer\DCP-B7520DW\Y17C_C1_ULWL_PP-inst-H1\xmlpaper\BRXM17A.INF</code><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312171646.png" alt="20240312171646"><br>根据我的打印机型号，选择<code>Brother DCP-B7520DW XML Paper1</code>。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312172309.png" alt="20240312172309"><br>选择<strong>替换当前的驱动程序</strong>，下一步，<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312172405.png" alt="20240312172405"><br>给打印机自定义一个名字，下一步；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312174733.png" alt="20240312174733"><br>选择<strong>不共享这台打印机</strong>，下一步；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240312174819.png" alt="20240312174819"><br>点击<strong>完成</strong>。也可以打印测试页看是否成功。</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>远程打印</tag>
      </tags>
  </entry>
  <entry>
    <title>关于半导体工艺中电容器件</title>
    <url>/2024/02/01/%E5%85%B3%E4%BA%8E%E5%8D%8A%E5%AF%BC%E4%BD%93%E5%B7%A5%E8%89%BA%E4%B8%AD%E7%94%B5%E5%AE%B9%E5%99%A8%E4%BB%B6/</url>
    <content><![CDATA[<p>半导体设计中常用的电容有: MIM, MOM, Varactor, NCAP, N/P MOS<br><span id="more"></span></p>
<h3 id="MIM"><a href="#MIM" class="headerlink" title="MIM"></a>MIM</h3><p>MIM 电容是利用异层金属制备:</p>
<ol>
<li>是使用特殊H -K 材料制作的高密度电容，比较薄，耐击穿性不好，比较贵，增加了新的工艺，需要额外的 mask(MIM 层间金属介质层)。</li>
<li>逻辑电路中本身存在较多的金属层，可以将奇数层金属连接在一起，偶数层金属连接在一起，形成层间 MIM 电容，但是层间距离比较大，一次电容密度比较小。</li>
<li>寄生电容大。</li>
</ol>
<h3 id="MOM"><a href="#MOM" class="headerlink" title="MOM"></a>MOM</h3><p>同层金属插指形成:</p>
<ol>
<li>比较占面积；</li>
<li>容值高；</li>
<li>工艺兼容，单独划分区域即可；</li>
<li>寄生电容小；</li>
<li>28nm 以下工艺固定使用 MOM 。</li>
</ol>
<h3 id="Varactor"><a href="#Varactor" class="headerlink" title="Varactor"></a>Varactor</h3><p>Poly-oxide-NWell，S/D NP+ 作为bulk，是一种电压控制的电容，电容是反偏积累工作状态，其电容与电压的关系完全取决于 NWell 掺杂浓度梯度，工艺难度较大。<br>Varactor 一般操作在 accumulation (积累)区，C-V 曲线较线性，常用在需要电压调整电容的控制回路中。</p>
<p>在 Psub 的工艺中，Varactor 和 NCAP 是坐在 NWell 中，S/D 是 N+ 重掺杂作为BULK，当 GATE 和 BULK 压差越大时，沟道积累负电荷越多，相当于 GATE 和 BULK 这两个极板离得越近，电容越大。</p>
<h3 id="NCAP"><a href="#NCAP" class="headerlink" title="NCAP"></a>NCAP</h3><h3 id="N-P-MOS-Poly-cap"><a href="#N-P-MOS-Poly-cap" class="headerlink" title="N/P MOS(Poly cap)"></a>N/P MOS(Poly cap)</h3><p>MOS 电容，对比 Varactor NWell 情况，Poly Cap 使用 PMOS。所以 S/D 使用 PP+ 而不是 NP+。<br>MOS Cap 一般操作在 inversion (反型)区， C-V 曲线不线性且陡峭，通常用在固定 Gate Voltage 做稳压电容。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>半导体专业</category>
        <category>模拟电路</category>
      </categories>
      <tags>
        <tag>器件</tag>
      </tags>
  </entry>
  <entry>
    <title>几种功率管</title>
    <url>/2023/08/17/%E5%87%A0%E7%A7%8D%E5%8A%9F%E7%8E%87%E7%AE%A1/</url>
    <content><![CDATA[<h2 id="DMOS：Double-Diffused-MOS"><a href="#DMOS：Double-Diffused-MOS" class="headerlink" title="DMOS：Double-Diffused MOS"></a>DMOS：Double-Diffused MOS</h2><h2 id="VDMOS：Virtical-DMOS"><a href="#VDMOS：Virtical-DMOS" class="headerlink" title="VDMOS：Virtical DMOS"></a>VDMOS：Virtical DMOS</h2><p>垂直扩散DMOS，VDMOS的漏极在硅片背面，沟道在两个维度上包围源极，所以叫“垂直”，实际上栅极依然是水平的。VDMOS是PowerMOS（大功率MOS器件）的一种，通过垂直设计减小沟道场强，可以使短沟道承受很高的电压和电流。<br>缺点是漏极要从背面引出，很难用和主流集成电路工艺兼容。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230817223815.png" alt="20230817223815"><br>这种结构可以减小漏电流并提高开关速度，具有低导通电阻、高电压承受能力和低开关损耗的优点。它在功率电子器件中广泛应用，如逆变器、直流-直流转换器和交流电机驱动器等。主要缺点是存在体效应和漏电流，且制造过程较为复杂。<br><span id="more"></span></p>
<h2 id="LDMOS：Lateral-DMOS，常用于高电压大电流电路。"><a href="#LDMOS：Lateral-DMOS，常用于高电压大电流电路。" class="headerlink" title="LDMOS：Lateral DMOS，常用于高电压大电流电路。"></a>LDMOS：Lateral DMOS，常用于高电压大电流电路。</h2><p>水平扩散DMOS，也是PowerMOS的一种，和VDMOS的区别是去掉了背部的漏极引出，方便兼容其它工艺(CMOS工艺)，和其他集成电路整合在同一块芯片上。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230817224559.png" alt="20230817224559"><br>可以看到LDMOS把背部的Drain引出挪到了右边，代价是相对VDMOS面积变大了。<br>LDMOS具有高电压承受能力和低导通电阻的优点。LDMOS主要应用于高频功率放大器、天线开关和发射机等领域。LDMOS的主要缺点是存在漏电流和温度效应，且不适用于高速开关应用。<br>LDMOS由于更容易与CMOS工艺兼容而被广泛采用。LDMOS器件结构如上图所示，是一种双扩散结构的功率器件。这项技术是在相同的源/漏区域注入两次，一次注入浓度较大（典型注入剂量 1015cm-2）的砷（As），另一次注入浓度较小（典型剂量1013cm-2）的硼（B）。注入之后再进行一个高温推进过程，由于硼扩散比砷快，所以在栅极边界下会沿着横向扩散更远（上图中P阱），形成一个有浓度梯度的沟道，它的沟道长度由这两次横向扩散的距离之差决定。为了增加击穿电压，在有源区和漏区之间有一个漂移区。LDMOS中的漂移区是该类器件设计的关键，漂移区的杂质浓度比较低，因此，当LDMOS 接高压时，漂移区由于是高阻，能够承受更高的电压。图1所示LDMOS的多晶扩展到漂移区的场氧上面，充当场极板，会弱化漂移区的表面电场，有利于提高击穿电压。场极板的作用大小与场极板的长度密切相关。要使场极板能充分发挥作用，一要设计好SiO2层的厚度，二要设计好场极板的长度。</p>
<h2 id="DEMOS：Drain-Extended-MOS，常用于高电压小电流电路。"><a href="#DEMOS：Drain-Extended-MOS，常用于高电压小电流电路。" class="headerlink" title="DEMOS：Drain-Extended MOS，常用于高电压小电流电路。"></a>DEMOS：Drain-Extended MOS，常用于高电压小电流电路。</h2><h2 id="SGT：Superjunction-MOSFET"><a href="#SGT：Superjunction-MOSFET" class="headerlink" title="SGT：Superjunction MOSFET"></a>SGT：Superjunction MOSFET</h2><p>采用多个交替的不同材料层构成，具有高电压承受能力和低导通电阻的优点。SGT主要应用于高压直流输电、电动汽车和太阳能发电等领域。SGT的主要缺点是制造成本较高。</p>
<h2 id="Cool-MOS"><a href="#Cool-MOS" class="headerlink" title="Cool MOS"></a>Cool MOS</h2><p>英飞凌发明制造的功率管，是一种快速开关MOSFET，具有低开关损耗和低导通电阻的优点。主要应用于高效率电源、LED驱动器和电动汽车充电器等领域。主要缺点是存在体效应和漏电流，且制造成本较高。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>半导体专业</category>
        <category>模拟电路</category>
      </categories>
      <tags>
        <tag>器件</tag>
      </tags>
  </entry>
  <entry>
    <title>在Windows11中找回照片查看器打开图片</title>
    <url>/2023/12/12/%E5%9C%A8Windows11%E4%B8%AD%E6%89%BE%E5%9B%9E%E7%85%A7%E7%89%87%E6%9F%A5%E7%9C%8B%E5%99%A8%E6%89%93%E5%BC%80%E5%9B%BE%E7%89%87/</url>
    <content><![CDATA[<ol>
<li>使用快捷键<code>Win + R</code>打开运行窗口， 输入<code>regedit</code>命令回车打开注册表<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20231212234749.png" alt="20231212234749"><span id="more"></span></li>
<li>找到<code>HKEY_LOCAL_MACHINE</code> -&gt; <code>SOFTWARE</code>-&gt;<code>Microsoft</code> -&gt; <code>Windows Photo Viewer</code> -&gt; <code>Capabilities</code> -&gt; <code>FileAssociations</code>，右键=&gt;新建=&gt;字符串值，名称填写<code>.jpg</code>，数值填写<code>PhotoViewer.FileAssoc.Tiff</code>，同理添加 <code>.png</code>  <code>.jpeg</code>，数值相同。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20231212234917.png" alt="20231212234917"></li>
<li>添加之后就可以使用Windows照片查看器看图。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20231212235008.png" alt="20231212235008"></li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>ZeroTier Documention</title>
    <url>/2024/03/06/ZeroTier-Documention/</url>
    <content><![CDATA[<p><a href="https://docs.zerotier.com/"><strong>ZeroTier Documentation</strong></a><br><span id="more"></span></p>
<h1 id="Getting-Started-with-ZeroTier"><a href="#Getting-Started-with-ZeroTier" class="headerlink" title="Getting Started with ZeroTier"></a>Getting Started with ZeroTier</h1><p>ZeroTier securely connects all your devices and services with each other, anywhere.</p>
<h2 id="What-is-ZeroTier"><a href="#What-is-ZeroTier" class="headerlink" title="What is ZeroTier?"></a>What is ZeroTier?</h2><p>ZeroTier is a way to connect devices over your own private network anywhere in the world. You do this by creating a network and then joining <em>two or more devices</em> to that network. You can use ZeroTier to play games, connect to remote business resources or even as a cloud backplane for your enterprise.<a href="https://docs.zerotier.com/start">Create your network.</a></p>
<blockquote>
<p><strong>ADVANCED</strong><br>ZeroTier uses a set of globally distributed root servers and network controllers to automatically negotiate P2P connections for your devices and provision your networks. You use Central to manage your networks. <a href="https://docs.zerotier.com/protocol">Here’s a technical deep dive of the protocol</a>.</p>
</blockquote>
<h2 id="Ceate-a-Network"><a href="#Ceate-a-Network" class="headerlink" title="Ceate a Network"></a>Ceate a Network</h2><p>A ZeroTier network is essentially a secure Local Area Network(LAN) that you can use anywhere in the world. Let’s make one and connect two devices over ZeroTier.<br>We’ll use <code>ping</code> to test the connection. Any two devices that can run ZeroTier will do: laptop, phone, virtual machine, etc…<br>Both devices can be at the same location, on the same physical network. If you move one to a cafe or to your office, it should still just work.<br>The rough outline is:</p>
<ul>
<li>Cerate a ZeroTier network</li>
<li>Join the network from two devices</li>
<li><code>ping</code> one device from the other over the ZeroTier network<br>This should take about 5 minutes.<blockquote>
<p>Results Preview<br>Here is a summary of the results of this tutorial, if you’re a networking person.<br>If this doesn’t mean anything to you, that’s OK. We’ll get there.<br>Each zerotier network you join creates a network interface on your devices. It’s like adding another Ethernet port to your computer.</p>
<pre><code>node1# ip -o a
1: lo    inet 127.0.0.1/8 scope host lo\       valid_lft forever preferred_lft forever
2: eth0    inet 192.168.182.201/24 brd 192.168.182.255 scope global dynamic noprefixroute eth0\       valid_lft 3277sec preferred_lft 2827sec
9: zt3jn2z57r    inet 10.2.0.11/23 brd 10.2.1.255 scope global zt3jn2z57r\       valid_lft forever preferred_lft forever
</code></pre><pre><code>node2# ip -o a
1: lo    inet 127.0.0.1/8 scope host lo\       valid_lft forever preferred_lft forever
2: eth0    inet 192.168.182.202/24 brd 192.168.182.255 scope global dynamic noprefixroute eth0\       valid_lft 3277sec preferred_lft 2827sec
9: zt3jn2z57r    inet 10.2.0.12/23 brd 10.2.1.255 scope global zt3jn2z57r\       valid_lft forever preferred_lft forever
</code></pre><p>```<br>node1# ping -c 3 10.2.0.12<br>PING 10.2.0.2 (10.2.0.12) 56(84) bytes of data.<br>64 bytes from 10.2.0.12: icmp_seq=1 ttl=64 time=5.66 ms<br>64 bytes from 10.2.0.12: icmp_seq=2 ttl=64 time=6.62 ms<br>64 bytes from 10.2.0.12: icmp_seq=3 ttl=64 time=8.50 ms</p>
</blockquote>
</li>
</ul>
<p>—- 10.2.0.12 ping statistics —-<br>3 packets transmitted, 3 received, 0% packet loss, time 2004ms</p>
<blockquote>
<p>```</p>
</blockquote>
<h3 id="Create-your-first-ZeroTier-network"><a href="#Create-your-first-ZeroTier-network" class="headerlink" title="Create your first ZeroTier network"></a>Create your first ZeroTier network</h3><h4 id="Create-an-account"><a href="#Create-an-account" class="headerlink" title="Create an account"></a>Create an account</h4><blockquote>
<p>NOTE<br>It’s free, no credit card is required.</p>
<ul>
<li>Go to <a href="https://my.zerotier.com/">my.zerotier.com</a> and create an account.<h4 id="Create-a-network"><a href="#Create-a-network" class="headerlink" title="Create a network"></a>Create a network</h4></li>
<li>Make sure you’re on the “Networks” tab of my.zerotier.com<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306141725.png" alt="20240306141725"></li>
<li>Click the <strong>Create A Network</strong> button.<br>This creates a virtual network with a random ID and a random name. We got “fervent_smathers” and <code>d5e04297a16fa690</code> here.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306142035.png" alt="20240306142035"></li>
<li>Click anywhere on the network to go to the details page for this network.<br>See the Network Settings panel:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306142144.png" alt="20240306142144"><br>We don’t need to change any settings, but we can change the name of the network to personalize it.</li>
<li>Change “fervent_smathers” to “my cool network” or whatever you like.</li>
<li>Collapse the Settings panel. Click on the word “Settings” at the top of the panel.<br>You don’t need to change any other settings.</li>
<li>See the Network Members panel:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306142515.png" alt="20240306142515"><br>It should say “No devices have joined this network”.</li>
<li>Leave this brower tab open. We’ll look at it again later.</li>
</ul>
</blockquote>
<h3 id="Setup-the-ZeroTier-app"><a href="#Setup-the-ZeroTier-app" class="headerlink" title="Setup the ZeroTier app"></a>Setup the ZeroTier app</h3><h4 id="Download-and-install-ZeroTier"><a href="#Download-and-install-ZeroTier" class="headerlink" title="Download and install ZeroTier"></a>Download and install ZeroTier</h4><p>For mobile devices, use the app store.</p>
<ul>
<li>Go to <a href="https://www.zerotier.com/download">zerotier.com/download</a></li>
<li>Run the installer<br>The ZeroTier client should now running on your devices.<h4 id="Join-your-first-ZeroTier-network"><a href="#Join-your-first-ZeroTier-network" class="headerlink" title="Join your first ZeroTier network"></a>Join your first ZeroTier network</h4>We need to tell the client to “join” the virtual network we just created.</li>
<li>Copy the Network ID of the network from my.zerotier.com. This is the long number that looks like: <code>d5e04297a16fa690</code></li>
<li>Paste the Network ID into the “join” command on your device<br>On macOS and Windows, there is a menubar/tray app. Select “join” from the menu.<blockquote>
<p><strong>NOTE</strong><br>Every running instance of ZeroTier has a unique address. It’s the 10 digit “Address” in the app, or <code>zerotier-cli info</code> command.<br>ZeroTier addresses are a very secure method of unique identification.</p>
</blockquote>
</li>
</ul>
<h3 id="Authorize-your-device-on-your-network"><a href="#Authorize-your-device-on-your-network" class="headerlink" title="Authorize your device on your network"></a>Authorize your device on your network</h3><p>At this point, your client should say “Access Denied.” A device can’t talk on your network unless you allow it, even if someone discovers the network’s ID.</p>
<h4 id="Authorize-your-device"><a href="#Authorize-your-device" class="headerlink" title="Authorize your device"></a>Authorize your device</h4><ul>
<li>Go to the Members panel that we left open on my.zerotier.com</li>
<li>Your node that just “joined” should appear here.</li>
<li>The “Address” should match the address in your client.</li>
<li>Click the “Auth?” check box for it.</li>
<li>Give it a name. Type something like “laptop” or “bob” into the <code>(short name)</code> input.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306150746.png" alt="20240306150746"></li>
</ul>
<h4 id="Confirm-authorization"><a href="#Confirm-authorization" class="headerlink" title="Confirm authorization"></a>Confirm authorization</h4><p>Back on your computer, your client should now say “OK” instead of “ACCESS DENIED” and it should show your custom “my cool network” name.<br>Now you have 1 member on your network. A network with 1 member can’t do much.</p>
<h3 id="Repeat-with-another-device"><a href="#Repeat-with-another-device" class="headerlink" title="Repeat with another device"></a>Repeat with another device</h3><p>We need to have 2 devices connected to the same ZeroTier network.</p>
<ul>
<li>Repeat the join and authorize steps with your second device.</li>
</ul>
<h3 id="Test-connectivity"><a href="#Test-connectivity" class="headerlink" title="Test connectivity"></a>Test connectivity</h3><p>Now you have two authorized nodes on your network. They should be able to talk over ZeroTier.<br>Your Network Members section should look something like this:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306151255.png" alt="20240306151255"><br>The “Managed IPs” will be different on your network.<br>We’re going to test with <code>ping</code>. It’s the only program that we can think of that exists by default on every operating system.<br>This is a command line program, but don’t worry: You can do it.</p>
<h4 id="Gotcha-Windows-blocks-ping"><a href="#Gotcha-Windows-blocks-ping" class="headerlink" title="Gotcha: Windows blocks ping"></a>Gotcha: Windows blocks ping</h4><p><del>Windows by default doesn’t respond to pings. If you try to ping a Windows computer from a different computer, it won’t work. You can enable ping.</del><br>ZeroTier automatically enables ping on your ZeroTier network adapter now. You can probably skip this step!</p>
<blockquote>
<p>How to enable ping on Windows</p>
<ul>
<li>Search for Windows Firewall in the Start Menu, and click to open it.</li>
<li>Click Advanced Settings on the left.</li>
<li>From the left pane of the resulting window, click Inbound Rules.</li>
<li>In the right pane, find the rules titled File and Printer Sharing(Echo Request - ICMPv4-In).</li>
<li>Right-click each rule and choose Enable Rule.<br>Here is a <a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-firewall/create-an-inbound-icmp-rule">tutorial by Microsoft</a><h4 id="Open-the-command-line"><a href="#Open-the-command-line" class="headerlink" title="Open the command line"></a>Open the command line</h4></li>
<li>Open the command line on your computer<h4 id="Find-the-ZeroTier-IP-Address-of-your-devices"><a href="#Find-the-ZeroTier-IP-Address-of-your-devices" class="headerlink" title="Find the ZeroTier IP Address of your devices"></a>Find the ZeroTier IP Address of your devices</h4><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240306153157.png" alt="20240306153157"><h4 id="Try-the-ping-command"><a href="#Try-the-ping-command" class="headerlink" title="Try the ping command"></a>Try the ping command</h4>Back in the Command Line / Terminal that you just opened:</li>
<li>type <code>ping -c 5 $ZEROTIER_IP_ADDRESS</code> <code>&lt;enter&gt;</code> into your command line.<br>A successful <code>ping</code><br>```<br>% ping -c 5 172.22.217.93<br>PING 172.22.217.93 (172.22.217.93): 56 data bytes<br>64 bytes from 172.22.217.93: icmp_seq=0 ttl=64 time=22.362 ms<br>64 bytes from 172.22.217.93: icmp_seq=1 ttl=64 time=10.157 ms<br>64 bytes from 172.22.217.93: icmp_seq=2 ttl=64 time=9.414 ms<br>64 bytes from 172.22.217.93: icmp_seq=3 ttl=64 time=9.019 ms<br>64 bytes from 172.22.217.93: icmp_seq=4 ttl=64 time=9.180 ms</li>
</ul>
</blockquote>
<p>—- 172.22.217.93 ping statistics —-<br>5 packets transmitted, 5 packets received, 0.0% packet loss<br>round-trip min/avg/max/stddev = 9.019/12.026/22.362/5.182 ms</p>
<pre><code>Try it with both ZeroTier Managed addresses on your network.
One of them is the same device you&#39;re on, so you&#39;re pinging yourself. Pinging the other device might be a little more interesting.
&gt; **INFO**
&gt; If something goes wrong you might see something like:
&gt;
</code></pre><p>% ping -c 5 172.22.217.92<br>PING 172.22.217.92 (172.22.217.92): 56 data bytes<br>Request timeout for icmp_seq 0<br>Request timeout for icmp_seq 1<br>Request timeout for icmp_seq 2<br>Request timeout for icmp_seq 3</p>
<p>—- 172.22.217.92 ping statistics —-<br>5 packets transmitted, 0 packets received, 100.0% packet loss</p>
<blockquote>
<pre><code>or
</code></pre><p>ping -c 5 192.168.123.234<br>PING 192.168.123.234 (192.168.123.234): 56 data bytes<br>92 bytes from 192.168.82.1: Destination Port Unreachable<br>Vr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst<br> 4  5  00 5400 56e7   0 0000  3f  01 d4ad 192.168.82.217  192.168.123.234<br>```<br>There may just be a typo in the IP address. Double check that your device is authorized at my.zerotier.com<br>Contact us on the <a href="https://discuss.zerotier.com/">discussion forum</a> and see the <a href="https://docs.zerotier.com/faq">troubling section</a> if you get stuck.</p>
</blockquote>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p><code>ping</code> doesn’t accomplish anything, but it does tell us ZeroTier is working. It’s useful to know about for troubleshooting networks, not just ZeroTier networks.<br>Visit the <a href="https://discuss.zerotier.com/">discussion forum</a> to talk about your use-cases or if you get stuck.</p>
<h4 id="Now-use-ZeroTier-to-do-something-you-want-to-do"><a href="#Now-use-ZeroTier-to-do-something-you-want-to-do" class="headerlink" title="Now, use ZeroTier to do something you want to do"></a>Now, use ZeroTier to do something you want to do</h4><h4 id="Some-popular-uses"><a href="#Some-popular-uses" class="headerlink" title="Some popular uses"></a>Some popular uses</h4><ul>
<li>Windows Remote Desktop</li>
<li>ssh(try <a href="https://mosh.org/">mosh</a>)</li>
<li>Private Gaming LAN</li>
<li>Access the web interfaces of your home lab</li>
<li>Build your own <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/7110693/Overriding+Default+Route+Full+Tunnel+Mode">VPN</a></li>
<li>Route to a <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/224395274/Route+between+ZeroTier+and+Physical+Networks">remote subnet</a></li>
<li>Route to a <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/7274520/Using+NDP+Emulated+6PLANE+Addressing+With+Docker">Docker network</a></li>
<li>Add <a href="https://docs.zerotier.com/dns">dns</a> to your network<h4 id="Join-multiple-networks"><a href="#Join-multiple-networks" class="headerlink" title="Join multiple networks"></a>Join multiple networks</h4>A node can join many networks at once. Make sure they don’t use the same subnet!<br>You can have a <code>home</code> network, a <code>friends</code> network, and a <code>work</code> network, for example.<br>They don’t all need to be networks that you’ve created. You can join other people’s network.<h4 id="Check-out-the-Whitepaper"><a href="#Check-out-the-Whitepaper" class="headerlink" title="Check out the Whitepaper"></a>Check out the Whitepaper</h4>For more info on the cryptography and protocol, see the: <a href="https://docs.zerotier.com/protocol">Design Whitepaper</a></li>
</ul>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="Minimum-System-Requirements"><a href="#Minimum-System-Requirements" class="headerlink" title="Minimum System Requirements"></a>Minimum System Requirements</h3><p>ZeroTier is lightweight, portable, and compatible across all major platforms and architectures. It typically consumes less than 16 MB of memory, only about 1 MB of storage, and even has a <a href="https://docs.zerotier.com/lbm">low-bandwidth mode</a> for IoT applications. It supports <code>32-bit ARM(arm32)</code>, <code>64-bit ARM(arm64)</code>, <code>32-bit Intel(x86)</code>, <code>64-bit Intel(x64/amd64)</code>, <code>MIPS</code>, and <code>s390x</code>. You can run it on <a href="https://docs.zerotier.com/linux">Linux</a>, <a href="https://docs.zerotier.com/macos">macOS</a>, <a href="https://docs.zerotier.com/windows">Windows</a>, <a href="https://docs.zerotier.com/ios">iOS/iPadOS</a>, <a href="https://docs.zerotier.com/android">Android</a>, and <a href="https://docs.zerotier.com/freebsd">FreeBSD</a>. You can run it on <a href="https://docs.zerotier.com/routers">Routers</a>, <a href="https://docs.zerotier.com/nas">Network Attached Storage</a>, and we <a href="https://docs.zerotier.com/proxy">have solutions</a> for when you can’t install ZeroTier on a small IoT sensor.<br>Our most recent client can still be run on tiny single-board computers like the original Raspberry Pi made over a decade ago and all versions of ZeroTier are backwards compatible.<br>ZeroTier is currently single-threaded so devices with more than two cores typically will not offer significant performance gains. Future versions of ZeroTier will introduce multithreading.</p>
<ul>
<li>While ZeroTier will operate on very low-power hardware(e.g. a single core 32-Bit ARM running at 600Mhz without AES hardware acceleration(AES-NI)), its performance will suffer.<br>We recommend the following for a happy ZeroTier experience: <code>&gt;=1GHz</code> CPU with at least <code>2</code> cores, and <code>AES-NI</code>.<blockquote>
<p><strong>ARM</strong><br>If you’re planning on embedding ZeroTier in a product such as a router, network attached storage or some other IoT application we see that our partners have a better experence with <code>64-bit ARM</code> as opposed to <code>32-bit ARM</code> since the core speeds are typically higher and the chips are more likely to have <code>AES-NI</code>.</p>
<h3 id="What-happens-if-a-ZeroTier-Inc-root-goes-down"><a href="#What-happens-if-a-ZeroTier-Inc-root-goes-down" class="headerlink" title="What happens if a ZeroTier, Inc root goes down?"></a>What happens if a ZeroTier, Inc root goes down?</h3><p>Out roots are globally distributed and redundant, if one fails requests will seamlessly fail-over to other roots.<br>If you are running your own roots the effect would be that no new connections can be established between nodes but existing connections would still work.</p>
<h3 id="Can-ZeroTier-Inc-See-my-traffic"><a href="#Can-ZeroTier-Inc-See-my-traffic" class="headerlink" title="Can ZeroTier, Inc. See my traffic?"></a>Can ZeroTier, Inc. See my traffic?</h3><p>No. Your traffic is end-to-end encrypted and your device’s private identity keys are never transmitted off of your device. Learn more about our <a href="https://docs.zerotier.com/protocol#crypto">cryptograph protocol</a>.</p>
<h3 id="Metrics-and-Monitoring"><a href="#Metrics-and-Monitoring" class="headerlink" title="Metrics and Monitoring"></a>Metrics and Monitoring</h3><p>ZeroTier Inc doesn’t have access to your traffic. We don’t current supply a monitoring “dashboard” for your networks and nodes. You can build your own.</p>
</blockquote>
</li>
<li><a href="https://github.com/zerotier/ZeroTierOne#prometheus-metrics">Prometheus Metrics</a> for the zerotier-one agent are available. Pipe these into the common prometheus/grafana setup.</li>
<li>Use your preferred monitoring tool <em>over</em> your ZeroTier networks. Some examples: Prometheus <a href="https://github.com/prometheus/blackbox_exporter">Blackbox exporter</a>, <a href="https://oss.oetiker.ch/smokeping/">SmokePing</a>, <a href="https://uptime.kuma.pet/">UptimeKuma</a></li>
<li><a href="https://docs.zerotier.com/rules#353trafficobservationandinterceptionaname3_5_3a">Traffic Observation and Interception</a><h3 id="Why-does-my-peers-list-have-nodes-I-don’t-recognize"><a href="#Why-does-my-peers-list-have-nodes-I-don’t-recognize" class="headerlink" title="Why does my peers list have nodes I don’t recognize?"></a>Why does my peers list have nodes I don’t recognize?</h3>The nodes are usually our infrastructure that your node needs to talk to in order to function. This includes thing like: <a href="https://docs.zerotier.com/roots">Root servers</a> and <a href="https://docs.zerotier.com/controller">Controllers</a>. Or possibly nodes from a previously joined network. The command <code>zerotier-cli peers</code> shows a list of nodes that your node knows about. Nodes can not talk to each other unless they are joined and authorized on the same network. Our root servers and controllers do not have access to you nodes’ encryption keys and thus cannot decrypt your traffic.<blockquote>
<p><strong>HOW TO IDENTIFY A CONTROLLER</strong><br>A controller is a ZeroTier node. The first 10 digits of a Network ID is the controller’s address.</p>
<h3 id="What-is-error-NOT-FOUND"><a href="#What-is-error-NOT-FOUND" class="headerlink" title="What is error NOT_FOUND?"></a>What is error <code>NOT_FOUND</code>?</h3><p>When your ZeroTier Client is showing NOT_FOUND as your network status, this usually means that you’ve entered your network ID incorrectly and are trying to join a non-existent network. Please check your network ID and try again.</p>
<h3 id="High-Latency-amp-Relaying"><a href="#High-Latency-amp-Relaying" class="headerlink" title="High Latency &amp; Relaying"></a>High Latency &amp; Relaying</h3><p>If you’re experiencing high latency(or high ping times), it’s possible the connection between two nodes is being Relayed. The command <code>zerotier-cli peers</code> (available in 1.4.x and above) will give you infomation on what if any connections are being relayed. The output will look something like this:</p>
<pre><code>[root@host] # zerotier-cli peers
&lt;ztaddr&gt;   &lt;ver&gt;  &lt;role&gt; &lt;lat&gt; &lt;link&gt; &lt;lastTX&gt; &lt;lastRX&gt; &lt;path&gt;
61d294b9cb -      PLANET    43 DIRECT 1617     6580     50.7.73.34/9993
62f865ae71 -      PLANET   193 DIRECT 1617     1424     2001:49f0:d0db:2::2/9993
6xxxxxxxx1 1.6.4  LEAF     730 DIRECT 8714     8714     35.222.83.92/62191
778cde7190 -      PLANET    76 DIRECT 1617     11607    103.195.103.66/9993
992fcf1db7 -      PLANET   163 DIRECT 6623     1454     2a02:6ea0:c024::/9993
deadbeef01 1.6.4  LEAF      -1 RELAY
</code></pre><p>If you see the peer you’re trying to contact in the RELAY state, that means packets are bouncing through our root servers because a direct connection between peers cannot be established. Side effects of RELAYING are increased latency and possible packet loss. See <a href="https://docs.zerotier.com/routertips">Router Configuration Tips</a> for how to resolve this.<br><strong>TIP</strong><br>If you experience high latency or packet jitter for more than four hours please contact your network admin as this may be a sign of a serious network condition.</p>
<h3 id="Bandwidth-considerations"><a href="#Bandwidth-considerations" class="headerlink" title="Bandwidth considerations"></a>Bandwidth considerations</h3><p>In the best case scenario, and in most cases, ZeroTier connects peer-to-peer and none of your network traffic travels through our servers. This means transfers go as fast as your CPU &amp; network can compress, encrypt and send packets, and how fast the remote end can receive them.<br>There are some cases, such as hostile NATs &amp; firewalls in which your encrypted packets do indeed get relayed through our root servers. Relaying through our root adds latency. The packets must travel farther physically than they would for a direct, peer to peer connection.<br>We do not throttle any of these packets, nor can we read the contents of the packets due to encryption. We also, however, cannot guarantee connection reliability when this happens. We do our best effort to get your packets where they need to go, but this is not always possible.<br>Considerations:</p>
</blockquote>
</li>
<li>CPU speed. The current version of zerotier-one is single threaded. Raw CPU speed is important in high bandwidth use cases.</li>
<li>Physical Internet connection. ZeroTier can only go as fast as the physical connection it’s running over.</li>
<li>Hardware Encryption. ZerTier uses hardware AES acceleration when available. Most current ARM and x86_64 platforms have AES acceleration.</li>
<li>Geographic distance. If your remote peer is on a different continent, there will be latency. We can’t improve the speed of light.<blockquote>
<p>TIP<br>If you are experiencing slow network speeds or difficulty making direct connections see <a href="https://docs.zerotier.com/routertips">Router Configuration Tips</a> or <a href="https://docs.zerotier.com/corporate-firewalls">Corporate Firewalls</a></p>
<h4 id="Will-transfers-go-faster-on-paid-accounts"><a href="#Will-transfers-go-faster-on-paid-accounts" class="headerlink" title="Will transfers go faster on paid accounts?"></a>Will transfers go faster on paid accounts?</h4><p>ZeroTier performance is not at all related to your account or subscription level. You may be able to change things on your end to enable faster connections between peers.</p>
<h3 id="Error-Cannot-connect-to-ZeroTier-service"><a href="#Error-Cannot-connect-to-ZeroTier-service" class="headerlink" title="Error: Cannot connect to ZeroTier service"></a>Error: Cannot connect to ZeroTier service</h3><p>This error means that the ZeroTier background service on your computer is either not running, or your local firewall is preventing the UI or CLI from talking to it.</p>
<h4 id="Windows-10"><a href="#Windows-10" class="headerlink" title="Windows 10"></a>Windows 10</h4><p>Open Task Manager and go to the “Services” tab. Scroll down until you see <code>ZeroTierOneService</code>. The status column should say <code>Running</code>. If it does not, right click on the line and click <code>Start</code></p>
<h4 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h4><p>Open Terminal.app and excute the following commands</p>
<pre><code>sudo launchctl unload /Library/LaunchDaemons/com.zerotier.one.plist
sudo launchctl load /Library/LaunchDaemons/com.zerotier.one.plist
</code></pre><h4 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h4><p>If your Linux distribution uses systemd, execute <code>sudo service zerotier-one start</code><br>If not, execute <code>sudo /etc/init.d/zerotier-one start</code></p>
<h4 id="Still-doesn’t-work"><a href="#Still-doesn’t-work" class="headerlink" title="Still doesn’t work?"></a>Still doesn’t work?</h4><p>Your system firewall is likely blocking communication with the ZeroTier service. Look up instructions for how to unblock an application from the firewall for your OS. ZeroTier will need to be accessible via TCP port 9993 fro the UI and CLI to interact with it.</p>
<h3 id="Where-can-I-find-old-version-of-ZeroTier"><a href="#Where-can-I-find-old-version-of-ZeroTier" class="headerlink" title="Where can I find old version of ZeroTier?"></a>Where can I find old version of ZeroTier?</h3><p>See <a href="https://docs.zerotier.com/releases#old">Release</a></p>
<h3 id="What-is-Earth"><a href="#What-is-Earth" class="headerlink" title="What is Earth?"></a>What is Earth?</h3><p><code>Earth</code> or <code>8056c2e21c000001</code> was a test network operated by ZeroTier, Inc., it was decommissioned in 2023.</p>
<h3 id="How-do-I-Update-Zerotier"><a href="#How-do-I-Update-Zerotier" class="headerlink" title="How do I Update Zerotier?"></a>How do I Update Zerotier?</h3><p>When you update ZeroTier, your configuration stays. You don’t need to re-join your networks.</p>
<h4 id="macOS-and-Windows"><a href="#macOS-and-Windows" class="headerlink" title="macOS and Windows"></a>macOS and Windows</h4><p>Grab the latest version from the <a href="https://www.zerotier.com/download">download page</a> and run the installer</p>
<h4 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a>Linux</h4><p>Use your OS’s package manager. eg <code>apt</code> on Debian based distributions, or <code>yum</code> or <code>dnf</code> on RedHat based distributions.</p>
<h4 id="iOS-and-Android"><a href="#iOS-and-Android" class="headerlink" title="iOS and Android"></a>iOS and Android</h4><p>Use the respective app stores.</p>
<h3 id="How-to-clear-or-reset-your-ZeroTier-address"><a href="#How-to-clear-or-reset-your-ZeroTier-address" class="headerlink" title="How to clear or reset your ZeroTier address"></a>How to clear or reset your ZeroTier address</h3><p>If you would like to clear or reset ZeroTier’s address on a device (the 10-digit address node ID) or you have cloned a device and you want to prevent it from using the same address, follow these steps in order:</p>
<h4 id="Step-1-Stop-the-service"><a href="#Step-1-Stop-the-service" class="headerlink" title="Step 1. Stop the service"></a>Step 1. Stop the service</h4><h5 id="On-Windows"><a href="#On-Windows" class="headerlink" title="On Windows"></a>On Windows</h5><p>On Windows this is done with the service manager.(Open the Start Menu and start typing “service”)</p>
<h5 id="On-macOS"><a href="#On-macOS" class="headerlink" title="On macOS"></a>On macOS</h5><p>On macOS you can open a terminal and use</p>
<pre><code>sudo launchctl unload /Library/LaunchDaemons/com.zerotier.one.plist
</code></pre><h5 id="On-Linux"><a href="#On-Linux" class="headerlink" title="On Linux"></a>On Linux</h5><p>This is usually</p>
<pre><code>sudo systemctl stop zerotier-one
</code></pre><p>or</p>
<pre><code>sudo service zerotier-one stop
</code></pre><h4 id="Step-2-Delete-the-file-identity-public-and-identity-secret-from-ZeroTier’s-working-directory"><a href="#Step-2-Delete-the-file-identity-public-and-identity-secret-from-ZeroTier’s-working-directory" class="headerlink" title="Step 2. Delete the file identity.public and identity.secret from ZeroTier’s working directory"></a>Step 2. Delete the file identity.public and identity.secret from ZeroTier’s working directory</h4></blockquote>
</li>
<li>On Windows this is usually <code>\ProgramData\ZeroTier\One</code></li>
<li>On Mac this is <code>/Library/Application Support/ZeroTier/One</code> in your terminal, type opne <code>/Library/Application Support/ZeroTier/One</code> to open the folder in Finder</li>
<li>On Linux this is usually <code>/var/lib/zerotier-one</code><h4 id="Step-3-Restart-the-service"><a href="#Step-3-Restart-the-service" class="headerlink" title="Step 3. Restart the service"></a>Step 3. Restart the service</h4><h5 id="On-Windows-1"><a href="#On-Windows-1" class="headerlink" title="On Windows"></a>On Windows</h5>Starting via the service manager on Windows<h5 id="On-Mac"><a href="#On-Mac" class="headerlink" title="On Mac"></a>On Mac</h5><pre><code>sudo launchctl load /Library/LaunchDaemons/com.zerotier.one.plist
</code></pre><h5 id="On-Linux-1"><a href="#On-Linux-1" class="headerlink" title="On Linux"></a>On Linux</h5><pre><code>sudo systemctl start zerotier-one
</code></pre>or<pre><code>sudo service zerotier-one start
</code></pre>When started without identities ZeroTier will generate new ones. You will need to authorize this new identity on any networks.<blockquote>
<p><strong>CAN’T FIND AN ANSWER?</strong><br><a href="https://discuss.zerotier.com/">Ask our community for help</a></p>
</blockquote>
</li>
</ul>
<blockquote>
<p><strong>NEXT STEPS</strong><br>Click <a href="https://docs.zerotier.com/start/">here</a> to create your network and start adding devices.</p>
</blockquote>
<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><blockquote>
<p><strong>CAN’T FIND AN ANSWER?</strong><br><a href="https://discuss.zerotier.com/">Ask out community for help</a></p>
<h3 id="Ping-is-not-working"><a href="#Ping-is-not-working" class="headerlink" title="Ping is not working"></a>Ping is not working</h3><p>First, make sure your device is authorized on the network and you’re using the ZeroTier assigned Managed IP address. Aside from that, some OSes block pings in their local firewall by default.</p>
<h4 id="Windows-Firewall"><a href="#Windows-Firewall" class="headerlink" title="Windows Firewall"></a>Windows Firewall</h4><p>ZeroTier versions 1.10.3 and greater automatically enable ping on ZeroTier adapters.</p>
<h4 id="macOS-Firewall"><a href="#macOS-Firewall" class="headerlink" title="macOS Firewall"></a>macOS Firewall</h4><p>The firewall is not enabled by default on macOS, and thus pings will not be blocked by default. If your firewall is enabled on macOS, go into System Preferences -&gt; Security &amp; Privacy. Under Firewall Options, ensure “Enable stealth mode”, is disabled. Stealth mode blocks pings.</p>
<h4 id="Linux-Firewalls"><a href="#Linux-Firewalls" class="headerlink" title="Linux Firewalls"></a>Linux Firewalls</h4><p>There are far too many Linux distributions out there to list instructions for all of them here. Please refer to your distribution’s documentation for how to unblock ICMP packets.<br><strong>GET STARTED</strong><br>Click <a href="https://docs.zerotier.com/start/">here</a> to create your network and start adding devices.</p>
<h3 id="Error-Cannot-connect-to-ZeroTier-service-or-Node-ID-“Unknown”-in-the-GUI-apps"><a href="#Error-Cannot-connect-to-ZeroTier-service-or-Node-ID-“Unknown”-in-the-GUI-apps" class="headerlink" title="Error: Cannot connect to ZeroTier service(or Node ID “Unknown” in the GUI apps)"></a>Error: Cannot connect to ZeroTier service(or Node ID “Unknown” in the GUI apps)</h3><p>This error means that the ZeroTier background service on your computer is either not running, or your local firewall is preventing the UI or CLI from talking to it.</p>
<h4 id="Windows-Service"><a href="#Windows-Service" class="headerlink" title="Windows Service"></a>Windows Service</h4><p>Open Task Manager and go to the “Services” tab. Scroll down until you see “SeroTierOneService”. The status column should say “Running”. If it does not, right click on the line and click “Start”.</p>
<h4 id="macOS-Service"><a href="#macOS-Service" class="headerlink" title="macOS Service"></a>macOS Service</h4><p>Open Terminal.app and excute the following commands</p>
<pre><code>sudo launchctl unload /Library/LaunchDaemons/com.zerotier.one.plist
sudo launchctl load /Library/LaunchDaemons/com.zerotier.one.plist
</code></pre><h4 id="Linux-Service"><a href="#Linux-Service" class="headerlink" title="Linux Service"></a>Linux Service</h4><p>If your Linux distribution uses systemd, excute:</p>
<pre><code>sudo service zerotier-one start
</code></pre><p>If not, excute:</p>
<pre><code>/etc/init.d/zerotier-one start
</code></pre><h4 id="Still-doesn’t-work-1"><a href="#Still-doesn’t-work-1" class="headerlink" title="Still doesn’t work?"></a>Still doesn’t work?</h4><p>Your system firewall is likely blocking communication with the ZeroTier service. Look up instructions for how to unblock an application from the firewall for your OS. ZeroTier will need to be accessible via TCP port 9993 for the UI and CLI to interact with it.</p>
<h3 id="Emergency-Instructions"><a href="#Emergency-Instructions" class="headerlink" title="Emergency Instructions"></a>Emergency Instructions</h3><p>“It was working, but now it’s not and I’m not sure why. And I need to get up and running quick.”<br>First, check with your friendly firewall admin that no configuration in the physical network connection has changed.<br>See the <a href="https://docs.zerotier.com/cli">CLI</a> article for help with the CLI.<br>We’re not aware of any bugs that require these steps, or we’d fix them, but sometimes poeple try the below.<br>Listed in order of severity:</p>
<h4 id="Restart-the-service"><a href="#Restart-the-service" class="headerlink" title="Restart the service"></a>Restart the service</h4><h5 id="macOS-1"><a href="#macOS-1" class="headerlink" title="macOS"></a>macOS</h5><p>Open Terminal.app, paste the below, and press enter:</p>
<pre><code>sudo launchctl unload /Library/LaunchDaemons/com.zerotier.one.plist
sudo launchctl load /Library/LaunchDaemons/com.zerotier.one.plist
</code></pre><p>It will ask you for your password. It’s the password you use to log in to your mac.</p>
<h5 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h5><ul>
<li>Type “Services” into the Start Menu to open the Windows Services Manager</li>
<li>Start and Stop the zerotier-one service in the Windows Services Manage.<h4 id="Linux-2"><a href="#Linux-2" class="headerlink" title="Linux"></a>Linux</h4><pre><code>systemctl restart zerotier-one
</code></pre><h4 id="Leave-all-networks-and-rejoin-them"><a href="#Leave-all-networks-and-rejoin-them" class="headerlink" title="Leave all networks and rejoin them"></a>Leave all networks and rejoin them</h4>Use the UI, or<br><code>zerotier-cli leave &lt;network-id&gt;</code> and <code>zerotier-cli join &lt;network-id&gt;</code><h4 id="Stop-service-Delete-peers-d-Start-servic"><a href="#Stop-service-Delete-peers-d-Start-servic" class="headerlink" title="Stop service, Delete peers.d, Start servic"></a>Stop service, Delete peers.d, Start servic</h4>Find peers.d in the <a href="http://localhost:3000/config#system">zerotier system directory</a><h4 id="Reset-Node-ID"><a href="#Reset-Node-ID" class="headerlink" title="Reset Node ID"></a>Reset Node ID</h4>The new node ID will have be re-authorized on any networks, and the node’s managed IP address manually re-assigned if needed.</li>
<li>Stop the service</li>
<li>Move or delete indentity.secret and identity.public files in the <a href="http://localhost:3000/config#system">zerotier system directory</a></li>
<li>Delete peers.d too</li>
<li>Start the service</li>
</ul>
</blockquote>
<h2 id="What-can-I-do-with-ZeroTier"><a href="#What-can-I-do-with-ZeroTier" class="headerlink" title="What can I do with ZeroTier?"></a>What can I do with ZeroTier?</h2><p>A List of Awesome ZeroTier Things<br>This repository contains a list of all things ZeroTier that can be found on The Internet. Feel free to add yours!<br><a href="https://github.com/zerotier/awesome-zerotier/edit/main/README.md">Pull Request</a> accepted!</p>
<h3 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h3><ul>
<li><a href="https://docs.zerotier.com/awesome#zerotier-self-hosting">ZeroTier Self-Hosting</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-training">ZeroTier Training</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-networking">ZeroTier Networking</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-linux">ZeroTier Linux</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-remote-access">ZeroTier Remote Access</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-sd-wan">ZeroTier SD-WAN</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-iot">ZeroTier IoT</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-droneuav">ZeroTier Drone/UAV</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-robotics">ZeroTier Robotics</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-automotive">ZeroTier Automotive</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-blockchaincrypto">ZeroTier Blockchain/Crypto</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-infosec">ZeroTier Infosec</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-ibm">ZeroTier IBM</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-terraform">ZeroTier Terraform</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-kubernetes">ZeroTier Kubernetes</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-docker">ZeroTier Docker</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-bridging">ZeroTier Bridging</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-mikrotik">ZeroTier MikroTik</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-ubiquiti">ZeroTier Ubiquiti</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-teltonika">ZeroTier Teltonika</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-openwrt">ZeroTier OpenWrt</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-opnsense">ZeroTier OPNsense</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-pfsense">ZeroTier pfSense</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-synology">ZeroTier Synology</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-raspberry-pi">ZeroTier Raspberry Pi</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-3-d-printing">ZeroTier 3-D Printing</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-homelab">ZeroTier Homelab</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-home-automation">ZeroTier Home Automation</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-videocameracctv">ZeroTier Video/Camera/CCTV</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-eve-ng">ZeroTier EVE-NG</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-blender">ZeroTier Blender</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-oculus">ZeroTier Oculus</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-gaming">ZeroTier Gaming</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-everything-else">ZeroTier Everything Else</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-reddit">ZeroTier Reddit</a></li>
<li><a href="https://docs.zerotier.com/awesome#zerotier-youtube">ZeroTier YouTube</a><blockquote>
<p><strong>NEXT STEPS</strong><br>Click <a href="">here</a> to create your network and start adding devices.</p>
<h3 id="ZeroTier-Self-Hosting"><a href="#ZeroTier-Self-Hosting" class="headerlink" title="ZeroTier Self-Hosting"></a>ZeroTier Self-Hosting</h3><h4 id="Self-Hosting-Network-Controller-Interfaces"><a href="#Self-Hosting-Network-Controller-Interfaces" class="headerlink" title="Self-Hosting Network Controller Interfaces"></a>Self-Hosting Network Controller Interfaces</h4></blockquote>
</li>
<li><a href="https://github.com/key-networks/ztncui">key-networks / ztncui</a> - GUI for self-hosted ZeroTier.</li>
<li><a href="https://github.com/key-networks/ztncui-aio">key-networks / ztncui-aio</a> - ZeroTier network controller user interface in a Docker container.</li>
<li><a href="https://github.com/thedunston/bash_cli_zt">thedunston / bash_cli_zt</a> - Command Line interface for self-hosted ZeroTier.</li>
<li><a href="https://github.com/dec0dOS/zero-ui">dec0dOS / zero-ui</a> - GUI for self-hosted ZeroTier.</li>
<li><a href="https://hub.docker.com/r/mdplusplus/zerotier-network-controller-ui">mdplusplus/zerotier-network-controller-ui</a> - Docker image for self-hosted ZeroTier.<h4 id="Self-Hosting-article"><a href="#Self-Hosting-article" class="headerlink" title="Self-Hosting article"></a>Self-Hosting article</h4></li>
<li><a href="https://www.exclusionzone.org/2019/12/10/zerotier-the-dorknet-rises/">zero - The Dorknet rises</a> - Self-hosted ZeroTier on OPNsense.</li>
<li><a href="https://medium.com/iotops/from-zero-to-zerotier-in-k3s-way-eadff5745566">From zero to Zerotier in k3s way</a> - Self-hosted ZeroTier on a Raspberry Pi, using k3s.<h4 id="Self-Hosting-videos"><a href="#Self-Hosting-videos" class="headerlink" title="Self-Hosting videos"></a>Self-Hosting videos</h4></li>
<li><a href="https://www.youtube.com/watch?v=oC7y_qYKUTU">DB Tech - ZeroTier Network Controller in Docker</a> - Self-hosted ZeroTier on Docker.<h3 id="ZeroTier-Training"><a href="#ZeroTier-Training" class="headerlink" title="ZeroTier Training"></a>ZeroTier Training</h3><h4 id="ZeroTier-Training-courses"><a href="#ZeroTier-Training-courses" class="headerlink" title="ZeroTier Training courses"></a>ZeroTier Training courses</h4></li>
<li><a href="https://www.cbtnuggets.com/it-training/skills/securely-connect-local-network-devices-aws-vpczerotier">CBT Nuggets - Securely Connect Local Network Devices to AWS VPC with ZeroTier</a><h3 id="ZeroTier-Networking"><a href="#ZeroTier-Networking" class="headerlink" title="ZeroTier Networking"></a>ZeroTier Networking</h3><h4 id="Networking-articles"><a href="#Networking-articles" class="headerlink" title="Networking articles"></a>Networking articles</h4></li>
<li><a href="https://dev.to/issmirnov/abusing-public-dns-for-zerotier-routing-36ke">Abusing Public DNS for Zerotier Routing</a></li>
<li><a href="https://www.petekeen.net/building-a-private-backplane-network-with-zerotier">Building a Private Backplane Network for your VPSs with ZeroTier | Pete Keen</a></li>
<li><a href="https://dzone.com/articles/creating-secure-private-networks-with-zerotier-vpn">Creating Secure Private Networks With ZeroTier VPN</a></li>
<li><a href="https://www.linkedin.com/pulse/creating-site-to-site-vpn-zerotier-bgp-robert-lynch/">Creating a Site-to-Site VPN with ZeroTier and BGP</a></li>
<li><a href="https://blog.fosketts.net/2022/01/14/how-to-connect-everything-from-everywhere-with-zerotier/">How To Connect Everything From Everywhere with ZeroTier</a></li>
<li><a href="https://www.danmanners.com/posts/2021-12-multi-cloud-k3s-and-booted-from-gcloud/">Multi-Cloud K3s, and also I got (temporarily) kicked off Google Cloud</a></li>
<li><a href="https://stubarea51.net/2021/11/23/network-modeling-segmented-lab-access-with-containerlab-and-zerotier">Network Modeling: Segmented Lab access with Containerlab and ZeroTier</a></li>
<li><a href="https://chrisatech.wordpress.com/2021/02/22/routing-traffic-to-zerotiers-subnet-from-all-devices-on-the-lan/">Routing traffic to ZeroTier’s subnet from all devices on the LAN</a><h4 id="Networking-articles-global"><a href="#Networking-articles-global" class="headerlink" title="Networking articles global"></a>Networking articles global</h4></li>
<li><a href="https://jiayaoo3o.github.io/2020/06/11/%E6%AF%94frp%E6%9B%B4%E5%A5%BD%E7%94%A8%E7%9A%84%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7-ZeroTier%20One/#more">比frp更好用的内网穿透工具-ZeroTier One</a></li>
<li><a href="https://blog.toolman.xyz/article/240">zerotier 基礎使用步驟教學</a></li>
<li><a href="https://cerebrux.net/2021/10/24/zerotier-%ce%b4%ce%b9%ce%ba%cf%84%cf%8d%cf%89%cf%83%ce%b7-%ce%b1%cf%80%ce%bf%ce%bc%ce%b1%ce%ba%cf%81%cf%85%cf%83%ce%bc%ce%ad%ce%bd%cf%89%ce%bd-%cf%83%cf%85%cf%83%ce%ba%ce%b5%cf%85%cf%8e%ce%bd/">ZeroTier | Δικτύωση απομακρυσμένων Linux, Windows, macOS, BSD, Android, iOS συσκευών</a><h4 id="Networking-videos"><a href="#Networking-videos" class="headerlink" title="Networking videos"></a>Networking videos</h4></li>
<li><a href="https://www.youtube.com/watch?v=Af758HL6VkA">Considered Normal? - Creating a Local LAN with ZeroTier</a></li>
<li><a href="https://www.youtube.com/watch?v=xp2ujXe1SOU">Duane Dunston - Private ZeroTier Network on the Public Internet</a></li>
<li><a href="https://www.youtube.com/watch?v=Fb65bU3oyEo">Duane Dunston - ZeroTier Hub and Spoke</a></li>
<li><a href="https://www.youtube.com/watch?v=XrLk21Xy2i0">Eric Sloof - ZeroTier - The ethernet switch for planet earth</a></li>
<li><a href="https://www.youtube.com/watch?v=JwGKi3UWJ_I">infoTK - Finally ! work from home using VPN free and without Public IP</a></li>
<li><a href="https://www.youtube.com/watch?v=eI-yxrMH3uY">MRP - Local Network everywhere - Zero Tier : Global Area Networking</a></li>
<li><a href="https://www.youtube.com/watch?v=Lao9T_RQTak">Network Collective - How Does ZeroTier Actually Work?</a></li>
<li><a href="https://www.youtube.com/watch?v=QfcwiSkV_AU">Lawrence Systems - Open Source Mesh VPN Solutions</a></li>
<li><a href="https://www.youtube.com/watch?v=Bl_Vau8wtgc">Lawrence Systems - ZeroTier Tutorial: Delivering the Capabilities of VPN, SDN, and SD-WAN via an Open Source System</a></li>
<li><a href="https://www.youtube.com/watch?v=9GTXN0opsdw">LearnLinuxTV - Networking with ZeroTier: Creating software-defined networks with Ease</a></li>
<li><a href="https://www.youtube.com/watch?v=1Sobvh6OiC8">Sheridan Computers - ZeroTier | Virtual Networking | Remote Desktop | Remote Working | VPN</a><h4 id="Networking-videos-global"><a href="#Networking-videos-global" class="headerlink" title="Networking videos global"></a>Networking videos global</h4></li>
<li><a href="https://www.youtube.com/watch?v=7tN9iw7FIo4">ADINATA - ZeroTier Solusi Remote Perangkat Aman Dan Nyaman Untuk Pengguna Internet Broadband Dan Dedicated</a></li>
<li><a href="https://blog.ayudait.eu/2020/11/usando-zerotier-one-y-nextdns.html">Usando ZeroTier One y NextDNS para acceder a tus datos por VPN</a></li>
<li><a href="https://www.youtube.com/watch?v=ZtXhZCkxaak">NASeros - Incorporación de un ordenador a ZeroTier</a></li>
<li><a href="https://www.youtube.com/watch?v=z8N1NeYORbM">Servicios Virtuales Administrados SVA - Multi Usuario RDP/VPN ZeroTier — CURSO GRATUITO</a></li>
<li><a href="https://www.youtube.com/watch?v=Pk5EXqNLFzA&amp;t=1s">Software Defined Networks with ZeroTier | Urdu</a></li>
<li>[VPN multisitio con ZeroTier]<a href="https://www.youtube.com/watch?v=ZDcwKQM1J4s&amp;t=2s">(</a>)</li>
<li><a href="https://www.youtube.com/watch?v=LHilEAF5S2U&amp;t">Zerotier: la Terra è il tuo ufficio (sicuro e privato)</a><h3 id="ZeroTier-Linux"><a href="#ZeroTier-Linux" class="headerlink" title="ZeroTier Linux"></a>ZeroTier Linux</h3></li>
<li><a href="https://github.com/Duoslow/zerotierIndicator">Duoslow / zerotierIndicator</a><h4 id="Linux-articles"><a href="#Linux-articles" class="headerlink" title="Linux articles"></a>Linux articles</h4></li>
<li><a href="https://www.simplecto.com/zerotier-jq-manage-zerotier-networks/">Curl and jq to Manage ZeroTier networks</a></li>
<li><a href="https://www.greghilston.com/post/install_zerotier/">Install Zerotier CLI Linux</a><h4 id="Linux-videos"><a href="#Linux-videos" class="headerlink" title="Linux videos"></a>Linux videos</h4></li>
<li><a href="https://www.youtube.com/watch?v=9KMHwCUzf4g">Roel Van de Paar - Install ZeroTier on Ubuntu with armhf hardware</a><h3 id="ZeroTier-Remote-Access"><a href="#ZeroTier-Remote-Access" class="headerlink" title="ZeroTier Remote Access"></a>ZeroTier Remote Access</h3><h4 id="Remote-Access-articles"><a href="#Remote-Access-articles" class="headerlink" title="Remote Access articles"></a>Remote Access articles</h4></li>
<li><a href="https://john.muchovej.com/thoughts/remote-access-without-port-forwarding/">Remote Access Without Port Forwarding</a></li>
<li><a href="https://www.spikefishsolutions.com/post/setting-up-remote-access-during-a-crisis">Setting up Remote Access During a Crisis</a></li>
<li><a href="https://www.stratospherix.com/support/how-to-access-your-files-from-anywhere-with-zerotier.php">Stratospherix FileBrowser - How to access your files from anywhere</a><h4 id="Remote-Access-articles-global"><a href="#Remote-Access-articles-global" class="headerlink" title="Remote Access articles global"></a>Remote Access articles global</h4></li>
<li><a href="https://www.canaletto.fr/post/teletravail-rdp-vpn">Télétravail, RDP &amp; VPN</a></li>
<li><a href="https://www.clien.net/service/board/park/14534750">zerotier 팀뷰어만 되는 환경에서 사용하니 정말 좋군요.</a><h4 id="Remote-Access-videos"><a href="#Remote-Access-videos" class="headerlink" title="Remote Access videos"></a>Remote Access videos</h4></li>
<li><a href="https://www.youtube.com/watch?v=ZShna7v77xc">Lawrence Systems - How To Work Remotely Using ZeroTier &amp; Windows Remote Desktop (RDP)</a></li>
<li><a href="https://www.youtube.com/watch?v=EgdFzxit_6M">Odly Otter - Setting up ZeroTier to securely connect to your home server while roaming</a></li>
<li><a href="https://www.youtube.com/watch?v=7C2AGnr9Q-w">Remote Access: Securely connect your devices over the internet with ZeroTier</a></li>
<li><a href="https://www.youtube.com/watch?v=bUOU8BW0IrM">The Cyber Mentor - Hack From Anywhere! - ZeroTier Remote Access</a><h3 id="ZeroTier-SD-WAN"><a href="#ZeroTier-SD-WAN" class="headerlink" title="ZeroTier SD-WAN"></a>ZeroTier SD-WAN</h3><h4 id="SD-WAN-articles"><a href="#SD-WAN-articles" class="headerlink" title="SD-WAN articles"></a>SD-WAN articles</h4></li>
<li><a href="https://www.linkedin.com/pulse/consumer-grade-sd-wan-solution-improve-mobile-jonathan-gearinger/">A consumer-grade SD-WAN solution to improve mobile internet</a></li>
<li><a href="https://know.innon.com/vpn-zerotier-and-teltonika">How do I create a VPN/SD-WAN with Zerotier and Teltonika?</a></li>
<li><a href="https://foro.seguridadwireless.net/openwrt/vpn-con-zerotier-en-openwrt/">ZeroTier on OpenWrt (VPN + SD-WAN)</a><h4 id="SD-WAN-videos"><a href="#SD-WAN-videos" class="headerlink" title="SD-WAN videos"></a>SD-WAN videos</h4></li>
<li><a href="https://www.youtube.com/watch?v=dn8rFCttJVg">Profitap HQ B.V - How to Connect IOTA to ZeroTier SD-WAN environment</a></li>
<li><a href="https://www.youtube.com/watch?v=pntbQBtneZg">SecurityGuy - Hands-on with ZeroTier SD-WAN for Cloud Connectivity</a><h4 id="SD-WAN-videos-global"><a href="#SD-WAN-videos-global" class="headerlink" title="SD-WAN videos global"></a>SD-WAN videos global</h4></li>
<li><a href="https://www.youtube.com/watch?v=pM2ZQ9trcM8">LACNIC RIR - ZeroTier - Usando una solución Open Source para integrar VPNs e iniciar operaciones SD-WAN</a><h3 id="ZeroTier-IoT"><a href="#ZeroTier-IoT" class="headerlink" title="ZeroTier IoT"></a>ZeroTier IoT</h3></li>
</ul>
<h2 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h2><h3 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h3><p><a href="https://github.com/zerotier/">github.com/zerotier/zerotierone</a></p>
<blockquote>
<p><strong>NEXT STEPS</strong><br>Click <a href="https://docs.zerotier.com/start/">here</a> to create your network and start adding devices.</p>
</blockquote>
<h2 id="Releases"><a href="#Releases" class="headerlink" title="Releases"></a>Releases</h2><blockquote>
<p><strong>BEFORE DOWNLOADING</strong><br>Click <a href="https://docs.zerotier.com/start/">here</a> to create your network and then start adding devices.</p>
<h3 id="Downloads-Page"><a href="#Downloads-Page" class="headerlink" title="Downloads Page"></a>Downloads Page</h3><p><a href="http://www.zerotier.com/download">http://www.zerotier.com/download</a></p>
<h3 id="Past-versions-of-ZeroTier"><a href="#Past-versions-of-ZeroTier" class="headerlink" title="Past versions of ZeroTier"></a>Past versions of ZeroTier</h3><p><a href="http://download.zerotier.com/RELEASES/">download.zerotier.com/RELEASES/</a></p>
<h3 id="Release-Notes"><a href="#Release-Notes" class="headerlink" title="Release Notes"></a>Release Notes</h3><p><a href="https://github.com/zerotier/ZeroTierOne/blob/dev/RELEASE-NOTES.md">github.com/zerotier/zerotierone</a></p>
</blockquote>
<h1 id="How-ZeroTier-Works"><a href="#How-ZeroTier-Works" class="headerlink" title="How ZeroTier Works"></a>How ZeroTier Works</h1><p>Our installable client service.</p>
<h2 id="The-Protocol"><a href="#The-Protocol" class="headerlink" title="The Protocol"></a>The Protocol</h2><p>ZeroTier is a smart programmable Ethernet switch for planet Earth. It allows all networked devices, VMs, containers, and applications to communicate as if they all reside in the same physical data center or cloud region.</p>
<h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p>ZeroTier is a distributed network hypervisor built atop a cryptographically secure global peer to peer network. It provides advanced network virtualization and management capabilities on par with an enterprise SDN switch, but across both local and wide area networks and connecting almost any kind of app or device.<br>This is accomplished by combining a cryptographically addressed and secure peer to peer network (termed VL1) with an Ethernet emulation layer somewhat similar to VXLAN (termed VL2). Our VL2 Ethernet virtualization layer includes advanced enterprise SDN features like fine grained access control rules for network micro-segmentation and securty monitoring.<br>All ZeroTier traffic is encrypted end-to-end using secret keys that only you control. Most traffic flows peer to peer, though we offer free (but slow) relaying for users who cannot establish peer to peer connections.<br>Everything in the ZeroTier world is controlled by two types of identifier: 40-bit/10-digit <em>ZeroTier address</em> and 64-bit/16-digit <em>network IDs</em>. These identifiers are easily distinguished by their length. A ZeroTier address identifies a node or “device”(laptop, phone, server, VM, app, etc.) while a network ID identifies a virtual Ethernet network that can be joined by devices.<br>ZeroTier addresses can be thought of as port numbers on an enormous planet-wide enterprise Ethernet smart switch supporting VLANs. Network IDs are VLAN IDs to which these ports may be assigned. A single port can be assigned to more than one VLAN.<br>A ZeroTier address looks like <code>8056c2e21c</code> and a network ID looks like <code>8056c2e21c000001</code>. Network IDs are composed of the ZeroTier address of that network’s primary controller and an arbitrary 24-bit ID that identifies the network on this controller. Network controllers are roughly analogous to SDN controllers in SDN protocols like <a href="https://en.wikipedia.org/wiki/OpenFlow">OpenFlow</a>, though as with the analogy between VXLAN and VL2 this should not be read to imply that the protocols or design are the same. You can use our convenient and inexpensive SaaS hosted controllers at <a href="https://my.zerotier.com/">my.zerotier.com</a> or <a href="https://github.com/zerotier/ZeroTierOne/controller/">run your own controller</a> if you don’t mind messing around with JSON configuration files or writing scripts to do so.</p>
<blockquote>
<p><strong>INFO</strong><br>Visit <a href="https://www.zerotier.com/">ZeroTier’s site</a> for more information and <a href="https://www.zerotier.com/download/">pre-built binary packages</a>. Apps for Android and iOS are available for free in the Google Play and Apple app stores.</p>
</blockquote>
<h3 id="Origin-and-Design-Philosophy"><a href="#Origin-and-Design-Philosophy" class="headerlink" title="Origin and Design Philosophy"></a>Origin and Design Philosophy</h3><p>The goals and design principles of ZeroTier are inspired by among other things the original <a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/43231.pdf">Google BeyondCorp</a> paper and the <a href="https://en.wikipedia.org/wiki/Jericho_Forum">Jericho Forum</a> with its notion of “deperimeterizationg.”</p>
<h3 id="Network-Hypervisor"><a href="#Network-Hypervisor" class="headerlink" title="Network Hypervisor"></a>Network Hypervisor</h3><p>The ZeroTier network hypervisor (currently found in the <a href="https://github.com/zerotier/ZeroTierOne/tree/master/node">node/</a> subfolder of the ZeroTierOne git repository) is a self-contained network virtualization engine that implements an Ethernet virtualization layer similar to <a href="https://en.wikipedia.org/wiki/Virtual_Extensible_LAN">VXLAN</a> on top of a global encrypted peer to peer network.<br>The ZeroTier protocol is original, though aspects of it are similar to VXLAN and IPSec. It has two conceptually separate but closely coupled layer <a href="https://en.wikipedia.org/wiki/OSI_model">in the OSI model</a> sense: <strong>VL1</strong> and <strong>VL2</strong>. VL1 is the underlying peer to peer transport layer, the “virtual wire,” while VL2 is an emulated Ethernet layer that provides operating systems and apps with a familiar communication medium.</p>
<h3 id="The-ZeroTier-Peer-to-Peer-Network-VL1"><a href="#The-ZeroTier-Peer-to-Peer-Network-VL1" class="headerlink" title="The ZeroTier Peer to Peer Network (VL1)"></a>The ZeroTier Peer to Peer Network (VL1)</h3><p>A global data center requires a global wire closet.<br>In conventional networks L1 (OSI layer 1) refers to the actual CAT5/CAT6 cables or wireless radio channels over which data is carried and the physical transceiver chips that modulate and demodulate it. VL1 is a peer to peer network that does the same thing by using encryption, authentication, and a lot of networking tricks to create virtual wires on a dynamic as-needed basis.</p>
<h3 id="Network-Topology-and-Peer-Discovery"><a href="#Network-Topology-and-Peer-Discovery" class="headerlink" title="Network Topology and Peer Discovery"></a>Network Topology and Peer Discovery</h3><p>VL1 is designed to be zero-configuration. A user can start a new ZeroTier node without having to write configuration files or provide the IP addresses of other nodes. It’s also designed to be fast. Any two devices in the world should be able to locate each other and communicate almost instantly.<br>To achieve this VL1 is organized like DNS. At the base of the network is a collection of always-present <strong>root servers</strong> whose role is similar to that of <a href="https://en.wikipedia.org/wiki/Root_name_server">DNS root name servers.</a> Roots run the same software as regular endpoints but reside at fast stable locations on the network and are designated as such by a <strong>world definition</strong>. World definitions come in two forms: the <strong>planet</strong> and one or more <strong>moons</strong>. The protocol includes a secure mechanism allowing world definitions to be updated in-band if root servers’ IP addresses or ZeroTier addresses change.<br>There is only one planet. Earth’s root servers are operated by ZeroTier, Inc. as a free service. There are currently four root servers distributed across the globe and multiple network providers. Almost everyone in the wrold has one within less than 100ms network latency from their location.<br>A node can “orbit” any number of moons. A moon is just a convenient way to add user-defined root servers to the pool. Users can create moons to reduce dependency on ZeroTier, Inc. infrastructure or to locate root servers closer for better performance. For on-premise SDN use a cluster of root servers can be located inside a building or data center so that ZeroTier can continue to operate normally if Internet connectivity is lost.<br>Nodes start with no direct links to one another, only upstream to roots (planet and moons). Every peer on VL1 possesses a globally unique 40-bit (10 hex digit) <strong>ZeroTier address</strong>, but unlike IP addresses these are opaque cryptographic identifiers that encode no routing information. To communicate peers first send packets “up” the tree, and as these packets traverse the network they trigger the opportunistic creation of direct links along the way. The tree is constantly trying to “collapse itself” to optimize itself to the pattern of traffic it is carrying.<br>Peer to peer connection setup goes like this:</p>
<ol>
<li>A wants to send a packet to B, but since it has no direct path it sends it upstream to R (a root).</li>
<li>If R has a direct link to B, it forwards the packet there. Otherwise it sends the packet upstream until planetary roots are reached. Planetary roots know about all nodes, so eventually the packet will reach B if B is online.</li>
<li>R also sends a message called <em>rendezvous</em> to A containing hints about how it might reach A.</li>
<li>A and B get their <em>rendezous</em> messages and attempt to send test messages to each other, possibly accomplishing <a href="https://en.wikipedia.org/wiki/UDP_hole_punching">hole punching</a> of any NATs or stateful firewalls that happen to be in the way. If this works a direct link is established and packets no longer need to take the scenic route.</li>
</ol>
<p>Since roots forward packets, A and B can reach each other instantly. A and B then begin attempting to make a direct peer to peer connection. If this succeeds it results in a faster lower latency like. We call this <em>transport triggered link provisioning</em> since it’s the forwarding of the packet itself that triggers the peer to peer network to attempt direct connection.<br>VL1 never gives up. If a direct path can’t be established, communication can continue through (slower) relaying. Direct connection attempts continue forever on a periodic basis. VL1 also has other features for establishing direct connectivity including LAN peer discovery, port prediction for traversal of symmetric IPv4 NATs, and explicit port mapping using uPnP and/or NAT-PMP if these are available on the local physical LAN.<br><em><a href="http://adamierymenko.com/decentralization.html">A blog post from 2014 by ZeroTier’s original author explains some of the reasoning behind VL1’s design.</a></em></p>
<h3 id="Addressing"><a href="#Addressing" class="headerlink" title="Addressing"></a>Addressing</h3><p>Every node is uniquely identified on VL1 by a 40-bit (10 hex digit) <strong>ZeroTier address</strong>. This address is computed from the public portion of public/provate key pair. A node’s address, public key, and private key together form its <strong>identity</strong>.<br><em>On devices running ZeroTier One the node identity is stored in <code>identity.public</code> and <code>identity.secret</code> in the service’s home directory.</em><br>When ZeroTier starts for the first time it generates a new identity. It then attempts to advertise it upstream to the network. In the very unlikely event that the identity’s 40-bit unique address is taken, it discards it and generates another.<br>Identities are claimed on a first come first serve basis and currently expire from planetary roots after 60 days of inactivity. If a long-dormant device returns it may re-claim its identity unless its address has been taken in the meantime (again, highly unlikely).<br>The address derivation algorithm used to compute addresses from public keys imposes a computational cost barrier against the intentional generation of a collision. Currently it would take approximately 10,000 CPU-years to do so (assuming e.g. a 3ghz intel core). This is expensive but not impossible, but it’s only the first line of defense. After generating a collision an attacker would then have to compromise all upstream nodes, network controllers, and anything else that has recently communicated with the target node and replace their cached identities.<br>ZeroTier addresses are, once advertised and claimed, a very secure method of unique identification.<br>When a node attempts to send a message to another node whose identity is not cached, it sends a <em>whois</em> query upstream to a root. Roots provide an authoritative identity cache.</p>
<h3 id="Cryptography"><a href="#Cryptography" class="headerlink" title="Cryptography"></a>Cryptography</h3><p>If you don’t know much about cryptography you can safely skip this section. <strong>TL;DR: packets are end-to-end encrypted and can’t be read by roots or anyone else, and we use modern 256-bit crypto in ways recommended by the professional cryptographers that created it.</strong><br>Asymmetric public key encryption is <a href="https://en.wikipedia.org/wiki/Curve25519">Curve25519/Ed25519</a>, a 256-bit elliptic curve variant.<br>Every VL1 packet is encrypted end to end using (as of the current version) 256-bit <a href="https://ianix.com/pub/salsa20-deployment.html">Salsa20</a> and authenticated using the <a href="https://en.wikipedia.org/wiki/Poly1305">Poly1305</a> message authentication (MAC) algorithm. MAC is computed after encryption <a href="https://tonyarcieri.com/all-the-crypto-code-youve-ever-written-is-probably-broken">(encrypt-then-MAC)</a> and the cipher/MAC composition used is identical to the <a href="https://nacl.cr.yp.to/">NaCI reference implementation</a>.<br>As of today we do not implement <a href="https://en.wikipedia.org/wiki/Forward_secrecy">forward secrecy</a> or other stateful cryptographic features in VL1. We don’t do this for the sake of simplicity, reliability, and code footprint, and because frequently changing state makes features like clustering and fail-over much harder to implement. See <a href="https://github.com/zerotier/ZeroTierOne/issues/204">our discussion on GitHub</a>.<br>We may implement forward secrecy in the future. For those who want this level of security today, we recommend using other cryptographic protocols such as SSL or SSH over ZeroTier. These protocols typically implement forward secrecy, but using them over ZeroTier also provides the secondary benefit of defense in depth. Most cryptography is compromised not by a flaw in encryption bu through bugs in the implementation. If you’re using two secure transports, the odds of a critical bug being discovered in both at the same time is very low. The CPU overhead of double-encryption is not significant for most work loads.</p>
<blockquote>
<p><strong>SECURITY</strong><br><a href="https://docs.zerotier.com/faq-security">More information on ZeroTier’s security practices</a></p>
</blockquote>
<h3 id="Trusted-Paths-for-Fast-Local-SDN"><a href="#Trusted-Paths-for-Fast-Local-SDN" class="headerlink" title="Trusted Paths for Fast Local SDN"></a>Trusted Paths for Fast Local SDN</h3><p>To support the use of ZeroTier as a high performance SDN/NFV protocol over physically secure network the protocol supports a feature called <em>trusted paths</em>. It is possible to configure all ZeroTier devices on a given network to skip encryption and authentication for traffic over a designated physical path. This can cut CPU use noticeably in high traffic scenarios but at the cost of losing virtually all transport security.<br>Trusted paths do not prevent communication with devices elsewhere, since traffic over other paths will be encrypted and authenticated normally.<br>We don’t recommend the use of this feature unless you really need the performance and you know what you’re doing. We also recommend thinking carefully before disabling transport security on a cloud private network. Larger cloud providers such as Amazon and Azure tend to provide good network segregation but many less costly providers offer private networks that are “party lines” and are not much more secure than the open Internet.</p>
<h3 id="Multipath"><a href="#Multipath" class="headerlink" title="Multipath"></a>Multipath</h3><p>Multipath allows the simultaneous (or conditional) aggregation of multiple physical links into a bond for increased total throughput, load balancing, redundancy, and fault tolerance. There is a set of standard bonding policies available that can be used right out of the box with no configuration. These policies are inspired by the policies offered by the Linux kernel. A bonding policy can be used easily without specifying any additional parameters.</p>
<blockquote>
<p><strong>MULTIPATH GUIDE</strong></p>
<ul>
<li>See <a href="https://docs.zerotier.com/multipath">here</a> for more info and examples.</li>
</ul>
</blockquote>
<h3 id="Ethernet-Virtualization-Layer-VL2"><a href="#Ethernet-Virtualization-Layer-VL2" class="headerlink" title="Ethernet Virtualization Layer (VL2)"></a>Ethernet Virtualization Layer (VL2)</h3><p><strong>VL2</strong> is a <a href="https://en.wikipedia.org/wiki/Virtual_Extensible_LAN">VXLAN</a>-like network virtualization protocol with SDN management features. It implements secure VLAN boundaries, multicast, rules, capability based security, and certificate based access control.<br>VL2 is built atop and carried by VL1, and in so doing it inherits VL1’s encryption and endpoint authentication and can use VL1 asymmetric keys to sign and verify credentials. VL1 also allows us to implement VL2 entirely free of concern for underlying physical network topology. Connectivity and routing efficiency issues are VL1 concerns. It’s important to understand that there is no relationship between VL2 virtual networks and VL1 paths. Much like VLAN multiplexing on a wired LAN, two nodes that share multiple network memberships in common will still only have one VL1 path (virtual wire) between them.</p>
<h3 id="Network-Identifiers-and-Controllers"><a href="#Network-Identifiers-and-Controllers" class="headerlink" title="Network Identifiers and Controllers"></a>Network Identifiers and Controllers</h3><p>Each VL2 network (VLAN) is identified by a 64-bit (16 hex digit) <strong>ZeroTier network ID</strong> that contains the 40-bit ZeroTier address of the network’s <strong>controller</strong> and a 24-bit number identifying the network on the controller.</p>
<pre><code>Network ID: 8056c2e21c123456
            |         |
            |         Network number on controller
            |
            ZeroTier address of controller
</code></pre><p>When a node joins a network or requests a network configuration update, it sends a network config query message (via VL1) to the network’s controller. The controller can then use the node’s VL1 address to look it up on the network and send it the appropriate certificates, credentials, and configuration information. From the perspective of VL2 virtual networks, VL1 ZeroTier addresses can be thought of as port numbers on an enormous global-scale virtual switch.<br>A common misunderstanding is to conflate network controllers with root servers (planet and moons). Root servers are connection facilitators that operate at the VL1 level. Network controllers are configuration managers and certificate authorities that belong to VL2. Generally root servers don’t join or control virtual networks and network controllers are not root servers, though it is possible to have a node do both.</p>
<h4 id="Controller-Security-Considerations"><a href="#Controller-Security-Considerations" class="headerlink" title="Controller Security Considerations"></a>Controller Security Considerations</h4><p>Network controllers serve as certificate authorities for ZeroTier virtual networks. As such, their <code>identity.secret</code> files should be guarded closely and backed up securely. Compromise of a controller’s secret key would allow an attacker to issue fraudulent network configurations or admit unauthorized members, while loss of the secret key results in loss of ability to control the network in any way or issue configuration updates and effectively renders the network unusable.<br>It is important that controllers’ system clocks remain relatively accurate (to within 30-60 seconds) and that they are secure against against remote tampering. Many cloud providers provide secure time sources either directly via the hypervisor or via NTP servers within their networks.</p>
<h3 id="Certificates-and-Other-Credentials"><a href="#Certificates-and-Other-Credentials" class="headerlink" title="Certificates and Other Credentials"></a>Certificates and Other Credentials</h3><p>All credentials issued by network controllers to member nodes in a given network are signed by the controller’s secret key to allow all network members to verify them. Credentials have timestamp fields populated by the controller, allowing relative comparison without the need to trust the node’s local system clock.<br>Credentials are issued only to their owners and are then pushed peer to peer by nodes that wish to communicate with other nodes on the network. This allows networks to grow to enormous sizes without requiring nodes to cache large numbers of credentials or to constantly consult the controller.</p>
<h4 id="Credential-Types"><a href="#Credential-Types" class="headerlink" title="Credential Types"></a>Credential Types</h4><ul>
<li><strong>Certificates of Membership</strong>: a certificate that a node presents to obtain the riht to communicate on a given network. Certificates of membership are accepted if they <em>agree</em>, meaning that the submitting member’s certificate’s timestamp differs from the recipient’s certificate’s timestamp by no more than the recipient certificate’s maximum timestamp delta value. This creates a decentralized moving-window scheme for certificate expiration without requiring node clock synchronization or constant checking with the controller.</li>
<li><strong>Revocations</strong>: a revocation instantaneously revokes a given credential by setting a hard timestamp limit before which it will not be accepted. Revocations are rapidly propagated peer to peer among members of a network using a rumor mill algorithm, allowing a controller to revoke a member credential across the entire network even if its connection to some members is unreliable.</li>
<li><strong>Capabilities</strong>: a capability is a bundle of network rules that is signed by the controller and can be presented to other members of a network to grant the presenter elevated privileges within the framwork of the network’s base rule set. More on this in the section on rules.</li>
<li><strong>Tags</strong>: a tag is a key/value pair signed by the controller that is automatically presented by members to one another and can be matched on in base or capability network rules. Tags can be used to categorize members by role, department, classification, ect.</li>
<li><strong>Certificates of Ownership</strong>: these certify that a given netwrok member owns something, such as an IP address. These are currently only used to lock down netwroks against IP address spoofing but could be used in the future to certify ownership of other network-level entities that can be matched in a filter.</li>
</ul>
<h3 id="Multicast-ARP-NDP-and-Special-Addressing-Modes"><a href="#Multicast-ARP-NDP-and-Special-Addressing-Modes" class="headerlink" title="Multicast, ARP, NDP, and Special Addressing Modes"></a>Multicast, ARP, NDP, and Special Addressing Modes</h3><p>ZeroTier netwroks support multicast via a simple publish/subscribe system.<br>When a node wishes to receive multicasts for a given multicast group, it advertises membership in this group to other members of the network with which it is communicating and to the network controller. When a node wishes to send a multicast it both consults its cache of recent advertisements and periodically solicits additional advertisements.<br>Broadcast (Ethernet <em>ff:ff:ff:ff:ff:ff</em>) is treated as a multicast group to which all members subscribe. It can be disabled at the network level to reduce traffic if it is not needed. IPv4 ARP receives special handling (see below) and will still work if normal broadcast is disabled.<br>Multicasts are propagated using simple sender-side replication. This places the full outbound bandwidth load for multicast on the sender and minimizes multicast latency. Network configurations contain a network-wide <strong>multicast limit</strong> configurable at the network controller. This specifies the maximum number of other nodes to which any node will send a multicast. If the number of known recipients in a given multicast group exceeds the multicast limit, the sender chooses a random subset.<br>There is no global limit on multicast recipients, but setting the multicast limit very high on very large networks could result in significant bandwidth overhead.</p>
<h4 id="Special-Handling-of-IPv4-ARP-Broadcasts"><a href="#Special-Handling-of-IPv4-ARP-Broadcasts" class="headerlink" title="Special Handling of IPv4 ARP Broadcasts"></a>Special Handling of IPv4 ARP Broadcasts</h4><p>IPv4 <a href="https://en.wikipedia.org/wiki/Address_Resolution_Protocol">ARP</a> is built on simple Ethernet broadcast and scales poorly on large or distributed networks. To improve ARP’s scalability ZeroTier generates a unique multicast group for each IPv4 address detected on its system and then transparently intercepts ARP queries and sends them only to the correct group. This converts ARP into effectively a unicast or narrow multicast protocol (like IPv6 NDP) and allows IPv4 ARP to work reliably across wide area networks without excess bandwidth consumption. A similar strategy is implemented under the hood by a number of enterprise switches and WiFi routers designed for deployment on extremely large LANs. This ARP emulation mode is transparent to the OS and application layers, but it does mean that packet sniffers will not see all ARP queries on a virtual network the way they typically can on smaller wired LANs.</p>
<h4 id="Multicast-Free-IPv6-Addressing-Modes"><a href="#Multicast-Free-IPv6-Addressing-Modes" class="headerlink" title="Multicast-Free IPv6 Addressing Modes"></a>Multicast-Free IPv6 Addressing Modes</h4><p>IPv6 uses a protocol called <a href="https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol">NDP</a> in place of ARP. It is similar in role and design but uses narrow multicast in place of broadcast for superior scalability on large networks. This protocol nevertheless still imposes the latency of an additional multicast lookup whenever a new address is contacted. This can add hundreds of milliseconds over a wide area network, or more if latencies associated with pub/sub recipient lookup are significant.<br>IPv6 addresses are large enough to easily encode ZeroTier addresses. For faster operation and better scaling we’ve implemented several special IPv6 addressing modes that allow the local node to emulate NDP. These are ZeroTier’s <strong>rfc4193</strong> and <strong>6plane</strong> IPv6 address assignment schemes. If these addressing schemes are enabled on a network, nodes locally intercept outbound NDP queries for matching addresses and then locally generate spoofed NDP replies.<br>Both modes dramatically reduce initial connection latency between network members. <strong>6plane</strong> additionally exploits NDP emulation to transparently assign an entire IPv6 /80 prefix to every node without requiring any node to possess additional routing table entries. This is designed for virtual machine and container hosts that wish to auto-assign IPv6 addresses to guests and is very useful on microservice architecture backplane networks.<br>Finally there is a security benefit to NDP emulation. ZeroTier addresses are cryptographically authenticated, and since Ethernet MAC addresses on networks are computed from ZeroTier addresses these are also secure. NDP emulated IPv6 addressing modes are therefore not vulnerable to NDP reply spoofing.<br>Normal non-NDP-emulated IPv6 addresses (including link-local addresses) can coexist with NDP-emulated addressing schemes. Any NDP queries that do not match NDP-emulated addresses are sent via normal multicast.</p>
<h3 id="Ethernet-Bridging"><a href="#Ethernet-Bridging" class="headerlink" title="Ethernet Bridging"></a>Ethernet Bridging</h3><p>ZeroTier emulates a true Ethernet switch. This includes the ability to L2 bridge other Ethernet networks (wired LAN, WiFi, virtual backplanes, etc.) to virtual networks using conventional Ethernet bridging.<br>To act as a bridge a network member must be designated as such by the controller. This is for security reasons as normal network members are not permitted to send traffic from any origin other than their MAC address. Designated bridges also receive special treatment from the multicast algorithm, which more aggressively and directly queries them for group subscriptions and replicates all broadcast traffic and ARP requests to them. As a result bridge nodes experience a slightly higher amount of multicast bandwidth overhead.<br>Bridging has been tested extensively on Linux using the Linux kernel native bridge, which cleanly handles network MTU mismatch. There are third party reports of bridging working on other platforms. The details of setting up bridging, including how to selectively block traffic like DHCP that may not be wanted across the bridge, are beyond the scope of this manual.</p>
<blockquote>
<p><strong>GUIDE</strong><br>See our <a href="https://docs.zerotier.com/bridging">bridging tutorial</a></p>
</blockquote>
<h3 id="Public-Networks"><a href="#Public-Networks" class="headerlink" title="Public Networks"></a>Public Networks</h3><p>It is possible to disable access control on a ZeroTier network. A public network’s members do not check certificates of membership, and new members to a public network are automatically marked as authorized by their host controller. It is not possible to de-authorize a member from a public network.<br>Rules on the other hand are enforced, so it’s possible to implement a special purpose public network that only allows access to a few things or that only allows a restricted subset of traffic.<br>Public networks are useful for testing and for peer to peer “party lines” for gaming, chat, and other applications. <strong>Participants in public networks are warned to pay special attention to security. If joining a public network be careful not to expose vulnerable services or accidentally share private files via open network shares or HTTP servers. Make sure your operating system, applications, and services are fully up to date.</strong></p>
<h3 id="Ad-Hoc-Networks"><a href="#Ad-Hoc-Networks" class="headerlink" title="Ad-Hoc Networks"></a>Ad-Hoc Networks</h3><p>A special kind of public network called an ad-hoc network may be accessed by joining a network ID with the format:</p>
<pre><code>ffSSSSEEEE000000
| |   |   |
| |   |   Reserved for future use, must be 0
| |   End of port range (hex)
| Start of port range (hex)
Reserved ZeroTier address prefix indicating a controller-less network
</code></pre><p>Ad-hoc networks are public (no access control) networks that have no network controller. Instead their configuration and other credentials are generated locally. Ad-hoc networks permit only IPv6 UDP and TCP unicast traffic (no multicast or broadcast) using 6plane format NDP-emulated IPv6 addresses. In addition an ad-hoc network ID encodes an IP port range. UDP packets and TCP SYN (connection open) packets are only allowed to destination ports within the encoded range.<br>For example <code>ff00160016000000</code> is an ad-hoc network allowing only SSH, while <code>ff0000ffff000000</code> is an ad-hoc network allowing any UDP or TCP port.<br>Keep in mind that these networks are public and anyone in the entire world can join them. Care must be taken to avoid exposing vulnerable services or sharing unwanted files or other resources.</p>
<blockquote>
<p><strong>GETTING STARTED</strong><br>Click <a href="https://docs.zerotier.com/start/">here</a> to create your network and start adding devices.</p>
</blockquote>
<h2 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h2><h3 id="Cryptography-1"><a href="#Cryptography-1" class="headerlink" title="Cryptography"></a>Cryptography</h3><p>ZeroTier uses state of the art cryptographic methods to encrypt your traffic end-to-end. <a href="https://docs.zerotier.com/protocol#cryptography">Read more here</a></p>
<h3 id="Report-a-vulnerability"><a href="#Report-a-vulnerability" class="headerlink" title="Report a vulnerability"></a>Report a vulnerability</h3><p>If you believe you’ve found a vulnerability please follow the instructions here to <a href="https://github.com/zerotier/ZeroTierOne/blob/dev/SECURITY.md">report it to our team</a></p>
<h3 id="Audit"><a href="#Audit" class="headerlink" title="Audit"></a>Audit</h3><p>In March 2020 we worked with <code>@trailofbits</code> to audit our protocol and cryptographic designs for ZeroTier 2.0. As one of its subjects is in our just-released beta, we are ready to make our first preliminary audit public <a href="https://storage.googleapis.com/zt-web-large-files/ZeroTier%20Protocol%20Review%20Summary.pdf">here</a>. A full code audit is coming after 2.0.</p>
<h2 id="Rules-Engine"><a href="#Rules-Engine" class="headerlink" title="Rules Engine"></a>Rules Engine</h2><p>Traffic on ZeroTier networks can be observed and controlled with a system of globally applied network rules. These are enforced in a distributed fashion by both the senders and the receivers of packets. To escape the rules engine a malicious attacker would need to fully compromise both sides of any conversation.<br>The ZeroTier VL2 rules engine differs from most other firewalls and SDN rules engines in several ways. The most immediately relevant of these is that the ZeroTier rules engine is stateless, meaning it lacks connection tracking. This means that bidirectional whitelisting can’t be accomplished by simply whitelisting reply packets to established connections. Instead some thought must be put into how to allow both sides of a desired flow. Rule patterns to achieve the most common desired objectives are included in this manual.<br>The decision to make our rules engine stateless was a design trade-off driven by several concerns. First we wanted to keep complexity, code footprint, and memory use very low to support small embedded devices. The second and more fundamental reason is that distributed stateful filtering requires distributed state synchronization. This would have added a large volume of additional sync traffic as well as introducing <a href="https://en.wikipedia.org/wiki/CAP_theorem">inescapable</a> new sources of instability and failure and a lot of surface area for security vulnerabilities.<br>While ZeroTier lacks state tracking, its rules engine includes something not found anywhere else in the enterprise networking space: <a href="https://en.wikipedia.org/wiki/Capability-based_security">capability-based security</a> and device tagging. Capabilities and tags allow extremely complex micro-segmented network rule schemes to be implemented in a sane, conceptual way that is both easier for human beings to understand and more efficient for machines to handle.<br>This section assumes some level of familiarity with network rules as they’re commonly used on firewalls and routers, etc. While the rules engine is part of VL2, it’s been given its own section in this manual due to the depth and cross-cutting nature of the topic.</p>
<h3 id="Rule-Sets-and-Rule-Evaluation"><a href="#Rule-Sets-and-Rule-Evaluation" class="headerlink" title="Rule Sets and Rule Evaluation"></a>Rule Sets and Rule Evaluation</h3><p>Rule sets are ordered lists of one or more rules, with each rule consisting of one or more <strong>match</strong> conditions followed by one <strong>action</strong>. As a rule set is evaluated, each match is tested in order and is then ANDed or ORed with the previous match result state. When an action is encountered it is taken if the result of the preceding matches is true. An action with no preceding matches is always taken. If no permissive actions are taken by any rule set the packet is discarded.<br>Here is a simple rule set that constrains Ethernet traffic on a network to only IPv4, ARP, or IPv6 as it would appear in the raw JSON format used by ZeroTier One’s built-in network controller implementation. (Don’t worry if this seems verbose and difficult. We have a more human-friendly way of writing rule sets, but before we introduce it it’s important to understand what is really happening.)</p>
<pre><code class="lang-json">[
  &#123;
    &quot;etherType&quot;: 2048,
    &quot;not&quot;: true,
    &quot;or&quot;: false,
    &quot;type&quot;: &quot;MATCH_ETHERTYPE&quot;
  &#125;,
  &#123;
    &quot;etherType&quot;: 2054,
    &quot;not&quot;: true,
    &quot;or&quot;: false,
    &quot;type&quot;: &quot;MATCH_ETHERTYPE&quot;
  &#125;,
  &#123;
    &quot;etherType&quot;: 34525,
    &quot;not&quot;: true,
    &quot;or&quot;: false,
    &quot;type&quot;: &quot;MATCH_ETHERTYPE&quot;
  &#125;,
  &#123;
    &quot;type&quot;: &quot;ACTION_DROP&quot;
  &#125;,
  &#123;
    &quot;type&quot;: &quot;ACTION_ACCEPT&quot;
  &#125;
]
</code></pre>
<p>This checks whether an Ethernet level packet is not IPv4 (ethertype 2048) and not IPv4 ARP (ethertype 2054) and not IPv6 (ethertype 34525). If all three matches evaluate to true (meaning the ethertype is none of these) then the <strong>drop</strong> action is taken. Otherwise the <strong>accept</strong> action is taken.<br>Networks have one base rule set that is applied to all traffic. Its size is constrained to 1024 entries (each match or action is an entry). It should be used to set the overall policies for all members of the network, and for most common use cases it’s all you’ll need. For more complex scenarios, both capabilities and tags provide methods of both managing complexity and scaling the overall size of a network’s rule system.</p>
<h3 id="Actions-and-Match-Conditions"><a href="#Actions-and-Match-Conditions" class="headerlink" title="Actions and Match Conditions"></a>Actions and Match Conditions</h3><p>These are the available matches and actions in raw form. The rule definition language outlined in <a href="https://docs.zerotier.com/rules#rule-definition-language">Rule Definition Language</a> provides a friendlier way for human beings to specify rules.</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>Action</strong></th>
<th><strong>Argument(s)</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ACTION_DROP</td>
<td></td>
<td>Drop packet and terminate all rule evaluation, including capabilities.</td>
</tr>
<tr>
<td>ACTION_BREAK</td>
<td></td>
<td>Terminate evaluation of this rule set but continue evaluating capabilities.</td>
</tr>
<tr>
<td>ACTION_ACCEPT</td>
<td></td>
<td>Accept packet and terminate further evaluation.</td>
</tr>
<tr>
<td>ACTION_TEE</td>
<td>length, address</td>
<td>Send a copy of up to the first <em>length</em> bytes (-1 for all) to a ZeroTier address.</td>
</tr>
<tr>
<td>ACTION_REDIRECT</td>
<td>address</td>
<td>Transparently redirect this packet to a ZeroTier address without changing its headers.</td>
</tr>
<tr>
<td><strong>Match Condition</strong></td>
<td><strong>Argument(s)</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr>
<td>MATCH_SOURCE_ZEROTIER_ADDRESS</td>
<td>zt</td>
<td>VL1 source address.</td>
</tr>
<tr>
<td>MATCH_DEST_ZEROTIER_ADDRESS</td>
<td>zt</td>
<td>VL1 destination address.</td>
</tr>
<tr>
<td>MATCH_MAC_SOURCE</td>
<td>mac</td>
<td>Ethernet source address.</td>
</tr>
<tr>
<td>MATCH_MAC_DEST</td>
<td>mac</td>
<td>Ethernet destination address.</td>
</tr>
<tr>
<td>MATCH_IPV4_SOURCE</td>
<td>ip</td>
<td>IPv4 source address.</td>
</tr>
<tr>
<td>MATCH_IPV4_DEST</td>
<td>ip</td>
<td>IPv4 destination address.</td>
</tr>
<tr>
<td>MATCH_IPV6_SOURCE</td>
<td>ip</td>
<td>IPv6 source address.</td>
</tr>
<tr>
<td>MATCH_IPV6_DEST</td>
<td>ip</td>
<td>IPv6 destination address.</td>
</tr>
<tr>
<td>MATCH_IP_TOS</td>
<td>mask,start,end</td>
<td>IP TOS field bitwise-ANDed with mask is within range.</td>
</tr>
<tr>
<td>MATCH_IP_PROTOCOL</td>
<td>ipProtocol</td>
<td>IP protocol number.</td>
</tr>
<tr>
<td>MATCH_ETHERTYPE</td>
<td>etherType</td>
<td>Ethernet frame type.</td>
</tr>
<tr>
<td>MATCH_ICMP</td>
<td>icmpType,icmpCode</td>
<td>ICMP type and code, if applicable. (V4 or V6)</td>
</tr>
<tr>
<td>MATCH_IP_SOURCE_PORT_RANGE</td>
<td>start,end</td>
<td>IP (V4 or V6) source port range (inclusive).</td>
</tr>
<tr>
<td>MATCH_IP_DEST_PORT_RANGE</td>
<td>start,end</td>
<td>IP (V4 or V6) destination port range (inclusive).</td>
</tr>
<tr>
<td>MATCH_CHARACTERISTICS</td>
<td>mask</td>
<td>Bitwise AND characteristic bits with mask, true if result is nonzero.</td>
</tr>
<tr>
<td>MATCH_FRAME_SIZE_RANGE</td>
<td>start,end</td>
<td>Ethernet frame size range (inclusive).</td>
</tr>
<tr>
<td>MATCH_RANDOM</td>
<td>probability</td>
<td>Match if a random 32-bit number is less than or equal to the probability.</td>
</tr>
<tr>
<td>MATCH_TAGS_DIFFERENCE</td>
<td>id,value</td>
<td>Difference between tags with this ID is less than or equal to the value.</td>
</tr>
<tr>
<td>MATCH_TAGS_BITWISE_AND</td>
<td>id,value</td>
<td>Tags ANDed together equal value.</td>
</tr>
<tr>
<td>MATCH_TAGS_BITWISE_OR</td>
<td>id,value</td>
<td>Tags ORed together equal value.</td>
</tr>
<tr>
<td>MATCH_TAGS_BITWISE_XOR</td>
<td>id,value</td>
<td>Tags XORed together equal value.</td>
</tr>
<tr>
<td>MATCH_TAGS_EQUAL</td>
<td>id,value</td>
<td>Both tags equal the same value.</td>
</tr>
<tr>
<td>MATCH_TAG_SENDER</td>
<td>id,value</td>
<td>Sending side’s tag equals this value.</td>
</tr>
<tr>
<td>MATCH_TAG_RECEIVER</td>
<td>id,value</td>
<td>Receiving side’s tag equals this value.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Capabilities"><a href="#Capabilities" class="headerlink" title="Capabilities"></a>Capabilities</h3><p>A capability is a small rule set that is bundled into a credential object, signed by the network controller, and issued to only those member(s) permitted to exercise it. When a member detects that outgoing traffic does not match the base rule set but is allowed by one of its capabilities, it periodically pushes the matching capability credential to the recipient ahead of the packet(s) in question. Peer to peer capability distribution is automatic and is triggered by capability match.<br>When the recipient receives the capability it authenticates it by checking its signature and timestamp and, provided the capability is valid, adds it to the set of capabilities to apply to incoming traffic from the capability’s owner. The sender has effectively told the recipient “I can too send this packet! Teacher says so!”<br>Capabilities allow large systems of rules to be broken down into functional aspects and then distributed intelligently only to those members with a need to know. This avoids the bandwidth and storage overhead of distributing huge monolithic rule sets and organizes rules conceptually to make them easier for administrators to understand.<br>There are three terminating actions that can be taken in a rule set: <strong>accept</strong>, <strong>break</strong>, and <strong>drop</strong>. The accept action terminates rule evaluation and accepts the packet. The break action terminates the evaluation of the current rule set but permits the further evaluation of capabilities. The drop action terminates rule evaluation and drops the packet without checking capabilities in the base rule set, but is equivalent to break in capability rule sets. In most cases break should be used unless certain traffic must be absolutely prohibited under any circumstance.<br>In the simple base rule set example in section 3.1 the drop action is taken in the unapproved case. This means that Ethernet whitelisting cannot be overridden by a capability. If we change <em>ACTION_DROP</em> in our example to <em>ACTION_BREAK</em>, then it becomes possible to issue the following capability:</p>
<pre><code class="lang-json">[
  &#123;
    &quot;etherType&quot;: 2114,
    &quot;not&quot;: false,
    &quot;or&quot;: false,
    &quot;type&quot;: &quot;MATCH_ETHERTYPE&quot;
  &#125;,
  &#123;
    &quot;type&quot;: &quot;ACTION_ACCEPT&quot;
  &#125;
]
</code></pre>
<p>Ethertype 2114 is <a href="https://wiki.wireshark.org/WakeOnLAN">wake-on-LAN</a>, a special packet that can cause some systems to wake from sleep mode. If we place the above tiny rule set into a capability and issue it to a device, this device <em>but no others</em> will now be permitted to send wake-on-LAN magic packets. (Wake-on-LAN requires hardware support so it would only work to target devices plugged into a physical network bridged to a ZeroTier network, but don’t worry about that here. It’s just an example of special traffic.)<br>Capability rule sets are limited to only 64 entries. The idea is to keep them small and simple. A capability should grant one thing or one small set of conceptually related things.</p>
<h3 id="Tags"><a href="#Tags" class="headerlink" title="Tags"></a>Tags</h3><p>ZeroTier provides a second mechanism to control rule set complexity. Tags are 32-bit numeric key-value pair credentials that are issued to network members and signed by the controller. They are then distributed peer to peer on a need to know basis in a similar manner to capabilities.<br>Tags provide a way to conditionally drop or allow traffic between members by member classification. They allow very detailed network micro-segmentation by member role, permission, function, etc. without resulting in a combinatorial explosion in rules table size.<br>Let’s say we want to permit traffic on TCP ports 139 and 445 (netbios/CIFS file sharing) only between systems that belong to the same department. Our company has 12,000 devices and 10 departments. Without tags this would require 144,000,000 rules, but with tags it can be accomplished by only a few.<br>First a tag is created to represent the department. Let’s give it tag ID 100. Each member system receives the tag with a value from 1 to 10 indicating which department it belongs to. We can then add the following rules to our network’s base rule set (or to a capability if so desired):</p>
<pre><code class="lang-json">[
  &#123;
    &quot;type&quot;: &quot;MATCH_IP_DEST_PORT_RANGE&quot;,
    &quot;not&quot;: false,
    &quot;or&quot;: false,
    &quot;start&quot;: 139,
    &quot;end&quot;: 139
  &#125;,
  &#123;
    &quot;type&quot;: &quot;MATCH_IP_DEST_PORT_RANGE&quot;,
    &quot;not&quot;: false,
    &quot;or&quot;: true,
    &quot;start&quot;: 445,
    &quot;end&quot;: 445
  &#125;,
  &#123;
    &quot;type&quot;: &quot;MATCH_IP_PROTOCOL&quot;,
    &quot;not&quot;: false,
    &quot;or&quot;: false,
    &quot;ipProtocol&quot;: 6
  &#125;,
  &#123;
    &quot;type&quot;: &quot;MATCH_TAGS_DIFFERENCE&quot;,
    &quot;not&quot;: false,
    &quot;or&quot;: false,
    &quot;id&quot;: 100,
    &quot;value&quot;: 0
  &#125;,
  &#123;
    &quot;type&quot;: &quot;ACTION_ACCEPT&quot;
  &#125;
]
</code></pre>
<p>This tells members in our network to accept TCP packets on ports 139 or 445 if the difference between tags with tag ID 10 is zero, meaning they match. (If a member does not have a value for this tag, it does not match.) Now all members of the same department can access CIFS file shares, but CIFS sharing between departments could still be prohibited. (TCP whitelisting requires some additional rules due to the stateless nature of our rules engine. See the section below on rule design patterns.)<br>Tags can be compared on numeric value or as bit fields via several different bit mask operations allowing many different systems of member classification to be implemented.<br>Tags without a default value may behave confusingly. As a best practice, use <code>default 0</code> in your tag definitions.</p>
<h3 id="Rule-Definition-Language"><a href="#Rule-Definition-Language" class="headerlink" title="Rule Definition Language"></a>Rule Definition Language</h3><p>Raw rule sets are verbose and difficult to write, so we created a minimal rule definition language that’s easier for human beings.<br>The parser for this language can be found in the <a href="https://github.com/zerotier/ZeroTierOne/tree/master/rule-compiler">rule-compiler subfolder of the ZeroTierOne project</a> and as <a href="https://www.npmjs.com/package/zerotier-rule-compiler">zerotier-rule-compiler</a> on NPM. It’s written in JavaScript and is the same code that powers the in-browser editor in ZeroTier Central.</p>
<h3 id="An-Introductory-Example"><a href="#An-Introductory-Example" class="headerlink" title="An Introductory Example"></a>An Introductory Example</h3><pre><code class="lang-bash"># Whitelist only IPv4 (/ARP) and IPv6 traffic and allow only ZeroTier-assigned IP addresses
drop                      # drop cannot be overridden by capabilities
  not ethertype ipv4      # frame is not ipv4
  and not ethertype arp   # AND is not ARP
  and not ethertype ipv6  # AND is not ipv6
  or not chr ipauth       # OR IP addresses are not authenticated (1.2.0+ only!)
;

# Allow SSH, HTTP, and HTTPS by allowing all TCP packets (including SYN/!ACK) to these ports
accept
  dport 22 or dport 80 or dport 443
  and ipprotocol tcp
;

# Create a tag for which department someone is in
tag department
  id 1000                 # arbitrary, but must be unique
  enum 100 sales          # has no meaning to filter, but used in UI to offer a selection
  enum 200 engineering
  enum 300 support
  enum 400 manufacturing
  default 0
;

# Allow Windows CIFS and netbios between computers in the same department using a tag
accept
  dport 139 or dport 445
  and ipprotocol tcp
  and tdiff department 0  # difference between department tags is 0, meaning they match
;

# Drop TCP SYN,!ACK packets (new connections) not explicitly whitelisted above
break                     # break can be overridden by a capability
  chr tcp_syn             # TCP SYN (TCP flags will never match non-TCP packets)
  and not chr tcp_ack     # AND not TCP ACK
;

# Create a capability called &quot;superuser&quot; that lets its holders override all but the initial &quot;drop&quot;
cap superuser
  id 1000 # arbitrary, but must be unique
  accept; # allow with no match conditions means allow anything and everything
;

# Accept other packets
accept;
</code></pre>
<p>This creates a network that can pass IPv4 (and ARP) and IPv6 traffic but no other Ethernet frame types. In addition the <code>not chr ipauth</code> condition drops traffic between IP addresses that have not been assigned by ZeroTier to their respective sources or destinations, blocking all IP spoofing. These are enforced with a hard <code>drop</code>, preventing them from being overridden by any capability.<br>All UDP is allowed, but all non-whitelisted new TCP connections (SYN/!ACK packets) are blocked. This is done with a soft <code>break</code>, allowing it to be overridden by capabilities. New TCP connections are allowed on ports 22, 80, and 443 for everyone. Windows file sharing is allowed only between computers in the same department by way of a tag. A super-user capability that can be assigned to administrative nodes allows the sender to initiate any kind of connection.<br>See TCP <a href="https://docs.zerotier.com/rules/#tcp-whitelisting">Whitelisting</a> for a discussion of how we accomplish TCP whitelisting here.</p>
<h3 id="Rule-Definition-Language-Syntax"><a href="#Rule-Definition-Language-Syntax" class="headerlink" title="Rule Definition Language Syntax"></a>Rule Definition Language Syntax</h3><pre><code class="lang-bash"># The remainder of this line is a comment.

action [ ... args ... ]
  [and|or] [not] match [... args ...]
  [ ... additional matches ... ]
;

tag &lt;name&gt;
  id &lt;id&gt;                 # arbitrary unique 32-bit ID
  [default &lt;value&gt;]       # default tag value to assign to members
  [enum &lt;value&gt; &lt;name&gt;]   # value can be any 32-bit unsigned integer
  [flag &lt;bit&gt; &lt;name&gt;]     # bit can be 0 to 31
  [ ... additional enums or flags ... ]
;

cap &lt;name&gt;
  id &lt;id&gt;                 # arbitrary unique 32-bit ID
  action [ ... args ... ]
    [ ... ]
  ;
  [ ... additional action blocks ... ]
;

macro &lt;name[($var1,...)]&gt;
  action [ ... args ... ]
    [ ... ]
  ;
;

include &lt;name(value,...)&gt;
</code></pre>
<p>Each action, tag, capability, or macro block ends with a semicolon. White space separates things. Indentation is not significant. Hash symbols indicate that the remainder of a line is a comment.<br>As described in sections <a href="https://docs.zerotier.com/rules#rulesets">Rule Sets and Rule Evaluation</a> through <a href="https://docs.zerotier.com/rules#tags">Tags</a>, a rule set is composed of one or more sequences of match,[match],…,action in which the action is taken if the chain of matches evaluates to true. Capabilities are small bundles of rules that can be assigned to nodes to give them special abilities, and tags are key/value pairs that can be assigned to nodes to allow rules to be selectively applied.<br>Macros are just a convenient way of defining more complex actions that can then be applied in multiple places. An example of a macro might be:</p>
<pre><code class="lang-bash">macro allowtcp($port)
  accept
    ipprotocol tcp
    and dport $port
  ;
;
</code></pre>
<p>You could then allow TCP ports in a standard TCP whitelisting scheme by just saying:</p>
<pre><code class="lang-bash">include allowtcp(80)
include allowtcp(443)
include allowtcp(8080)
</code></pre>
<p>Tag <code>enum</code> and <code>flag</code> directives have no meaning to the actual ZeroTier rules engine, but they can be used by user interfaces like ZeroTier Central to make it easier to assign and search tags.</p>
<h3 id="Actions-Matches-Operators-and-Constants"><a href="#Actions-Matches-Operators-and-Constants" class="headerlink" title="Actions, Matches, Operators, and Constants"></a>Actions, Matches, Operators, and Constants</h3><div class="table-container">
<table>
<thead>
<tr>
<th><strong>Action</strong></th>
<th><strong>Argument(s)</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>drop</td>
<td></td>
<td>Drop packet and terminate all rule evaluation, including capabilities.</td>
</tr>
<tr>
<td>break</td>
<td></td>
<td>erminate evaluation of this rule set but continue evaluating capabilities.</td>
</tr>
<tr>
<td>accept</td>
<td></td>
<td>Accept packet and terminate further evaluation.</td>
</tr>
<tr>
<td>tee</td>
<td>&lt;length&gt; &lt;address&gt;</td>
<td>Send a copy of up to the first length bytes (-1 for all) to a ZeroTier address.</td>
</tr>
<tr>
<td>redirect</td>
<td>&lt;address&gt;</td>
<td>Transparently redirect this packet to a ZeroTier address without changing its headers.</td>
</tr>
<tr>
<td><strong>Match Condition</strong></td>
<td><strong>Argument(s)</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr>
<td>ztsrc</td>
<td>&lt;address&gt;</td>
<td>VL1 source address.</td>
</tr>
<tr>
<td>ztdest</td>
<td>&lt;address&gt;</td>
<td>VL1 destination address.</td>
</tr>
<tr>
<td>macsrc</td>
<td>&lt;address&gt;</td>
<td>Ethernet source address.</td>
</tr>
<tr>
<td>macdest</td>
<td>&lt;address&gt;</td>
<td>Ethernet destination address.</td>
</tr>
<tr>
<td>ipsrc</td>
<td>&lt;address/prefix&gt;</td>
<td>Source IP address or network (V4 or V6 auto-detected).</td>
</tr>
<tr>
<td>ipdest</td>
<td>&lt;address/prefix&gt;</td>
<td>Destination IP address or network (V4 or V6 auto-detected).</td>
</tr>
<tr>
<td>iptos</td>
<td>&lt;mask&gt; &lt;start[-end]&gt;</td>
<td>IP TOS field bitwise-ANDed with mask is within range.</td>
</tr>
<tr>
<td>ipprotocol</td>
<td>&lt;protocol&gt;</td>
<td>IP protocol number.</td>
</tr>
<tr>
<td>ethertype</td>
<td>&lt;type&gt;</td>
<td>Ethernet frame type.</td>
</tr>
<tr>
<td>icmp</td>
<td>&lt;type&gt; &lt;code&gt;</td>
<td>ICMP type (V4 or V6) and code. Use -1 for code if not applicable.</td>
</tr>
<tr>
<td>sport</td>
<td>&lt;start[-end]&gt;</td>
<td>IP (V4 or V6) source port range (inclusive).</td>
</tr>
<tr>
<td>dport</td>
<td>&lt;start[-end]&gt;</td>
<td>IP (V4 or V6) destination port range (inclusive).</td>
</tr>
<tr>
<td>chr</td>
<td>&lt;mask/name&gt;</td>
<td>Bitwise AND characteristic bits with mask, true if result is nonzero.</td>
</tr>
<tr>
<td>framesize</td>
<td>&lt;start[-end]&gt;</td>
<td>Ethernet frame size range (inclusive).</td>
</tr>
<tr>
<td>random</td>
<td>&lt;probability&gt;</td>
<td>Match randomly with probability 0.0 (0%) to 1.0 (100%).</td>
</tr>
<tr>
<td>tdiff</td>
<td>&lt;id&gt; &lt;value&gt;</td>
<td>Difference between tags (absolute value) with this ID is less than or equal to the value.</td>
</tr>
<tr>
<td>tand</td>
<td>&lt;id&gt; &lt;value&gt;</td>
<td>Tags ANDed together equal value.</td>
</tr>
<tr>
<td>tor</td>
<td>&lt;id&gt; &lt;value&gt;</td>
<td>Tags ORed together equal value.</td>
</tr>
<tr>
<td>txor</td>
<td>&lt;id&gt; &lt;value&gt;</td>
<td>Tags XORed together equal value.</td>
</tr>
<tr>
<td>teq</td>
<td>&lt;id&gt; &lt;value&gt;</td>
<td>Both tags equal the same value.</td>
</tr>
<tr>
<td>tseq</td>
<td>&lt;id&gt; &lt;value&gt;</td>
<td>Sending side’s tag equals this value.</td>
</tr>
<tr>
<td>treq</td>
<td>&lt;id&gt; &lt;value&gt;</td>
<td>Receiving side’s tag equals this value.</td>
</tr>
</tbody>
</table>
</div>
<p>Match conditions may be joined by <strong>and</strong> (default if none specified) or <strong>or</strong> and may be modified by <strong>not</strong>.<br>Match conditions are evaluated from left to right; <code>a and b or c</code> is a different rule than <code>b or c and a</code>. The rules language doesn’t support parentheses, but for example purposes the above would evaluate as: <code>(a and b) or c</code> vs <code>(b or c) and a</code><br>Traffic won’t be <code>tee</code>d if it is blocked by a <code>break</code> or <code>drop</code>.<br>For convenience the following symbols can be used when matching on certain packet attributes:</p>
<ul>
<li>IP protocols (<code>ipprotocol</code>): <strong>icmp</strong> (for IPv4), <strong>igmp</strong>, <strong>ipip</strong>, <strong>tcp</strong>, <strong>egp</strong>, <strong>igp</strong>, <strong>udp</strong>, <strong>rdp</strong>, <strong>esp</strong>, <strong>ah</strong>, <strong>icmp6</strong> (for IPv6), <strong>l2tp</strong>, <strong>sctp</strong>, and <strong>udplite</strong>.</li>
<li>Ethernet frame types (<code>ethertype</code>): <strong>ipv4</strong>, <strong>arp</strong>, <strong>ipv6</strong>, <strong>wol</strong> (wake on LAN), <strong>rarp</strong>, <strong>atalk</strong>, <strong>aarp</strong>, <strong>ipx_a</strong>, <strong>ipx_b</strong>.</li>
<li>Packet characteristics (bit masks for <code>chr</code>):<ul>
<li><strong>inbound</strong>: packet is being filtered on the receiving side (use not inbound for sending side)</li>
<li><strong>multicast</strong>: destination is a multicast or broadcast MAC</li>
<li><strong>broadcast</strong>: destination is the broadcast MAC</li>
<li><strong>ipauth</strong>: sender IP is assigned by ZeroTier to the sending node</li>
<li><strong>tcp_fin</strong>: packet is TCP with FIN flag set</li>
<li><strong>tcp_syn</strong>: packet is TCP with SYN flag set</li>
<li><strong>tcp_rst</strong>: packet is TCP with RST flag set</li>
<li><strong>tcp_psh</strong>: packet is TCP with PSH flag set</li>
<li><strong>tcp_ack</strong>: packet is TCP with ACK flag set</li>
<li><strong>tcp_urg</strong>: packet is TCP with URG flag set</li>
<li><strong>tcp_ece</strong>: packet is TCP with ECE flag set</li>
<li><strong>tcp_cwr</strong>: packet is TCP with CWR flag set</li>
<li><strong>tcp_ns</strong>: packet is TCP with NS flag set</li>
<li><strong>tcp_rs2</strong>: packet is TCP with RS2 (reserved bit 2) flag set</li>
<li><strong>tcp_rs1</strong>: packet is TCP with RS1 (reserved bit 1) flag set</li>
<li><strong>tcp_rs0</strong>: packet is TCP with RS0 (reserved bit 0) flag set</li>
</ul>
</li>
</ul>
<h3 id="Usefull-Design-Patterns"><a href="#Usefull-Design-Patterns" class="headerlink" title="Usefull Design Patterns"></a>Usefull Design Patterns</h3><h3 id="TCP-Whitelisting"><a href="#TCP-Whitelisting" class="headerlink" title="TCP Whitelisting"></a>TCP Whitelisting</h3><p>First, add this at or near the bottom of your rules:</p>
<pre><code># Block TCP SYN,!ACK to prevent new non-whitelisted TCP connections from being initiated
# unless previously whitelisted or allowed by a capability.
break chr tcp_syn and not chr tcp_ack;
</code></pre><p>Then above the SYN,!ACK break (or in a capability) add rules to allow TCP packets with permitted destination ports:</p>
<pre><code># Allow TCP port 80 (HTTP)
accept ipprotocol tcp and dport 80;
</code></pre><p>ZeroTier’s filter is stateless. If we block all TCP packets except those with the correct destination port, this will prevent reply packets from returning to their senders.<br>Allowing reply packets with the correct (inverse) source port seems like a simple fix, but this is insecure as it allows anyone to initiate any TCP connection if they bind to whitelisted source ports.<br>The best solution is to block all non-whitelisted TCP packets with flags SYN,!ACK (SYN and not ACK) and and then whitelist desired destination ports. This way TCP replies and control traffic are allowed, but new connections cannot be opened unless they are permitted.</p>
<h3 id="Locking-Down-UDP"><a href="#Locking-Down-UDP" class="headerlink" title="Locking Down UDP"></a>Locking Down UDP</h3><p>UDP is tougher to deal with in a stateless paradigm. It’s connectionless so there is no way to specifically select a new session vs. an existing session. The best way to lock down UDP on a network is to use tags to allow it to and from things like DNS servers that need to speak it.</p>
<pre><code>tag udpserver
  id 1000
  default 0
;

accept
  ipprotocol udp
  and tor udpserver 1
  or chr multicast
;

break ipprotocol udp;
</code></pre><p>First we define a tag called udpserver with a default value of 0. We don’t set any enums or flags for this tag since it will be used as a boolean. For servers that need to respond to DNS queries, set the udpserver to 1.<br>Then we accept UDP traffic if the value of the udpserver tag is 1 when both sender and receiver tags are ORed together, or if UDP traffic is multicast. This allows multicast mDNS and Netbios announcements and allows UDP traffic to and from UDP servers, but prohibits other horizontal UDP traffic.</p>
<h3 id="Traffic-Observation-and-Interception"><a href="#Traffic-Observation-and-Interception" class="headerlink" title="Traffic Observation and Interception"></a>Traffic Observation and Interception</h3><p>Here’s a simple rule to monitor everything:</p>
<pre><code># Send a copy of EVERY packet on both sender and receiver side to ZeroTier address &quot;deadbeef11&quot;.
tee -1 deadbeef11;
</code></pre><p>That’s going to flood <code>deadbeef11</code> with two full copies of every single packet, since it will match on both the sender and the recipient side. A less bandwidth-intensive security monitor setup might look like this:</p>
<pre><code>tee 128 deadbeef11
  chr inbound
  and chr tcp_syn or chr tcp_rst or chr tcp_fin
  or random 0.1
;

tee 128 deadbeef22
  not chr inbound
  and chr tcp_syn or chr tcp_rst or chr tcp_fin
  or random 0.1
;
</code></pre><p>This is a bit more clever. It sends the first 128 bytes of every TCP SYN, RST, or FIN packet (TCP connection open and close) to one observer on the inbound side and another observer on the outbound side. It also sends the first 128 bytes of other packets with a probability of one in ten. The first 128 bytes of a packet will be enough to see the Ethernet and IP headers as well as layer 4+ information about many protocols.<br>This would allow observers to watch every new TCP connection on the network and also passively monitor other traffic in a “fuzzy” probabilistic fashion without using very much bandwidth. We split sending and receiving observers to prevent duplicate packets and also to allow us to detect cases where one side is failing to tee traffic more frequently than would be easily explained by packet loss.<br>There are many, many variations on the above that are possible but hopefully these will be enough to get you started.<br>Passive out-of-line monitoring with <strong>tee</strong> is not perfect. If bandwidth between two parties exceeds the bandwidth of one or both parties to the observer, packets will get dropped. It also provides no mechanism to filter traffic in depth since the observer cannot directly intervene (though it could de-authorize a member via the controller API).<br>Active in-line monitoring can be achieved with <strong>redirect</strong>:</p>
<pre><code>redirect deadbeef11
  dport 80 or sport 80
  and ipprotocol tcp
;
</code></pre><p>This will pipe all HTTP traffic through <code>deadbeef11</code>. The target node will receive each Ethernet frame intact including its original Ethernet source and destination MAC address. To forward the packet on to its final destination, simply re-send it unmodified via the same interface on which it was received. The intermediate node could scan, modify, and interrupt HTTP traffic across the network. To regular network participants this is completely invisible as it occurs at layer 2 (Ethernet), though some performance degradation may be noticed especially if the link is running across WAN.</p>
<h3 id="The-Classified-System-Pattern"><a href="#The-Classified-System-Pattern" class="headerlink" title="The Classified System Pattern"></a>The Classified System Pattern</h3><p>One useful pattern for access control resembles the way military organizations classify data. Information is deemed classified, and only those who have the required level of classification are allowed to access it.<br>A model resembling this can be implemented in ZeroTier network rules as follows:</p>
<pre><code># Is this member classified?
tag classified
  id 2
  enum 0 no
  enum 1 secret
  enum 2 top
  default no
;

# Clearance flags (a bit like groups)
tag clearance
  id 1
  default 0
  flag 0 staging
  flag 1 production
  flag 2 financial
  flag 3 security
  flag 4 executive
;

# If one party is classified, require at least one overlapping clearance bit
break
  not tor classified 0
  and tand clearance 0
;
</code></pre><p>Initially members will be assigned a default classification of 0 (“no”). These can freely communicate since the bitwise OR of their classified tags will be zero. Neither member possesses a classification requirement.<br>To restrict access to a member, set its classified tag to secret or top. (In this example there is no difference, but two levels are included in case you want to implement some kind of more detailed segmentation based on these.) Now the first match (<code>not tor classified 0</code>) will be true and the packet will be dropped unless the two communicating members have at least one clearance bit in common (<code>tand clearance 0)</code>.</p>
<h2 id="Client-Configuration"><a href="#Client-Configuration" class="headerlink" title="Client Configuration"></a>Client Configuration</h2><p>ZeroTier One is a service that can run on laptops, desktops, servers, virtual machines, and containers to provide virtual network connectivity through a virtual network port much like a VPN client. It can also act as a network controller and as a federated root server.<br><a href="https://www.zerotier.com/download.shtml">Binary packages are available on the ZeroTier site</a> and source code is found on <a href="https://github.com/zerotier/ZeroTierOne">GitHub</a>.<br>After the service is installed and started, networks can be joined using their 16-digit network IDs. Each network appears as a virtual “tap” network port on your system that behaves just like an ordinary Ethernet port.</p>
<h3 id="ZeroTier-runs-as-Admin"><a href="#ZeroTier-runs-as-Admin" class="headerlink" title="ZeroTier runs as Admin"></a>ZeroTier runs as Admin</h3><p>There are two separate ZeroTier apps on PCs.<br>There is a ZeroTier system service. It runs as Admin. It does all the networking. There is a user interface tray app. It does not run as Admin. It talks to the service to join and leave networks.<br>For the app to talk to the service, it needs access to the secret token. If the user running the UI app can’t access the token, it can’t talk the service, so they can’t leave or join networks or change other settings.<br>During install, the token is copied to a location that the installing user can access.</p>
<h3 id="Configuration-Files"><a href="#Configuration-Files" class="headerlink" title="Configuration Files"></a>Configuration Files</h3><h4 id="System"><a href="#System" class="headerlink" title="System"></a>System</h4><p>The ZeroTier One service keeps its configuration and state information in its working directory. The working directory location is:</p>
<ul>
<li>Windows: <code>C:\ProgramData\ZeroTier\One</code></li>
<li>macOS: <code>/Library/Application Support/ZeroTier/One</code></li>
<li>Linux: <code>/var/lib/zerotier-one</code></li>
<li>FreeBSD/OpenBSD: <code>/var/db/zerotier-one</code></li>
</ul>
<h5 id="Network-Specific-Configuration"><a href="#Network-Specific-Configuration" class="headerlink" title="Network Specific Configuration"></a>Network Specific Configuration</h5><p>See <code>$WORKING/networks.d</code> in the working directory</p>
<h5 id="amp-lt-network-id-amp-gt-conf-is-a-binary-file-You-can’t-edit-it-by-hand"><a href="#amp-lt-network-id-amp-gt-conf-is-a-binary-file-You-can’t-edit-it-by-hand" class="headerlink" title="&amp;lt;network-id&amp;gt;.conf is a binary file. You can’t edit it by hand"></a><code>&amp;lt;network-id&amp;gt;.conf</code> is a binary file. You can’t edit it by hand</h5><p>If you place an empty file named <code>&amp;lt;network-id&amp;gt;.conf</code> in <code>networks.d</code>, ZeroTier will join that network when it starts.</p>
<h5 id="amp-lt-network-id-amp-gt-local-conf-text-file-with-the-netwrok’s-setting"><a href="#amp-lt-network-id-amp-gt-local-conf-text-file-with-the-netwrok’s-setting" class="headerlink" title="&amp;lt;network-id&amp;gt;.local.conf text file with the netwrok’s setting"></a><code>&amp;lt;network-id&amp;gt;.local.conf</code> text file with the netwrok’s setting</h5><p>The contents look like this:</p>
<pre><code>allowManaged=1
allowGlobal=0
allowDefault=0
allowDNS=0
</code></pre><p>These settings apply to the specific ZeroTier network.<br>Here is a summary of their meanings:</p>
<ul>
<li>Allow Managed. Default Yes. Allow ZeroTier to set IP Addresses and Routes ( <a href="https://en.wikipedia.org/wiki/Private_network">local/private</a> ranges only)</li>
<li>Allow Global. Default No. Allow ZeroTier to set Global/Public/Not-Private range IPs and Routes.</li>
<li>Allow Default. Default No. Allow ZeroTier to set the Default Route on the system. See <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/7110693/Overriding+Default+Route+Full+Tunnel+Mode">Full Tunnel Mode</a>.</li>
<li>Allow DNS. Default No. Allow ZeroTier to set DNS servers.</li>
</ul>
<p>ZeroTier will use these settings when it starts. If you change these settings from the UI or zerotier-cli, the file will update. If you edit the file directly, you need to restart the service.</p>
<h4 id="User"><a href="#User" class="headerlink" title="User"></a>User</h4><p>Some user specific settings may be stored in the user’s path:</p>
<ul>
<li><code>C:\Users\&lt;User&gt;\AppData\Local\ZeroTier</code> (Windows)</li>
<li><code>~/Library/Application\ Support/ZeroTier</code> (macOS)<h3 id="Local-Configuration-OPtions"><a href="#Local-Configuration-OPtions" class="headerlink" title="Local Configuration OPtions"></a>Local Configuration OPtions</h3>A file called local.conf in the ZeroTier home folder contains configuration options that apply to the local node. It can be used to set up trusted paths, blacklist physical paths, set up physical path hints for certain nodes, and define trusted upstream devices (federated roots). Most of the time, you don’t need to change any of these settings.<br>In a large deployment it can be deployed using a tool like Puppet, Chef, SaltStack, etc. to set a uniform configuration across systems.<br><code>local.conf</code> is a JSON format file that can also be edited and rewritten by ZeroTier One itself, so ensure that proper JSON formatting is used. Paste your JSON into a JSON tool before saving your configuration file.<br>Settings available in <code>local.conf</code> (this is not valid JSON, and JSON does not allow comments):<pre><code class="lang-json">&#123;
  &quot;physical&quot;: &#123; /* Settings that apply to physical L2/L3 network paths. */
      &quot;NETWORK/bits&quot;: &#123; /* Network e.g. 10.0.0.0/24 or fd00::/32 */
          &quot;blacklist&quot;: true|false, /* If true, blacklist this path for all ZeroTier traffic */
          &quot;trustedPathId&quot;: 0|!0 /* If present and nonzero, define this as a trusted path (see below) */
      &#125; /* ,... additional networks */
  &#125;,
  &quot;virtual&quot;: &#123; /* Settings applied to ZeroTier virtual network devices (VL1) */
      &quot;##########&quot;: &#123; /* 10-digit ZeroTier address */
          &quot;try&quot;: [ &quot;IP/port&quot;/*,...*/ ], /* Hints on where to reach this peer if no upstream/roots are online */
          &quot;blacklist&quot;: [ &quot;NETWORK/bits&quot;/*,...*/ ] /* Blacklist a physical path for only this peer. */
      &#125;
  &#125;,
  &quot;settings&quot;: &#123; /* Other global settings */
      &quot;primaryPort&quot;: 0-65535, /* If set, override default port of 9993 and any command line port */
      &quot;portMappingEnabled&quot;: true|false, /* If true (the default), try to use uPnP or NAT-PMP to map ports */
      &quot;softwareUpdate&quot;: &quot;apply&quot;|&quot;download&quot;|&quot;disable&quot;, /* Automatically apply updates, just download, or disable built-in software updates */
      &quot;softwareUpdateChannel&quot;: &quot;release&quot;|&quot;beta&quot;, /* Software update channel */
      &quot;softwareUpdateDist&quot;: true|false, /* If true, distribute software updates (only really useful to ZeroTier, Inc. itself, default is false) */
      &quot;interfacePrefixBlacklist&quot;: [ &quot;XXX&quot;,... ], /* Array of interface name prefixes (e.g. eth for eth#) to blacklist for ZT traffic */
      &quot;allowManagementFrom&quot;: [ &quot;NETWORK/bits&quot; ]|null, /* If non-NULL, allow JSON/HTTP management from this IP network. Default is 127.0.0.1 only. */
      &quot;allowTcpFallbackRelay&quot;: true|false /* Allow or disallow establishment of TCP relay connections (true by default) */
  &#125;
&#125;
</code></pre>
</li>
<li><strong>trustedPathld</strong>:A trusted path is a physical network over which encryption and authentication are not required. This provides a performance boost but sacrifices all ZeroTier’s security features when communicating over this path. Only use this feature if you know what you are doing and really need the performance! To set up a trusted path, all devices on the same trusted physical network must have the same trusted path ID. Trusted path IDs are arbitrary unsigned 64-bit integers. These are not secrets. The security of a trusted path depends on its physical configuration. Take special care that any firewalls at its boundaries do not allow traffic in our out with IPs overlapping the trusted network range.</li>
</ul>
<p>An example local.conf:</p>
<pre><code class="lang-json">&#123;
    &quot;physical&quot;: &#123;
        &quot;10.0.0.0/24&quot;: &#123;
            &quot;blacklist&quot;: true
        &#125;,
        &quot;10.10.10.0/24&quot;: &#123;
            &quot;trustedPathId&quot;: 101010024
        &#125;,
    &#125;,
    &quot;virtual&quot;: &#123;
        &quot;feedbeef12&quot;: &#123;
            &quot;role&quot;: &quot;UPSTREAM&quot;,
            &quot;try&quot;: [ &quot;10.10.20.1/9993&quot; ],
            &quot;blacklist&quot;: [ &quot;192.168.0.0/24&quot; ]
        &#125;
    &#125;,
    &quot;settings&quot;: &#123;
        &quot;softwareUpdate&quot;: &quot;apply&quot;,
        &quot;softwareUpdateChannel&quot;: &quot;release&quot;
    &#125;
&#125;
</code></pre>
<h3 id="authtoken-location"><a href="#authtoken-location" class="headerlink" title="authtoken location"></a><code>authtoken</code> location</h3><p>The installer copies <code>authtoken.secret</code> to the installing user’s <a href="https://docs.zerotier.com/config#user">path</a>.<br>To control the ZeroTier system service, you need the token. If you don’t have the token, you can’t leave or join networks, for example. The UI app uses the token to control the system service. The cli, <code>zerotier-cli</code>, uses it also.<br>The token is called <code>authtoken.secret</code> and it is stored in the ZeroTier working directory. You need to be Admin to access the working directory.<br>The user’s copy of <code>authtoken.secret</code> is in:</p>
<ul>
<li>C:\Users\<User>\AppData\Local\ZeroTier (Windows)</li>
<li>~/Library/Application\ Support/ZeroTier (macOS)</li>
</ul>
<p>If you don’t want a user to control ZeroTier, don’t give them this file and don’t give them access to the working directory.</p>
<h2 id="What-is-a-Network-Controller"><a href="#What-is-a-Network-Controller" class="headerlink" title="What is a Network Controller?"></a>What is a Network Controller?</h2><blockquote>
<p><strong>INFO</strong><br><a href="https://docs.zerotier.com/controller">Set up your own Controller</a></p>
</blockquote>
<p>Every ZeroTier virtual network has a network controller responsible for admitting members to the network, issuing certificates, and issuing default configuration information.<br>This is our reference controller implementation and is almost the same as the one we use to power our own hosted services at <a href="https://my.zerotier.com/">my.zerotier.com</a>. The only difference is the database backend used.<br>Controller data is stored in JSON format under <code>controller.d</code> in the ZeroTier working directory. It can be copied, rsync’d, placed in <code>git</code>, etc. The files under <code>controller.d</code> should not be modified in place while the controller is running or data loss may result, and if they are edited directly take care not to save corrupt JSON since that can also lead to data loss when the controller is restarted. Going through the API is strongly preferred to directly modifying these files.<br>See the API section below for information about controlling the controller.</p>
<h3 id="Scalability-and-Reliability"><a href="#Scalability-and-Reliability" class="headerlink" title="Scalability and Reliability"></a>Scalability and Reliability</h3><p>Controllers can in theory host up to 2^24 networks and serve many millions of devices (or more), but we recommend spreading large numbers of networks across many controllers for load balancing and fault tolerance reasons. Since the controller uses the filesystem as its data store we recommend fast filesystems and fast SSD drives for heavily loaded controllers.<br>Since ZeroTier nodes are mobile and do not need static IPs, implementing high availability fail-over for controllers is easy. Just replicate their working directories from master to backup and have something automatically fire up the backup if the master goes down. Modern orchestration tools like Nomad and Kubernetes can be of help here.</p>
<h3 id="Dockerizing-Controllers"><a href="#Dockerizing-Controllers" class="headerlink" title="Dockerizing Controllers"></a>Dockerizing Controllers</h3><p>ZeroTier network controllers can easily be run in Docker or other container systems. Since containers do not need to actually join networks, extra privilege options like “—device=/dev/net/tun —privileged” are not needed. You’ll just need to map the local JSON API port of the running controller and allow it to access the Internet (over UDP/9993 at a minimum) so things can reach and query it.</p>
<h3 id="Upgrading-from-Older-1-1-14-or-earlier-Version"><a href="#Upgrading-from-Older-1-1-14-or-earlier-Version" class="headerlink" title="Upgrading from Older (1.1.14 or earlier) Version"></a>Upgrading from Older (1.1.14 or earlier) Version</h3><p>Older versions of this code used a SQLite database instead of in-filesystem JSON. A migration utility called <code>migrate-sqlite</code> is included here and must be used to migrate this data to the new format. If the controller is started with an old <code>controller.db</code> in its working directory it will terminate after printing an error to stderr. This is done to prevent “surprises” for those running DIY controllers using the old code.<br>The migration tool is written in nodeJS and can be used like this:</p>
<pre><code class="lang-bash">cd migrate-sqlite
npm install
node migrate.js &lt;/path/to/controller.db&gt; &lt;/path/to/controller.d&gt;
</code></pre>
<h3 id="Network-Controller-API"><a href="#Network-Controller-API" class="headerlink" title="Network Controller API"></a>Network Controller API</h3><p>The controller API is hosted via the same JSON API endpoint that ZeroTier One uses for local control (usually at 127.0.0.1 port 9993). All controller options are routed under the <code>/controller</code> base path.<br>The controller microservice itself does not implement any fine-grained access control. Access control is via the ZeroTier control interface itself and <code>authtoken.secret</code>. This can be sent as the <code>X-ZT1-Auth</code> HTTP header field or appended to the URL as <code>?auth=&lt;token&gt;</code>. Take care when doing the latter that request URLs are not being logged.<br>While networks with any valid ID can be added to the controller’s database, it will only actually work to control networks whose first 10 hex digits correspond with the network controller’s ZeroTier ID. See <a href="https://docs.zerotier.com/protocol#nwid">Network Identifiers and Controllers</a>.<br>The controller JSON API is very sensitive about types. Integers must be integers and strings strings, etc. Incorrect types may be ignored, set to default values, or set to undefined values.<br>Full documentation of the Controller API can be found on our <a href="https://docs.zerotier.com/service/v1#tag/controller">documentation site</a></p>
<h3 id="Prometheus-Metrics"><a href="#Prometheus-Metrics" class="headerlink" title="Prometheus Metrics"></a>Prometheus Metrics</h3><p>Controller specific metrics are available from the <code>/metrics</code> endpoint.<br><strong>Metric Name</strong>|<strong>Type</strong>|<strong>Description</strong><br>——|——|——<br>controller_network_count|Gauge|number of networks the controller is serving<br>controller_member_count|Gauge|number of network members the controller is serving<br>controller_network_change_count|Counter|number of times a network configuration is changed<br>controller_member_change_count|Counter|number of times a network member configuration is changed<br>controller_member_auth_count|Counter|number of network member auths<br>controller_member_deauth_count|Counter|number of network member deauths</p>
<h1 id="Central"><a href="#Central" class="headerlink" title="Central"></a>Central</h1><h2 id="Create-a-Network"><a href="#Create-a-Network" class="headerlink" title="Create a Network"></a>Create a Network</h2><p>A ZeroTier network is essentially a secure Local Area Network (LAN) that you can use anywhere in the world. Let’s make one and connect two devices over ZeroTier.<br>We’ll use <code>ping</code> to test the connection. Any two devices that can run ZeroTier will do: laptop, phone, virtual machine, etc…<br>Both devices can be at the same location, on the same physical network. If you move one to a cafe or to your office, it should still just work.<br>The rough outline is:</p>
<ul>
<li>Create a ZeroTier network</li>
<li>Join the network from two devices</li>
<li><code>ping</code> one device from the other over the ZeroTier network</li>
</ul>
<p>This should take about 5 minutes.</p>
<blockquote>
<p><strong>Results Preview</strong><br>Here is a summary of the results of this tutorial, if you’re a networking person.<br>If this doesn’t mean anything to you, that’s OK. We’ll get there.<br>Each zerotier network you join creates a network interface on your device. It’s like adding another Ethernet port to your computer.</p>
<pre><code>node1# ip -o a
1: lo    inet 127.0.0.1/8 scope host lo\       valid_lft forever preferred_lft forever
2: eth0    inet 192.168.182.201/24 brd 192.168.182.255 scope global dynamic noprefixroute eth0\       valid_lft 3277sec preferred_lft 2827sec
9: zt3jn2z57r    inet 10.2.0.11/23 brd 10.2.1.255 scope global zt3jn2z57r\       valid_lft forever preferred_lft forever
</code></pre><pre><code>node2# ip -o a
1: lo    inet 127.0.0.1/8 scope host lo\       valid_lft forever preferred_lft forever
2: eth0    inet 192.168.182.202/24 brd 192.168.182.255 scope global dynamic noprefixroute eth0\       valid_lft 3277sec preferred_lft 2827sec
9: zt3jn2z57r    inet 10.2.0.12/23 brd 10.2.1.255 scope global zt3jn2z57r\       valid_lft forever preferred_lft forever
</code></pre><pre><code>node1# ping -c 3 10.2.0.12
PING 10.2.0.2 (10.2.0.12) 56(84) bytes of data.
64 bytes from 10.2.0.12: icmp_seq=1 ttl=64 time=5.66 ms
64 bytes from 10.2.0.12: icmp_seq=2 ttl=64 time=6.62 ms
64 bytes from 10.2.0.12: icmp_seq=3 ttl=64 time=8.50 ms

--- 10.2.0.12 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2004ms
</code></pre></blockquote>
<h3 id="Create-your-first-ZeroTier-network-1"><a href="#Create-your-first-ZeroTier-network-1" class="headerlink" title="Create your first ZeroTier network"></a>Create your first ZeroTier network</h3><h4 id="Create-an-account-1"><a href="#Create-an-account-1" class="headerlink" title="Create an account"></a>Create an account</h4><blockquote>
<p><strong>NOTE</strong><br>It’s free, no credit card is required.</p>
</blockquote>
<ul>
<li>Go to <a href="https://my.zerotier.com/">my.zerotier.com</a> and create an account.<h4 id="Create-a-network-1"><a href="#Create-a-network-1" class="headerlink" title="Create a network"></a>Create a network</h4></li>
<li>Make sure you’re on the “Networks” tab of my.zerotier.com<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316155636.png" alt="20240316155636"></li>
<li>Click the <strong>Create A Network</strong> button.</li>
</ul>
<p>This creates a virtual network with a random ID and a random name. We got “fervent_smathers” and d5e04297a16fa690 here.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316155855.png" alt="20240316155855"></p>
<ul>
<li>Click anywhere on the network to go to the details page for this network.</li>
</ul>
<p>See the Network Settings panel:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316155931.png" alt="20240316155931"><br>We don’t need to change any settings, but we can change the name of the network to personalize it.</p>
<ul>
<li>Change “fervent_smathers” to “my cool network” or whatever you like.</li>
<li>Collapse the Settings panel. Click on the word “Settings” at the top of the panel.</li>
</ul>
<p>You don’t need to change any other settings.</p>
<ul>
<li>See the Network Members panel:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316160036.png" alt="20240316160036"><br>It should say “No devices have joined this network”.</li>
<li>Leave this browser tab open. We’ll look at it again later.</li>
</ul>
<h3 id="Setup-the-ZeroTier-app-1"><a href="#Setup-the-ZeroTier-app-1" class="headerlink" title="Setup the ZeroTier app"></a>Setup the ZeroTier app</h3><h4 id="Download-and-install-ZeroTier-1"><a href="#Download-and-install-ZeroTier-1" class="headerlink" title="Download and install ZeroTier"></a>Download and install ZeroTier</h4><p>For mobile devices, use the app store.</p>
<ul>
<li>Go to <a href="https://www.zerotier.com/download">zerotier.com/download</a> in a different tab of your browser.</li>
<li>Run the installer</li>
</ul>
<p>The ZeroTier client should now running on your device.</p>
<h4 id="Join-your-first-ZeroTier-netwrok"><a href="#Join-your-first-ZeroTier-netwrok" class="headerlink" title="Join your first ZeroTier netwrok"></a>Join your first ZeroTier netwrok</h4><p>We need to tell the client to “join” the virtual network we just created.</p>
<ul>
<li>Copy the Network ID of the network from my.zerotier.com This is the long number that looks like like: d5e04297a16fa690</li>
<li>Paste the Network ID into the “join” command on your device<br>On macOS and Windows, there is a menubar/tray app. Select “join” from the menu.<blockquote>
<p><strong>NOTE</strong><br>Every running instance of ZeroTier has a unique address. It’s the 10 digit “Address” in the app, or <code>zerotier-cli</code> info command.<br>ZeroTier addresses are a very secure method of unique identification.</p>
</blockquote>
</li>
</ul>
<h3 id="Authorize-your-device-on-your-network-1"><a href="#Authorize-your-device-on-your-network-1" class="headerlink" title="Authorize your device on your network"></a>Authorize your device on your network</h3><p>At this point, your client should say “Access Denied.” A device can’t talk on your network unless you allow it, even if someone discovers the network’s ID.</p>
<h4 id="Authorize-your-device-1"><a href="#Authorize-your-device-1" class="headerlink" title="Authorize your device"></a>Authorize your device</h4><ul>
<li>Go to the Members panel that we left open on my.zerotier.com</li>
<li>Your node that just “joined” should appear here.</li>
<li>The “Address” should match the address in your client.</li>
<li>Click the “Auth?” check box for it.</li>
<li>Give it a name. Type something like “laptop” or “bob” into the (short name) input.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316160617.png" alt="20240316160617"></li>
</ul>
<h4 id="Confirm-authorization-1"><a href="#Confirm-authorization-1" class="headerlink" title="Confirm authorization"></a>Confirm authorization</h4><p>Back on your computer, your client should now say “OK” instead of “ACCESS DENIED” and it should show your custom “my cool network” name.<br>Now you have 1 member on your network. A network with 1 member can’t do much.</p>
<h3 id="Repeat-with-another-device-1"><a href="#Repeat-with-another-device-1" class="headerlink" title="Repeat with another device"></a>Repeat with another device</h3><p>We need to have 2 devices connected to the same ZeroTier network.</p>
<ul>
<li>Repeat the join and authorize steps with your second device.</li>
</ul>
<h3 id="Test-connectivity-1"><a href="#Test-connectivity-1" class="headerlink" title="Test connectivity"></a>Test connectivity</h3><p>Now you have two authorized nodes on your network. They should be able to talk over ZeroTier.<br>Your Network Members section should look something like this:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316160752.png" alt="20240316160752"><br>The “Managed IPs” will be different on your network.<br>We’re going to test with <code>ping</code>. It’s the only program that we can think of that exists by default on every operating system.<br>This is a command line program, but don’t worry: You can do it.</p>
<h4 id="Gotcha-Windows-blocks-ping-1"><a href="#Gotcha-Windows-blocks-ping-1" class="headerlink" title="Gotcha: Windows blocks ping"></a>Gotcha: Windows blocks ping</h4><p><del>Windows by default doesn’t respond to pings. If you try to ping a Windows computer from a different computer, it won’t work. You can enable ping.</del><br>ZeroTier automatically enables ping on your ZeroTier network adapter now. You can probably skip this step!</p>
<blockquote>
<p><strong>How to enable ping on Windows</strong></p>
<ul>
<li>Search for Windows Firewall in the Start Menu, and click to open it.</li>
<li>Click Advanced Settings on the left.</li>
<li>From the left pane of the resulting window, click Inbound Rules.</li>
<li>In the right pane, find the rules titled File and Printer Sharing (Echo Request - ICMPv4-In).</li>
<li>Right-click each rule and choose Enable Rule.<br>Here is a <a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-firewall/create-an-inbound-icmp-rule">tutorial by Microsoft</a></li>
</ul>
</blockquote>
<h4 id="Open-the-command-line-1"><a href="#Open-the-command-line-1" class="headerlink" title="Open the command line"></a>Open the command line</h4><ul>
<li>Open the command line on your computer</li>
</ul>
<h5 id="macOS-2"><a href="#macOS-2" class="headerlink" title="macOS"></a>macOS</h5><ul>
<li>Use Spotlight (cmd-space) to search for Terminal</li>
</ul>
<p><a href="https://support.apple.com/guide/terminal/open-or-quit-terminal-apd5265185d-f365-44cb-8b09-71a064a42125/mac">Apple’s Instructions</a></p>
<h5 id="Windows-1"><a href="#Windows-1" class="headerlink" title="Windows"></a>Windows</h5><ul>
<li>Search for “powershell” and open it</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/starting-windows-powershell?view=powershell-7.3">Microsoft’s Instructions</a></p>
<h5 id="Linux-3"><a href="#Linux-3" class="headerlink" title="Linux"></a>Linux</h5><ul>
<li>It’s different on every flavor of Linux. You’ll have to search duckduckgo for “open terminal ubuntu” or similar.</li>
</ul>
<h5 id="Mobile"><a href="#Mobile" class="headerlink" title="Mobile"></a>Mobile</h5><p>Mobile operating systems don’t have a command line. You can download a “ping” app from your app store if you want.<br>Or <code>ping</code> your phone from your desktop computer.<br>Try switching your phone from wifi to cell and back. It may take about a minute, but ZeroTier should automatically keep the connection working.</p>
<h4 id="Find-the-ZeroTier-IP-Addresses-of-your-devices"><a href="#Find-the-ZeroTier-IP-Addresses-of-your-devices" class="headerlink" title="Find the ZeroTier IP Addresses of your devices"></a>Find the ZeroTier IP Addresses of your devices</h4><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240316161618.png" alt="20240316161618"></p>
<h4 id="Try-the-ping-command-1"><a href="#Try-the-ping-command-1" class="headerlink" title="Try the ping command"></a>Try the ping command</h4><p>Back in the Command Line / Terminal that you just opened:<br>type <code>ping -c 5 $ZEROTIER_IP_ADDRESS</code> <code>&lt;enter&gt;</code> into your command line.<br>A successful <code>ping</code>:</p>
<pre><code class="lang-cmd">% ping -c 5 172.22.217.93
PING 172.22.217.93 (172.22.217.93): 56 data bytes
64 bytes from 172.22.217.93: icmp_seq=0 ttl=64 time=22.362 ms
64 bytes from 172.22.217.93: icmp_seq=1 ttl=64 time=10.157 ms
64 bytes from 172.22.217.93: icmp_seq=2 ttl=64 time=9.414 ms
64 bytes from 172.22.217.93: icmp_seq=3 ttl=64 time=9.019 ms
64 bytes from 172.22.217.93: icmp_seq=4 ttl=64 time=9.180 ms

--- 172.22.217.93 ping statistics ---
5 packets transmitted, 5 packets received, 0.0% packet loss
round-trip min/avg/max/stddev = 9.019/12.026/22.362/5.182 ms
</code></pre>
<p>Try it with both ZeroTier Managed addresses on your network.<br>One of them is the same device you’re on, so you’re pinging yourself. Pinging the other device might be a little more interesting.</p>
<blockquote>
<p><strong>INFO</strong><br>If something goes wrong you might see something like:</p>
<pre><code>% ping -c 5 172.22.217.92
PING 172.22.217.92 (172.22.217.92): 56 data bytes
Request timeout for icmp_seq 0
Request timeout for icmp_seq 1
Request timeout for icmp_seq 2
Request timeout for icmp_seq 3

--- 172.22.217.92 ping statistics ---
5 packets transmitted, 0 packets received, 100.0% packet loss
</code></pre></blockquote>
<p>or</p>
<blockquote>
<pre><code>ping -c 5 192.168.123.234
PING 192.168.123.234 (192.168.123.234): 56 data bytes
92 bytes from 192.168.82.1: Destination Port Unreachable
Vr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst
 4  5  00 5400 56e7   0 0000  3f  01 d4ad 192.168.82.217  192.168.123.234
</code></pre><p>There may just be a typo in the IP address. Double check that your device is authorized at my.zerotier.com<br>Contact us on the <a href="https://discuss.zerotier.com/">discussion forum</a> and see the <a href="https://docs.zerotier.com/faq">troubleshooting section</a> if you get stuck.</p>
</blockquote>
<h3 id="Conclusion-1"><a href="#Conclusion-1" class="headerlink" title="Conclusion"></a>Conclusion</h3><p><code>ping</code> doesn’t accomplish anything, but it does tell us ZeroTier is working. It’s useful to know about for troubleshooting networks, not just ZeroTier networks.<br>Visit the <a href="https://discuss.zerotier.com/">discussion forum</a> to talk about your use-cases or if you get stuck.</p>
<h4 id="Now-use-ZeroTier-to-do-something-you-want-to-do-1"><a href="#Now-use-ZeroTier-to-do-something-you-want-to-do-1" class="headerlink" title="Now, use ZeroTier to do something you want to do"></a>Now, use ZeroTier to do something you want to do</h4><h4 id="Some-popular-uses-1"><a href="#Some-popular-uses-1" class="headerlink" title="Some popular uses"></a>Some popular uses</h4><ul>
<li>Windows Remote Desktop</li>
<li>ssh (try <a href="https://mosh.org/">mosh</a>)</li>
<li>Private Gaming LAN</li>
<li>Access the web interfaces of your home lab</li>
<li>Build your own <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/7110693/Overriding+Default+Route+Full+Tunnel+Mode">VPN</a></li>
<li>Route to a <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/224395274/Route+between+ZeroTier+and+Physical+Networks">remote subnet</a></li>
<li>Route to a <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/7274520/Using+NDP+Emulated+6PLANE+Addressing+With+Docker">Docker network</a></li>
<li>Add <a href="https://docs.zerotier.com/dns">dns</a> to your network</li>
</ul>
<h4 id="Join-multiple-networks-1"><a href="#Join-multiple-networks-1" class="headerlink" title="Join multiple networks"></a>Join multiple networks</h4><p>A node can join many networks at once. Make sure they don’t use the same subnet!<br>You can have a <code>home</code> network, a <code>friends</code> network, and a <code>work</code> network, for example.<br>They don’t all need to be networks that you’ve created. You can join other people’s networks.</p>
<h4 id="Check-out-the-Whitepaper-1"><a href="#Check-out-the-Whitepaper-1" class="headerlink" title="Check out the Whitepaper"></a>Check out the Whitepaper</h4><p>For more info on the cryptography and protocol, see the: <a href="https://docs.zerotier.com/protocol">Design Whitepaper</a></p>
<h2 id="Central-FAQ"><a href="#Central-FAQ" class="headerlink" title="Central FAQ"></a>Central FAQ</h2><h3 id="Can-I-move-or-transfer-my-network-s-to-another-user"><a href="#Can-I-move-or-transfer-my-network-s-to-another-user" class="headerlink" title="Can I move or transfer my network(s) to another user?"></a>Can I move or transfer my network(s) to another user?</h3><p>When you join an <a href="https://docs.zerotier.com/organizations">Organization</a>, all of your networks are transferred to the Organization.<br>Other than that, there is no way to transfer individual networks between accounts.</p>
<h4 id="To-change-your-Organization-Owner"><a href="#To-change-your-Organization-Owner" class="headerlink" title="To change your Organization Owner"></a>To change your Organization Owner</h4><p>What you can do is change the email address of your account to a different address. From the account page, select “Manage Account” then “Personal Info”. From there you can change the email address. After changing, please log out and log back in.<br>Note: This email address must not already have a ZeroTier Central account.<br>Many users prefer to use something like “billing” or “admin” <code>@example.com</code> for their organization owner email account and then invite <code>alice@example.com</code> and <code>bob@example.com</code> as network admins.</p>
<blockquote>
<p><strong>TIP</strong><br>You can avoid this process by using a shared email address or distribution list (example: <code>zerotier@example.com</code>) instead of a personal address for the account that manages your organization.</p>
</blockquote>
<h3 id="Can-I-make-my-subnet-bigger"><a href="#Can-I-make-my-subnet-bigger" class="headerlink" title="Can I make my subnet bigger?"></a>Can I make my subnet bigger?</h3><p>Yes. Your network’s existing members will keep their existing IPs.</p>
<ol>
<li>Create a new, larger Managed Route.</li>
<li>Delete the old, smaller Managed Route.</li>
<li>Change IPv4 Auto-Assign from Easy to Advanced</li>
<li>Delete the existing range</li>
<li>Add the new, bigger range</li>
</ol>
<p>For example, if your network was on the Easy Mode <code>192.168.195.*</code> (/24)</p>
<ul>
<li>Change the managed route to 192.168.194.0/23</li>
<li>Change the auto assign range to: 192.168.194.1 to 192.168.195.254</li>
</ul>
<p>If you change to a completely different, non-overlapping subnet, your network’s members will get new IPs in the new range, and keep their old IPs. You will have to delete the old IPs from each member if you don’t like to see them in the list.<br>For example, if you change from <code>192.168.195.*</code> to <code>10.244.*.*</code>, then the member nodes will have IPs in both ranges, like: 192.16.195.1 and 10.244.1.1<br>IPs don’t actually get applied on the operating system unless the network has a matching managed route.</p>
<h3 id="How-are-nodes-counted-against-my-subscription"><a href="#How-are-nodes-counted-against-my-subscription" class="headerlink" title="How are nodes counted against my subscription?"></a>How are nodes counted against my subscription?</h3><p>If the same node is a member of multiple networks, it is counted only once.<br>Only authorized nodes are counted. You don’t need to hide or delete nodes for billing purposes. De-authorized nodes aren’t counted.</p>
<h2 id="SSO-OIDC"><a href="#SSO-OIDC" class="headerlink" title="SSO/OIDC"></a>SSO/OIDC</h2><h3 id="ZeroTier-Central-configuration"><a href="#ZeroTier-Central-configuration" class="headerlink" title="ZeroTier Central configuration"></a>ZeroTier Central configuration</h3><blockquote>
<p><strong>NOTE</strong><br>SSO is currently only supported on desktop operating systems such as macOS and Windows. Support for iOS and Android, and better support for authenticating via the command line is still to come.</p>
</blockquote>
<h4 id="Update-clients"><a href="#Update-clients" class="headerlink" title="Update clients"></a>Update clients</h4><ul>
<li>Download and install ZeroTier 1.10.3 or greater on clients that will use SSO.<br><a href="https://www.zerotier.com/download/">https://www.zerotier.com/download/</a></li>
</ul>
<h4 id="Configure-SSO-in-ZeroTier-Central"><a href="#Configure-SSO-in-ZeroTier-Central" class="headerlink" title="Configure SSO in ZeroTier Central"></a>Configure SSO in ZeroTier Central</h4><p>Visit <a href="https://my.zerotier.com/account">https://my.zerotier.com/account</a> and complete the SSO configuration toward the bottom of the page. You will need your sso provider’s Issuer URL as well as a Client ID.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318091806.png" alt="20240318091806"><br>You can configure multiple OIDC clients for your organization, but only one may be used at a time on an individual network.</p>
<h4 id="Configure-SSO-on-individual-networks"><a href="#Configure-SSO-on-individual-networks" class="headerlink" title="Configure SSO on individual networks"></a>Configure SSO on individual networks</h4><p>If you enable this on an existing network, you may accidentally block existing users. Please practice on a test network.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318091853.png" alt="20240318091853"><br>There are three login modes for SSO enabled networks:</p>
<ol>
<li>Standard - If the user can successfully authenticate to your OIDC provider, they will be allowed access to the ZeroTier network</li>
<li><a href="https://docs.zerotier.com/sso#email-based-network-access">Email Based Access</a> - The user is allowed to access the network if and only if their email address is in the email list provided by the network administrator.</li>
<li><a href="https://docs.zerotier.com/sso#email-based-network-access">Group/Role Based Access</a> - The user is allowed to access the network if and only if they are assigned one of the proper roles by the OIDC server.<h4 id="Exclude-specific-devices-from-SSO-requirements"><a href="#Exclude-specific-devices-from-SSO-requirements" class="headerlink" title="Exclude specific devices from SSO requirements"></a>Exclude specific devices from SSO requirements</h4>This is useful for routers, servers, embedded devices, etc… You can do this from the wrench icon in the Members list.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318092456.png" alt="20240318092456"><h3 id="SSO-provider-configuration"><a href="#SSO-provider-configuration" class="headerlink" title="SSO provider configuration"></a>SSO provider configuration</h3></li>
</ol>
<ul>
<li>SSO Provider <strong>must</strong> support <a href="https://oauth.net/2/pkce/">PKCE</a></li>
<li>Requires the following scopes:<ul>
<li><code>openid</code></li>
<li><code>profile</code></li>
<li><code>email</code></li>
<li><code>offline_access</code></li>
</ul>
</li>
<li>Configure the callback URL to <code>http://localhost:9993/sso</code></li>
</ul>
<h3 id="Provider-Specific-Configuration-Notes"><a href="#Provider-Specific-Configuration-Notes" class="headerlink" title="Provider Specific Configuration Notes"></a>Provider Specific Configuration Notes</h3><h4 id="Auth0"><a href="#Auth0" class="headerlink" title="Auth0"></a>Auth0</h4><p>Please ensure the following fields are set on your Auth0 application config:</p>
<ul>
<li>Application Type: Native</li>
<li>Token Endpoint Authentication Method: None</li>
<li>Allowed Callback URL: <a href="http://localhost:9993/sso">http://localhost:9993/sso</a></li>
<li>Under Advanced Settings -&gt; Grant Types, ensure Authorization Code, and Refresh Token are selected.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong><br>The OIDC spec is picky about the Issuer URL you enter. It must match what the server configuration metadata endpoint returns.<br>In the case of Auth0 specifically, Your Issuer URL MUST end with a <code>/</code>. For example, in Auth0’s application configuration, show’s just the fully qualified domain name. What must be entered in the Issuer field in ZeroTier Central is: <code>https://your-domain-id.auth0.com/</code></p>
</blockquote>
<h4 id="Authelia"><a href="#Authelia" class="headerlink" title="Authelia"></a>Authelia</h4><p><a href="https://www.authelia.com/">Authelia</a> is a self hosted SSO solution. ZeroTier uses PKCE, so the field <code>secret</code> must be an empty string and <code>public</code> must be true.</p>
<blockquote>
<p><strong>NOTE</strong><br>Use of Authelia requires ZeroTierOne version 1.10.1 or greater. There is an incompatibility between the two in the 1.10.0 release.</p>
</blockquote>
<p>Example client configuration:</p>
<pre><code>    clients:
        ## The ID is the OpenID Connect ClientID which is used to link an application to a configuration.
      - id: authelia-sso-client

        ## The description to show to users when they end up on the consent screen. Defaults to the ID above.
        description: zerotier

        ## The client secret is a shared secret between Authelia and the consumer of this client.
        secret: &quot;&quot;

        ## Sector Identifiers are occasionally used to generate pairwise subject identifiers. In most cases this is not
        ## necessary. Read the documentation for more information.
        ## The subject identifier must be the host component of a URL, which is a domain name with an optional port.
        # sector_identifier: example.com

        ## Sets the client to public. This should typically not be set, please see the documentation for usage.
        public: true

        ## The policy to require for this client; one_factor or two_factor.
        authorization_policy: one_factor

        ## By default users cannot remember pre-configured consents. Setting this value to a period of time using a
        ## duration notation will enable users to remember consent for this client. The time configured is the amount
        ## of time the pre-configured consent is valid for granting new authorizations to the user.
        # pre_configured_consent_duration:

        ## Audience this client is allowed to request.
        audience: [
          &quot;authelia-test-client&quot;
        ]

        ## Scopes this client is allowed to request.
        scopes:
          - openid
          - groups
          - email
          - profile
          - offline_access

        ## Redirect URI&#39;s specifies a list of valid case-sensitive callbacks for this client.
        redirect_uris:
          - http://localhost:9993/sso

        ## Grant Types configures which grants this client can obtain.
        ## It&#39;s not recommended to define this unless you know what you&#39;re doing.
        grant_types:
          - refresh_token
          - authorization_code

        ## Response Types configures which responses this client can be sent.
        ## It&#39;s not recommended to define this unless you know what you&#39;re doing.
        response_types:
          - code
          - id_token

        ## Response Modes configures which response modes this client supports.
        response_modes:
          - form_post
          - query
          - fragment

        ## The algorithm used to sign userinfo endpoint responses for this client, either none or RS256.
        userinfo_signing_algorithm: none
</code></pre><h4 id="Azure-AD"><a href="#Azure-AD" class="headerlink" title="Azure AD"></a>Azure AD</h4><p>Navigate to your directory in the Azure portal, and select “App Registrations” in the Manage column.<br>Click “New Registration”<br>Set the Name of the application. e.g. “ZeroTier Central SSO”<br>Under Redirect URI:<br>Platform: Public client/native (mobile &amp; desktop)<br>Set the Redirect URI to <code>http://localhost:9993/sso</code><br>Do not use a trailing <code>/</code> when you enter the “issuer” url in Central.</p>
<h4 id="Google-Workspace"><a href="#Google-Workspace" class="headerlink" title="Google Workspace"></a>Google Workspace</h4><p>Google OAuth2/OIDC is not supported as Google does not support PKCE clients at this time. You can, however, use <a href="http://localhost:3000/central/sso#keycloak-as-a-saml-identity-broker">Keycloak as a SAML Identity Broker</a> with Google Workspace.</p>
<h4 id="Keycloak"><a href="#Keycloak" class="headerlink" title="Keycloak"></a>Keycloak</h4><p>Log into your Keycloak administration console, go to the Client configuration and create a new client. Configuration is fairly straightforward, with the following requirements:</p>
<ul>
<li>Client Protocol: openid-connect</li>
<li>Access Type: public</li>
<li>Standard Flow Enabled: ON</li>
<li>Root URL: <a href="https://my.zerotier.com/">https://my.zerotier.com</a></li>
<li>Valid Redirect URLS<ul>
<li><a href="https://my.zerotier.com/">https://my.zerotier.com/</a>*</li>
<li><a href="http://localhost/sso">http://localhost/sso</a></li>
</ul>
</li>
<li>Admin URL: <a href="https://my.zerotier.com/">https://my.zerotier.com</a></li>
<li>Web Origins: *<br>See <a href="https://www.keycloak.org/docs/latest/server_admin/index.html#assembly-managing-clients_server_administration_guide">here</a> for full documentation for configuring OpenID Connect clients with Keycloak.<h5 id="Keycloak-as-a-SAML-Identity-Broker"><a href="#Keycloak-as-a-SAML-Identity-Broker" class="headerlink" title="Keycloak as a SAML Identity Broker"></a>Keycloak as a SAML Identity Broker</h5>If you have a SAML provider, but not an OpenID Connect provider, <a href="https://www.keycloak.org/">Keycloak</a> can also be used to bridge the gap. On your keycloak Admin page, go to Identity Providers. From the dropdown, select <code>SAML v2.0</code> and create the connection to your SAML provider. Combined with the general Keycloak OIDC client settings above, you now have an OIDC server that authenticates against your SAML provider.<h4 id="Okta"><a href="#Okta" class="headerlink" title="Okta"></a>Okta</h4></li>
<li>Application Type: Native</li>
<li>Token Endpoint Authentication Method: None</li>
<li>Allowed Callback URL: <a href="http://localhost:9993/sso">http://localhost:9993/sso</a></li>
<li>Under Advanced Settings -&gt; Grant Types, ensure Implicit, Authorization Code, and Refresh Token are selected.</li>
</ul>
<h4 id="OneLogin"><a href="#OneLogin" class="headerlink" title="OneLogin"></a>OneLogin</h4><blockquote>
<p><strong>NOTE</strong><br>OneLogin requires ZeroTier One v1.10.3+</p>
</blockquote>
<p>Log in to your OneLogin admin console. Select “Custom Connectors” from the “Applications” menu. Hit the “New Connector” button. Name your connector, set Sign on method to OpenID Connect, and set the Redirect URI to <code>https://localhost:9993/sso</code>. Finally, back on the on Custom Connectors page, hit the “Add App to Connector” link. Adjust the description &amp; logo settings as you see fit, and then save.<br>Once the above steps are complete, go to the SSO tab for your new OneLogin Application. Set “Application Type” to “Native”, and “Token Endpoint” to “None (PKCE)”. You’ll also find the required Client ID and Issuer URLs to enter into <a href="https://my.zerotier.com/account">https://my.zerotier.com/account</a>.</p>
<h3 id="Customizing-the-Final-SSO-Flow-Page"><a href="#Customizing-the-Final-SSO-Flow-Page" class="headerlink" title="Customizing the Final SSO Flow Page"></a>Customizing the Final SSO Flow Page</h3><p>If you wish, you can customize the final view of the sso login process. Create the file <code>$ZEROTIER_HOME/sso-auth.template.html</code>.<br>Note: Any CSS or images must be hosted externally, or placed within the single HTML page itself.<br>You may customize the page to look however you wish. At this time there are only two template values set by zerotier:</p>
<ul>
<li><code>networkId</code></li>
<li><code>messageText</code><br>Templates must be valid HTML, and the template values must be placed inside <code>&#123;&#123; ... &#125;&#125;</code> blocks like so:<pre><code>&#123;&#123; networkId &#125;&#125;
&#123;&#123; messageText &#125;&#125;
</code></pre>You may react to errors via the <code>isError</code> variable:<pre><code>&#123;% if isError %&#125;
<span style="color: red;">&#123;&#123; messageText &#125;&#125;</span>
&#123;% else %&#125;
&#123;&#123; messageText &#125;&#125;
&#123;% endif %&#125;
</code></pre><h3 id="Email-Based-Network-Access"><a href="#Email-Based-Network-Access" class="headerlink" title="Email Based Network Access"></a>Email Based Network Access</h3>With Email based network access, a network administrator can limit access to the network to only users whose email addresses are present in the list specified by the network administrator.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318093942.png" alt="20240318093942"><h3 id="Role-Based-Network-Access"><a href="#Role-Based-Network-Access" class="headerlink" title="Role Based Network Access"></a>Role Based Network Access</h3>Configuring Role Based Access controls is different across all of the different OIDC providers available. We’ll give examples for many of the large ones.<br>Role/group names are up to the network administrator. Simply add one or more role name to your network configuration, and users will be required to have at least one of those roles assigned in order to access the network.<h4 id="Auth0-1"><a href="#Auth0-1" class="headerlink" title="Auth0"></a>Auth0</h4>Auth0 requires multiple steps to configure.<h5 id="Step-1-Create-a-Role-and-Assign-Users"><a href="#Step-1-Create-a-Role-and-Assign-Users" class="headerlink" title="Step 1: Create a Role and Assign Users"></a>Step 1: Create a Role and Assign Users</h5>Log into your auth0.com management console. Go to User Management and select roles. Hit the <code>+ Create Role</code> button in the upper right corner. Give your new role a name &amp; description of your choosing.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318094126.png" alt="20240318094126"><br>Once the new role is created, go to the Users tab. There you will be able to add the users you wish to have access to the role.<h5 id="Step-2-Attach-Roles-to-ID-and-Access-Tokens"><a href="#Step-2-Attach-Roles-to-ID-and-Access-Tokens" class="headerlink" title="Step 2: Attach Roles to ID and Access Tokens"></a>Step 2: Attach Roles to ID and Access Tokens</h5>In order for ZeroTier to be able to read the roles a user has been assigned, they must be added to the ID and Access tokens, and mapped to the correct name. In the Auth0.com dashboard, go to Actions, and select Flows. Click the Login flow. On the right side of the screen, hit the + next to <code>Add Action</code> and select <code>Build Custom</code>. Give the action a name such as “Attach ZeroTier Roles” with Trigger set to “Login/Post Login” and Runtime set to “Node 16” (or whatever the latest default is).<br>Next you will get a screen with a code editor. Delete everything in the buffer and add the following:<pre><code>exports.onExecutePostLogin = async (event, api) =&gt; &#123;
  const namespace = &quot;https://my.zerotier.com&quot;;
  if (event.authorization) &#123;
      api.idToken.setCustomClaim(`$&#123;namespace&#125;/roles`, event.authorization.roles);
      api.accessToken.setCustomClaim(`$&#123;namespace&#125;/roles`, event.authorization.roles);
  &#125;
&#125;
</code></pre><blockquote>
<p><strong>NOTE</strong><br>Auth0 requires roles to be in a namespaced name. To properly integrate with ZeroTier Central, the final claim name set on the token via the script above <strong>must</strong> be <code>https://my.zerotier.com/roles</code>. Please enter the login script exactly as shown above to reduce the chances of errors.</p>
</blockquote>
</li>
</ul>
<p>Once it is entered, hit <code>Deploy</code> on the upper right hand side of the screen.<br>Hit the <code>&lt;- Back to flow</code> link, which will take you back to the Login Flow graph. Under Add Action, select Custom. You’ll find your new action listed there. Drag it between <code>Start</code> and <code>Complete</code> in the login flow and click Apply. When finished, your flow will look something like this:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318094440.png" alt="20240318094440"><br>Your users’ assigned roles will now be attached to the tokens required to authorize a user on your ZeroTier networks.</p>
<h4 id="Azure-AD-1"><a href="#Azure-AD-1" class="headerlink" title="Azure AD"></a>Azure AD</h4><p><a href="https://learn.microsoft.com/en-us/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps">https://learn.microsoft.com/en-us/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps</a></p>
<h4 id="Step-1-Create-an-App-Role"><a href="#Step-1-Create-an-App-Role" class="headerlink" title="Step 1: Create an App Role"></a>Step 1: Create an App Role</h4><p>In the Azure portal, go to Azure Active Directory and select App Registrations. Select the app you’ve created for integration with ZeroTier Central. In the Manage menu, select App Roles, and then create a new app role and hit Apply<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318094647.png" alt="20240318094647"><br>The <code>Value</code> field is what you use as the role name in the network configuration on <a href="https://my.zerotier.com">https://my.zerotier.com</a></p>
<h4 id="Step-2-Assign-App-Role"><a href="#Step-2-Assign-App-Role" class="headerlink" title="Step 2: Assign App Role"></a>Step 2: Assign App Role</h4><p>Go back to Azure Active Directory in the Azure portal. Select Enterprise Applications from the list of options on the side of the screen. Select the app to be used for ZeroTier Central integration.<br>Select <code>Users and Groups</code> from the Manage menu. Select all of the users you want to assign the App Role and select <code>Edit Assignment</code>. Click on the area of the screen that says “Select a Role”, then find your newly created app role from step 1, click it and hit the <code>Select</code> button.</p>
<h4 id="Okta-1"><a href="#Okta-1" class="headerlink" title="Okta"></a>Okta</h4><p>Okta doesn’t have the concept of Roles, but it does have Groups that can be used for the same purpose when authenticating to a ZeroTier network.</p>
<blockquote>
<p><strong>NOTE</strong><br>Okta role/group based access requires ZeroTier One version 1.10.3+</p>
</blockquote>
<h5 id="Step-1-Create-a-Group-and-Assign-Users"><a href="#Step-1-Create-a-Group-and-Assign-Users" class="headerlink" title="Step 1: Create a Group and Assign Users"></a>Step 1: Create a Group and Assign Users</h5><p>From your Okta administrator dashboard, go to Directory and select Groups. Create a group with the name of your choice. Once created, assign people to the group that you want to have access to your ZeroTier network.</p>
<h5 id="Step-2-Attach-Groups-to-Tokens"><a href="#Step-2-Attach-Groups-to-Tokens" class="headerlink" title="Step 2: Attach Groups to Tokens"></a>Step 2: Attach Groups to Tokens</h5><p>In the Okta administrator dashboard, go to Applications and open the configuration for the Okta Application you’ve configured for use with ZeroTier. Click the ‘Edit’ button in the “OpenID Connect ID Token” box. Set “Group claim type” to “Filter”, and set the three fields for “Group claim filter” to <code>roles</code>, <code>Matches regex</code>, and <code>.*</code>.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318094935.png" alt="20240318094935"><br>It is possible to limit the groups to only certain groups. See Okta’s <a href="https://developer.okta.com/docs/reference/okta-expression-language/#group-functions">group filter documentation</a> for more information.</p>
<h4 id="OneLogin-by-OneIdentity"><a href="#OneLogin-by-OneIdentity" class="headerlink" title="OneLogin by OneIdentity"></a>OneLogin by OneIdentity</h4><p>Coming Soon</p>
<h2 id="Add-new-SSO-Seats"><a href="#Add-new-SSO-Seats" class="headerlink" title="Add new SSO Seats"></a>Add new SSO Seats</h2><p>If you are already on the Pro plan, to increase your Node, Admin, or SSO entitlements:<br>Go to the Account page<br>Click Modify Plan<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318160443.png" alt="20240318160443"><br>You will see your current subscription level<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318160518.png" alt="20240318160518"><br>Adjust the levels to your new needs<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318160555.png" alt="20240318160555"><br>Click checkout<br>The system will figure out any needed credits or proration.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318160627.png" alt="20240318160627"><br>Click Update Subscription to finish to accept the changes<br>This will charge your card if needed and update your account to the new subscription levels.</p>
<h2 id="Authentication-Login-and-Email-issues"><a href="#Authentication-Login-and-Email-issues" class="headerlink" title="Authentication, Login, and Email issues"></a>Authentication, Login, and Email issues</h2><h3 id="Not-receiving-emails-from-us"><a href="#Not-receiving-emails-from-us" class="headerlink" title="Not receiving emails from us?"></a>Not receiving emails from us?</h3><p>If you are not receiving password reset emails, first check your Spam/Junk Mail folder.<br>If it’s not in your Spam/Junk Mail folder, contact your email administrator to ensure emails from <a href="my@zerotier.com">my@zerotier.com</a> are not being blocked at the server level.</p>
<h3 id="Changing-Your-Email-Address"><a href="#Changing-Your-Email-Address" class="headerlink" title="Changing Your Email Address"></a>Changing Your Email Address</h3><p>Log into ZeroTier Central at <a href="https://my.zerotier.com">https://my.zerotier.com</a>. Once logged in, there’s a “Manage Account” link on the Account page. Click that and then “Personal Info” and you’ll be taken to a form where you can change your email address.</p>
<h3 id="Invalid-Authenticator-Code"><a href="#Invalid-Authenticator-Code" class="headerlink" title="Invalid Authenticator Code"></a>Invalid Authenticator Code</h3><p>This can be caused by the time being wrong on your computer or phone.</p>
<h3 id="Lost-Authenticator-Code"><a href="#Lost-Authenticator-Code" class="headerlink" title="Lost Authenticator Code"></a>Lost Authenticator Code</h3><p>Use the Password Reset flow. Click “forgot password” on the login screen.</p>
<blockquote>
<p><strong>HISTORY</strong><br>If you have not logged in to your account since 2019, accounts were migrated to a new system in 2019. Your networks are still there!<br>Please try to create an account with the same email address you used before.</p>
</blockquote>
<h2 id="Organizations"><a href="#Organizations" class="headerlink" title="Organizations"></a>Organizations</h2><p>You’ve subscribed to my.zerotier.com and want your coworkers to also have the benefits of a Pro account.<br>Add them to your Organization by going to my.zerotier.com/account<br>Create an invite by typing in an email address<br>We will email them the link. You can also paste it into your company chat.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318161100.png" alt="20240318161100"><br>Once they accept the invite, they can be added as Admins to individual networks.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318161120.png" alt="20240318161120"><br>The invited User will see:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318161207.png" alt="20240318161207"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318161236.png" alt="20240318161236"></p>
<h3 id="Removing-Admins-from-the-Organization"><a href="#Removing-Admins-from-the-Organization" class="headerlink" title="Removing Admins from the Organization"></a>Removing Admins from the Organization</h3><p>You can click the “remove” button next to their name in the list of admins. They will lose Admin access to the organizations networks.</p>
<h3 id="Change-the-Organization-owner"><a href="#Change-the-Organization-owner" class="headerlink" title="Change the Organization owner"></a>Change the Organization owner</h3><p>There is currently no straight-forward way to do this, and ZeroTier support can’t change your organization owner via email/ticket because that would be insecure.<br>The secure way to do this is to change the login of the organization owner:</p>
<ul>
<li>Go to <a href="https://my.zerotier.com/account">https://my.zerotier.com/account</a></li>
<li>click Manage Account</li>
<li>Click Personal Info</li>
<li>Change the email address to the new organization owner’s email</li>
<li>Log out and back in</li>
<li>You may want to change the password as well</li>
</ul>
<p>Consider using a general email address like “<a href="billing@example.com">billing@example.com</a>“ or “<a href="zerotier@example.com">zerotier@example.com</a>“ when you sign up, or when you change org owners.</p>
<h4 id="Can-I-move-or-transfer-my-network-s-to-another-user-1"><a href="#Can-I-move-or-transfer-my-network-s-to-another-user-1" class="headerlink" title="Can I move or transfer my network(s) to another user?"></a>Can I move or transfer my network(s) to another user?</h4><p>The only process that moves networks is joining an organization. When you join, the organization absorbs all your existing networks.<br>If your networks are small; It may be faster to start a new account and new networks.</p>
<h2 id="Add-Network-Admin"><a href="#Add-Network-Admin" class="headerlink" title="Add Network Admin"></a>Add Network Admin</h2><p>Professional subscriptions have a shared administration feature.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318161858.png" alt="20240318161858"><br>Toward the bottom of a Network’s page. There is a section titled “Administrators”<br>A user must be a member of your Organization to become a Network Administrator.</p>
<h3 id="Permissions"><a href="#Permissions" class="headerlink" title="Permissions"></a>Permissions</h3><p>You can allow another my.zerotier.com user permission to</p>
<ul>
<li><strong>Read</strong>. They can look at the network but not change anything</li>
<li><strong>Authorize</strong>. Allow them to Authorize new members, but not make other changes.</li>
<li><strong>Modify</strong>. Allow them to change any settings on this Network.</li>
<li><strong>Delete</strong>. Allow them to delete the network.<h2 id="Pricing"><a href="#Pricing" class="headerlink" title="Pricing"></a>Pricing</h2><blockquote>
<p><strong> INFO</strong><br>See our <a href="https://www.zerotier.com/pricing/">pricing page</a> for current plans.</p>
</blockquote>
</li>
</ul>
<h3 id="Do-my-networks-still-work-properly-if-I’m-out-of-compliance"><a href="#Do-my-networks-still-work-properly-if-I’m-out-of-compliance" class="headerlink" title="Do my networks still work properly if I’m out of compliance?"></a>Do my networks still work properly if I’m out of compliance?</h3><p>Yes, everything works fine for the old network members you’ve set up. Many people use ZeroTier for critical infrastructure and we make it our highest priority to ensure your service isn’t interrupted in relation to the new pricing plan. Our enforcement just blocks your ability to add new members to your network until you’re in compliance with the new plan.</p>
<blockquote>
<p><strong>HISTORY</strong><br>On Thursday, 9 June 2022 we updated our product plans and the Free Basic plan has changed. Here are some things to know:<br>We have changed the number of nodes available on the Free Basic plan from 50 to 25.<br>We have also changed how we count them. We now count total nodes authorized across all the networks you have, not individual members on networks, so while the free limit is now 25, these nodes can now be authorized on multiple networks. Networks are free. For some users with multiple networks, this may amount to a limit increase.<br>If you are over the limit, your networks and the nodes already authorized on them will still work, but you will need to purchase node packs to add new nodes.<br>Node packs are only $5.00/month for packs of 25 nodes. You can purchase them on your account page in ZeroTier Central.<br>For more information about the pricing plan, please read: <a href="https://www.zerotier.com/2022/06/09/zerotier-business-sso-is-here-and-so-is-our-new-pricing/">https://www.zerotier.com/2022/06/09/zerotier-business-sso-is-here-and-so-is-our-new-pricing/</a></p>
</blockquote>
<h2 id="Invoices-Billing-Unsubscribe"><a href="#Invoices-Billing-Unsubscribe" class="headerlink" title="Invoices, Billing, Unsubscribe"></a>Invoices, Billing, Unsubscribe</h2><ul>
<li>Go to your <a href="https://my.zerotier.com/account">account page</a></li>
<li>Click Manage Billing<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318162449.png" alt="20240318162449"><br>It will take you to this page where you can update information and download invoices:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318162507.png" alt="20240318162507"><h3 id="I-don’t-see-a-“Manage-Billing”-button"><a href="#I-don’t-see-a-“Manage-Billing”-button" class="headerlink" title="I don’t see a “Manage Billing” button"></a>I don’t see a “Manage Billing” button</h3>Only the Organization Owner can edit billing info. The account page will show who your Organization Owner is, if it is not you.<h3 id="If-the-address-is-incorrect-on-your-invoice"><a href="#If-the-address-is-incorrect-on-your-invoice" class="headerlink" title="If the address is incorrect on your invoice"></a>If the address is incorrect on your invoice</h3>Please use the Update Information link. If possible, use Address Line 1 for your company name. And Line 2 for your address. If it doesn’t fit please contact us.<br>After changing the address, use the <em>download invoice</em> link. If too much time has passed since the invoice was finalized, it won’t be updated. Sorry.<h3 id="My-invoices-don’t-show-my-Tax-ID"><a href="#My-invoices-don’t-show-my-Tax-ID" class="headerlink" title="My invoices don’t show my Tax ID"></a>My invoices don’t show my Tax ID</h3>ZeroTier’s US Tax ID is 47-3126707. We aren’t incorporated outside of the US so we don’t have a Tax ID for anywhere outside of the US. Our payment processor will not print your Tax ID on invoices for this reason.<br>If you need a Tax ID in order to purchase ZeroTier, consider reaching out to a local MSP to buy ZeroTier through them.<h3 id="How-to-delete-your-whole-account"><a href="#How-to-delete-your-whole-account" class="headerlink" title="How to delete your whole account"></a>How to delete your whole account</h3>Go to your <a href="https://my.zerotier.com/account">account page</a> and click on the “delete account” button.<br>This deletes everything about your account, in accordance with various privacy laws.</li>
</ul>
<h2 id="Hide-or-Delete-Nodes"><a href="#Hide-or-Delete-Nodes" class="headerlink" title="Hide or Delete Nodes"></a>Hide or Delete Nodes</h2><p>There are delete and hide buttons on the right side of the list nodes in the Members section of a ZeroTier network.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318162824.png" alt="20240318162824"></p>
<h3 id="Hiding-a-Member"><a href="#Hiding-a-Member" class="headerlink" title="Hiding a Member"></a>Hiding a Member</h3><p>The member will be de-authorized and hidden from view in the list.<br>Hidden members can be revealed by setting the “Hidden” checkbox above the member’s list.</p>
<h3 id="Deleting-a-Member"><a href="#Deleting-a-Member" class="headerlink" title="Deleting a Member"></a>Deleting a Member</h3><p>The member will be de-authorized and completely removed from the list. It’s a little more permanent than hiding.</p>
<h3 id="Recover-a-Deleted-Member"><a href="#Recover-a-Deleted-Member" class="headerlink" title="Recover a Deleted Member"></a>Recover a Deleted Member</h3><p>You’ve deleted a member from your network, possibly by accident, and you want to get it back:</p>
<ul>
<li>Go to the Settings section of the network</li>
<li>Find the Manually Add Member section</li>
<li>Paste in the Node ID<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318163025.png" alt="20240318163025"><br>If you’ve lost your Node ID, it can be viewed on the device in the ZeroTier app.<br>Delete should only be used if the node will never join again. Just de-authorize them instead if you don’t want them counted against your node limits.<br>If you don’t see the Delete and Hide Buttons, you have likely turned off your network’s access control by setting it to Public.<br>Public networks have no access control. If you deleted or de-authorized a member it would reappear within a few seconds.<br>Set your network to back to Private.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318163059.png" alt="20240318163059"><h2 id="Web-Hooks"><a href="#Web-Hooks" class="headerlink" title="Web Hooks"></a>Web Hooks</h2>Subscribers can receive notifications of changes to their networks, network members, and organizations on my.zerotier.com via Web Hooks.<h3 id="Configuring-Web-Hooks"><a href="#Configuring-Web-Hooks" class="headerlink" title="Configuring Web Hooks"></a>Configuring Web Hooks</h3>Go to the <a href="https://my.zerotier.com/account">Account</a> page. Under <code>Your Organization</code> there is a section called <code>Webhooks</code>.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318163227.png" alt="20240318163227"><br>Enter the URL your HTTP(S) endpoint that will receive the webhook and (optionally) enter a description, then select the event types you wish to receive on the webhook.<br>See <a href="https://github.com/zerotier/ztchooks">github.com/zerotier/ztchooks</a> for example code for receiving &amp; processing webhooks.<br>All hooks fired will contain the following three fields:<pre><code>&#123;
  &quot;hookd_id&quot;: ...,
  &quot;org_id&quot;: ...,
  &quot;hook_type&quot;: ...,
&#125;
</code></pre>The rest of the fields vary by <code>hook_type</code>. Full definitions of all of the fields can be found <a href="https://github.com/zerotier/ztchooks/blob/main/types.go">here</a>.<h3 id="Hook-Types"><a href="#Hook-Types" class="headerlink" title="Hook Types"></a>Hook Types</h3></li>
<li>Network Join (<code>NETWORK_JOIN</code>) - Fired when a new member is requesting to join a network. NOTE: This is only fired once when the network controller first receives the join request from the network member.</li>
<li>Network Auth (<code>NETWORK_AUTH</code>) - Fired when an administrator authorizes a new member to a network.</li>
<li>Network Deauth (<code>NETWORK_DEAUTH</code>) - Fired when an administrator revokes authorization from a network.</li>
<li>Network Created (<code>NETWORK_CREATED</code>) - Fired when an administrator creates a new network.</li>
<li>Network Deleted (<code>NETWORK_DELETED</code>) - Fired when an administrator deletes a network.</li>
<li>Network Configuration Change (<code>NETWORK_CONFIG_CHANGED</code>) - Fired when an administrator changes the configuration of a network.</li>
<li>Network SSO Login (<code>NETWORK_SSO_LOGIN</code>) - Fired when a user is authorized/reauthorized to a network via SSO.</li>
<li>Network SSO Login Error (<code>NETWORK_SSO_LOGIN_ERROR</code>) - Fired when there is an error authorizing/reauthorizing to a network via SSO.</li>
<li>Member Configuration Change (<code>MEMBER_CONFIG_CHANGED</code>) - Fired when an administrator makes a configuration change to a network member.</li>
<li>Member Deleted (<code>MEMBER_DELETED</code>) - Fired when an administrator deletes a network member.</li>
<li>Organization Invite Sent (<code>ORG_INVITE_SENT</code>) - Fired when the account owner invites an administrator to the network.</li>
<li>Organization Invite Accepted (<code>ORG_INVITE_ACCEPTED</code>) - Fired when the invitee accepts and joins the organization.</li>
<li>Organization Invite Rejected (<code>ORG_INVITE_REJECTED</code>) - Fired when the invitee rejects the invitation.</li>
<li>Organization Member Removed (<code>ORG_MEMBER_REMOVED</code>) - Fired when the account owner removes a member from the organization.<h3 id="Retries"><a href="#Retries" class="headerlink" title="Retries"></a>Retries</h3>If a hook fails to be sent for any reason, it will be retried up to a maximum of 10 times with an exponential backoff policy. The 2nd attempt will be approximately 1 minute after the first. The third approximately 2 minutes after the 2nd, and so on to a maximum of 1 hour between attempts. If there is still a failure after 10 attempts, the call will be abandoned.<h3 id="Web-Hook-Security"><a href="#Web-Hook-Security" class="headerlink" title="Web Hook Security"></a>Web Hook Security</h3>In order enhance security, and to prevent replay attacks, we have implemented a hook signing algorithm so you can verify each hook request as you receive it. We have also provided a <a href="https://github.com/zerotier/ztchooks">Go Library</a> and a <a href="https://github.com/zerotier/ztchooks-ts">TypeScript Library</a> for your use in verifying incoming webhooks.<br>First you must create a Webhook Signing Secret from your <a href="https://my.zerotier.com/account">account page</a>.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318163829.png" alt="20240318163829"><br>The secret is a hexadecimal string. You will need a copy in order to verify webhooks. The signature will be placed in the HTTP header <code>X-ZTC-Signature</code>.<h4 id="Go-Example"><a href="#Go-Example" class="headerlink" title="Go Example"></a>Go Example</h4>```<br>import (<br>  “net/http”<br>  “github.com/zerotier/ztchooks”<br>)</li>
</ul>
<p>const PSK = “<your_signing_secret>“</p>
<p>func hookCatcher(res http.ResponseWriter, req *http.Request) {<br>    body, err := io.ReadAll(req.Body)<br>    if err != nil {<br>        panic(err)<br>    }</p>
<pre><code>signature := req.Header.Get(&quot;X-ZTC-Signature&quot;)
if err := ztchooks.VerifyHookSignature(PSK, signature, body, ztchooks.DefaultTolerance); err != nil &#123;
    // signature verification failed
    res.WriteHeader(http.StatusInternalServerError)
    w.Write([]byte(&quot;500 - Signature Verification Failed&quot;))
    return
&#125;

// Signature verification succeded
</code></pre><p>}</p>
<p>func main() {<br>    http.HandleFunc(“/“, hookCatcher)<br>    http.ListenAndServe(“:9999”, nil)<br>}</p>
<pre><code>NOTE: A more complete example of verification &amp; processing hooks can be found [here](https://github.com/zerotier/ztchooks/blob/main/example/hook-catcher.go).
It is possible to have multiple signing secrets. Hooks will be signed with all secrets, and the verification method provided by the `ztchooks` library does take this into account automatically.

# Guides
## Docker
Simple example using an interactive shell.
ZeroTier One makes ZeroTier virtual networks available as &#39;tap&#39; virtual network ports. To do this inside a Docker container requires a few elevated permissions and access to the `/dev/net/tun` device.
Fortunately this is easy:
</code></pre><p>docker run -it —rm \<br>—cap-add=NET_ADMIN \<br>—cap-add=SYS_ADMIN \<br>—device=/dev/net/tun centos:7 [… command …]</p>
<pre><code>Where `[... command ...]` is an optional command, in the example below we&#39;ll provide `/bin/bash` to get an interactive shell.
&gt; **INFO**
&gt; `SYS_ADMIN` is needed because `NET_ADMIN` does not include the `ioctl()` required to put `/dev/net/tun` in tap mode. This appears to be a bug in Linux&#39;s capability model but it would have to be fixed upstream.

Here&#39;s a transcript of an example session where we start a command prompt in a test container, install ZeroTier, start it (must be done manually here because the container does not run init or systemd), join a test network, and ping something.
Starting a container with an interactive shell:
```bash
docker run -it --rm \
--cap-add=NET_ADMIN \
--cap-add=SYS_ADMIN \
--device=/dev/net/tun centos:7 /bin/bash
</code></pre><p>Then, while inside the container we install ZeroTier:</p>
<pre><code class="lang-bash">[root@5b88595860bc /]# curl https://install.zerotier.com/ | bash
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 12243  100 12243    0     0  18523      0 --:--:-- --:--:-- --:--:-- 18550

*** ZeroTier One Quick Install for Unix-like Systems

*** Supported targets for this script:
***    macOS (10.7+) on x86_64 (just installs ZeroTier One.pkg)
***    Linux / Debian (wheezy or newer) on i386, x86_64, and armhf (Raspbian/jessie only)
***    Linux / Ubuntu (trusty or newer) on i386 and x86_64
***    Linux / SuSE (12+) on i386 and x86_64
***    Linux / CentOS (6+) on i386 and x86_64
***    Linux / Fedora (22+) on i386 and x86_64
***    Linux / Amazon (2016.03+) on x86_64

*** Please report problems to contact@zerotier.com and we will try to fix ASAP!

*** Detecting Linux Distribution

*** Found RHEL/CentOS, creating /etc/yum.repos.d/zerotier.repo

*** Installing zerotier-one package...
[ ... snipped a bunch of yum install output ...]

*** Enabling and starting zerotier-one service...
Created symlink from /etc/systemd/system/multi-user.target.wants/zerotier-one.service to /usr/lib/systemd/system/zerotier-one.service.
Failed to get D-Bus connection: Operation not permitted

*** Package installed but cannot start service! You may be in a Docker
*** container or using a non-standard init service.
</code></pre>
<p>Start ZeroTier and join a network:</p>
<pre><code class="lang-bash">[root@5b88595860bc /]# /usr/sbin/zerotier-one -d
[root@5b88595860bc /]# /usr/sbin/zerotier-cli join 8056c2e21c000001
200 join OK
[root@5b88595860bc /]# /usr/sbin/zerotier-cli listnetworks
200 listnetworks
200 listnetworks 8056c2e21c000001 - 02:e6:10:ab:69:33 REQUESTING_CONFIGURATION PRIVATE zt0 -
[root@5b88595860bc /]# /usr/sbin/zerotier-cli listnetworks
200 listnetworks
200 listnetworks 8056c2e21c000001 earth.zerotier.net 02:e6:10:ab:69:33 OK PUBLIC zt0 fd80:56c2:e21c:0000:0199:93e6:10b7:8bf1/88,28.183.140.10/7
</code></pre>
<p>Try pinging something:</p>
<pre><code class="lang-bash">[root@5b88595860bc /]# ping &lt;some_other_zerotier_nodes_ip&gt;
</code></pre>
<p>Exit</p>
<pre><code class="lang-bash">[root@5b88595860bc /]# exit
</code></pre>
<h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><blockquote>
<p><strong>BETA</strong><br>This feature is still in beta. This will soon be integrated into ZeroTier 2.0, but for now, it is segregated to allow us to iterate quickly.</p>
<h3 id="Conceptual-Prerequisites"><a href="#Conceptual-Prerequisites" class="headerlink" title="Conceptual Prerequisites"></a>Conceptual Prerequisites</h3><ul>
<li>When ZeroTier joins a network, it creates a virtual network interface.</li>
<li>When ZeroTier joins multiple networks, there will be multiple network interfaces.</li>
<li>When ZeroNSD starts, it binds to a ZeroTier network interface.</li>
<li>When ZeroTier is joined to multiple networks, it needs multiple ZeroNSDs, one for each interface.</li>
</ul>
</blockquote>
<p>This means:</p>
<ul>
<li>ZeroNSD will be accessible from the node it is running on.</li>
<li>ZeroNSD will be accessible from other nodes on the ZeroTier network.</li>
<li>ZeroNSD will be isolated from other networks the node might be on.</li>
</ul>
<h3 id="Technical-Prerequisites"><a href="#Technical-Prerequisites" class="headerlink" title="Technical Prerequisites"></a>Technical Prerequisites</h3><p>This Quickstart was written using two machines - one Ubuntu virtual machine on Digital Ocean, and one macOS laptop on a residential ISP. To follow along step by step, you’ll need to provision equivalent infrastructure. If you use different platforms, you should be able to figure out what to do with minimal effort.</p>
<h3 id="Create-a-ZeroTier-Network"><a href="#Create-a-ZeroTier-Network" class="headerlink" title="Create a ZeroTier Network"></a>Create a ZeroTier Network</h3><p>You may do this manually through the <a href="https://my.zerotier.com/">ZeroTier Central WebUI</a>,<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182436.png" alt="20240318182436"></p>
<h3 id="Install-ZeroTier"><a href="#Install-ZeroTier" class="headerlink" title="Install ZeroTier"></a>Install ZeroTier</h3><p>ZeroTier must be installed and joined to the network you intend to provide DNS service to. The following should work from the CLI on most platforms. Windows users may download the MSI from the <a href="https://www.zerotier.com/download/">ZeroTier Downloads</a> page. For the remainder of this document, please replace the example network <code>af78bf94364e2035</code> with a network ID your own.</p>
<pre><code>notroot@ubuntu:~$ curl -s https://install.zerotier.com | sudo bash
notroot@ubuntu:~$ sudo zerotier-cli join af78bf94364e2035
notroot@ubuntu:~$ sudo zerotier-cli  set af78bf94364e2035 allowDNS=1
</code></pre><h3 id="Authorize-the-Nodes"><a href="#Authorize-the-Nodes" class="headerlink" title="Authorize the Nodes"></a>Authorize the Nodes</h3><p>Authorize the node to the network by clicking the “Auth” button in the Members section in the <a href="https://my.zerotier.com/">ZeroTier Central WebUI</a>.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182525.png" alt="20240318182525"><br>First, <a href="https://docs.zerotier.com/api/tokens">create a Central API token</a>.<br>Next, you will need to stash this in a file for ZeroNSD to read.</p>
<pre><code class="lang-bash">sudo bash -c &quot;echo ZEROTIER_CENTRAL_TOKEN &gt; /var/lib/zerotier-one/token&quot;
sudo chown zerotier-one:zerotier-one /var/lib/zerotier-one/token
sudo chmod 600 /var/lib/zerotier-one/token
</code></pre>
<h3 id="ZeroTier-Systemd-Manager"><a href="#ZeroTier-Systemd-Manager" class="headerlink" title="ZeroTier Systemd Manager"></a>ZeroTier Systemd Manager</h3><p>zerotier-systemd-manager publishes rpm and deb packages available at <a href="https://github.com/zerotier/zerotier-systemd-manager/releases">https://github.com/zerotier/zerotier-systemd-manager/releases</a></p>
<pre><code class="lang-bash">wget https://github.com/zerotier/zerotier-systemd-manager/releases/download/v0.1.9/zerotier-systemd-manager_0.1.9_linux_amd64.deb
sudo dpkg -i zerotier-systemd-manager_0.1.9_linux_amd64.deb
</code></pre>
<p>Finally, restart all the ZeroTier services.</p>
<pre><code class="lang-bash">sudo systemctl daemon-reload
sudo systemctl restart zerotier-one
sudo systemctl enable zerotier-systemd-manager.timer
sudo systemctl start zerotier-systemd-manager.timer
</code></pre>
<h3 id="Install-ZeroNSD"><a href="#Install-ZeroNSD" class="headerlink" title="Install ZeroNSD"></a>Install ZeroNSD</h3><p>ZeroNSD should only run on one node per network. Latency for DNS really matters, so try to place it as close to the clients as possible.</p>
<h4 id="Packages"><a href="#Packages" class="headerlink" title="Packages"></a>Packages</h4><p>ZeroNSD publishes rpm, deb, and msi packages, available <a href="https://github.com/zerotier/zeronsd/releases">here</a>.<br><em>The latest release is <strong>not</strong> reflected below. Go to the link above to get a link!</em></p>
<pre><code class="lang-bash">wget https://github.com/zerotier/zeronsd/releases/download/v0.1.7/zeronsd_0.1.7_amd64.deb
sudo dpkg -i zeronsd_0.1.7_amd64.deb
</code></pre>
<h4 id="Cargo"><a href="#Cargo" class="headerlink" title="Cargo"></a>Cargo</h4><p>If we don’t have packages for your platform, you can still install it with cargo.</p>
<pre><code class="lang-bash">sudo /usr/bin/apt-get -y install net-tools librust-openssl-dev pkg-config cargo
sudo /usr/bin/cargo install zeronsd --root /usr/local
</code></pre>
<h4 id="Serve-DNS"><a href="#Serve-DNS" class="headerlink" title="Serve DNS"></a>Serve DNS</h4><p>For each network you want to serve DNS to, do the following (replace <code>af78bf94364e2035</code> with <em>your</em> network ID)</p>
<pre><code class="lang-bash">sudo zeronsd supervise -t /var/lib/zerotier-one/token -w -d beyond.corp af78bf94364e2035
sudo systemctl start zeronsd-af78bf94364e2035
sudo systemctl enable zeronsd-af78bf94364e2035
</code></pre>
<h4 id="Verify-functionality"><a href="#Verify-functionality" class="headerlink" title="Verify functionality"></a>Verify functionality</h4><p>You should be able to ping the laptop via it’s DNS name (or any preceding subdomain, since we’ve set the wildcard flag)</p>
<pre><code class="lang-bash">notroot@ubuntu:~$ ping laptop.beyond.corp
PING laptop.beyond.corp (172.22.192.177) 56(84) bytes of data.
64 bytes from 172.22.192.177 (172.22.192.177): icmp_seq=1 ttl=64 time=50.1 ms
64 bytes from 172.22.192.177 (172.22.192.177): icmp_seq=2 ttl=64 time=49.5 ms
64 bytes from 172.22.192.177 (172.22.192.177): icmp_seq=3 ttl=64 time=48.6 ms
</code></pre>
<p>or</p>
<pre><code class="lang-bash">notroot@ubuntu:~$ ping laptop.beyond.corp
PING travel.laptop.beyond.corp (172.22.192.177) 56(84) bytes of data.
64 bytes from 172.22.192.177 (172.22.192.177): icmp_seq=1 ttl=64 time=50.1 ms
64 bytes from 172.22.192.177 (172.22.192.177): icmp_seq=2 ttl=64 time=49.5 ms
64 bytes from 172.22.192.177 (172.22.192.177): icmp_seq=3 ttl=64 time=48.6 ms
</code></pre>
<h4 id="Update-flag-settings"><a href="#Update-flag-settings" class="headerlink" title="Update flag settings"></a>Update flag settings</h4><p>In order to change the settings (such as the TLD), do the following (replace <code>af78bf94364e2035</code> with your network ID)</p>
<pre><code class="lang-bash">sudo zeronsd supervise -t /var/lib/zerotier-one/token -w -d beyond.corp af78bf94364e2035
sudo systemctl daemon-reload
sudo systemctl enable zeronsd-af78bf94364e2035
</code></pre>
<p>Most Linux distributions, by default, do not have per-interface DNS resolution out of the box. To test DNS queries against ZeroNSD without <code>zerotier-systemd-manager</code>, find the IP address that ZeroNSD has bound itself to, and run queries against it explicitly.</p>
<pre><code class="lang-bash">sudo lsof -i -n | grep ^zeronsd | grep UDP | awk &#39;&#123; print $9 &#125;&#39; | cut -f1 -d:
172.22.245.70
</code></pre>
<p>Query the DNS server directly with the dig command<br>The Ubuntu machine can be queried with:</p>
<pre><code class="lang-bash">dig +short @172.22.245.70 zt-3513e8b98d.beyond.corp
172.22.245.70
dig +short @172.22.245.70 server.beyond.corp
172.22.245.70
</code></pre>
<p>The macOS laptop can be queried with:</p>
<pre><code class="lang-bash">dig +short @172.22.245.70 zt-eff05def90.beyond.corp
172.22.245.70
dig +short @172.22.245.70 laptop.beyond.corp
172.22.192.177
</code></pre>
<p>Add a line to <code>/etc/hosts</code> and query again.</p>
<pre><code class="lang-bash">bash -c &#39;echo &quot;1.2.3.4 test&quot; &gt;&gt; /etc/hosts&#39;
dig +short @172.22.245.70 test.beyond.corp
1.2.3.4
</code></pre>
<p>Query a domain on the public DNS to verify fall through</p>
<pre><code class="lang-bash">dig +short @172.22.245.70 example.com
93.184.216.34
</code></pre>
<h4 id="macOS-3"><a href="#macOS-3" class="headerlink" title="macOS"></a>macOS</h4><p>macOS uses <code>dns-sd</code> for DNS resolution. Unfortunately, <code>nslookup</code>,<code>host</code>, and <code>dig</code> are broken on macOS. <code>ping</code> works.</p>
<pre><code>user@osx:~$ ping server.beyond.corp
PING server.beyond.corp (172.22.245.70): 56 data bytes
64 bytes from 172.22.245.70: icmp_seq=0 ttl=64 time=37.361 ms
64 bytes from 172.22.245.70: icmp_seq=1 ttl=64 time=38.129 ms
64 bytes from 172.22.245.70: icmp_seq=2 ttl=64 time=37.569 ms
</code></pre><p>To check out the system resolver settings, use: <code>scutil --dns</code>.<br>The Ubuntu machine can be queried with<br><code>dns-sd -G v4 server.beyond.corp</code> <code>dns-sd -G v4 zt-3513e8b98d.beyond.corp</code><br>The macOS machine be queried with<br><code>dns-sd -G v4 laptop.beyond.corp</code> <code>dns-sd -G v4 zt-eff05def90.beyond.corp</code></p>
<h4 id="Windows-2"><a href="#Windows-2" class="headerlink" title="Windows"></a>Windows</h4><p>Are you a Windows user? Does this work out of the box? Does nslookup behave properly? Let us know… feedback and pull requests welcome =)</p>
<h4 id="Serving-non-ZeroTier-records"><a href="#Serving-non-ZeroTier-records" class="headerlink" title="Serving non-ZeroTier records"></a>Serving non-ZeroTier records</h4><p><strong>NOTE</strong> this portion of the document is largely intended for advanced users who want to get more out of <code>zeronsd</code>‘s service.<br><code>zeronsd</code> will also serve non-zerotier records in two situations: It will forward <code>/etc/resolv.conf</code>‘s nameservers on a TLD mismatch. This behavior is similar to <code>dnsmasq</code>, a popular DNS server on Linux.<br>Additionally, to serve custom records you can supply the <code>-f</code> flag with a file in <a href="https://man7.org/linux/man-pages/man5/hosts.5.html">hosts format</a> it will service records from that file under the provided TLD, <em>merged in</em> with the zerotier nodes. Example below.<br><strong>NOTE</strong>: if you followed the steps above, you will want to <code>systemctl stop zeronsd-&lt;network id&gt;</code>, and <code>zeronsd unsupervise &lt;network id&gt;</code> your network, before continuing.<br>Make a file called <code>hosts</code> and put this in it:</p>
<pre><code class="lang-bash">1.1.1.1 cloudflare-dns
</code></pre>
<p>Then, let’s start a temporary server for now. We’ll just use the <code>start</code> subcommand of <code>zeronsd</code>. This will run in the foreground, so start a new terminal or <code>&amp;</code> it.</p>
<pre><code class="lang-bash">$ zeronsd start -t /var/lib/zerotier-one/token -f ./hosts -d beyond.corp &lt;network id&gt;
Welcome to ZeroNS!
Your IP is 1.2.3.4
</code></pre>
<p>Finally, we can lookup <code>cloudflare-dns.beyond.corp</code> to find CloudFlare’s DNS server really really fast!</p>
<pre><code class="lang-bash">$ host cloudflare-dns.beyond.corp 1.2.3.4
cloudflare-dns.beyond.corp has address 1.1.1.1
</code></pre>
<blockquote>
<p><strong>TIP</strong><br><a href="https://discuss.zerotier.com/search?q=dns">See community threads about DNS</a></p>
</blockquote>
<h2 id="VPN-Exit-Node"><a href="#VPN-Exit-Node" class="headerlink" title="VPN Exit Node"></a>VPN Exit Node</h2><p>Route all your Internet traffic through a ZeroTier node.</p>
<blockquote>
<p><strong>IN THIS TUTORIAL</strong></p>
<ul>
<li><a href="https://docs.zerotier.com/start">Create a ZeroTier Network</a></li>
<li><a href="https://docs.zerotier.com/exitnode#setup">Set up an <code>exit node</code></a> that handles all your internet traffic</li>
<li>Join the <code>exit node</code> and a personal node to your ZeroTier network</li>
<li>Tell your personal node to use your <code>exit node</code></li>
</ul>
</blockquote>
<p>ZeroTier creates imaginary LANs. Default route override means that computers on your imaginary LAN will be routing Internet traffic through it. Just like a real LAN, your imaginary LAN is going to now need a gateway. Setup here is almost identical to what you’d do to configure a NAT gateway for a conventional wired LAN.</p>
<h3 id="First-create-your-exit-node"><a href="#First-create-your-exit-node" class="headerlink" title="First, create your exit node"></a>First, create your exit node</h3><p>This is the node that will handle all of your internet traffic. It can be something as small as a $5 VPS or a Raspberry Pi.</p>
<ul>
<li>If you haven’t already, go <a href="https://docs.zerotier.com/start">create a network</a> and come back</li>
<li>Install ZeroTier on it</li>
<li>Join the exit node to your ZeroTier network:<pre><code class="lang-bash">sudo zerotier-cli join &lt;nwid&gt;
</code></pre>
</li>
</ul>
<h3 id="Enable-IPv4-Forwarding-on-the-exit-node"><a href="#Enable-IPv4-Forwarding-on-the-exit-node" class="headerlink" title="Enable IPv4 Forwarding on the exit node"></a>Enable IPv4 Forwarding on the exit node</h3><p>On the computer acting as the VPN exit node:</p>
<pre><code class="lang-bash">sudo nano /etc/sysctl.conf
</code></pre>
<p>Add the line:</p>
<pre><code class="lang-bash">/etc/sysctl.conf
net.ipv4.ip_forward = 1
</code></pre>
<p>Tell the kernel to reload settings:</p>
<pre><code class="lang-bash">sudo sysctl -p
</code></pre>
<p>Check that settings were correctly applied:</p>
<pre><code class="lang-bash">sudo sysctl net.ipv4.ip_forward
</code></pre>
<p>If you’ve joined (and authorized!) your exit node to your network then you are ready to begin configuring it. Start by setting a few environment variables that we will use later:<br>Get the name of your ZeroTier interface, it will start with <code>zt</code>:</p>
<pre><code class="lang-bash">ip link show
</code></pre>
<pre><code class="lang-bash">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 96:00:02:8d:28:c7 brd ff:ff:ff:ff:ff:ff
    altname enp1s0
3: zthnhhqofq: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 2800 qdisc fq_codel state UNKNOWN mode DEFAULT group default qlen 1000
    link/ether 86:61:c6:fe:ed:dc brd ff:ff:ff:ff:ff:ff
</code></pre>
<p>In our case it was <code>zthnhhqofq</code>. Let’s set the environment variable:</p>
<pre><code class="lang-bash">export ZT_IF=zthnhhqofq
</code></pre>
<p>Next, get the name of the regular WAN interface to the internet:<br>In our case it was <code>eth0</code></p>
<pre><code class="lang-bash">export WAN_IF=eth0
</code></pre>
<p>Enable NAT and IP masquerading:</p>
<pre><code class="lang-bash">sudo iptables -t nat -A POSTROUTING -o $WAN_IF -j MASQUERADE
</code></pre>
<p>Allow traffic forwarding:</p>
<pre><code class="lang-bash">sudo iptables -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
</code></pre>
<p>Allow traffic forwarding from the ZeroTier interface to the WAN interface:</p>
<pre><code class="lang-bash">sudo iptables -A FORWARD -i $ZT_IF -o $WAN_IF -j ACCEPT
</code></pre>
<p>Make <code>iptables</code> rules persist after reboot:</p>
<pre><code class="lang-bash">sudo apt-get install iptables-persistent
</code></pre>
<p>Save your new <code>iptables</code> rules:</p>
<pre><code class="lang-bash">sudo netfilter-persistent save
</code></pre>
<blockquote>
<p><strong>RESTART</strong><br>At this point it would be a good idea to restart your exit node and verify that the routing rules have persisted.</p>
</blockquote>
<pre><code class="lang-bash">sudo iptables-save
-----------------------------------------------------------------------------------------------
...

-A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i zthnhhqofq -o eth0 -j ACCEPT

...

-A POSTROUTING -o eth0 -j MASQUERADE

...
</code></pre>
<p>Your exit node is complete, now we need to configure your network.</p>
<h3 id="Configure-your-network"><a href="#Configure-your-network" class="headerlink" title="Configure your network"></a>Configure your network</h3><p>Now that your exit node is set up we need to configure your ZeroTier network to advertise a Default Route so that other nodes know that the exit node can route traffic to the internet.<br>Central &gt; Network &gt;</p>
<h3 id="Tell-other-nodes-to-use-exit-node"><a href="#Tell-other-nodes-to-use-exit-node" class="headerlink" title="Tell other nodes to use exit node"></a>Tell other nodes to use exit node</h3><blockquote>
<p><strong>~/.BASHRC</strong><br>Try adding something like the following for simple tunnel on/off control:</p>
<pre><code>tunnel()
&#123;
 sudo zerotier-cli set $nwid allowDefault=1
&#125;

notunnel()
&#123;
 sudo zerotier-cli set $nwid allowDefault=0
&#125;
</code></pre></blockquote>
<h2 id="Cloud-Deployments"><a href="#Cloud-Deployments" class="headerlink" title="Cloud Deployments"></a>Cloud Deployments</h2><h3 id="Terraform"><a href="#Terraform" class="headerlink" title="Terraform"></a>Terraform</h3><blockquote>
<p><strong>ADVANCED</strong><br>For the multi-cloud edition of this guide, click <a href="https://docs.zerotier.com/terraform-multicloud">here</a></p>
</blockquote>
<h4 id="Welcome"><a href="#Welcome" class="headerlink" title="Welcome"></a>Welcome</h4><p>Managing large numbers of settings in a webUI can be a total bummer. It’d be much nicer if we could describe our ZeroTier networks and membership settings as code. That would let us keep them in version control, and integrate them into our software delivery pipelines.<br>Now we can!<br>Terraform allows us to talk to the ZeroTier Central API and describe our network infrastructure, as code. This tutorial will walk you though how to get started.<br>To follow along step by step, you will need:</p>
<ul>
<li>A <a href="https://github.com/">Github</a> account,</li>
<li>A <a href="https://my.zerotier.com/">ZeroTier Central</a> account,</li>
<li>A <a href="https://my.zerotier.com/">Terraform Cloud</a> account.</li>
</ul>
<p>It should take you about 10 minutes to through this tutorial. It will be done in browser without touching the command line at all.</p>
<h4 id="Import-the-Quickstart-repo"><a href="#Import-the-Quickstart-repo" class="headerlink" title="Import the Quickstart repo"></a>Import the Quickstart repo</h4><p>Use Github’s <a href="https://github.com/new/import">Import</a> feature to create a private copy of the <a href="https://github.com/zerotier/terraform-quickstart">ZeroTier Terraform Quickstart repo</a>. We will hook this up to a Terraform runner on <a href="https://app.terraform.io/">Terraform Cloud</a>. After that, we will use Github’s in-browser editing feature to drive the tutorial.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318180825.png" alt="20240318180825"></p>
<h4 id="Create-a-Terraform-workspace"><a href="#Create-a-Terraform-workspace" class="headerlink" title="Create a Terraform workspace"></a>Create a Terraform workspace</h4><p>Next, we create a Terraform workspace and attach it to our private Github repository. Be sure to select <strong><em>version control workflow</em></strong>, select the correct Github account, (we want the private copy, not the original), and give it a unique name.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318180949.png" alt="20240318180949"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181001.png" alt="20240318181001"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181011.png" alt="20240318181011"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181020.png" alt="20240318181020"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181029.png" alt="20240318181029"></p>
<h4 id="Create-a-Central-API-Token"><a href="#Create-a-Central-API-Token" class="headerlink" title="Create a Central API Token"></a>Create a Central API Token</h4><p>Next, we create an API token that Terraform will use to drive the ZeroTier Central API. Navigate to <code>Account</code> -&gt; <code>API Access Tokens</code>.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181104.png" alt="20240318181104"></p>
<h4 id="Add-token-as-a-Workspace-Environment-Variable"><a href="#Add-token-as-a-Workspace-Environment-Variable" class="headerlink" title="Add token as a Workspace Environment Variable"></a>Add token as a Workspace Environment Variable</h4><p>Add the token as an Environment Variable to our workspace. This will let the <a href="https://github.com/zerotier/terraform-provider-zerotier">ZeroTier Terraform Provider</a> authenticate to the API. The variable must be named <code>ZEROTIER_CENTRAL_TOKEN</code>. Be sure to check the <code>Sensitive</code> box.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181210.png" alt="20240318181210"></p>
<h4 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h4><p>This example is probably the simplest thing you can do with ZeroTier. It creates a single network, then joins two members. The <code>member_id</code> settings in the repository are made up, which is good enough to demonstrate how to drive the API with Terraform. Feel free to replace them with real Node IDs of any devices you may wish to join to the networks.<br>In your Github repo, click on <code>hello.tf</code>. There will be a little “edit” icon around the section with the code. Uncomment the Terraform resources and click the green “commit changes” button.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181312.png" alt="20240318181312"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181322.png" alt="20240318181322"></p>
<pre><code class="lang-json">resource &quot;zerotier_network&quot; &quot;hello&quot; &#123;
  name        = &quot;hello&quot;
  description = &quot;Hello World&quot;
  assignment_pool &#123;
    start = &quot;192.168.42.1&quot;
    end   = &quot;192.168.42.254&quot;
  &#125;
  route &#123;
    target = &quot;192.168.42.0/24&quot;
  &#125;
&#125;

resource &quot;zerotier_member&quot; &quot;alice&quot; &#123;
  name        = &quot;alice&quot;
  member_id   = &quot;a11c3411ce&quot;
  description = &quot;Alice&#39;s laptop&quot;
  network_id  = zerotier_network.hello.id
&#125;

resource &quot;zerotier_member&quot; &quot;bob&quot; &#123;
  name        = &quot;bob&quot;
  member_id   = &quot;b0bd0bb0bb&quot;
  description = &quot;Bob&#39;s laptop&quot;
  network_id  = zerotier_network.hello.id
&#125;
</code></pre>
<p>Queue a plan then “Confirm and Apply”.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181358.png" alt="20240318181358"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181408.png" alt="20240318181408"><br>After Terraform applies the plan, check out the ZeroTier Cental webUI to confirm it was created.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181434.png" alt="20240318181434"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181445.png" alt="20240318181445"></p>
<h4 id="Bridging-Networks"><a href="#Bridging-Networks" class="headerlink" title="Bridging Networks"></a>Bridging Networks</h4><p>The next example manipulates the <code>allow_ethernet_bridging</code> settings on the Member objects. When running on machines with multiple physical Ethernet interfaces, ZeroTier can be configured to pass layer2 traffic such as ARP, NDP, multicast, mDNS, etc.<br>To make this work, you’ll need to go into your router’s OS and configure a bridge between a physical interface and the ZeroTier interface.<br>The <a href="https://registry.terraform.io/modules/zerotier/network/zerotier/">ZeroTier Network</a> Terraform module provides a slightly nicer interface, letting us use CIDRs for our subnets.<br>Repeat the steps from “Hello World” with <code>bridging.tf</code><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181548.png" alt="20240318181548"></p>
<pre><code class="lang-json">module &quot;bridgenet&quot; &#123;
  source      = &quot;zerotier/network/zerotier&quot;
  version     = &quot;1.0.0&quot;
  name        = &quot;bridgenet&quot;
  description = &quot;bridging example&quot;
  subnets     = [&quot;10.10.0.0/16&quot;]
  flow_rules  = &quot;accept;&quot;
&#125;

resource &quot;zerotier_member&quot; &quot;router1&quot; &#123;
  name                    = &quot;router1&quot;
  member_id               = &quot;71c71c71c1&quot;
  description             = &quot;Alice&#39;s router&quot;
  ip_assignments          = [&quot;10.10.1.1&quot;]
  allow_ethernet_bridging = true
  network_id              = module.bridgenet.id
&#125;

resource &quot;zerotier_member&quot; &quot;router2&quot; &#123;
  name                    = &quot;router2&quot;
  member_id               = &quot;71c71c71c2&quot;
  description             = &quot;Bob&#39;s router&quot;
  ip_assignments          = [&quot;10.10.2.1&quot;]
  allow_ethernet_bridging = true
  network_id              = module.bridgenet.id
&#125;
</code></pre>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181612.png" alt="20240318181612"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181620.png" alt="20240318181620"><br>After Terraform applies the plan, check out the ZeroTier Cental webUI to confirm it was created.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181637.png" alt="20240318181637"></p>
<h4 id="Network-Segmentation"><a href="#Network-Segmentation" class="headerlink" title="Network Segmentation"></a>Network Segmentation</h4><p>The next example creates the networks, <code>red</code>, <code>green</code>, and <code>yellow</code>. We define two groups. The red team gets access to the <code>red</code> network, and the green team gets access to the green network. Red and green make <code>yellow</code>.<br>Repeat the steps from “Hello World” with <code>groups.tf</code><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181737.png" alt="20240318181737"></p>
<pre><code class="lang-json">variable &quot;segments&quot; &#123;
  default = &#123;
    red = &#123;
      description = &quot;red&quot;
      subnets     = [&quot;10.1.0.0/16&quot;]
      flow_rules  = &quot;accept;&quot;
    &#125;
    green = &#123;
      description = &quot;green&quot;
      subnets     = [&quot;10.2.0.0/16&quot;]
      flow_rules  = &quot;accept;&quot;
    &#125;
    yellow = &#123;
      description = &quot;yellow&quot;
      subnets     = [&quot;10.3.0.0/16&quot;]
      flow_rules  = &quot;accept;&quot;
    &#125;
  &#125;
&#125;

variable &quot;members&quot; &#123;
  default = &#123;
    red = &#123;
      eve = &#123;
        description = &quot;Eve&#39;s Laptop&quot;
        member_id   = &quot;34b34b34b3&quot;
      &#125;
      steve = &#123;
        description = &quot;Steve&#39;s Laptop&quot;
        member_id   = &quot;573b3573b3&quot;
      &#125;
    &#125;
    green = &#123;
      cletus = &#123;
        description = &quot;Cletus&#39; Laptop&quot;
        member_id   = &quot;c133715b0b&quot;
      &#125;
      brandie = &#123;
        description = &quot;Brandie&#39;s Laptop&quot;
        member_id   = &quot;b33fb33fff&quot;
      &#125;
    &#125;
  &#125;
&#125;

module &quot;segments&quot; &#123;
  for_each    = var.segments
  source      = &quot;zerotier/network/zerotier&quot;
  version     = &quot;1.0.0&quot;
  name        = each.key
  description = each.value.description
  subnets     = each.value.subnets
  flow_rules  = each.value.flow_rules
&#125;

resource &quot;zerotier_member&quot; &quot;red&quot; &#123;
  for_each   = &#123; for k, v in var.members.red : (k) =&gt; v &#125;
  name       = each.key
  member_id  = each.value.member_id
  network_id = module.segments[&quot;red&quot;].id
&#125;

resource &quot;zerotier_member&quot; &quot;green&quot; &#123;
  for_each   = &#123; for k, v in var.members.green : (k) =&gt; v &#125;
  name       = each.key
  member_id  = each.value.member_id
  network_id = module.segments[&quot;green&quot;].id
&#125;

resource &quot;zerotier_member&quot; &quot;yellow&quot; &#123;
  for_each   = &#123; for k, v in merge(var.members.red, var.members.green) : (k) =&gt; v &#125;
  name       = each.key
  member_id  = each.value.member_id
  network_id = module.segments[&quot;yellow&quot;].id
&#125;
</code></pre>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181809.png" alt="20240318181809"><br>After Terraform applies the plan, check out the ZeroTier Cental webUI to confirm it was created.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318181827.png" alt="20240318181827"></p>
<h4 id="Many-to-Many"><a href="#Many-to-Many" class="headerlink" title="Many to Many"></a>Many to Many</h4><p>In the last example, show how to assign many members to many networks. This example used the Terraform <a href="https://www.terraform.io/docs/language/functions/setproduct.html">setproduct</a> function to find all possible combinations of two sets.</p>
<p>The <code>zerotier_identity</code> resource is a distant cousin of the Terraform <a href="https://registry.terraform.io/providers/hashicorp/tls/latest/docs/resources/private_key">tls_private_key</a> resource. This resource would normally be used to inject secrets into cloud instances via <code>cloudinit</code>. We encourage you to use the <a href="https://app.terraform.io/">Terraform Cloud</a> to keep your Terraform state safe.</p>
<p>Repeat the steps from “Hello World” with <code>many2many.tf</code><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182052.png" alt="20240318182052"></p>
<pre><code class="lang-json">variable &quot;letters&quot; &#123;
  default = [&quot;alfa&quot;, &quot;bravo&quot;, &quot;charlie&quot;]
&#125;

variable &quot;shapes&quot; &#123;
  default = [&quot;circle&quot;, &quot;square&quot;, &quot;diamond&quot; ]
&#125;

resource &quot;zerotier_identity&quot; &quot;letters&quot; &#123;
  for_each = &#123; for i in var.letters : i =&gt; i &#125;
&#125;

module &quot;shapes&quot; &#123;
  for_each    = &#123; for i, k in var.shapes : (k) =&gt; i &#125;
  source      = &quot;zerotier/network/zerotier&quot;
  version     = &quot;1.0.0&quot;
  name        = each.key
  description = each.key
  subnets     = [cidrsubnet(&quot;10.11.0.0/16&quot;, 8, each.value)]
  flow_rules  = &quot;accept;&quot;
&#125;

resource &quot;zerotier_member&quot; &quot;shape-letters&quot; &#123;
  for_each    = &#123; for i in setproduct(var.letters, keys(module.shapes)) : join(&quot;-&quot;, flatten(i)) =&gt; i &#125;
  name        = each.key
  member_id   = zerotier_identity.letters[each.value[0]].id
  description = module.shapes[each.value[1]].description
  network_id  = module.shapes[each.value[1]].id
&#125;
</code></pre>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182119.png" alt="20240318182119"><br>After Terraform applies the plan, check out the ZeroTier Cental webUI to confirm it was created.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182136.png" alt="20240318182136"></p>
<h4 id="Cleaning-up"><a href="#Cleaning-up" class="headerlink" title="Cleaning up"></a>Cleaning up</h4><p>When you’re done experimenting with ZeroTier and Terraform, tear everything down by queueing a destroy plan.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182157.png" alt="20240318182157"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318182210.png" alt="20240318182210"></p>
<h4 id="That’s-all-folks"><a href="#That’s-all-folks" class="headerlink" title="That’s all folks"></a>That’s all folks</h4><p>If you like this tutorial, check out the <a href="https://docs.zerotier.com/terraform/multicloud-quickstart">ZeroTier Multicloud Terraform Quickstart</a> next!<br>-s</p>
<h3 id="cloud-init"><a href="#cloud-init" class="headerlink" title="cloud-init"></a>cloud-init</h3><h4 id="Set-up-ZeroTier-using-cloud-init"><a href="#Set-up-ZeroTier-using-cloud-init" class="headerlink" title="Set up ZeroTier using cloud-init"></a>Set up ZeroTier using <code>cloud-init</code></h4><h5 id="What-is-cloud-init"><a href="#What-is-cloud-init" class="headerlink" title="What is cloud-init?"></a>What is <code>cloud-init</code>?</h5><p>cloud-init is a convenient and cross-platform way to initialize cloud instances. It is supported by all major cloud providers. You can use it to configure OS settings, install packages, or even start up specific instances of ZeroTier.</p>
<h5 id="How-do-you-use-it"><a href="#How-do-you-use-it" class="headerlink" title="How do you use it?"></a>How do you use it?</h5><p>Typically a cloud-init file can be uploaded to a cloud provider or added as an additional payload via an API.</p>
<h5 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h5><pre><code class="lang-conf">#cloud-config

hostname: &quot;devbox&quot;
users:
  - name: wrankles

shell: /bin/bash

disable_root: 1
ssh_pwauth:   0
packages:
  - htop
  - tcpdump

runcmd:
  - apt-get update
  #- mkdir -p /var/lib/zerotier-one
  #- echo &quot;1234567890:0:...&quot; &gt; /var/lib/zerotier-one/identity.secret
  #- echo &quot;1234567890:0:...&quot; &gt; /var/lib/zerotier-one/identity.public
  - curl -s https://install.zerotier.com | bash
  - zerotier-cli join cfb8bf9836c2fc3a
  - systemctl restart ssh
</code></pre>
<h5 id="Pre-populate-ZeroTier-identities-optional"><a href="#Pre-populate-ZeroTier-identities-optional" class="headerlink" title="Pre-populate ZeroTier identities(optional)"></a>Pre-populate ZeroTier identities(optional)</h5><p>Uncomment the <code>runcmd</code> lines starting with <code>mkdir</code> and <code>echo</code> if you want to write known ZeroTier identities to disk before startup. This is useful if you’ve already authorized or scripted around a specific node ID and want it to start up the same each time.</p>
<blockquote>
<p><strong>CAUTION</strong><br>If you place your ZeroTier node’s secret key in your cloud init file it is possible for someone to impersonate your node if they get ahold of this cloud-init file.</p>
</blockquote>
<h5 id="Password-less-SSH-optional"><a href="#Password-less-SSH-optional" class="headerlink" title="Password-less SSH (optional)"></a>Password-less SSH (optional)</h5><p>It’s usually recommended that you disable the root account and disable password-based ssh authentication and rely solely on key-based authentication. <a href="https://www.digitalocean.com/community/tutorials/how-to-use-cloud-config-for-your-initial-server-setup">Digital Ocean has some really great documentation on the subject</a>.<br>To make getting into your cloud instance as easy as possible you can add entries to <code>authorized_keys</code>:</p>
<pre><code class="lang-ssh">ssh-authorized-keys:
    - ssh-rsa AAAAB38fwi3756q238if75dh6awd476r3bg78f56ghfaa7fdh63qf5dq378f5632gha3875j3f498da7hfhjkfawejtfsktfr89ew4jftsjrf8t9rhg7tjser8tsre7yjgvased89rfdcsh67rewhg8tq7tsge546w4
</code></pre>
<p>To make getting into other instances <em>from this instance</em> easier, you can add a pre-generated private key to <code>ssh_keys</code>:</p>
<pre><code class="lang-ssh">ssh_deletekeys: false
ssh_keys:
    ed25519_private: |
        -----BEGIN OPENSSH PRIVATE KEY-----
        $#HYBES$Y%GW$Gfs9g8ES$Y%GW$Gfs9g867ZDI1NTE5AAAAIHQbjzWgsNOt/8gH+QI/Eob
        fs9g867q34tqGT$#HYBES$mZ+AW4OZPnTPI89ZPmVMLuayrD2cE86Z/il8b+867q34tqGT
        fs9g867q34ZDI1NTE5AAAAIHQbjzWgsNOt/8gH+QI/Eob6BES$Y%$#HYBES$Y%GW$Gfs9g
        fs9g867q34tqGT$#HYBES$YZDI1NTE5AAAAIHQbjzWgsNOt/8gH+QI/Eob6Z/8ZXbHHdGx
        fs9g867mZ+AW4OZPnTPI89ZPmVMLuayrD2cE86Z/il8b+gw3s9g867q4g
        -----END OPENSSH PRIVATE KEY-----

    ed25519_public: ssh-ed25519 AAAAB3NzaC1yc2EAAAABIwAAAQEAklOUpqxiX1nKhXpHAZsMciLq8V6RjsHDTYW7hdI4 devbox
</code></pre>
<p><a href="https://wiki.archlinux.org/title/SSH_keys">Read more about SSH keys here</a></p>
<h2 id="Advanced-Networking"><a href="#Advanced-Networking" class="headerlink" title="Advanced Networking"></a>Advanced Networking</h2><h3 id="Multipath-1"><a href="#Multipath-1" class="headerlink" title="Multipath"></a>Multipath</h3><p>Multipath allows the simultaneous (or conditional) aggregation of multiple physical links into a bond for increased total throughput, load balancing, redundancy, and fault tolerance. There is a set of standard bonding policies available that can be used right out of the box with no configuration. These policies are inspired by <a href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">the policies offered by the Linux kernel</a>. A bonding policy can be used easily without specifying any additional parameters. For example:</p>
<pre><code class="lang-conf">Example local.conf
-------------------------------------------------------------------------------------
&#123; &quot;settings&quot;: &#123; &quot;defaultBondingPolicy&quot;: &quot;active-backup&quot; &#125; &#125;
</code></pre>
<h4 id="Standard-policies"><a href="#Standard-policies" class="headerlink" title="Standard policies"></a>Standard policies</h4><ul>
<li><a href="https://docs.zerotier.com/multipath#active-backup">active-backup</a>: Use only one primary link at a time and failover to another designated link.</li>
<li><a href="https://docs.zerotier.com/multipath#broadcast">broadcast</a>: Duplicate traffic across all available links at all times.</li>
<li><a href="https://docs.zerotier.com/multipath#balance-rr">balance-rr</a>: Stripe packets across multiple links (not for use with TCP.)</li>
<li><a href="https://docs.zerotier.com/multipath#balance-xor">balance-xor</a>: Hash flows to specific links.</li>
<li><a href="https://docs.zerotier.com/multipath#balance-aware">balance-aware</a>: Auto-balance flows across links.</li>
</ul>
<h4 id="Custom-policies"><a href="#Custom-policies" class="headerlink" title="Custom policies"></a>Custom policies</h4><p>To customize a bonding policy simply specify a standard policy as <code>basePolicy</code> and override its parameters. Note that a modified custom policy <em>cannot</em> have the same name as a standard policy. (Note how we renamed the following example to <code>rapid-active-backup</code>). For example, to create a more rapid <code>active-backup</code> policy that will failover <code>1 second</code> after it detects a link failure:</p>
<pre><code class="lang-conf">local.conf
------------------------------------------------------------------------------------
&#123;
  &quot;settings&quot;:
  &#123;
    &quot;defaultBondingPolicy&quot;: &quot;rapid-active-backup&quot;,
    &quot;policies&quot;:
    &#123;
      &quot;rapid-active-backup&quot;:
      &#123;
        &quot;basePolicy&quot;: &quot;active-backup&quot;,
        &quot;failoverInterval&quot;: 1000
      &#125;
    &#125;
  &#125;
&#125;
</code></pre>
<p>You can only override parameters that are valid for the chosen <code>basePolicy</code>. The list below shows parameters that can apply to any policy. Parameters that are unique to a given policy type are described in that policy’s section.</p>
<pre><code class="lang-json">Example policy settings (not valid JSON)
------------------------------------------------------------------------------------
&#123;
  &quot;settings&quot;:
  &#123;
    &quot;defaultBondingPolicy&quot;: &quot;rapid-active-backup&quot;,
    &quot;policies&quot;:
    &#123;
      &quot;rapid-active-backup&quot;:
      &#123;
        &quot;basePolicy&quot;: &quot;active-backup&quot;,
        &quot;failoverInterval&quot;: 1000,
        &quot;upDelay&quot;:0-65535,
        &quot;downDelay&quot;:0-65535,
      &#125;
    &#125;
  &#125;
&#125;
</code></pre>
<h4 id="Physical-interfaces"><a href="#Physical-interfaces" class="headerlink" title="Physical interfaces"></a>Physical interfaces</h4><p>Bonds are composed of multiple links (known paths over system network interfaces). By default if no interfaces are specified ZeroTier will attempt to use all network interfaces, including your expensive wireless links. In order to avoid this you should tell ZeroTier which interfaces are okay to talk on and also under what conditions. If a set of links is defined, ZeroTier will use only those links and ignore everything else.</p>
<pre><code class="lang-json">Example local.conf: To specify that ZeroTier should only use eth1 but then failover to eth2 and that it should prefer IPv4 over IPv6 except on eth2 where only IPv6 is allowed.
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
&#123;
  &quot;settings&quot;: &#123;
    &quot;defaultBondingPolicy&quot;: &quot;rapid-active-backup&quot;,
    &quot;policies&quot;: &#123;
      &quot;rapid-active-backup&quot;: &#123;
        &quot;basePolicy&quot;: &quot;active-backup&quot;,
        &quot;failoverInterval&quot;: 1000,
        &quot;links&quot;:
        &#123;
          &quot;eth0&quot;:
          &#123;
            &quot;ipvPref&quot;: 46,
            &quot;failoverTo&quot;: &quot;eth1&quot;
          &#125;,
          &quot;eth1&quot;:
          &#123;
            &quot;ipvPref&quot;: 46,
            &quot;failoverTo&quot;: &quot;eth2&quot;
          &#125;,
          &quot;eth2&quot;:
          &#123;
            &quot;ipvPref&quot;: 6
          &#125;
        &#125;
      &#125;
    &#125;
  &#125;
&#125;
</code></pre>
<h4 id="Link-settings"><a href="#Link-settings" class="headerlink" title="Link settings"></a>Link settings</h4><p>The behavior of links can be changed by setting various properties:</p>
<pre><code class="lang-json">Customizable link parameters (not valid JSON)
-------------------------------------------------------------------------------------
...

&quot;links&quot;:
&#123;
  &quot;eth0&quot;: /* Network interface system name */
  &#123;
    &quot;ipvPref&quot;: [0,4,6,46,64], /* (optional) IP version preference for paths on a link. */
    &quot;capacity&quot;: 0-1000000, /* (optional) Arbitrary units of link &quot;capacity&quot;. Can be used to manually allocate traffic. */
    &quot;failoverTo&quot;: &quot;failoverInterfaceName&quot;, /* (optional) Which link should be used next after a failure of this link. */
    &quot;mode&quot;: &quot;primary&quot;|&quot;spare&quot; /* (optional) Whether this link is used by default or only after all other links fail. */
  &#125;,
  ...
&#125;

...
</code></pre>
<h4 id="Spare-links"><a href="#Spare-links" class="headerlink" title="Spare links"></a>Spare links</h4><p>A warm spare is a link that is not actively used to process traffic until all other available links are down. Note however that some ambient probing traffic is still sent to guarantee its performance. Spare links are not available when using the <code>broadcast</code> policy. Cold spares are left as an exercise for the reader.</p>
<pre><code>Example local.conf: To specify that traffic should be hashed over two links eth0 and eth1 and that expensive_lte0 should only be used when the other two are down.
---------------------------------------------------------------------------------------------------------------------------------------------------
&#123;
  &quot;settings&quot;: &#123;
    &quot;defaultBondingPolicy&quot;: &quot;xor-with-a-spare&quot;,
    &quot;policies&quot;: &#123;
      &quot;xor-with-a-spare&quot;: &#123;
        &quot;basePolicy&quot;: &quot;balance-xor&quot;,
        &quot;links&quot;:
        &#123;
          &quot;eth0&quot;:
          &#123;
            &quot;mode&quot;: &quot;primary&quot;
          &#125;,
          &quot;eth1&quot;:
          &#123;
            &quot;mode&quot;: &quot;primary&quot;
          &#125;,
          &quot;expensive_lte0&quot;:
          &#123;
            &quot;mode&quot;: &quot;spare&quot;
          &#125;
        &#125;
      &#125;
    &#125;
  &#125;
&#125;
</code></pre><h4 id="Peer-specific-bonds"><a href="#Peer-specific-bonds" class="headerlink" title="Peer-specific bonds"></a>Peer-specific bonds</h4><p>It is possible to use a policy for one peer and another policy for a different peer. For instance, if one were to want <code>active-backup</code> for all peers by default but for certain peers to be bonded with a custom load-balanced bond such as <code>my-custom-balance-xor</code> one could do the following:</p>
<pre><code class="lang-json">Example local.conf
-----------------------------------------------
&#123;
  &quot;settings&quot;:
  &#123;
    &quot;defaultBondingPolicy&quot;: &quot;active-backup&quot;,
    &quot;policies&quot;:
    &#123;
      &quot;my-custom-balance-xor&quot;:
      &#123;
        &quot;failoverInterval&quot;: 2000,
        &quot;upDelay&quot;: 5000,
        &quot;basePolicy&quot;: &quot;balance-xor&quot;
      &#125;
    &#125;,
    &quot;peerSpecificBonds&quot;:
    &#123;
      &quot;f6203a2db3&quot;:&quot;my-custom-balance-xor&quot;,
      &quot;45b0301da2&quot;:&quot;my-custom-balance-xor&quot;,
      &quot;a92cb526fa&quot;:&quot;my-custom-balance-xor&quot;
    &#125;
  &#125;
&#125;
</code></pre>
<h4 id="active-backup"><a href="#active-backup" class="headerlink" title="active-backup"></a>active-backup</h4><pre><code class="lang-json">Example local.conf
&#123; &quot;settings&quot;: &#123; &quot;defaultBondingPolicy&quot;: &quot;active-backup&quot; &#125; &#125;
</code></pre>
<p>Traffic is sent on only one link at any time. A different link becomes active if the current link fails. This mode provides fault tolerance with a nearly immediate failover depending on the <code>failoverInterval</code> you set. This mode does not increase total throughput. If no <code>primary</code> and <code>spare</code> links are defined ZeroTier will attempt to pick the best one.</p>
<ul>
<li><code>mode</code>: <code>primary|spare</code> Link option which specifies which link is the primary device. The specified device is intended to always be the active link while it is available. There are exceptions to this behavior when using different <code>linkSelectMethod</code> modes. There can only be one <code>primary</code> link in this bonding policy.</li>
<li><code>linkSelectMethod</code>: Specifies the selection policy for the active link during failure and/or recovery events. This is similar to the Linux Kernel’s <code>primary_reselect</code> option but with a minor extension:<ul>
<li><code>optimize</code>: <strong>(default if user provides no failover guidance)</strong> The primary link can change periodically if a superior link is detected.</li>
<li><code>always</code>: <strong>(default when links are explicitly specified)</strong>: Primary link regains status as active link whenever it comes back up.</li>
<li><code>better</code>: Primary link regains status as active link when it comes back up and (if) it is better than the currently-active link.</li>
<li><code>failure</code>: Primary link regains status as active link only if the currently-active link fails.<br>```conf<br>Example local.conf</li>
</ul>
</li>
</ul>
<hr>
<p>{<br>  “settings”:<br>  {<br>    “defaultBondingPolicy”: “custom-active-backup”,<br>    “custom-active-backup”:<br>    {<br>      “basePolicy”: “active-backup”,<br>      “linkSelectMethod”: “always”,<br>      “failoverInterval”: 5000,<br>      “links”:<br>      {<br>        “eth0”: { “failoverTo”: “eth1”, “mode”: “primary” },<br>        “eth1”: { “mode”: “spare” },<br>        “eth2”: { “mode”: “spare” },<br>        “eth3”: { “mode”: “spare” }<br>      }<br>    }<br>  }<br>}</p>
<pre><code>#### broadcast
```json
Example local.conf
-------------------------------------------------------
&#123; &quot;settings&quot;: &#123; &quot;defaultBondingPolicy&quot;: &quot;broadcast&quot; &#125; &#125;
</code></pre><p>Traffic is sent on <em>all</em> available links simultaneously. This mode provides fault tolerance and effectively immediate failover due to transmission redundancy. This mode is a poor utilization of throughput resources and will <strong>not</strong> increase throughput but can prevent packet loss during a link failure.</p>
<h4 id="balance-rr"><a href="#balance-rr" class="headerlink" title="balance-rr"></a>balance-rr</h4><pre><code class="lang-json">Example local.conf
--------------------------------------------------------------------
&#123; &quot;settings&quot;: &#123; &quot;defaultBondingPolicy&quot;: &quot;balance-rr&quot; &#125; &#125;
</code></pre>
<p>Traffic is striped across multiple links. This mode offers partial fault tolerance immediately, full fault tolerance eventually. This policy is unaware of protocols and is primarily intended for use with protocols that are not sensitive to reordering delays. The only option available for this policy is <code>packetsPerLink</code> which specifies the number of packets to transmit via a link before moving to the next link in the round-robin sequence. When set to <code>0</code> a link is chosen at random for each outgoing packet (doing so would be inefficient). The default value is <code>64</code>, lower values can begin to add overhead to packet processing. This mode is <strong>not</strong> suitable for traffic that is sensitive to re-ordering such as TCP.</p>
<h4 id="balance-xor"><a href="#balance-xor" class="headerlink" title="balance-xor"></a>balance-xor</h4><pre><code class="lang-json">Example local.conf
------------------------------------------------------------
&#123; &quot;settings&quot;: &#123; &quot;defaultBondingPolicy&quot;: &quot;balance-xor&quot; &#125; &#125;
</code></pre>
<p>Traffic is categorized into <em>flows</em> based on <em>source port</em>, <em>destination port</em>, and <em>protocol type</em> these flows are then hashed onto available links where they will persist for the duration of their life. Traffic that does not have an assigned port (such as ICMP pings) will be randomly distributed across links. This mode offers partial fault tolerance immediately, full fault tolerance eventually. This mode is suitable for traffic that is sensitive to re-ordering such as TCP.</p>
<h4 id="balance-aware"><a href="#balance-aware" class="headerlink" title="balance-aware"></a>balance-aware</h4><pre><code class="lang-json">Example local.conf
------------------------------------------------------
&#123; &quot;settings&quot;: &#123; &quot;defaultBondingPolicy&quot;: &quot;balance-aware&quot; &#125; &#125;
</code></pre>
<p>This mode operates similarly to <code>balance-xor</code> in that it hashes flows onto specific links. However, it may reassign flows mid-conversation and perform other types of optimizations. This mode may surprise you more often than <code>balance-xor</code> by causing re-ordering delays for certain flows but it should lead to a better total experience when all flows are considered. This policy allows you to specify not only <a href="https://docs.zerotier.com/multipath#asymmetric-links">relative link capacities</a> but also a <a href="https://docs.zerotier.com/multipath#link-quality">notion of quality</a> expressed as a weighted vector with a sum of <code>1.0</code>. See below:</p>
<pre><code class="lang-json">Example local.conf: A maximum acceptable value for latency and packet delay variance are given along with weights that tell ZeroTier how important that limit is. Additionally, link capacities are given as hints to enable proportional traffic allocation.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
&#123;
  &quot;settings&quot;:
  &#123;
    &quot;defaultBondingPolicy&quot;: &quot;custom-balance-aware&quot;,
    &quot;policies&quot;:
    &#123;
      &quot;custom-balance-aware&quot;:
      &#123;
        &quot;basePolicy&quot;: &quot;balance-aware&quot;,
        &quot;failoverInterval&quot;: 5000,
        &quot;linkQuality&quot;: &#123;
          &quot;lat_max&quot; : 400.0,
          &quot;pdv_max&quot; : 20.0,
          &quot;lat_weight&quot; : 0.5,
          &quot;pdv_weight&quot; : 0.5
        &#125;,
        &quot;links&quot;: &#123;
          &quot;wlan0&quot;: &#123; &quot;capacity&quot;: 250 &#125;,
          &quot;eth0&quot;: &#123; &quot;capacity&quot;: 1000  &#125;
        &#125;
      &#125;
    &#125;
  &#125;
&#125;
</code></pre>
<p>In the above example if any links begin to show signs of saturation (for instance if latency increases beyond <code>400ms</code>) flows will be moved from it until it is no longer judged to be saturated.</p>
<h4 id="Link-Quality"><a href="#Link-Quality" class="headerlink" title="Link Quality"></a>Link Quality</h4><p>As seen in the <a href="https://docs.zerotier.com/multipath#balance-aware">balance-aware</a> example configuration, you can provide hints to ZeroTier as to when a link is no longer suitable for use. You can set limits on the following:</p>
<ul>
<li><code>lat_max</code>: Maximum (mean) latency observed over many samples</li>
<li><code>pdv_max</code>: Maximum packet delay variance (similar to jitter)<br>Then, weights must also be provided to tell ZeroTier how important your limits are (as a reminder, the weights must sum to <code>1.0</code>):<pre><code>&quot;linkQuality&quot;: &#123;
&quot;lat_max&quot; : 80.0,
&quot;pdv_max&quot; : 20.0,
&quot;lat_weight&quot; : 0.5,
&quot;pdv_weight&quot; : 0.5
&#125;
</code></pre>If any one of these limits are violated ZeroTier will attempt to avoid assigning new flows to the link in question as well as begin moving flows from that link to other higher quality links. ZeroTier will first try to find a link that doesn’t violate any of your limits but if it is unable to do so it will pick the next best according to a quality ranking derived from your weights. There is no guarantee that links will be entirely avoided or that all of their flows will be moved if there are no better links to move to so these limits are merely strong suggestions to ZeroTier.<h4 id="Asymmetric-links"><a href="#Asymmetric-links" class="headerlink" title="Asymmetric links"></a>Asymmetric links</h4>Any set of physical links regardless of their relative performance may be combined using any of the policies. However if the relative performance among the links vary too wildly (for instance a fiber link and an LTE link) you may find that blindly striping or hashing traffic across them doesn’t turn out so well. For these scenarios it is recommended that you use <a href="https://docs.zerotier.com/multipath#balance-aware">balance-aware</a> and provide <code>capacity</code> and/or <code>linkQuality</code> hints to ZeroTier.<h5 id="Capacity"><a href="#Capacity" class="headerlink" title="Capacity"></a>Capacity</h5>```conf<br>Example capacities (not a valid config by itself)</li>
</ul>
<hr>
<p>“links”: {<br>  “wlan0”: { “capacity”: 250 },<br>  “eth0”: { “capacity”: 1000  }<br>}</p>
<pre><code>The term is meant to be a one-size-fits-all numerical value which represents the diameter of the pipe so to speak. That is, how much traffic it can process before it becomes clogged and congestion controls kick in. This will suggest to ZeroTier that it should assign traffic flows proportionally.
##### Quality
Providing [quality](https://docs.zerotier.com/multipath#link-quality) hints to ZeroTier can be done in conjunction with the aforementioned `capacity` property without issue. See the [balance-aware](https://docs.zerotier.com/multipath#balance-aware) section for an example of how to do this.
```conf
Example local.conf: How to use arbitrary (but relative) capacity values
--------------------------------------------------------------------------
&#123;
  &quot;settings&quot;:
  &#123;
    &quot;defaultBondingPolicy&quot;: &quot;custom-balance-aware&quot;,
    &quot;policies&quot;:
    &#123;
      &quot;custom-balance-aware&quot;:
      &#123;
        &quot;basePolicy&quot;: &quot;balance-aware&quot;,
        &quot;links&quot;: &#123;
          &quot;eth0&quot;: &#123; &quot;capacity&quot;: 10000 &#125;,
          &quot;eth1&quot;: &#123; &quot;capacity&quot;: 1000  &#125;,
          &quot;eth2&quot;: &#123; &quot;capacity&quot;: 100   &#125;
        &#125;
      &#125;
    &#125;
  &#125;
&#125;
</code></pre><p>The above configuration will roughly result in the following allocation:</p>
<pre><code class="lang-bash">10000 + 1000 + 100 = 11100 total &quot;capacity units&quot; across all links

eth0 10000 / 11100 = ~0.900 %
eth1 1000  / 11100 = ~0.090 %
eth2 100   / 11100 = ~0.009 %
</code></pre>
<p>A good rule of thumb would be to express your known link speeds in units of <code>Mbit/s</code>. This isn’t strictly necessary as long as the quantities make sense relative to each other.</p>
<h4 id="Using-the-CLI"><a href="#Using-the-CLI" class="headerlink" title="Using the CLI"></a>Using the CLI</h4><p>Currently most configuration is handled via manual editing of each node’s <code>local.conf</code>. There are only a few available CLI commands.<br>To view bonds to all peers:</p>
<pre><code>zerotier-cli bond list
--------------------------------------------------------------
    &lt;peer&gt;                        &lt;bondtype&gt;     &lt;links&gt;
2f33b459c1                       balance-xor         18/18
6af835ae71                     active-backup         2/2
77dcbe7120                     active-backup         5/5
cbae04eb89                     active-backup         5/5
bafe99feb9                     active-backup         3/3
</code></pre><blockquote>
<p><strong>TIP</strong><br>If you’d like to ingest this data into your own monitoring solution use <code>zerotier-cli -j bond list</code> to emit a JSON blob instead.</p>
</blockquote>
<p>To see the current state of a bond to a given peer:</p>
<pre><code class="lang-bash">zerotier-cli bond 77dcbe7120 show
---------------------------------------------------------------------------------------------------------------------------------------------
Peer                   : 77dcbe7120
Bond                   : balance-rr
Link Select Method     : 0
Links                  : 4/4
Failover Interval (ms) : 500
Up Delay (ms)          : 0
Down Delay (ms)        : 0
Packets Per Link       : 64

idx                  interface                                  path               socket
----------------------------------------------------------------------------------------------------
 0:                     enp5s0                                192.168.88.155/57605 000055e03aa4d5a0
 1:                     enp5s0                                192.168.88.155/57605 000055e03aa4dc80
 9:            wlxc07a002fb470                                192.168.88.155/57605 000055e03aa4d440
10:            wlxc07a002fb470                                192.168.88.155/57605 000055e03aa4db20


idx     lat      pdv     plr     per    speed  alloc      rx_age      tx_age  eligible  bonded
----------------------------------------------------------------------------------------------------
 0:     0.00     0.00  0.0000  0.0000    1000   0.07          62          66         1       1
 1:    10.00    21.00  0.0000  0.0000    1000   0.04          61          66         1       1
 9:     6.00     1.00  0.0000  0.0000    5000   0.06         227         567         1       1
10:     0.00     0.00  0.0000  0.0000    5000   0.07          60          48         1       1
</code></pre>
<p>The reported allocation percentages have an uncertainty value of <code>+/- 0.4%</code>.<br>To forcibly rotate to a different link in an <code>active-backup</code> bond:</p>
<pre><code class="lang-bash">zerotier-cli bond 77dcbe7120 rotate
-------------------------------------------------------------------------------------------------------------------------
active link rotated from 000055c8aa8392f0-enp5s0/104.175.36.67/9993 to 000055c8aa838210-enp5s0/104.175.36.67/9993
</code></pre>
<p>To set a custom MTU for a bonded link:</p>
<pre><code class="lang-bash">zerotier-cli bond setmtu 1300 enp5s0 192.168.88.155
---------------------------------------------------------------------------------------------------------
200 setmtu OK
</code></pre>
<h3 id="Layer-2-Bridge"><a href="#Layer-2-Bridge" class="headerlink" title="Layer 2 Bridge"></a>Layer 2 Bridge</h3><p>Do you have devices that can’t run ZeroTier that you want to access remotely? You can use a small Linux PC as a bridge between ZeroTier and physical networks.</p>
<blockquote>
<p><strong>NOTE</strong><br>This topic is related to but different from using ZeroTier as a Layer 5 <a href="https://docs.zerotier.com/proxy">Service Proxy</a>.</p>
</blockquote>
<h4 id="Assumptions"><a href="#Assumptions" class="headerlink" title="Assumptions"></a>Assumptions</h4><ul>
<li>You’re doing this on your home network and can log in to your router and find the DHCP settings.</li>
<li>You have a keyboard, monitor, and ethernet cable plugged into your Pi. Chances are high we’ll break networking and lose access to the Pi.</li>
<li>You’re somewhat familiar with the command line and ssh.</li>
<li>We’re going to use systemd networking for this. You could probably adapt the concepts to a different Linux network configuration system if you have opinions about systemd.</li>
<li>We used a Raspberry Pi 2 while writing this, but a Pi 3 or 4 should work fine. Anything running a Debian 10+ based distro should be fine. It doesn’t have to be a Raspberry Pi, but some of these instructions might be Raspbian specific.</li>
</ul>
<h4 id="What-you’ll-need"><a href="#What-you’ll-need" class="headerlink" title="What you’ll need"></a>What you’ll need</h4><ul>
<li>Physical LAN Subnet</li>
<li>Physical LAN DHCP Range</li>
<li>ZeroTier Auto-Assign Range</li>
<li>Default Gateway IP Address (the router)</li>
<li>Bridge IP Address (will be statically assigned)</li>
<li>Create a new ZeroTier network and get the ID. Keep an old network around for secondary way to connect any devices already using ZeroTier.</li>
<li>The DHCP range and ZeroTier Auto-Assign range should be in the same subnet, but not overlap. You’d probably base this off what is already configured on your router.</li>
</ul>
<h5 id="An-example-plan"><a href="#An-example-plan" class="headerlink" title="An example plan"></a>An example plan</h5><div class="table-container">
<table>
<thead>
<tr>
<th><strong>Name</strong></th>
<th><strong>Value</strong></th>
<th><strong>Referred to below as</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Physical LAN Subnet</td>
<td>192.168.192.0/24</td>
<td></td>
</tr>
<tr>
<td>Physical LAN DHCP RANGE</td>
<td>192.168.192.65 through 192.168.192.126</td>
<td></td>
</tr>
<tr>
<td>ZeroTier Auto-Assign Range</td>
<td>192.168.192.129 through 192.168.192.190</td>
<td>$ZT_POOL</td>
</tr>
<tr>
<td>ZeroTier Managed Route</td>
<td>192.168.192.0/23</td>
<td>$ZT_ROUTE</td>
</tr>
<tr>
<td>Default Gateway IP Address</td>
<td>192.168.192.1</td>
<td>$GW_ADDR</td>
</tr>
<tr>
<td>Bridge IP Address</td>
<td>192.168.192.2/24 (or use DHCP)</td>
<td>$BR_ADDR</td>
</tr>
<tr>
<td>ZeroTier Network ID</td>
<td>d5e04297a19bbd70</td>
<td>$NETWORK_ID</td>
</tr>
<tr>
<td>ZeroTier Network Interface Name</td>
<td>zt3jnwghuq</td>
<td>$ZT_IF</td>
</tr>
</tbody>
</table>
</div>
<h4 id="Get-your-bridge-device-up-and-running"><a href="#Get-your-bridge-device-up-and-running" class="headerlink" title="Get your bridge device up and running"></a>Get your bridge device up and running</h4><h5 id="Follow-the-Raspberry-Pi-install-instructions"><a href="#Follow-the-Raspberry-Pi-install-instructions" class="headerlink" title="Follow the Raspberry Pi install instructions"></a>Follow the Raspberry Pi install instructions</h5><ul>
<li><a href="https://www.raspberrypi.org/downloads/raspbian/">Install Raspbian OS</a></li>
<li><a href="https://www.raspberrypi.org/documentation/remote-access/ssh/">Enable SSH</a></li>
</ul>
<h4 id="SSH-into-the-Pi"><a href="#SSH-into-the-Pi" class="headerlink" title="SSH into the Pi"></a>SSH into the Pi</h4><p>It’s easier to login via ssh now and copy/paste commands from the comfort of your own PC.<br>The DNS name might just work for you:<br><code>ssh pi@raspberrypi.local</code> Or <code>ssh pi@&lt;ip-address-of-pi&gt;</code></p>
<h4 id="Update-the-Operating-System"><a href="#Update-the-Operating-System" class="headerlink" title="Update the Operating System"></a>Update the Operating System</h4><pre><code class="lang-bash">sudo apt update &amp;&amp; sudo apt -y full-upgrade &amp;&amp; sudo reboot
</code></pre>
<p>Log back in after it’s done</p>
<h4 id="Install-ZeroTier-1"><a href="#Install-ZeroTier-1" class="headerlink" title="Install ZeroTier"></a>Install ZeroTier</h4><pre><code class="lang-bash">https://www.ZeroTier.com/download/
-------------------------------------------------------------------------
curl -s https://install.zerotier.com | sudo bash
</code></pre>
<h4 id="Let’s-set-some-shell-variables-now"><a href="#Let’s-set-some-shell-variables-now" class="headerlink" title="Let’s set some shell variables now"></a>Let’s set some shell variables now</h4><pre><code>NETWORK_ID=&lt;your-network-id&gt;
BR_IF=&quot;br0&quot;
BR_ADDR=&lt;your-bridge-address&gt;
GW_ADDR=&lt;your-gateway-address&gt;
</code></pre><h4 id="Join-ZeroTier-Network"><a href="#Join-ZeroTier-Network" class="headerlink" title="Join ZeroTier Network"></a>Join ZeroTier Network</h4><pre><code class="lang-bash">sudo zerotier-cli join $NETWORK_ID
</code></pre>
<p>We don’t want ZeroTier to manage addresses or routes on <code>$ZT_IF</code>. We’re doing it statically below, on the bridge interface.</p>
<pre><code class="lang-bash">sudo zerotier-cli set $NETWORK_ID allowManaged=0
</code></pre>
<p>Set one more variable</p>
<pre><code class="lang-bash">ZT_IF=&lt;your-zt-interface-name&gt;
</code></pre>
<p>Copy the <code>dev</code> name from the <code>listnetworks</code> output for <code>$ZT_IF</code>. It will be something like: zt3jvirser</p>
<h4 id="Configure-the-device-in-ZeroTier-Central"><a href="#Configure-the-device-in-ZeroTier-Central" class="headerlink" title="Configure the device in ZeroTier Central"></a>Configure the device in ZeroTier Central</h4><ul>
<li>Go to the Members section of the Network</li>
<li>Open the Wrench Icon for advanced settings and check</li>
<li>Check Allow Bridging</li>
<li>Check Do Not Auto Assign</li>
<li>Authorize the member</li>
</ul>
<h4 id="Switch-to-systemd-networking"><a href="#Switch-to-systemd-networking" class="headerlink" title="Switch to systemd networking"></a>Switch to systemd networking</h4><p>Remove existing network stuff</p>
<pre><code class="lang-bash">sudo apt remove --purge --auto-remove dhcpcd5 fake-hwclock ifupdown isc-dhcp-client isc-dhcp-common openresolv
</code></pre>
<p>Enable systemd-networkd</p>
<pre><code class="lang-bash">sudo ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf;
sudo systemctl enable systemd-networkd;
sudo systemctl enable systemd-resolved;
sudo systemctl enable systemd-timesyncd;
</code></pre>
<p>Configure interfaces</p>
<pre><code class="lang-bash">sudo zerotier-cli set $NETWORK_ID allowManaged=0
</code></pre>
<p>Write Network Configuration files. Puts ethernet and zerotier into the bridge and configures the bridge with a static IP. See below for DHCP configuration on the bridge.</p>
<pre><code class="lang-bash">cat &lt;&lt; EOF | sudo tee /etc/systemd/network/25-bridge-br0.network
[Match]
Name=$BR_IF

[Network]
Address=$BR_ADDR
Gateway=$GW_ADDR
DNS=1.1.1.1
EOF

cat &lt;&lt; EOF | sudo tee /etc/systemd/network/br0.netdev
[NetDev]
Name=$BR_IF
Kind=bridge
EOF

cat &lt;&lt; EOF | sudo tee /etc/systemd/network/25-bridge-br0-zt.network
[Match]
Name=$ZT_IF

[Network]
Bridge=$BR_IF
EOF

cat &lt;&lt; EOF | sudo tee /etc/systemd/network/25-bridge-br0-en.network
[Match]
Name=eth0 # might be en*

[Network]
Bridge=$BR_IF
EOF
</code></pre>
<p>Review configuration</p>
<pre><code class="lang-bash">tail -n+0 /etc/systemd/network/*
</code></pre>
<p>If needed, edit the files with the editor of your preference.<br>If it looks good:</p>
<pre><code class="lang-bash">sudo reboot
</code></pre>
<p>You should be able to, from the physical LAN, connect to the Pi via <code>$BR_ADDR</code></p>
<h4 id="If-it-takes-a-long-time-waiting-for-the-network-during-boot"><a href="#If-it-takes-a-long-time-waiting-for-the-network-during-boot" class="headerlink" title="If it takes a long time waiting for the network during boot"></a>If it takes a long time waiting for the network during boot</h4><p>Sometimes the physical interface turns out to be a long “predictable interface name” like: “enb827eb0d4176”, sometimes it’s just <code>eth0</code>, depending on Raspbian version(???).<br><a href="https://wiki.debian.org/NetworkConfiguration#Network_Interface_Names">https://wiki.debian.org/NetworkConfiguration#Network_Interface_Names</a><br>Hook up a keyboard and monitor and check with ip addr then edit <code>/etc/systemd/network/25-bridge-br0-en.network</code> to match.</p>
<h4 id="Configure-ZeroTier-Network"><a href="#Configure-ZeroTier-Network" class="headerlink" title="Configure ZeroTier Network"></a>Configure ZeroTier Network</h4><p>At <code>my.zerotier.com/network/$NETWORK_ID</code>-&gt;<code>Settings</code>-&gt;<code>Advanced</code></p>
<ul>
<li>Delete the default Managed Route. Add the new Managed Route <code>$ZT_ROUTE</code></li>
<li>Change IPV4 Auto-Assign to Advanced</li>
<li>Remove existing Pool. Create new Pool with start and end from <code>$ZT_POOL</code></li>
<li>For documentation purposes, assign <code>$BR_ADDR</code> to the ZeroTier bridge member<br>It should be working now.</li>
</ul>
<h4 id="Next-steps"><a href="#Next-steps" class="headerlink" title="Next steps"></a>Next steps</h4><p>Either it worked, and you can ssh back in to <code>$BR_ADDR</code> after a minute, or it didn’t work and the Pi isn’t on the network anymore and you need to use the keyboard and monitor to figure out what went wrong.</p>
<blockquote>
<p><strong>TIP</strong><br>Make a backup of the sd card so you don’t have to repeat these steps</p>
</blockquote>
<h4 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h4><p>Configure bridge with DHCP</p>
<pre><code class="lang-bash">cat &lt;&lt; EOF | sudo tee /etc/systemd/network/25-bridge-br0.network
[Match]
Name=$BR_IF

[Network]
DHCP=yes
EOF
</code></pre>
<h4 id="FAQ-1"><a href="#FAQ-1" class="headerlink" title="FAQ"></a>FAQ</h4><h5 id="I-can-ping-the-bridge-but-not-behind-it"><a href="#I-can-ping-the-bridge-but-not-behind-it" class="headerlink" title="I can ping the bridge, but not behind it"></a>I can ping the bridge, but not behind it</h5><p>Sometimes, iptables rules apply: <code>echo &quot;0&quot; &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</code> or <code>iptables -A FORWARD -p all -i br0 -j ACCEPT</code><br>See: <a href="https://serverfault.com/questions/162366/iptables-bridge-and-forward-chain">https://serverfault.com/questions/162366/iptables-bridge-and-forward-chain</a></p>
<h5 id="Why-is-the-Managed-Route-23-and-the-LAN-subnet-24"><a href="#Why-is-the-Managed-Route-23-and-the-LAN-subnet-24" class="headerlink" title="Why is the Managed Route /23 and the LAN subnet /24?"></a>Why is the Managed Route /23 and the LAN subnet /24?</h5><p>Say you have a laptop that is on the ZeroTier network and you bring it home. Now its WiFi address and ZeroTier address are in the same subnet. Which interface/address should your laptop use for internet access? <a href="https://en.wikipedia.org/wiki/Longest_prefix_match">https://en.wikipedia.org/wiki/Longest_prefix_match</a></p>
<h5 id="Why-is-an-app-on-my-phone-not-working-over-ZeroTier"><a href="#Why-is-an-app-on-my-phone-not-working-over-ZeroTier" class="headerlink" title="Why is an app on my phone not working over ZeroTier?"></a>Why is an app on my phone not working over ZeroTier?</h5><p>Unfortunately the iOS and Android VPN APIs won’t let ZeroTier use multicast/broadcast. These are typically how apps auto-discover services on the LAN. 😭 Stay tuned for an article on bridging a ZeroTier network and a WiFi access point.</p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><ul>
<li><a href="https://systemd.network/systemd.network.html">https://systemd.network/systemd.network.html</a></li>
<li><a href="https://hackaday.io/project/162164/instructions">https://hackaday.io/project/162164/instructions</a></li>
</ul>
<h3 id="Layer-5-Proxy-Pylon"><a href="#Layer-5-Proxy-Pylon" class="headerlink" title="Layer 5 Proxy (Pylon)"></a>Layer 5 Proxy (Pylon)</h3><p><a href="https://github.com/zerotier/pylon">zerotier/pylon</a> is a tool built using <a href="https://github.com/zerotier/libzt">libzt</a> that allows you to run a SOCKS5 Proxy that connects services and apps to and from your secure ZeroTier network without installing ZeroTier and without bringing up any new network interfaces. Pylon can be run as one of two personalities that can work alone or together depending on your needs:<br><strong>Name</strong>|<strong>What does this do</strong>|<strong>Is this a ZeroTier Node?</strong><br>——|——|——<br><code>pylon refract</code>    |This bridges traffic to and from your LAN    |Yes<br><code>pylon reflect</code>    |This relays traffic over <code>TCP/443</code>    |No<br>In a nutshell you run <code>pylon refract</code> on some physical device on your LAN. Then devices and services that cannot install ZeroTier will connect to it on a port that you specify. Now services or devices on your LAN can talk to things on your ZeroTier network and vice versa. You can optionally run a <code>pylon reflect</code> if you’re behind some <a href="https://docs.zerotier.com/nat">tricky NAT</a> and need to relay over TCP/443.<br>See the repo for more thorough instructions: <a href="https://github.com/zerotier/pylon">zerotier/pylon</a></p>
<blockquote>
<p><strong>NOTE</strong><br>This topic is related to but different from Bridging. Proxy mode is useful if you’re unable to install our normal client on your devices.</p>
</blockquote>
<h3 id="code-server-ZeroTier"><a href="#code-server-ZeroTier" class="headerlink" title="code-server + ZeroTier"></a>code-server + ZeroTier</h3><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318195025.png" alt="20240318195025"></p>
<h4 id="What"><a href="#What" class="headerlink" title="What"></a>What</h4><p><code>code-server</code> allows you to run an instance of VSCode in the browser and edit code on remote machines. Combining this with ZeroTier lets you do this securely across your virtual network. See their project page: <a href="https://github.com/coder/code-server">github.com/coder/code-server</a></p>
<h4 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h4><pre><code class="lang-bash">curl -fsSL https://code-server.dev/install.sh | sh
</code></pre>
<h4 id="Configure"><a href="#Configure" class="headerlink" title="Configure"></a>Configure</h4><p>By default <code>code-server</code> will listen on <code>0.0.0.0</code>. We of course do not want to do this since we’d like to only access it over our secure ZeroTier network. To do this, open the config file:</p>
<pre><code class="lang-bash">nano /home/$USER/.config/code-server/config.yaml
</code></pre>
<p>Change your <code>bind-addr</code> to the ip address of the ZeroTier network interface for the network you’d like to access code-server over.<br>You can get this via <a href="https://my.zerotier.com/">Central</a> or from the <code>zerotier-cli</code>. For instance:</p>
<pre><code class="lang-bash">sudo zerotier-cli listnetworks
200 listnetworks &lt;nwid&gt; &lt;name&gt; &lt;mac&gt; &lt;status&gt; &lt;type&gt; &lt;dev&gt; &lt;ZT assigned ips&gt;
200 listnetworks 8156abe27c21623c intranet.joseph.com 31:26:27:43:19:fb OK PRIVATE ztcjyorbnc fd80:76c1:124c:2268:1da9:9bf1:14d:ab3e/88,10.241.208.61/16
</code></pre>
<pre><code class="lang-bash">bind-addr: 10.241.208.61:8080
auth: password
password: correcthorsebatterystaple
cert: false
</code></pre>
<h4 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h4><pre><code class="lang-bash">code-server
</code></pre>
<h4 id="Access-Remotely"><a href="#Access-Remotely" class="headerlink" title="Access Remotely"></a>Access Remotely</h4><p>Now from another computer <em>that is also joined to the same ZeroTier network</em> open a browser and type in the node’s address and port that is running code-server, you should be prompted to enter your password:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240318200012.png" alt="20240318200012"><br>You’re done!</p>
<blockquote>
<p><strong>CAUTION</strong><br>VS Code may state: <code>code-server is being accessed in an insecure context. Web views, the clipboard, and other functionality may not work as expected.</code>, this is true but as long as you’ve correctly set your <code>bind-addr</code> in the previous step your connection even over HTTP is secure since they are mediated over ZeroTier. Though we do recommend defense in depth so for sensitive situations we always suggest HTTPS.</p>
</blockquote>
<h3 id="Route-between-ZeroTier-and-Physical-Networks"><a href="#Route-between-ZeroTier-and-Physical-Networks" class="headerlink" title="Route between ZeroTier and Physical Networks"></a>Route between ZeroTier and Physical Networks</h3><p>This seems to be the simplest pattern for getting remote access to your LAN. It doesn’t require access to the LAN’s router or have some of the pitfalls of bridging. This requires a Linux PC or VM, something that runs iptables, on your LAN. A Raspberry Pi works. This is a NAT/Masquerade setup.<br>If you have a router that can run zerotier, you should use that instead of this article. Many router vendors and operating systems have zerotier packages.</p>
<blockquote>
<p><strong>POSSIBLE DISADVANTAGES</strong><br>No broadcast/multicast across networks (but the mobile OS’s don’t allow this anyways).<br>Can’t initiate connections from the LAN to an external ZeroTier client.</p>
</blockquote>
<h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><ul>
<li>Install ZeroTier</li>
<li>Add a managed route to the ZeroTier network (at my.zerotier.com)</li>
<li>Enable IP Forwarding</li>
<li>Configure iptables</li>
</ul>
<h4 id="Required-information"><a href="#Required-information" class="headerlink" title="Required information"></a>Required information</h4><p>For Example:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>Info</strong></th>
<th><strong>Example</strong></th>
<th><strong>Shorthand Name Below</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ZeroTier Network ID</td>
<td>d5e04297a19bbd70</td>
<td>$NETWORK_ID</td>
</tr>
<tr>
<td>ZeroTier Interface Name</td>
<td>zt7nnig26</td>
<td>$ZT_IFACE</td>
</tr>
<tr>
<td>Physical Interface Name</td>
<td>eth0</td>
<td>$PHY_IFACE</td>
</tr>
<tr>
<td>ZeroTier subnet</td>
<td>172.27.0.0/16    </td>
</tr>
<tr>
<td>Physical subnet</td>
<td>192.168.100.0/24</td>
<td>$PHY_SUB</td>
</tr>
<tr>
<td>ZeroTier IP Address of “Router”</td>
<td>172.27.0.1</td>
<td>$ZT_ADDR</td>
</tr>
</tbody>
</table>
</div>
<h4 id="Install-ZeroTier-2"><a href="#Install-ZeroTier-2" class="headerlink" title="Install ZeroTier"></a>Install ZeroTier</h4><p><a href="https://www.zerotier.com/download/">https://www.zerotier.com/download/</a></p>
<pre><code class="lang-bash">sudo zerotier-cli join $NETWORK_ID
sudo zerotier-cli listnetworks
</code></pre>
<p>Authorize it at <code>my.zerotier.com/network/$NETWORK_ID</code><br>The listnetworks output has the ZeroTier Interface name under <code>&lt;dev&gt;</code></p>
<h4 id="Configure-the-ZeroTier-managed-route"><a href="#Configure-the-ZeroTier-managed-route" class="headerlink" title="Configure the ZeroTier managed route"></a>Configure the ZeroTier managed route</h4><p>At <code>my.zerotier.com/network/$NETWORK_ID</code>-&gt;<code>Settings</code>-&gt;<code>Managed Routes</code><br>This adds another route to every device joined to the ZeroTier network.</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>Destination</strong></th>
<th><strong>(Via)</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>$PHY_SUB</td>
<td>$ZT_ADDR</td>
</tr>
</tbody>
</table>
</div>
<p>For example:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>Destination</strong></th>
<th><strong>(Via)</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.100.0/23</td>
<td>172.27.0.1</td>
</tr>
</tbody>
</table>
</div>
<p>Configure the destination route as slightly <strong>larger</strong> than the actual physical subnet, here <em>/23</em> instead of <em>/24</em> (a smaller number is a bigger subnet in this notation) This makes devices that are on both the physical and the ZeroTier network prefer the physical connection.</p>
<h4 id="Enable-IP-forwarding"><a href="#Enable-IP-forwarding" class="headerlink" title="Enable IP forwarding"></a>Enable IP forwarding</h4><p>This can vary depending on linux distribution. Typically:<br>Edit <code>/etc/sysctl.conf</code> to uncomment <code>net.ipv4.ip_forward</code>. This enables forwarding at boot.<br>To enable it now</p>
<pre><code class="lang-bash">sudo sysctl -w net.ipv4.ip_forward=1
</code></pre>
<h4 id="Configure-iptables"><a href="#Configure-iptables" class="headerlink" title="Configure iptables"></a>Configure iptables</h4><p>Assign some shell variables (personalize these)</p>
<pre><code class="lang-bash">PHY_IFACE=eth0; ZT_IFACE=zt7nnig26
</code></pre>
<p>Add rules to iptables</p>
<pre><code class="lang-bash">sudo iptables -t nat -A POSTROUTING -o $PHY_IFACE -j MASQUERADE
sudo iptables -A FORWARD -i $PHY_IFACE -o $ZT_IFACE -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i $ZT_IFACE -o $PHY_IFACE -j ACCEPT
</code></pre>
<p>Save iptables rules for next boot</p>
<pre><code class="lang-bash">sudo apt install iptables-persistent
sudo bash -c iptables-save &gt; /etc/iptables/rules.v4
</code></pre>
<h4 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h4><ul>
<li>Turn off wifi on your phone</li>
<li>Join it to the zerotier network, authorize it</li>
<li>Try to access something on the physical LAN</li>
</ul>
<h3 id="Network-Microsegmentation"><a href="#Network-Microsegmentation" class="headerlink" title="Network Microsegmentation"></a>Network Microsegmentation</h3><h4 id="Create-a-netwrok-for-each-role"><a href="#Create-a-netwrok-for-each-role" class="headerlink" title="Create a netwrok for each role"></a>Create a netwrok for each role</h4><p>Devices can join multiple networks at once. Networks are free on my.zerotier.com. Each network can have its own <a href="https://docs.zerotier.com/rules">Network Flow Rules</a>. “Network A allows only RDP traffic.” for example.</p>
<h5 id="Pros"><a href="#Pros" class="headerlink" title="Pros"></a>Pros</h5><ul>
<li>Easy</li>
<li>Automatic authorization of nodes with SSO/OIDC</li>
</ul>
<h5 id="Cons"><a href="#Cons" class="headerlink" title="Cons"></a>Cons</h5><ul>
<li>Multiple sets of subnets, IP addresses, etc… to maintain. Can be automated with Terraform.</li>
<li>Mobile devices can connect to only 1 network at a time</li>
</ul>
<h5 id="Summary-1"><a href="#Summary-1" class="headerlink" title="Summary"></a>Summary</h5><ul>
<li>Create a ZeroTier network for each role: <em>Red, Green, and Blue</em>. Or: <em>Sales, HR, IT</em>. Or: <em>Dev, Prod, Staging</em>. Or: <em>Customer A, Customer B</em></li>
<li>Join shared resources to multiple networks</li>
<li>Join users to the networks they need access to<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319095759.png" alt="20240319095759"></li>
</ul>
<h4 id="ZeroTier-Network-Flow-Rules"><a href="#ZeroTier-Network-Flow-Rules" class="headerlink" title="ZeroTier Network Flow Rules"></a>ZeroTier Network Flow Rules</h4><p>Tag network members with roles.</p>
<h5 id="Pros-1"><a href="#Pros-1" class="headerlink" title="Pros"></a>Pros</h5><ul>
<li>Fine grained, low-level access control</li>
<li>One network config and set of members to maintain</li>
</ul>
<h5 id="Cons-1"><a href="#Cons-1" class="headerlink" title="Cons"></a>Cons</h5><ul>
<li>Tricky to build rule sets</li>
<li>Rules not integrated with OIDC yet</li>
</ul>
<h5 id="Summary-2"><a href="#Summary-2" class="headerlink" title="Summary"></a>Summary</h5><ul>
<li>Create a network</li>
<li>Use the Flow Rules to segment the network</li>
</ul>
<p>Here is the simplest possible <a href="https://docs.zerotier.com/rules">ZeroTier Flow Rules</a> example. More complex rules can be mixed in with these. See the docs or contact us for help.<br>Replace the default rules with:</p>
<pre><code class="lang-bash">tag role id 1
    default 0
    flag 0 red
    flag 1 green
    flag 2 blue
;

drop tand role 0;

accept;
</code></pre>
<p>Devices will be able to talk only if they have at least one overlapping role. The tagging system is based on bitwise math, which we won’t try to explain here. Basically: Rename “red” “green” and “blue” with your real role names. Add more roles by adding flags in increasing order: <em>flag 3 yellow, flag 4 indigo</em><br>After saving a rule set with tags. A tag interface appears below:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319100037.png" alt="20240319100037"></p>
<h3 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h3><h4 id="How-to-characterize-NAT"><a href="#How-to-characterize-NAT" class="headerlink" title="How to characterize NAT"></a>How to characterize NAT</h4><p>When debugging it is often nice to be able to gather information about NAT type and behavior. ZeroTier does not use STUN (for various reasons), but many STUN implementations contain some helpful code for doing this. It’s helpful to use an external utility since it’s “out of band” and therefore independent of ZeroTier.</p>
<pre><code class="lang-bash">sudo apt-get install stun
sudo stun stun.callwithus.com 0
</code></pre>
<p>This will perform the basic NAT characterization test from the STUN RFC. The STUN server can be any public STUN server.<br>It will generate output like:</p>
<pre><code class="lang-bash">STUN client version 0.96
running test number 0
Primary: Independent Mapping, Port Dependent Filter, preserves ports, no hairpin
Return value is 0x000017
</code></pre>
<h3 id="Integrating-with-Physical-Networks"><a href="#Integrating-with-Physical-Networks" class="headerlink" title="Integrating with Physical Networks"></a>Integrating with Physical Networks</h3><p>ZeroTier creates networks interfaces, IP addresses, and routes on your computers. Because of this, you can use all the standard networking tools and techniques with your ZeroTier networks.<br>There are 2 main ways to connect your ZeroTier networks to your Physical networks: Routing and Bridging. Yes, they are technically different things. Bridging has its downsides, including that it’s tricky to set up.</p>
<h4 id="Routing-or-Bridging"><a href="#Routing-or-Bridging" class="headerlink" title="Routing or Bridging?"></a>Routing or Bridging?</h4><p>Most of the time, choose routing.<br>Do you have devices that can’t install zerotier, use broadcast or multicast, and need to talk to ZeroTier nodes? Then consider bridging.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319110507.png" alt="20240319110507"></p>
<h4 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h4><p>There are many ways to set up routing.<br>We have only a <a href="https://docs.zerotier.com/route-between-phys-and-virt">Masquerade Tutorial</a> so far, but the steps are the same for any of these set ups; just skip the IPTables Masquerade step.<br>Here are some of the common examples:</p>
<h5 id="Router-can-run-ZeroTier"><a href="#Router-can-run-ZeroTier" class="headerlink" title="Router can run ZeroTier"></a>Router can run ZeroTier</h5><p>This is the best case. Since the router/firewall is the default gateway, no additional routing config needs to be done. It already knows the routes to the ZeroTier networks it’s joined to.<br>Some examples:</p>
<ul>
<li>Mikrotik</li>
<li>Teltonika Networks</li>
<li>OpenWRT</li>
<li>OPNsense</li>
</ul>
<p>If you aren’t already using existing routers, consider one of these!<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319110649.png" alt="20240319110649"></p>
<h5 id="Router-can’t-run-ZeroTier"><a href="#Router-can’t-run-ZeroTier" class="headerlink" title="Router can’t run ZeroTier"></a>Router can’t run ZeroTier</h5><p>You’ll have to run ZeroTier on a device or virtual machine in your LAN. You should use Linux if at all possible. This will act as the “router” between ZeroTier and Physical networks.</p>
<h5 id="Static-Routes-on-Gateway"><a href="#Static-Routes-on-Gateway" class="headerlink" title="Static Routes on Gateway"></a>Static Routes on Gateway</h5><p>Add a Static Route to your router/gateway:<br><code>[ZeroTier subnet] via [LAN IP of ZeroTier &quot;router&quot;]</code><br>For example:<br><code>10.147.20.0/24 via 10.0.0.2</code><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319110829.png" alt="20240319110829"></p>
<h5 id="Masquerade"><a href="#Masquerade" class="headerlink" title="Masquerade"></a>Masquerade</h5><p>This is the same method that your home router uses to route between Internet and your home LAN. See the <a href="https://docs.zerotier.com/route-between-phys-and-virt">Masquerade Tutorial</a><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319110923.png" alt="20240319110923"></p>
<h4 id="Bridging"><a href="#Bridging" class="headerlink" title="Bridging"></a>Bridging</h4><p>See the <a href="https://docs.zerotier.com/bridging">Bridging Tutorial</a><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319111011.png" alt="20240319111011"><br>Some things that use broadcast:</p>
<h5 id="Wake-on-LAN"><a href="#Wake-on-LAN" class="headerlink" title="Wake on LAN"></a>Wake on LAN</h5><p>Since ZeroTier is a program that runs on your computer, if the computer is off, it won’t be able to receive ZeroTier packets. Wake on LAN packets need to be on the physical network. You still might not need Bridging if this is your only requirement: Run ZeroTier on a different computer on your LAN, and send the WoL packet from that computer.</p>
<h5 id="Auto-discovery"><a href="#Auto-discovery" class="headerlink" title="Auto-discovery"></a>Auto-discovery</h5><p>Does your equipment come with a companion desktop or mobile application that auto-discovers the hardware on the network? This process usually uses broadcast. If the app lets you type in an IP address in the settings instead of using auto-discovery, that might be easier.<br>Mobile Operating Systems don’t let you do broadcast over a “VPN” connection. You need run a bridge wherever the equipment is, <em>and</em> where the phone or tablet is.</p>
<h5 id="Embedded-equipment"><a href="#Embedded-equipment" class="headerlink" title="Embedded equipment"></a>Embedded equipment</h5><ul>
<li>Industrial</li>
<li>Audio / Video / Lighting equipment</li>
<li>Cameras</li>
</ul>
<h2 id="Self-Hosting"><a href="#Self-Hosting" class="headerlink" title="Self-Hosting"></a>Self-Hosting</h2><p>Take control by self-hosting your own ZeroTier infrastructure.</p>
<h3 id="Network-Controller"><a href="#Network-Controller" class="headerlink" title="Network Controller"></a>Network Controller</h3><blockquote>
<p><strong>INFO</strong><br><a href="https://docs.zerotier.com/what-is-a-controller">Network Controller Reference Documentation</a></p>
</blockquote>
<h4 id="Tutorial"><a href="#Tutorial" class="headerlink" title="Tutorial"></a>Tutorial</h4><p>First, skim the <a href="https://github.com/zerotier/ZeroTierOne/tree/master/controller">README</a>.<br>We’re going to use <code>curl</code> to set up an example ZeroTier network. An easy way to get <code>curl</code> in Windows is to install <a href="https://git-scm.com/downloads">the latest version of Git</a>, which comes with bash, curl, and other tools.</p>
<blockquote>
<p><strong>OPENAPI</strong><br>The setup described here uses the local <a href="https://docs.zerotier.com/api/service">ZeroTierOne service API</a> to provision and manage networks. You can <a href="https://docs.zerotier.com/service/v1#tag/controller">browse</a> the OpenAPI docs for the local controller API for more detail on this interface.</p>
</blockquote>
<p>This is a low tech way to setup a controller for example purposes. You’d likely build yourself something fancier around this API.</p>
<h5 id="Authtoken"><a href="#Authtoken" class="headerlink" title="Authtoken"></a>Authtoken</h5><p>You’ll need to find the current local auth token on your system using the instructions in the <a href="https://docs.zerotier.com/api/tokens#zerotierone-service-token">API Tokens</a> guide.</p>
<h5 id="Get-your-Node-ID"><a href="#Get-your-Node-ID" class="headerlink" title="Get your Node ID"></a>Get your Node ID</h5><blockquote>
<p><strong>NOTE</strong><br>Network IDs are based on the Node ID of the Controller. Controllers are nodes! When you join a network, your node finds the controller like it does with other nodes: by its Node ID.</p>
</blockquote>
<h6 id="with-zerotier-cli"><a href="#with-zerotier-cli" class="headerlink" title="with zerotier-cli"></a>with zerotier-cli</h6><p>(may need sudo)</p>
<pre><code class="lang-bash">zerotier-cli info
</code></pre>
<h6 id="with-curl"><a href="#with-curl" class="headerlink" title="with curl"></a>with curl</h6><pre><code class="lang-bash">curl &quot;http://localhost:9993/status&quot; -H &quot;X-ZT1-AUTH: $&#123;TOKEN&#125;&quot;
</code></pre>
<p>It’s the “Address” in the above’s output.<br>Let’s save the Node ID to an environment variable too:</p>
<pre><code class="lang-bash">NODEID=your-node-id
</code></pre>
<p>or try:</p>
<pre><code class="lang-bash">NODEID=$(zerotier-cli info | cut -d &quot; &quot; -f 3)
</code></pre>
<h5 id="Create-a-Network-1"><a href="#Create-a-Network-1" class="headerlink" title="Create a Network"></a>Create a Network</h5><pre><code class="lang-bash">curl -X POST &quot;http://localhost:9993/controller/network/$&#123;NODEID&#125;______&quot; -H &quot;X-ZT1-AUTH: $&#123;TOKEN&#125;&quot; -d &#123;&#125;
</code></pre>
<p>This should return JSON for a fresh network.</p>
<blockquote>
<p><strong>NOTE</strong><br>When you post to <code>/network/$&#123;NODEID&#125;______</code> the controller generates a random Network ID for you.<br>See the “id” of your newly created network.</p>
</blockquote>
<p>Let’s save the new Network ID to an environment variable</p>
<pre><code class="lang-bash">NWID=your-network-id
</code></pre>
<h5 id="List-Networks"><a href="#List-Networks" class="headerlink" title="List Networks"></a>List Networks</h5><pre><code class="lang-bash">curl &quot;http://localhost:9993/controller/network&quot; -H &quot;X-ZT1-AUTH: $&#123;TOKEN&#125;&quot;
</code></pre>
<p>This returns a list of Network IDs. It should include the ID returned by the create command we did in the previous step.</p>
<h5 id="Get-Network-Info"><a href="#Get-Network-Info" class="headerlink" title="Get Network Info"></a>Get Network Info</h5><pre><code class="lang-bash">curl &quot;http://localhost:9993/controller/network/$&#123;NWID&#125;&quot; -H &quot;X-ZT1-AUTH: $&#123;TOKEN&#125;&quot;
</code></pre>
<h5 id="List-Network-Members"><a href="#List-Network-Members" class="headerlink" title="List Network Members"></a>List Network Members</h5><p>You’ll need another node to join your network first, or this will be empty. You can use a phone, or another PC, or a VM, or a VPS…</p>
<pre><code class="lang-bash">curl &quot;http://localhost:9993/controller/network/$&#123;NWID&#125;/member&quot; -H &quot;X-ZT1-AUTH: $&#123;TOKEN&#125;&quot;
</code></pre>
<p>I guess you could join the controller node to its own network, for demonstration purposes.<br>Save the Node ID of one of your Network Members in an env var</p>
<pre><code class="lang-bash">MEMID=a-member&#39;s-node-id
</code></pre>
<h5 id="Get-Member-Info"><a href="#Get-Member-Info" class="headerlink" title="Get Member Info"></a>Get Member Info</h5><pre><code class="lang-bash">curl &quot;http://localhost:9993/controller/network/$&#123;NWID&#125;/member/$&#123;MEMID&#125;&quot; -H &quot;X-ZT1-AUTH: $&#123;TOKEN&#125;&quot;
</code></pre>
<h5 id="Configure-the-Network"><a href="#Configure-the-Network" class="headerlink" title="Configure the Network"></a>Configure the Network</h5><p>For Nodes to talk, we need to add a Managed Route and IP Auto-Assign Range on the network. Let’s make it a Private network too. Prefer Private networks.</p>
<pre><code class="lang-bash">curl -X POST &quot;http://localhost:9993/controller/network/$&#123;NWID&#125;&quot; -H &quot;X-ZT1-AUTH: $&#123;TOKEN&#125;&quot; \
    -d &#39;&#123;&quot;ipAssignmentPools&quot;: [&#123;&quot;ipRangeStart&quot;: &quot;192.168.192.1&quot;, &quot;ipRangeEnd&quot;: &quot;192.168.192.254&quot;&#125;], &quot;routes&quot;: [&#123;&quot;target&quot;: &quot;192.168.192.0/24&quot;, &quot;via&quot;: null&#125;], &quot;v4AssignMode&quot;: &quot;zt&quot;, &quot;private&quot;: true &#125;&#39;
</code></pre>
<h5 id="Authorize-a-member"><a href="#Authorize-a-member" class="headerlink" title="Authorize a member"></a>Authorize a member</h5><pre><code class="lang-bash">curl -X POST &quot;http://localhost:9993/controller/network/$&#123;NWID&#125;/member/$&#123;MEMID&#125;&quot; -H &quot;X-ZT1-AUTH: $&#123;TOKEN&#125;&quot; -d &#39;&#123;&quot;authorized&quot;: true&#125;&#39;
</code></pre>
<h5 id="Network-Info-Again"><a href="#Network-Info-Again" class="headerlink" title="Network Info Again"></a>Network Info Again</h5><pre><code class="lang-bash">curl &quot;http://localhost:9993/controller/network/$&#123;NWID&#125;&quot; -H &quot;X-ZT1-AUTH: $&#123;TOKEN&#125;&quot;
</code></pre>
<h5 id="Member-Info-Again"><a href="#Member-Info-Again" class="headerlink" title="Member Info Again"></a>Member Info Again</h5><pre><code class="lang-bash">curl &quot;http://localhost:9993/controller/network/$&#123;NWID&#125;/member/$&#123;MEMID&#125;&quot; -H &quot;X-ZT1-AUTH: $&#123;TOKEN&#125;&quot;
</code></pre>
<h5 id="Confirm-from-your-nodes"><a href="#Confirm-from-your-nodes" class="headerlink" title="Confirm from your nodes"></a>Confirm from your nodes</h5><pre><code class="lang-bash">sudo zerotier-cli listnetworks
</code></pre>
<p>It should say “OK PRIVATE” and have an IP address.</p>
<h5 id="Deauthorize-Member"><a href="#Deauthorize-Member" class="headerlink" title="Deauthorize Member"></a>Deauthorize Member</h5><pre><code class="lang-bash">curl -X POST &quot;http://localhost:9993/controller/network/$&#123;NWID&#125;/member/$&#123;MEMID&#125;&quot; -H &quot;X-ZT1-AUTH: $&#123;TOKEN&#125;&quot; -d &#39;&#123;&quot;authorized&quot;: false&#125;&#39;
</code></pre>
<h5 id="Delete-Member"><a href="#Delete-Member" class="headerlink" title="Delete Member"></a>Delete Member</h5><pre><code class="lang-bash">curl -X DELETE &quot;http://localhost:9993/controller/network/$&#123;NWID&#125;/member/$&#123;MEMID&#125;&quot; -H &quot;X-ZT1-AUTH: $&#123;TOKEN&#125;&quot;
</code></pre>
<blockquote>
<p><strong>CAUTION</strong><br>You can “delete” a member, but they will show up in the output of “list member” again if the node is still online and trying to join. You should make sure to deauthorize before deleting.</p>
</blockquote>
<h5 id="Backup-your-controller"><a href="#Backup-your-controller" class="headerlink" title="Backup your controller"></a>Backup your controller</h5><p>If you want to keep these networks, copy the ZeroTier Home directory somewhere. Most importantly, the identity.secret and the controller.d directory.</p>
<h5 id="Clean-up-networks"><a href="#Clean-up-networks" class="headerlink" title="Clean up networks"></a>Clean up networks</h5><p>You may want to delete these networks now that you’re done testing. You could use the API to delete every network.<br>Or you can delete the controller.d directory.</p>
<h6 id="Linux-4"><a href="#Linux-4" class="headerlink" title="Linux"></a>Linux</h6><p>stop zerotier (If you’re ssh’d in over zerotier, this will break your connection):</p>
<pre><code class="lang-bash">systemctl stop zerotier-one
</code></pre>
<p>delete controller configs:</p>
<pre><code class="lang-bash">cd /var/lib/zerotier-one/
# rm -rf ./controller.d/
</code></pre>
<p>start zerotier:</p>
<pre><code class="lang-bash">systemctl start zerotier-one
</code></pre>
<h6 id="macOS-4"><a href="#macOS-4" class="headerlink" title="macOS"></a>macOS</h6><p>stop zerotier:</p>
<pre><code class="lang-bash">sudo launchctl unload /Library/LaunchDaemons/com.zerotier.one.plist
</code></pre>
<p>delete controller configs:</p>
<pre><code class="lang-bash">cd &quot;/Library/Application Support/ZeroTier/One&quot;
# sudo rm -rf ./controller.d
</code></pre>
<p>start zerotier:</p>
<pre><code class="lang-bash">sudo launchctl load /Library/LaunchDaemons/com.zerotier.one.plist
</code></pre>
<h3 id="Private-Root-Servers"><a href="#Private-Root-Servers" class="headerlink" title="Private Root Servers"></a>Private Root Servers</h3><h4 id="Creating-Your-Own-Roots-a-k-a-Moons"><a href="#Creating-Your-Own-Roots-a-k-a-Moons" class="headerlink" title="Creating Your Own Roots (a.k.a. Moons)"></a>Creating Your Own Roots (a.k.a. Moons)</h4><p>All ZeroTier nodes on a planet effectively inhabit a single data center. This makes it easy to directly connect devices anywhere, but it has the disadvantage of not working without an Internet connection. Network connections are far from perfectly reliable, and sometimes for security reasons a user may wish to “air gap” a set of nodes from the rest of the Internet entirely.<br>In 1.2.0 we introduced the ability to add your own user-defined roots. Since the data center we inhabit is the planet, a user-defined set of roots is called a <strong>moon</strong>. When a node “orbits” a moon, it adds the moon’s roots to its root server set. Nodes orbiting moons will still use planetary roots, but they’ll use the moon’s roots if they look faster or if nothing else is available.<br>The first step in creating a moon is to deploy a set of root servers. In most cases we recommend two. These are regular ZeroTier nodes, but ones that are always on and have static (physical) IP addresses. These static IPs could be global Internet IPs or physical intranet IPs that are only reachable internally. In the latter case your moon’s roots won’t work outside your office, but that doesn’t matter. Roaming nodes will just use planetary roots instead.<br>We recommend that root servers do not act as network controllers, join networks, or perform any other overlapping functions. They need good reliable network connections but otherwise require very little RAM, storage, or CPU. A root could be a small VM, VPS, or cloud instance, or a small device like a <a href="https://www.raspberrypi.org/">Raspberry Pi</a>. If you provision your roots as VMs, take care that they do not all reside on the same physical hardware. This would defeat the purpose of having two.<br>The next step is to create a world definition using <code>zerotier-idtool</code>. You will need the <code>identity.public</code> files from each of your root servers. Pick one root (doesn’t matter which) and run <code>zerotier-idtool initmoon &lt;identity.public of one root&gt; &gt;&gt;moon.json</code>. The <code>zerotier-idtool</code>command will output a JSON version of your world definition to <em>stdout</em>, so we redirect it to <code>moon.json</code>.<br>Examine this file. It will contain something like:</p>
<pre><code class="lang-json">
    &#123;
      &quot;id&quot;: &quot;deadbeef00&quot;,
      &quot;objtype&quot;: &quot;world&quot;,
      &quot;roots&quot;: [
        &#123;
          &quot;identity&quot;: &quot;deadbeef00:0:34031483094...&quot;,
          &quot;stableEndpoints&quot;: []
        &#125;
      ],
      &quot;signingKey&quot;: &quot;b324d84cec708d1b51d5ac03e75afba501a12e2124705ec34a614bf8f9b2c800f44d9824ad3ab2e3da1ac52ecb39ac052ce3f54e58d8944b52632eb6d671d0e0&quot;,
      &quot;signingKey_SECRET&quot;: &quot;ffc5dd0b2baf1c9b220d1c9cb39633f9e2151cf350a6d0e67c913f8952bafaf3671d2226388e1406e7670dc645851bf7d3643da701fd4599fedb9914c3918db3&quot;,
      &quot;updatesMustBeSignedBy&quot;: &quot;b324d84cec708d1b51d5ac03e75afba501a12e2124705ec34a614bf8f9b2c800f44d9824ad3ab2e3da1ac52ecb39ac052ce3f54e58d8944b52632eb6d671d0e0&quot;,
      &quot;worldType&quot;: &quot;moon&quot;
    &#125;
</code></pre>
<p>The world ID is technically arbitrary and could be any random 64-bit value. By convention we use the address of one of the roots.<br>The world definition JSON file <strong>contains secrets</strong>, so it’s important to keep it in a safe place. The <code>signingKey_SECRET</code> is what will allow you to update your world definition automatically in the future.<br>Now add your other root(s) and define their stable endpoints. You’ll end up with something that looks like:</p>
<pre><code class="lang-JSON">    &#123;
      &quot;id&quot;: &quot;deadbeef00&quot;,
      &quot;objtype&quot;: &quot;world&quot;,
      &quot;roots&quot;: [
        &#123;
          &quot;identity&quot;: &quot;deadbeef00:0:34031483094...&quot;,
          &quot;stableEndpoints&quot;: [ &quot;10.0.0.2/9993&quot;,&quot;2001:abcd:abcd::1/9993&quot; ]
        &#125;,
        &#123;
          &quot;identity&quot;: &quot;feedbeef11:0:83588158384...&quot;,
          &quot;stableEndpoints&quot;: [ &quot;10.0.0.3/9993&quot;,&quot;2001:abcd:abcd::3/9993&quot; ]
        &#125;
      ],
      &quot;signingKey&quot;: &quot;b324d84cec708d1b51d5ac03e75afba501a12e2124705ec34a614bf8f9b2c800f44d9824ad3ab2e3da1ac52ecb39ac052ce3f54e58d8944b52632eb6d671d0e0&quot;,
      &quot;signingKey_SECRET&quot;: &quot;ffc5dd0b2baf1c9b220d1c9cb39633f9e2151cf350a6d0e67c913f8952bafaf3671d2226388e1406e7670dc645851bf7d3643da701fd4599fedb9914c3918db3&quot;,
      &quot;updatesMustBeSignedBy&quot;: &quot;b324d84cec708d1b51d5ac03e75afba501a12e2124705ec34a614bf8f9b2c800f44d9824ad3ab2e3da1ac52ecb39ac052ce3f54e58d8944b52632eb6d671d0e0&quot;,
      &quot;worldType&quot;: &quot;moon&quot;
    &#125;
</code></pre>
<p>The static IP addresses you use must be reachable from all the places you want these roots to serve. If you’re deploying these for use at a physical location, use internal IPs. If you want them to be usable off-site, use public IPs from your DMZ or host them at a cloud provider with a data center presence close to you. Low-cost cloud hosts that provide simple static direct IP addressing and dual-stack IPv4/IPv6 support like <a href="https://digitalocean.com/">Digital Ocean</a>, <a href="https://vultr.com/">Vultr</a>, and <a href="https://linode.com/">Linode</a> make ideal places to host roots. The lowest priced instances at these providers are more than sufficient in most cases.<br>The third step is to generate the actual signed world with <code>zerotier-idtool genmoon moon.json</code>. In this case this will generate a file called <code>000000deadbeef00.moon</code>. This does not contain secret keys but is signed by the secret from the JSON file.<br>Now go to your roots, create (if it does not exist) a subdirectory of their working directories (usually <code>/var/lib/zerotier-one</code> on Linux) called <code>moons.d</code>, and copy the signed moon file there. Now restart the roots and they should be ready.<br>You can add these roots to regular nodes in one of two ways: by placing the same world definition file in their <code>moons.d</code> directories or by using the zerotier-cli orbit command: <code>zerotier-cli orbit deadbeef00 deadbeef00</code>. The first argument is the world ID (which we can shorten by removing the two leading zeroes) and the second is the address of any of its roots. This will contact the root and obtain the full world definition from it if it’s online and reachable.<br>Once you’ve “orbited” your moon, try <code>zerotier-cli listpeers</code>. You should see the roots you’ve created listed as <code>MOON</code> instead of <code>LEAF</code>. They will now be used as alternative root servers.</p>
<h1 id="Development"><a href="#Development" class="headerlink" title="Development"></a>Development</h1><p>The ZeroTier agent and <a href="https://my.zerotier.com/">Central</a> both provide APIs that allow you to query information about your networks and peers, as well as managing the configuration and membership of your networks.</p>
<h2 id="Central-API"><a href="#Central-API" class="headerlink" title="Central API"></a>Central API</h2><p><a href="https://docs.zerotier.com/central">Central</a> is our hosted control plane for ZeroTierOne networks.<br>In addition to the web-based GUI, you can use the <a href="https://docs.zerotier.com/central/v1">Central API</a> to view and manage your networks. You will need an <a href="https://docs.zerotier.com/api/tokens#zerotier-central-token">API token</a> for access.<br>You can write your own client code to connect with Central using our <a href="https://docs.zerotier.com/api/central/examples">examples</a> as a starting point, or use an existing integration like our <a href="https://docs.zerotier.com/terraform">Terraform provider</a>.</p>
<h3 id="API-Reference-V1"><a href="#API-Reference-V1" class="headerlink" title="API Reference (V1)"></a>API Reference (V1)</h3><p><a href="https://docs.zerotier.com/central/v1/">https://docs.zerotier.com/central/v1/</a></p>
<h3 id="Central-APO-Examples"><a href="#Central-APO-Examples" class="headerlink" title="Central APO Examples"></a>Central APO Examples</h3><p>In the examples below use the following placeholder variables to match commonly-needed parameters:</p>
<ul>
<li>$ZT_TOKEN: an API token associated with an active account on <a href="https://my.zerotier.com/">Central</a></li>
<li>$NWID: an active network ID</li>
</ul>
<blockquote>
<p><strong>INFO</strong><br>See the <a href="https://docs.zerotier.com/api/tokens">Central API Tokens</a> guide for an explanation of how to create and manage API tokens.</p>
</blockquote>
<p><strong>Exporting Data from the Central API</strong><br>The examples below are intended to run in a system terminal, and require the following command-line tools:</p>
<ul>
<li><a href="https://curl.so/">curl</a></li>
<li><a href="https://jqlang.github.io/jq/">jq</a></li>
</ul>
<p>Each of them will fetch network information and produce CSV as output. You can then import that CSV into your choice of database, spreadsheet, or configuration-management tool(s).</p>
<h4 id="List-current-networks"><a href="#List-current-networks" class="headerlink" title="List current networks"></a>List current networks</h4><pre><code class="lang-bash">curl -s -H &quot;Authorization: token $ZT_TOKEN&quot; \
  &quot;https://api.zerotier.com/api/v1/network&quot; \
  | jq &#39;.[] | [
    .id,
    .config.name,
    .config.description,
    .totalMemberCount,
    .config.creationTime,
    .config.ipAssignmentPools[0].ipRangeStart,
    .config.ipAssignmentPools[0].ipRangeEnd
  ]&#39; \
  | jq -rs &#39;.[] | @csv&#39;
</code></pre>
<h4 id="List-network-members"><a href="#List-network-members" class="headerlink" title="List network members"></a>List network members</h4><pre><code class="lang-bash">curl -H &quot;Authorization: token $ZT_TOKEN&quot; \
  &quot;https://api.zerotier.com/api/v1/network/$NWID/member&quot; \
  | jq &#39;.[] | [
    .id,
    .lastSeen,
    .physicalAddress,
    .ipAssignments[0],
    .name
  ]&#39; \
  | jq -rs &#39;.[] | @csv
</code></pre>
<h2 id="Service-API"><a href="#Service-API" class="headerlink" title="Service API"></a>Service API</h2><p>The ZeroTierOne service provides an API which is used by the <a href="https://docs.zerotier.com/cli">ZeroTierOne CLI</a> and other clients to manage settings on your local instance of ZeroTier. This administration API is restricted to <code>localhost</code> by default, and requires authentication using an <a href="https://docs.zerotier.com/api/tokens#zerotierone-service-token">API token</a>.<br>Once you have your local token, you can access <a href="https://docs.zerotier.com/service/v1">local node, network, and peer information</a>, as well as configuring a <a href="https://docs.zerotier.com/controller">standalone controller</a>.</p>
<h3 id="API-Reference-V1-1"><a href="#API-Reference-V1-1" class="headerlink" title="API Reference (V1)"></a>API Reference (V1)</h3><p><a href="https://docs.zerotier.com/service/v1/">https://docs.zerotier.com/service/v1/</a></p>
<h2 id="Using-API-Token"><a href="#Using-API-Token" class="headerlink" title="Using API Token"></a>Using API Token</h2><p>Access to the ZeroTier APIs requires an authentication token. This guide describes the methods and tools needed to create and manage these tokens.</p>
<h4 id="ZeroTier-Central-Token"><a href="#ZeroTier-Central-Token" class="headerlink" title="ZeroTier Central Token"></a>ZeroTier Central Token</h4><p>To use the Central API, you need a token associated with your account. To create one, log into <a href="https://my.zerotier.com/">my.zerotier.com</a> and create a named token in the <a href="https://my.zerotier.com/account">Account</a> tab. Pick a memorable name that shows the intended use of the token: for example, “Terraform automation token” or “internal dev key”.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240319140950.png" alt="20240319140950"><br>Each token you create is associated with your user account, so it will allow the same level of access to manage and query networks that you have when working in the Central UI.</p>
<blockquote>
<p><strong>CAUTION</strong><br>The token is displayed only once at the time you create it, so you should save it somewhere safe before clicking ‘Done’.</p>
</blockquote>
<h4 id="ZeroTierOne-Service-Token"><a href="#ZeroTierOne-Service-Token" class="headerlink" title="ZeroTierOne Service Token"></a>ZeroTierOne Service Token</h4><p>The local service API token is store in the <code>authtoken.secret</code> file in the ZeroTier service state directory. You’ll need it to make API calls to the local service.</p>
<blockquote>
<p><strong>NOTE</strong><br>ZeroTier generates the token at random the first time it starts. If you delete the file and restart the ZeroTierOne service a new token will be created, and the existing token will no longer be usable to access the API.</p>
</blockquote>
<p>You can store the current auth token value in an environment variable for use in scripting and local development using the following terminal commands:<br><em>Linux</em>: <code>TOKEN=$(sudo cat /var/lib/zerotier-one/authtoken.secret)</code><br><em>macOS</em>: <code>TOKEN=$(sudo cat &quot;/Library/Application Support/ZeroTier/One/authtoken.secret&quot;)</code><br><em>Windows</em>: <code>$env.TOKEN = Get-Content C:\ProgramData\ZeroTier\One\authtoken.secret</code></p>
<h2 id="Sockets-libzt"><a href="#Sockets-libzt" class="headerlink" title="Sockets(libzt)"></a>Sockets(libzt)</h2><p>Encrypted P2P connections for your app or service.<br>This guide explains how to use the ZeroTier SDK Socket API. It is meant to be read linearly and progresses from beginner topics to advanced topics. We will start by creating a simple <a href="https://docs.zerotier.com/sockets#pingable-node-part-1">pingable node</a> while skipping over most of the gritty details. Then we’ll move on to a full <a href="https://docs.zerotier.com/sockets#client-and-server-part-2">client-server socket application</a> where we will take the occasional tangent to learn more about how all of this works. Source code for the examples can be found here: <a href="https://github.com/zerotier/libzt/tree/main/examples">libzt/examples</a>. For API reference documentation see the sidebar to the left. To read more more about how ZeroTier works in general, see our <a href="https://docs.zerotier.com/zerotier/manual">Design Whitepaper</a>. If you find an error on this page or you just need help getting something to work please open a <a href="https://github.com/zerotier/libzt/issues">GitHub issue</a>.</p>
<h3 id="Install-1"><a href="#Install-1" class="headerlink" title="Install"></a>Install</h3><p><em>C/C++</em>: <code>brew install zerotier/tap/libzt</code><br><em>Rust</em>: <code># See https://crates.io/crates/libzt</code><br><em>Python</em>: <code>pip install libzt</code><br><em>C#</em>: <code>Install-Package ZeroTier.Sockets</code><br><em>Java</em>: <code>Install-Package ZeroTier.Sockets</code><br>Alternatively, build from source: <a href="https://www.github.com/zerotier/libzt">github.com/zerotier/libzt</a></p>
<blockquote>
<p><strong>INFO</strong><br>For the purposes of this guide it is recommended that you first <a href="https://my.zerotier.com/">create an account</a> and a private network to test on, but it is not strictly necessary if you’re comfortable joining public networks or setting up your own network controller.</p>
</blockquote>
<h3 id="Usage-summary"><a href="#Usage-summary" class="headerlink" title="Usage summary"></a>Usage summary</h3><p><em>C/C++</em>: </p>
<pre><code class="lang-C">#include &lt;ZeroTierSockets.h&gt;

// ...
zts_node_start();
zts_net_join(0x1234567890abcdef);
// ...
int s = zts_socket(ZTS_AF_INET, ZTS_SOCK_STREAM, 0);
zts_connect(s, in4, adddrlen);
// ...
zts_node_stop();
</code></pre>
<p><em>Rust</em>: </p>
<pre><code class="lang-rust">use libzt;
use libzt::tcp::&#123;TcpListener, TcpStream&#125;;
// ...
let node = libzt::node::ZeroTierNode &#123;&#125;;
node.start();
node.net_join(net_id);
// ...
TcpStream::connect(remote_addr);
// ...
node.stop();
</code></pre>
<p><em>Python</em>: </p>
<pre><code class="lang-python">import libzt

# ...
node = libzt.ZeroTierNode()
node.node_start()
# ...
node.net_join(0x1234567890abcdef)
# ...
client = libzt.socket(libzt.ZTS_AF_INET, libzt.ZTS_SOCK_STREAM, 0)
client.connect((remote_ip, remote_port))
</code></pre>
<p><em>C#</em>: </p>
<pre><code class="lang-C#">using ZeroTier;
// ...
ZeroTier.Core.Node node = new ZeroTier.Core.Node();
node.Start();
// ...
node.Join(0x1234567890abcdef);
// ...
ZeroTier.Sockets.Socket sender = new ZeroTier.Sockets.Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
sender.Connect(remoteServerEndPoint);
// ...
node.Stop();
</code></pre>
<p><em>Java</em>: </p>
<pre><code class="lang-java">import com.zerotier.sockets.*;

// ...
ZeroTierNode node = new ZeroTierNode();
node.start();
// ...
node.join(0x1234567890abcdef);
// ...
ZeroTierSocket socket = new ZeroTierSocket(remoteAddr, port);
</code></pre>
<h3 id="Pingable-Node-Part1"><a href="#Pingable-Node-Part1" class="headerlink" title="Pingable Node (Part1)"></a>Pingable Node (Part1)</h3><p>To start things off we will:</p>
<ul>
<li>Set up a node</li>
<li>Join it to your network</li>
<li>Assign it a globally-available static IPv4 and/or IPv6 address</li>
<li>Ping it</li>
</ul>
<p>We’ll be skipping over a lot of details in this first example, but we’ll cover those in the <a href="https://docs.zerotier.com/sockets#client-and-server-part-2">next example</a>. It’s also worth noting that in this first example we will be using the sequential API for simplicity but there is an <a href="https://docs.zerotier.com/sockets#events">event</a> notification system that can be used as well.</p>
<h4 id="Starting-a-node"><a href="#Starting-a-node" class="headerlink" title="Starting a node"></a>Starting a node</h4><p>Starting a node is easy and if you don’t provide a configuration ZeroTier will generate a new identity automatically, but don’t worry about that yet:<br><em>C/C++</em>:</p>
<pre><code class="lang-c">// No &quot;node object&quot; creation necessary in C
zts_node_start();
</code></pre>
<p><em>Rust</em>:</p>
<pre><code class="lang-rust">let node = libzt::node::ZeroTierNode &#123;&#125;;
node.start();
</code></pre>
<p><em>Python</em>:</p>
<pre><code class="lang-python">node = libzt.ZeroTierNode()
node.start()
</code></pre>
<p><em>C#</em>:</p>
<pre><code class="lang-c#">ZeroTier.Core.Node node = new ZeroTier.Core.Node();
node.Start();
</code></pre>
<p><em>Java</em>:</p>
<pre><code class="lang-java">ZeroTierNode node = new ZeroTierNode();
node.start();
</code></pre>
<p>Before we can join any networks or use sockets we need to know when the node has successfully come online. We will use a rather crude wait loop but as mentioned before, there are <a href="https://docs.zerotier.com/sockets#events">event</a>-based methods for accomplishing this that we will discuss later:<br><em>C/C++</em>:</p>
<pre><code class="lang-c">while (! zts_node_is_online()) &#123;
  zts_util_delay(1000);
&#125;
</code></pre>
<p><em>Rust</em>:</p>
<pre><code class="lang-rust">while !node.is_online() &#123;
    node.delay(1000);
&#125;
</code></pre>
<p><em>Python</em>:</p>
<pre><code class="lang-python">while not node.is_online():
  time.sleep(1)
</code></pre>
<p><em>C#</em>:</p>
<pre><code class="lang-c#">while (! node.Online) &#123;
  Thread.Sleep(1000);
&#125;
</code></pre>
<p><em>Java</em>:</p>
<pre><code class="lang-java">while (! node.isOnline()) &#123;
  ZeroTierNative.zts_util_delay(1000);
&#125;
</code></pre>
<p>Once we’ve broken from this loop we can be confident that the node has a valid identity and has made contact with at least one root server. At this point let’s print our node’s identity. This is the <code>public short form</code> of your identity that you can share with people, we will discuss how to get the <code>secret</code> portion later on:<br><em>C/C++</em>: <code>printf(&quot;%llx\n&quot;, (long long int)zts_node_get_id());</code><br><em>Rust</em>: <code>println!(&quot;&#123;:#06x&#125;&quot;, node.id());</code><br><em>Python</em>: <code>print(node.get_id())</code><br><em>C#</em>: <code>Console.WriteLine(node.Id.ToString(&quot;x16&quot;));</code><br><em>Java</em>: <code>System.out.println(Long.toHexString(node.getId()));</code></p>
<h4 id="Join-a-network"><a href="#Join-a-network" class="headerlink" title="Join a network"></a>Join a network</h4><p>Now we’re ready to join a network:<br><em>C/C++</em>: <code>zts_net_join(0x1234567890abcdef);</code><br><em>Rust</em>: <code>node.net_join(0x1234567890abcdef);</code><br><em>Python</em>: <code>node.net_join(0x1234567890abcdef)</code><br><em>C#</em>: <code>node.Join(0x1234567890abcdef);</code><br><em>Java</em>: <code>node.join(0x1234567890abcdef);</code><br>The network join request will contact our network controllers (or yours!) and if the network is <code>public</code> your node will be allowed to join immediately. If however the network is <code>private</code> the node will not be allowed to join until the network owner authorizes the node.<br>A node is not assigned an IP address until it has successfully joined the network. This process usually takes a few seconds, thus your application must wait until the network config is received and it has been assigned an address:<br><em>C/C++</em>:</p>
<pre><code class="lang-c">while (! zts_net_transport_is_ready(net_id)) &#123;
  zts_util_delay(1000);
&#125;
</code></pre>
<p><em>Rust</em>:</p>
<pre><code class="lang-rust">while !node.net_transport_is_ready(net_id) &#123;
    node.delay(1000);
&#125;
</code></pre>
<p><em>Python</em>:</p>
<pre><code class="lang-python">while not node.net_transport_is_ready(net_id):
  time.sleep(1)
</code></pre>
<p><em>C#</em>:</p>
<pre><code class="lang-c#">while (! node.IsNetworkTransportReady(networkId)) &#123;
  Thread.Sleep(1000);
&#125;
</code></pre>
<p><em>Java</em>:</p>
<pre><code class="lang-java">while (! node.isNetworkTransportReady(networkId)) &#123;
  ZeroTierNative.zts_util_delay(1000);
&#125;
</code></pre>
<p>The transport readiness check above essentially just makes sure we have been authorized on the network and that we also have an assigned address and a managed route.</p>
<h4 id="Getting-your-IP-address"><a href="#Getting-your-IP-address" class="headerlink" title="Getting your IP address"></a>Getting your IP address</h4><blockquote>
<p><strong>NOTE</strong><br>Currently, only one address of each family type may be assigned (per network) to a libzt node at any time. That means one IPv4 and one IPv6 address. This is a technical limitation that will be removed in future versions.</p>
</blockquote>
<p><em>C/C++</em>:</p>
<pre><code class="lang-c">char ipstr[ZTS_IP_MAX_STR_LEN] = &#123; 0 &#125;;
zts_addr_get_str(net_id, ZTS_AF_INET, ipstr, ZTS_IP_MAX_STR_LEN);
printf(&quot;%s\n&quot;, ipstr);
</code></pre>
<p><em>Rust</em>:</p>
<pre><code class="lang-rust">let addr = node.addr_get(net_id).unwrap();
println!(&quot;&#123;&#125;&quot;, addr);
</code></pre>
<p><em>Python</em>:</p>
<pre><code class="lang-python">print(node.addr_get_ipv4(net_id))
print(node.addr_get_ipv6(net_id))
</code></pre>
<p><em>C#</em>:</p>
<pre><code class="lang-c#">foreach (IPAddress addr in node.GetNetworkAddresses(networkId)) &#123;
  Console.WriteLine(addr);
&#125;
</code></pre>
<p><em>Java</em>:</p>
<pre><code class="lang-java">System.out.println(node.getIPv4Address(networkId).getHostAddress());
System.out.println(node.getIPv6Address(networkId).getHostAddress());
</code></pre>
<p>From another machine (or the same machine, whatever you’re into), use our regular client <a href="https://www.zerotier.com/download/">zerotier-one</a> (or another libzt instance) to join the same network and ping the address displayed by your new node above. You should see some jittery initial responses as our transport-triggered link is established and then once a VL2 P2P link is established the response time will stabilize.<br>🎉 Congratulations you’ve just done something cool, I guess. Ready for something with sockets?<br>Oh crap, I forgot. We need to stop the node when we’re done:<br><em>C/C++</em>: <code>zts_node_stop();</code><br><em>Rust</em>: <code>node.stop();</code><br><em>Python</em>: <code>node.stop()</code><br><em>C#</em>: <code>node.Stop()</code><br><em>Java</em>: <code>node.stop()</code><br>Full example source code can be found here: <a href="https://github.com/zerotier/libzt/tree/main/examples">libzt/examples</a></p>
<h3 id="Sockets"><a href="#Sockets" class="headerlink" title="Sockets"></a>Sockets</h3><blockquote>
<p><strong>TIP</strong><br>If you’re new to socket programming I highly recommend at least perusing <a href="https://beej.us/guide/bgnet/">Beej’s Guide to Network Programming</a>. This is the best reference material you’ll find on the subject. It greatly helped in my own personal understanding. A portion of our C API is merely redirected calls to <a href="https://savannah.nongnu.org/projects/lwip/">lwIP’s C API</a> and is thus directly compatible with what you’ll learn in his guide.</p>
</blockquote>
<p>Before we move onto the next section we need to quickly discuss how the socket API is structured. For each supported language ZeroTier provides a socket interface that attempts to be as idiomatic as possible. If you are using one of these non-C bindings the following text about the <code>C API</code> may not apply to you, but it’s still good to know. <a href="https://docs.zerotier.com/sockets#client-and-server-part-2">I don’t care about this</a><br>ZeroTier sockets can be controlled via <code>zts_bsd_</code> functions that operate nearly identically to normal BSD-style sockets, and <code>zts_</code> functions that provide simplified arguments and reduce the need to use things like <code>struct sockaddr</code>. These functions can be used on the same socket interchangeably without issue.<br>For instance:</p>
<ul>
<li><code>zts_bsd_connect()</code> will behave in the same way as an ordinary <code>connect()</code> call (but over ZeroTier of course)</li>
<li><code>zts_connect()</code> will perform a little magic behind the scenes to deal with transport-triggered link provisioning. (i.e. re-attempting for you)</li>
<li><code>zts_tcp_client()</code> will wrap all of the common socket calls (including a <code>zts_connect()</code>) into a single call.</li>
</ul>
<p>You are allowed to use each type of call and mix their usage among sockets as you please, as long as what you’re doing makes sense at the protocol level. For instance the following is legal:</p>
<pre><code class="lang-c">int sock = zts_bsd_socket(ZTS_AF_INET, ZTS_SOCK_STREAM, 0);
zts_connect(sock, addr, addrlen);
zts_bsd_write(sock, buf, buflen);
</code></pre>
<h3 id="Client-and-Server-Part2"><a href="#Client-and-Server-Part2" class="headerlink" title="Client and Server (Part2)"></a>Client and Server (Part2)</h3><p>In this section we will:</p>
<ul>
<li>Use most of the same setup code as the <a href="https://docs.zerotier.com/sockets#pingable-node-part-1">Pingable Node</a> example</li>
<li>Set up a TCP server and client</li>
<li>Send a short message between the two</li>
</ul>
<p>To see full source code of the following with proper error and exception handling, see <a href="https://github.com/zerotier/libzt/tree/main/examples">libzt/examples</a> and <a href="https://github.com/zerotier/libzt/tree/main/test">libzt/test</a>.<br>Let’s start our node:<br><em>C/C++</em>:</p>
<pre><code class="lang-c">zts_init_from_storage(storage_path);

zts_node_start();

while (! zts_node_is_online()) &#123;
  zts_util_delay(1000);
&#125;

printf(&quot;Node ID: %llx\n&quot;, zts_node_get_id());

zts_net_join(net_id);

while (! zts_net_transport_is_ready(net_id)) &#123;
  zts_util_delay(1000);
&#125;

char ipstr[ZTS_IP_MAX_STR_LEN] = &#123; 0 &#125;;
zts_addr_get_str(net_id, family, ipstr, ZTS_IP_MAX_STR_LEN);
printf(&quot;IP address: %s\n&quot;, net_id, ipstr);
</code></pre>
<p><em>Rust</em>:</p>
<pre><code class="lang-rust">let node = libzt::node::ZeroTierNode &#123;&#125;;
node.init_from_storage(&amp;storage_path);

node.start();

while !node.is_online() &#123;
    node.delay(1000);
&#125;

println!(&quot;Node ID = &#123;:#06x&#125;&quot;, node.id());

node.net_join(net_id);

while !node.net_transport_is_ready(net_id) &#123;
    node.delay(1000);
&#125;
let addr = node.addr_get(net_id).unwrap();
println!(&quot;IP address: &#123;&#125;&quot;, addr);
</code></pre>
<p><em>Python</em>:</p>
<pre><code class="lang-python">node = libzt.ZeroTierNode()
node.init_from_storage(storage_path)

node.node_start()

while not node.node_is_online():
  time.sleep(1)

print(&quot;Node ID:&quot;, node.node_id())

node.net_join(net_id)

while not node.net_transport_is_ready(net_id):
  time.sleep(1)

print(&quot;IP address: &quot;, node.addr_get_ipv4(net_id))
</code></pre>
<p><em>C#</em>:</p>
<pre><code class="lang-c#">node = new ZeroTier.Core.Node();
node.InitFromStorage(configFilePath);

node.Start();

while (! node.Online) &#123;
  Thread.Sleep(1000);
&#125;

Console.WriteLine(&quot;Node ID:&quot; + node.Id)

node.Join(networkId);

while (! node.IsNetworkTransportReady(networkId)) &#123;
  Thread.Sleep(1000);
&#125;

foreach (IPAddress addr in node.GetNetworkAddresses(networkId)) &#123;
  Console.WriteLine(&quot;IP address: &quot; + addr);
&#125;
</code></pre>
<p><em>Java</em>:</p>
<pre><code class="lang-java">ZeroTierNode node = new ZeroTierNode();
node.initFromStorage(storagePath);

node.start();

while (! node.isOnline()) &#123;
  ZeroTierNative.zts_util_delay(1000);
&#125;

System.out.println(&quot;Node ID: &quot; + Long.toHexString(node.getId()));

node.join(networkId);

while (! node.isNetworkTransportReady(networkId)) &#123;
  ZeroTierNative.zts_util_delay(1000);
&#125;

System.out.println(&quot;IP address: &quot; + node.getIPv4Address(networkId).getHostAddress());
</code></pre>
<p>Notice that in the above code we use a new type of initialization function. In this case we are using a location on storage to retrieve and store our identities. We do this since we don’t want to generate a unique identity for each application run. It’s computationally-expensive and wasteful, think of the tardigrades.</p>
<h4 id="TCP-Server"><a href="#TCP-Server" class="headerlink" title="TCP Server"></a>TCP Server</h4><p>Below is a simple blocking server that will open a listening socket, wait for a message and print what it receives. To see full source code of the following with proper error and exception handling, see <a href="https://github.com/zerotier/libzt/tree/main/examples">libzt/examples</a> and<a href="https://github.com/zerotier/libzt/tree/main/test">libzt/test</a>.<br><em>C/C++</em>:</p>
<pre><code class="lang-c">char remote_addr[ZTS_INET6_ADDRSTRLEN] = &#123; 0 &#125;;
int remote_port = 0;
int len = ZTS_INET6_ADDRSTRLEN;

// Set up listen socket
// Note: We could also use standard zts_bsd_socket, zts_bsd_bind, etc
int fd = zts_tcp_server(local_addr, 8000, remote_addr, len, &amp;remote_port)
printf(&quot;Accepted connection from %s:%d\n&quot;, remote_addr, remote_port);

// RX
char recvBuf[128] = &#123; 0 &#125;;
zts_read(fd, recvBuf, sizeof(recvBuf));
printf(&quot;RX: %s\n&quot;, recvBuf);

// Cleanup
zts_close(fd);
zts_node_stop();
</code></pre>
<p><em>Rust</em>:</p>
<pre><code class="lang-rust">// Set up listen socket
let listener = TcpListener::bind(&quot;0.0.0.0:8000&quot;).unwrap();
for stream in listener.incoming() &#123;
    match stream &#123;
        Ok(stream) =&gt; &#123;
            println!(&quot;Accepted connection from: &#123;&#125;&quot;, stream.peer_addr().unwrap());
            thread::spawn(move || &#123;
                handle_client(stream)
            &#125;);
        &#125;
        Err(e) =&gt; &#123;
            println!(&quot;Error: &#123;&#125;&quot;, e);
        &#125;
    &#125;
&#125;
drop(listener);
</code></pre>
<p><em>Python</em>:</p>
<pre><code class="lang-python"># Set up listen socket
serv = libzt.socket(libzt.ZTS_AF_INET, libzt.ZTS_SOCK_STREAM, 0)
serv.bind((&quot;0.0.0.0&quot;, 8000))
serv.listen(1)
conn, addr = serv.accept()
print(&quot;Accepted connection from: &quot;, addr)

# RX
data = conn.recv(128)
print(&quot;RX: &quot;, data)

# Cleanup
conn.close()
node.node_stop()
</code></pre>
<p><em>C#</em>:</p>
<pre><code class="lang-c#">// Set up listen socket
ZeroTier.Sockets.Socket listener =
  new ZeroTier.Sockets.Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
listener.Bind(localEndPoint);
listener.Listen(1);
ZeroTier.Sockets.Socket handler;
handler = listener.Accept();
Console.WriteLine(&quot;Accepted connection from: &quot; + handler.RemoteEndPoint.ToString());

// RX
string data = null;
byte[] bytes = new Byte[128];
int bytesReceived = handler.Receive(bytes);
data = Encoding.ASCII.GetString(bytes, 0, bytesReceived);
Console.WriteLine(&quot;RX: &quot; + data);

// Cleanup
handler.Shutdown(SocketShutdown.Both);
handler.Close();
node.Stop();
</code></pre>
<p><em>Java</em>:</p>
<pre><code class="lang-java">// Set up listen socket
ZeroTierServerSocket listener = new ZeroTierServerSocket(port);
ZeroTierSocket conn = listener.accept();
ZeroTierInputStream inputStream = conn.getInputStream();
DataInputStream dataInputStream = new DataInputStream(inputStream);

// RX
String message = dataInputStream.readUTF();
System.out.println(&quot;RX: &quot; + message);

// Cleanup
listener.close();
conn.close();
node.stop();
</code></pre>
<h4 id="TCP-Client"><a href="#TCP-Client" class="headerlink" title="TCP Client"></a>TCP Client</h4><p>Below is a simple client that will connect to a remote host and send a message. To see full source code of the following with proper error and exception handling, see <a href="https://github.com/zerotier/libzt/tree/main/examples">libzt/examples</a> and <a href="https://github.com/zerotier/libzt/tree/main/test">libzt/test</a>.<br><em>C/C++</em>:</p>
<pre><code class="lang-c">char* msgStr = (char*)&quot;Hello, network!&quot;;
int bytes = 0, fd;

// Set up connection socket
// Note: We could also use standard zts_bsd_socket, zts_bsd_connect, etc
fd = zts_tcp_client(remote_addr, remote_port);

// TX
zts_write(fd, msgStr, strlen(msgStr))

// Cleanup
zts_close(fd);
zts_node_stop();
</code></pre>
<p><em>Rust</em>:</p>
<pre><code class="lang-rust">// Set up connection socket
match TcpStream::connect(remote_addr) &#123;
    Ok(mut stream) =&gt; &#123;
        // TX
        let msg = b&quot;Hello, network!&quot;;
        stream.write(msg).unwrap();
    &#125;
    Err(e) =&gt; &#123;
        // Failed to connect
    &#125;
&#125;
</code></pre>
<p><em>Python</em>:</p>
<pre><code class="lang-python"># Set up connection socket
client = libzt.socket(libzt.ZTS_AF_INET, libzt.ZTS_SOCK_STREAM, 0)
client.connect((remote_ip, remote_port))

# TX
data = &quot;Hello, network!&quot;
client.send(data.encode(&quot;utf-8&quot;))

# Cleanup
client.close()
node.node_stop()
</code></pre>
<p><em>C#</em>:</p>
<pre><code class="lang-c#">// Set up connection socket
byte[] bytes = new byte[128];
ZeroTier.Sockets.Socket sender =
  new ZeroTier.Sockets.Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
sender.Connect(remoteServerEndPoint);

// TX
byte[] msg = Encoding.ASCII.GetBytes(&quot;Hello, network!&quot;);
int bytesSent = sender.Send(msg);

// Cleanup
sender.Shutdown(SocketShutdown.Both);
sender.Close();
node.Stop();
</code></pre>
<p><em>Java</em>:</p>
<pre><code class="lang-java">// Set up connection socket
ZeroTierSocket socket = new ZeroTierSocket(remoteAddr, port);
ZeroTierOutputStream outputStream = socket.getOutputStream();
DataOutputStream dataOutputStream = new DataOutputStream(outputStream);

// TX
dataOutputStream.writeUTF(&quot;Hello, network!&quot;);

// Cleanup
socket.close();
node.stop();
</code></pre>
<h1 id="OS-Platform-Notes"><a href="#OS-Platform-Notes" class="headerlink" title="OS / Platform Notes"></a>OS / Platform Notes</h1><h2 id="Linux-5"><a href="#Linux-5" class="headerlink" title="Linux"></a>Linux</h2><h3 id="Linux-FAQ"><a href="#Linux-FAQ" class="headerlink" title="Linux FAQ"></a>Linux FAQ</h3><h3 id="Snap-Package"><a href="#Snap-Package" class="headerlink" title="Snap Package"></a>Snap Package</h3><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><h3 id="Layer-2-Bridge-1"><a href="#Layer-2-Bridge-1" class="headerlink" title="Layer 2 Bridge"></a>Layer 2 Bridge</h3><h3 id="Amazon-VPC-Gateway"><a href="#Amazon-VPC-Gateway" class="headerlink" title="Amazon VPC Gateway"></a>Amazon VPC Gateway</h3><h3 id="NAT-1"><a href="#NAT-1" class="headerlink" title="NAT"></a>NAT</h3><h3 id="6PLANE-with-Docker"><a href="#6PLANE-with-Docker" class="headerlink" title="6PLANE with Docker"></a>6PLANE with Docker</h3><h3 id="code-server-ZeroTier-1"><a href="#code-server-ZeroTier-1" class="headerlink" title="code-server + ZeroTier"></a>code-server + ZeroTier</h3><h3 id="cloud-init-1"><a href="#cloud-init-1" class="headerlink" title="cloud-init"></a>cloud-init</h3><h3 id="Route-between-ZeroTier-and-Physical-Networks-1"><a href="#Route-between-ZeroTier-and-Physical-Networks-1" class="headerlink" title="Route between ZeroTier and Physical Networks"></a>Route between ZeroTier and Physical Networks</h3><h2 id="macOS-5"><a href="#macOS-5" class="headerlink" title="macOS"></a>macOS</h2><h3 id="macOS-FAQ"><a href="#macOS-FAQ" class="headerlink" title="macOS FAQ"></a>macOS FAQ</h3><h2 id="Windows-3"><a href="#Windows-3" class="headerlink" title="Windows"></a>Windows</h2><h3 id="Windows-FAQ"><a href="#Windows-FAQ" class="headerlink" title="Windows FAQ"></a>Windows FAQ</h3><h3 id="Chocolatey"><a href="#Chocolatey" class="headerlink" title="Chocolatey"></a>Chocolatey</h3><h3 id="WinGet"><a href="#WinGet" class="headerlink" title="WinGet"></a>WinGet</h3><h3 id="LAN-Game-Announcements"><a href="#LAN-Game-Announcements" class="headerlink" title="LAN Game Announcements"></a>LAN Game Announcements</h3><h3 id="Unknown-Node-ID"><a href="#Unknown-Node-ID" class="headerlink" title="Unknown Node ID"></a>Unknown Node ID</h3><h2 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h2><h3 id="Android-FAQ"><a href="#Android-FAQ" class="headerlink" title="Android FAQ"></a>Android FAQ</h3><h2 id="iOS-iPadOS"><a href="#iOS-iPadOS" class="headerlink" title="iOS / iPadOS"></a>iOS / iPadOS</h2><h3 id="iOS-or-iPadOS-FAQ"><a href="#iOS-or-iPadOS-FAQ" class="headerlink" title="iOS or iPadOS FAQ"></a>iOS or iPadOS FAQ</h3><h2 id="Routers"><a href="#Routers" class="headerlink" title="Routers"></a>Routers</h2><h3 id="Router-Config-Tips"><a href="#Router-Config-Tips" class="headerlink" title="Router Config Tips"></a>Router Config Tips</h3><h3 id="Corporate-Firewalls"><a href="#Corporate-Firewalls" class="headerlink" title="Corporate Firewalls"></a>Corporate Firewalls</h3><h3 id="Teltonika-Networks"><a href="#Teltonika-Networks" class="headerlink" title="Teltonika Networks"></a>Teltonika Networks</h3><h3 id="Mikro-Tik"><a href="#Mikro-Tik" class="headerlink" title="Mikro Tik"></a>Mikro Tik</h3><h3 id="OpenWRT"><a href="#OpenWRT" class="headerlink" title="OpenWRT"></a>OpenWRT</h3><h3 id="OPNsense"><a href="#OPNsense" class="headerlink" title="OPNsense"></a>OPNsense</h3><h3 id="Ubiquiti"><a href="#Ubiquiti" class="headerlink" title="Ubiquiti"></a>Ubiquiti</h3><h3 id="Route-between-ZeroTier-and-Physical-Networks-2"><a href="#Route-between-ZeroTier-and-Physical-Networks-2" class="headerlink" title="Route between ZeroTier and Physical Networks"></a>Route between ZeroTier and Physical Networks</h3><h2 id="NAS"><a href="#NAS" class="headerlink" title="NAS"></a>NAS</h2><h3 id="FreeNAS"><a href="#FreeNAS" class="headerlink" title="FreeNAS"></a>FreeNAS</h3><h3 id="ASUSTOR"><a href="#ASUSTOR" class="headerlink" title="ASUSTOR"></a>ASUSTOR</h3><h3 id="QNAP"><a href="#QNAP" class="headerlink" title="QNAP"></a>QNAP</h3><h3 id="Synology"><a href="#Synology" class="headerlink" title="Synology"></a>Synology</h3><h3 id="Western-Digital"><a href="#Western-Digital" class="headerlink" title="Western Digital"></a>Western Digital</h3><h2 id="IoT"><a href="#IoT" class="headerlink" title="IoT"></a>IoT</h2><h3 id="Low-Bandwidth-Mode"><a href="#Low-Bandwidth-Mode" class="headerlink" title="Low Bandwidth Mode"></a>Low Bandwidth Mode</h3><h3 id="OS-and-Device-Compatibility"><a href="#OS-and-Device-Compatibility" class="headerlink" title="OS and Device Compatibility"></a>OS and Device Compatibility</h3><h3 id="Layer-2-Bridge-2"><a href="#Layer-2-Bridge-2" class="headerlink" title="Layer 2 Bridge"></a>Layer 2 Bridge</h3><h3 id="Layer-5-Proxy-Pylon-1"><a href="#Layer-5-Proxy-Pylon-1" class="headerlink" title="Layer 5 Proxy (Pylon)"></a>Layer 5 Proxy (Pylon)</h3><h3 id="Security-1"><a href="#Security-1" class="headerlink" title="Security"></a>Security</h3><h3 id="Route-between-ZeroTier-and-Physical-Networks-3"><a href="#Route-between-ZeroTier-and-Physical-Networks-3" class="headerlink" title="Route between ZeroTier and Physical Networks"></a>Route between ZeroTier and Physical Networks</h3><h2 id="FreeBSD"><a href="#FreeBSD" class="headerlink" title="FreeBSD"></a>FreeBSD</h2><h3 id="FreeBSD-FAQ"><a href="#FreeBSD-FAQ" class="headerlink" title="FreeBSD FAQ"></a>FreeBSD FAQ</h3><h1 id="Service-Providers"><a href="#Service-Providers" class="headerlink" title="Service Providers"></a>Service Providers</h1><h2 id="Rules-FAQ"><a href="#Rules-FAQ" class="headerlink" title="Rules FAQ"></a>Rules FAQ</h2><h2 id="Security-2"><a href="#Security-2" class="headerlink" title="Security"></a>Security</h2><h2 id="SSO-OIDC-1"><a href="#SSO-OIDC-1" class="headerlink" title="SSO / OIDC"></a>SSO / OIDC</h2><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>Zerotier</tag>
      </tags>
  </entry>
  <entry>
    <title>如果你是一个普通的父母</title>
    <url>/2023/09/11/%E5%A6%82%E6%9E%9C%E4%BD%A0%E6%98%AF%E4%B8%80%E4%B8%AA%E6%99%AE%E9%80%9A%E7%9A%84%E7%88%B6%E6%AF%8D/</url>
    <content><![CDATA[<p>　　网上看到了一段话，非常治愈，非常鸡汤。大家都说是从人民日报看到的，但是我搜索了一圈也没看到哪一期的人民日报上刊登了这样的文字。文字是好文字就好，何必非要冠以噱头，互联网时代让信息变得巨量却碎片，周末在家辅导孩子功课时孩子非要在网络上搜索知识，经过好一通解释才说服孩子试着使用工具书来查阅资料。互联网给我们带来无穷便利的同时也在剥夺人类的自主能力，让人类的依赖性变得更强。正如“奶头乐”阴谋，资本利用了人类的劣根性让普通人为其辛劳一生却不自知。所以说无论什么主义社会，只要有统治阶级，就一定会想方设法的愚化群众。是不是又到了开启民智的时期？<br><span id="more"></span><br>　　话题扯了有点远，这篇分享的主要目的还是来分享这段治愈的文字：</p>
<blockquote>
<p>&emsp;&emsp;如果你是一个普通的父母，没有什么优秀的资源和太多的文化，不知道该怎么教育孩子，那我们就不如多鼓励他，多认可孩子，多表扬孩子，多理解和支持孩子，不要把自己的认知、焦虑、恐惧、愤怒和委屈转移给孩子，这就是对孩子最好的教育。<br>&emsp;&emsp;孩子若是平凡之辈，那就承欢膝下，若是出类拔萃，那就让他展翅高飞，接受孩子的平庸，就像孩子从来没要求父母一定要多么得好一样……记住了:<b><font color="orange">穷不怪父，孝不比兄，苦不责妻，气不凶子</font></b>，送给自己一起共勉。</p>
</blockquote>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>杂学</category>
        <category>社科教育等</category>
      </categories>
      <tags>
        <tag>育儿</tag>
      </tags>
  </entry>
  <entry>
    <title>古诗词欣赏—20231127</title>
    <url>/2023/11/27/%E5%8F%A4%E8%AF%97%E8%AF%8D%E6%AC%A3%E8%B5%8F%E2%80%9420231127/</url>
    <content><![CDATA[<ul>
<li><p>表达随遇而安：<br>时光清浅处，一步一安然。</p>
</li>
<li><p>表达岁月静好：<br>山野万万里，余生路漫。日暮酒杯淡饭，一半一半</p>
</li>
<li><p>夸心上人美好：<br>山有扶苏，隰（xí）有荷华。</p>
</li>
<li><p>想说坚韧不拔：<br>冬青树上挂凌霄，岁晏花凋树不凋。</p>
</li>
<li><p>对于好朋友：<br>半师半友半知己，半慕半尊半倾心。</p>
</li>
<li><p>乐观面对上火：<br>时间煮雨，岁月缝花。以欢喜心，慢度日常。</p>
</li>
<li><p>琐碎诗意交织：<br>手执烟火以谋生，心怀诗意以谋爱。</p>
</li>
<li><p>表达对另一半的爱意：<br>日出有盼，日落有念。心有所期，忙而不茫。</p>
<span id="more"></span>
</li>
<li><p>古人对万物的雅称：</p>
<ul>
<li>太阳：扶光</li>
<li>月亮：望舒</li>
<li>梅花：疏影</li>
<li>风筝：纸鸢</li>
<li>圆月：冰轮</li>
<li>茄子：落苏</li>
<li>小草：柔甲</li>
<li>天河：星汉</li>
<li>天空：碧落</li>
<li>大地：坤灵</li>
<li>雪花：寒酥</li>
<li>风　：扶摇</li>
<li>云　：纤凝</li>
<li>雨　：灵泽</li>
<li>茶　：不夜侯</li>
<li>酒　：忘忧君</li>
</ul>
</li>
<li><p>你更喜欢谁的相思</p>
<ul>
<li>纳兰性德：人生若只如初见，何事秋风悲画扇。</li>
<li>　李清照：花自飘零水自流，一种相思，两处闲愁。</li>
<li>　白居易：群埋泉下泥销骨，我寄人间雪满头。</li>
<li>　辛弃疾：若教眼底无离恨，不信人间有白头。</li>
<li>　温庭筠：玲珑骰子安红豆，入骨相思知不知。</li>
<li>　李商隐：直道相思了无益，未妨惆怅是清狂。</li>
<li>　王国维：最是人间留不住，朱颜辞镜花辞树。</li>
<li>　欧阳修：泪眼问花花不语，乱红飞过秋千去。</li>
<li>　卓文君：愿得一心人，自首不相离。</li>
<li>　唐　寅：晓看天色暮看云，行也思君，坐也思君。</li>
<li>　元　稹：曾经沧海难为水，除却巫山不是云。</li>
<li>　李　白：相思相见知何日，此时此夜难为情。</li>
<li>　李　煜：春花秋月何时了？往事知多少。</li>
<li>　柳　永：衣带渐宽终不悔，为伊消得人憔悴。</li>
<li>　苏　轼：十年生死两茫茫，不思量，自难忘。</li>
</ul>
</li>
<li><p>古诗词中的表白：</p>
<ul>
<li>三生清风三里路，步步春风再无你。（我终于失去你了）</li>
<li>我与春风皆过客，你携秋水揽星河。（我不喜欢你了）</li>
<li>既许一人以偏爱，愿尽余生之慷慨。（我这一生都会对你好，爱你）</li>
<li>半身风雨半身伤，半句别恨半句凉。（真的很难过）</li>
<li>无人与我立黄昏，无人问我粥可温。（孤单一人）</li>
<li>从此音尘各悄然，春山如黛草如烟。（以后各奔东西，不必联系）</li>
<li>苍天不解人情暖，冷眼看花尽是悲。（没人能够读懂我）</li>
<li>从此烟雨落金城，一人撑伞两人行。（我们在一起了）</li>
</ul>
</li>
<li><p>古人拒绝表白：</p>
<ul>
<li>一身清贫怎敢入繁华，两袖清风怎敢误佳人。（我配不上你）</li>
<li>枝上柳绵吹又少，天涯何处无芳草。（你追谁都行，别追我）</li>
<li>感郎千金意，惭无倾城色。（你很好，是我配不上你）</li>
<li>子非我良人，亦非我最新。（你不是我喜欢的类型）</li>
<li>心似流水不倦花，我如明月君勿恋。（你不要爱上我）</li>
<li>万水千山都是情，冥冥之中靠天定。（我们之间不合适）</li>
<li>落花有意随流水，流水无心恋落花。（你喜欢我，但我不喜欢你）</li>
<li>都兰之猗猎扬扬其香，不采而佩于兰何伤。（你是个好人，我不想伤害你）</li>
</ul>
</li>
<li><p>用古文表达失恋：</p>
<ul>
<li>【青铜】一别两宽，各自欢喜。</li>
<li>【白银】你有你的清欢渡，我有我的不归路。</li>
<li>【黄金】从此山水不相逢，莫道彼此长和短。</li>
<li>【钻石】柳絮随风各西东，物是人非事事休。</li>
<li>【王者】山河岁月空惆怅，今生今世已惘然。</li>
</ul>
</li>
</ul>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>文学爱好</category>
        <category>诗歌</category>
      </categories>
  </entry>
  <entry>
    <title>小米Note刷机过程记录</title>
    <url>/2024/03/04/%E5%B0%8F%E7%B1%B3Note%E5%88%B7%E6%9C%BA%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h2 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h2><p>查了一下订单，2015年5月回国的时候给爸爸和我买了两台小米Note，应该用了没有多久就出问题了一直闲置在家。上网查了一下回收价只有2元，所以就像改造一下看能不能当个简单的服务器来使用。</p>
<h2 id="2-准备"><a href="#2-准备" class="headerlink" title="2. 准备"></a>2. 准备</h2><h3 id="2-1-小米手机助手"><a href="#2-1-小米手机助手" class="headerlink" title="2.1 小米手机助手"></a>2.1 小米手机助手</h3><p>近些年一直都没有关注小米，上网一查发现小米官网已经不开放手机助手的下载了，在网上找到这么一个网页:<a href="https://miuiver.com/mi-phone-assistant/">MiPhoneAssistant 小米手机助手下载合集</a>。<br>留个底:<br>由于小米助手官方已经很久没更新了，最近一次更新是 2021-10-28，所以强烈不建议在这之后发布的手机和 MIUI 版本上使用，大概率会有适配兼容问题，备份恢复功能很可能不能按预期工作，它只适合在老机型和 MIUI 老版本上使用！</p>
<p>下面是小米助手官方下载地址，版本由新到旧排列，可按个人喜好或需要选择。<br><a href="https://miuirom.xiaomi.com/rom/u1106245679/4.2.1028.10/MiAssistant-4.2.1028.10.zip">https://miuirom.xiaomi.com/rom/u1106245679/4.2.1028.10/MiAssistant-4.2.1028.10.zip</a><br><a href="https://miuirom.xiaomi.com/rom/u1106245679/3.2.522.32/MiAssistant-3.2.522.32.zip">https://miuirom.xiaomi.com/rom/u1106245679/3.2.522.32/MiAssistant-3.2.522.32.zip</a><br><a href="https://miuirom.xiaomi.com/rom/u491047765/2.3.0.4071/mipctoolexe-2.3.0.4071.exe">https://miuirom.xiaomi.com/rom/u491047765/2.3.0.4071/mipctoolexe-2.3.0.4071.exe</a><br><a href="https://miuirom.xiaomi.com/rom/u491047765/2.3.0.3101/mipctoolexe-2.3.0.3101.exe">https://miuirom.xiaomi.com/rom/u491047765/2.3.0.3101/mipctoolexe-2.3.0.3101.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.3.0.1031_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.3.0.1031_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.7241_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.7241_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.6261_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.6261_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.4091_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.4091_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.3171_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.3171_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.2131_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.2131_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.1301_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.2.0.1301_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.1.0.12251_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.1.0.12251_2717.exe</a><br><a href="https://bigota.d.miui.com/MiFlash/MiSetup2.1.0.11211_2717.exe">https://bigota.d.miui.com/MiFlash/MiSetup2.1.0.11211_2717.exe</a></p>
<p>文件 MD5 校验值如下。</p>
<pre><code>b9aaa49dd92a828179b4994b1eb82136  MiAssistant-3.2.522.32.zip
7bc76814006a340667dbe72669c66e1f  MiAssistant-4.2.1028.10.zip
b4ebf49b441a3f4997fc1ac4a82486a5  mipctoolexe-2.3.0.3101.exe
d274427550884f389c7e417a13bfd3c1  mipctoolexe-2.3.0.4071.exe
d4580a3adff0db692f7a0420b568499f  MiSetup2.1.0.11211_2717.exe
936fc4c41e247baf21528e13e26e577e  MiSetup2.1.0.12251_2717.exe
8251f9670237d91f22cc70fa8f910086  MiSetup2.2.0.1301_2717.exe
80a68985a0d063d32d7884d008a0a71e  MiSetup2.2.0.2131_2717.exe
98c7c5185ee0cd2f1940fcc8a0f95f99  MiSetup2.2.0.3171_2717.exe
e1073d32737075b51709c9a2b1c0cc99  MiSetup2.2.0.4091_2717.exe
aea5d32a8c4839fc35a2ed4fbb53e70f  MiSetup2.2.0.6261_2717.exe
62d3bd3427038a67ea8772972da1f82f  MiSetup2.2.0.7241_2717.exe
539cd92545f27978e2fe29aae527d4b2  MiSetup2.3.0.1031_2717.exe
</code></pre><p>尝试了一下上面下载地址的前4个还可以下载，但是后面的已经无法打开了，会提示<code>403 Forbidden</code>。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>设备及使用</category>
      </categories>
      <tags>
        <tag>小米</tag>
      </tags>
  </entry>
  <entry>
    <title>放大器的谐波失真(THD)</title>
    <url>/2023/08/21/%E6%94%BE%E5%A4%A7%E5%99%A8%E7%9A%84%E8%B0%90%E6%B3%A2%E5%A4%B1%E7%9C%9F-THD/</url>
    <content><![CDATA[<p>本文主要总结和收集关于放大器谐波失真的原因及改良方法。</p>
<h2 id="一、什么是谐波失真"><a href="#一、什么是谐波失真" class="headerlink" title="一、什么是谐波失真"></a>一、什么是谐波失真</h2><blockquote>
<p>THD是英文Total Harmonic Distortion的缩写，译成中文即为总谐波失真。</p>
</blockquote>
<h3 id="谐波失真是什么？"><a href="#谐波失真是什么？" class="headerlink" title="谐波失真是什么？"></a>谐波失真是什么？</h3><p>谐波失真的原因是电路电路的线性度不好。<br>理想线性电路的输入x和输出y可以使用一次方程表示：$y=ax+b$<br><span id="more"></span><br>如果输出和输入的关系偏离了上述方程的直线我们称之为线性度差。<br>下面是一个典型的线性度差的代表电路：Diode Clip电路。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821215601.png" alt="20230821215601"><br>根据二极管的顺方向I-V特性可知，在±0.6V之外被clip，就是说当输入电压在±0.6V之外时，电路显现非线性特性，如下图：<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821215939.png" alt="20230821215939"><br>如果将正弦波作为此电路的输入信号，输出信号变为在原信号基础上叠加了“不存在”的信号。其输入即输出入下式所示：<br>输入：$V_{in}=sinωt$<br>输出：$V_{out}=a_1sin(ωt+φ_1)+a_2sin(ωt+φ_2)+a_3sin(ωt+φ_3)+…$<br>输入输出的FFT(Fast Fourier Transform)结果如下图所示：<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821220543.png" alt="20230821220543"></p>
<h2 id="二、谐波失真的定量分析"><a href="#二、谐波失真的定量分析" class="headerlink" title="二、谐波失真的定量分析"></a>二、谐波失真的定量分析</h2><p>在进行谐波失真的定量分析时经常用到的指标为THD和THD+N。</p>
<blockquote>
<p>THD+N即Total Harmonic Distortion + Noise的缩写。</p>
</blockquote>
<p>通常我们所说的谐波失真都是叠加了输入信号的高次谐波。THD的定义即为在基波的高次谐波的平方和的平方根与基波的电压之比。<br>即：$V_{THD}=\frac{\sqrt{V_2^2+V_3^2+V_4^2+…+V_N^2}}{V_1}$<br>其中，$V_1$为基波电压成分，$V_2$、$V_3$、$V_4$···$V_N$为整数倍的谐波电压成分。<br>高次谐波成分+噪声，即THD+N就是在高次谐波中再加入噪声：<br>$V_{THD}=\frac{\sqrt{V_2^2+V_3^2+V_4^2+…+V_N^2+V_{Noise}^2}}{V_1}$</p>
<h2 id="三、通过反馈改善谐波失真"><a href="#三、通过反馈改善谐波失真" class="headerlink" title="三、通过反馈改善谐波失真"></a>三、通过反馈改善谐波失真</h2><p>改善THD方法中最一般的方法就是利用反馈，还是用上面的Diode Clip电路举例说明，在此电路中加入放大器及其反馈后电路结构如下：<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821222803.png" alt="20230821222803"></p>
<p><em>我们使用LTSpice中的理想放大器，设置其直流增益为100dB，带宽为10MHz。则1kHz的输入信号的增益为80dB。</em><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821223007.png" alt="20230821223007"></p>
<p>由于作为中间节点的放大器的输出可以对非线性进行抵消，所以整个电路的输入输出特性有了较大的改善。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821223242.png" alt="20230821223242"></p>
<p>使用1kHz的正弦波作为输入时可以看出只有少量的谐波成分的残留。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821223841.png" alt="20230821223841"></p>
<p>通过FFT结果可以看到奇数倍的高次谐波成分。$THD=3.2\%$<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821224015.png" alt="20230821224015"></p>
<h3 id="下面讨论如果进一步削减谐波失真应该怎么做"><a href="#下面讨论如果进一步削减谐波失真应该怎么做" class="headerlink" title="下面讨论如果进一步削减谐波失真应该怎么做"></a>下面讨论如果进一步削减谐波失真应该怎么做</h3><p>首先为了加强反馈网络我们可以保持放大器带宽的情况下将放大器的增益提高到120dB以上。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821224157.png" alt="20230821224157"></p>
<p>可以看到THD完全没有改善还是3.2%，原因是1kHz的反馈量没有变化。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821224254.png" alt="20230821224254"></p>
<p>然后尝试保持放大器的直流增益不变将带宽增加到100MHz。由于是单极点放大器，所以1kHz时的增益约上升10倍。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821224406.png" alt="20230821224406"></p>
<p>THD改善了0.35%，约上升了1/10。所以，<b><font color="red"> 改善AC的谐波失真需要重点关注带宽！！</font></b><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821224550.png" alt="20230821224550"></p>
<p>为确保放大器的稳定性，在高频阶段通常降低增益。也就是说在单位增益频率附近的信号无法使用反馈来改善THD。所以，一般来说高频信号的THD会比较差。</p>
<h2 id="四、输出端形成的开关谐波失真"><a href="#四、输出端形成的开关谐波失真" class="headerlink" title="四、输出端形成的开关谐波失真"></a>四、输出端形成的开关谐波失真</h2><p>经过妥当设计的放大器在规格范围内使用时，造成谐波失真的最多原因是输出端的谐波失真。<br>通过使用射极跟随器驱动负载电路的电路举例说明：<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821224912.png" alt="20230821224912"></p>
<p>射极跟随器通常对输入电压进行约1倍的放大输出(即，输出=输入)，但如果集电极的电流在接近0A附近工作时，线性度会发生恶化。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821225043.png" alt="20230821225043"></p>
<p>使用正弦波作为输入信号，在集电极电流为0(cut off)时输出波形出现严重失真。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821225153.png" alt="20230821225153"></p>
<p>现实中放大器则通常通过一个npn和一个pnp组成推挽式结构，在一侧无法正常工作时通过另一侧进行补偿。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821225302.png" alt="20230821225302"></p>
<p>即使使用合适的偏置在输入信号为0时两侧的三极管均不会发生cut off(Class AB)，在大振幅或大负载电流的情况下也会使一侧的三极管发生cut off，不可避免地导致THD指标恶化。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821225458.png" alt="20230821225458"></p>
<p>开关谐波失真在Class A结构中可以避免，但是会增加功耗及电路的复杂度。</p>
<h2 id="五、耗尽层电容引起的失真"><a href="#五、耗尽层电容引起的失真" class="headerlink" title="五、耗尽层电容引起的失真"></a>五、耗尽层电容引起的失真</h2><p>去除开关因素导致的失真之后，剩余的就是耗尽层电容为起因导致的失真。<br>由于耗尽层是绝缘的，所以在Si和耗尽层之间可以看做形成电容，这个电容称之为耗尽层电容。耗尽层的长度随两边的电压不同而变化，就是说随着两端电压的不同耗尽层电容值是发生变化的。可变容量二极管就是利用这一原理制作而成的。普通的小信号用PN结二极管以及晶体管的集电极和基电极之间的容值也会跟随两端电压而变化。<br>耗尽层电容导致的失真由以下电路模型展示。<br>虽然在直流区域有反馈，但是在100kHz时输出由G1的互导和Q1的寄生电容决定。<br>Q1以外均使用理想器件，Q1为共基级放大电路，所以输出波形仅会受到由集电极电位影响的非线性度影响而导致失真。Q1的集极-基级之间的反向偏置，所以在集电极上形成耗尽层电容$C_{ob}$经电源V2连接GND。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821230626.png" alt="20230821230626"></p>
<p>若集电极电压发生变化，则$C_{ob}$的容值发生变化，导致$C_{ob}$的充电电流释放至GND而造成了失真发生。THD为0.47%。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821230849.png" alt="20230821230849"></p>
<p>其对策为增加射极跟随器使$C_{ob}$的充电电流能够回流。通过Q2可以使Q1的集电极==&gt; $C_{ob}$==&gt; GND释放的电流进行回流而抵消$C_{ob}$造成的非线性。为使开环增益相同增加C3.<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821231335.png" alt="20230821231335"></p>
<p>此时，THD有了巨大的改善，变为0.0008%。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20230821231413.png" alt="20230821231413"></p>
<blockquote>
<p>参考文献：<br><em><font size=2>Douglas Self, Small Signal Audio Design, 2010, Focal Press</font></em><br><em><font size=2>黒田徹, 解析OPアンプ&amp;トランジスタ活用, 2002, CQ出版</font></em></p>
</blockquote>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>半导体专业</category>
        <category>模拟电路</category>
      </categories>
  </entry>
  <entry>
    <title>抽取寄生时屏蔽掉在spice model中已经存在的寄生电容</title>
    <url>/2023/12/03/%E6%8A%BD%E5%8F%96%E5%AF%84%E7%94%9F%E6%97%B6%E5%B1%8F%E8%94%BD%E6%8E%89%E5%9C%A8spice-model%E4%B8%AD%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E7%9A%84%E5%AF%84%E7%94%9F%E7%94%B5%E5%AE%B9/</url>
    <content><![CDATA[<p>在提取寄生参数时，除了需要关注金属导体的寄生电容外，还需要分析mos器件的节点寄生参数提取是否准确。<br>下面是一个典型的 nmos 4端器件:</p>
<p>该mos管的4个节点 D, G, S, B 的寄生电容是否准确呢？<br>首先用calibre xrc提取一下其寄生参数，结果如下:</p>
<pre><code>cc_1 S G 3.32511f
cc_2 S D 6.73464e-19
cc_3 S B 12.7622f
cc_4 G D 3.32511f
cc_5 G B 1.16212f
cc_6 D B 12.7506f
</code></pre><span id="more"></span>
<p>上述寄生电容分为4类:</p>
<ul>
<li>Gate 到 Source/Drain 电容</li>
<li>Source/Drain 到 Bulk 电容</li>
<li>Gate 到 Bulk 电容</li>
<li>Source 到 Drain 电容</li>
</ul>
<p>由于在spice model中一般会自动把上述4类电容考虑，如果寄生参数提取中再提取一遍，就会发生重复提取。<br>因此，需要把这4类电容屏蔽，屏蔽方法如下:</p>
<ul>
<li>屏蔽 Gate 到 Source/Drain 电容<pre><code>PEX IGNORE CAPACITANCE ALL poly nsd
PEX IGNORE CAPACITANCE ALL poly psd
</code></pre></li>
<li>屏蔽 Gate 到 Bulk 电容，其中 ALLGATE 是 mark layer<pre><code>PEX IGNORE CAPATANCE DEVICE INTRINSIC poly ALLGATE
</code></pre></li>
</ul>
<p>设置上述3个参数后，提取结果如下:</p>
<pre><code>cc_1 S D 0.00129446f
cc_2 S B 12.7622f
cc_3 G B 0.211916f
cc_4 D B 12.7506f
</code></pre><p>可以看到，Gate 到 Source/Drain 的电容没有了，被屏蔽掉了。Gate 到 Bulk 的电容比刚才的值小了，说明在mos管区域的电容被屏蔽了，只剩下 Gate 露头的电容了，这个符合预期。<br>但是，Source/Drain 到 Bulk 的电容没有屏蔽掉，该如何设置呢？<br>首先看一下再原始的工艺文件定义中，有如下语句:</p>
<pre><code>diffusion = diff &#123;
    thickness = 0.004
    min_width = 0.15
    min_spacing = 0.18
    resistivity = 10
    src_drn_layers = &#123;nsd_psd_&#125;
&#125;
</code></pre><p>注意 diffusion, src_drn_layers是关键字，nsd_psd_ 是两个 process layer。<br>calibre命令文件中原来有如下语句:</p>
<pre><code>PEX MAP diff NTAP PTAP nsd psd
</code></pre><p>它把 nsd, psd 映射到了diff层，但是没有告诉工具映射到 nsd_psd_层。<br>如果修改该语句如下:</p>
<pre><code>PEX MAP diff NTAP PTAP
PEX MAP nsd_nsd_
PEX MAP psd_psd_
</code></pre><p>当calibre xrc识别到该语句后，自动会把nsd之间的相互电容屏蔽掉，也自动会把 nsd/psd 到衬底的电容屏蔽掉。<br>屏蔽后提取结果如下:</p>
<pre><code>cc_1 S B 0.0777512f
cc_2 G B 0.211916f
cc_3 D B 0.0540989f
</code></pre><p>以上3个电容都是连接到mos管的金属之间的耦合电容了，电容值很小，不是器件本身的电容，符合预期。</p>
<hr>
<p>如果用户在原始的工艺定义中没有用 diffusion 的关键字，而是用 conductor 的关键字，如下:</p>
<pre><code>conductor = diff &#123;
    thickness = 0.004
    min_width = 0.15
    min_spacing = 0.18
    resistivity = 10
&#125;
</code></pre><p>则用户需要增加额外的语句来屏蔽 source 到 drain，source 到衬底的寄生电容。</p>
<ul>
<li>屏蔽 Gate 到 Source/Drain 的电容<pre><code>PEX IGNORE CAPATANCE ALL poly nsd
PEX IGNORE CAPATANCE ALL poly psd
</code></pre></li>
<li>屏蔽 Gate 到 Bulk<pre><code>PEX IGNORE CAPACITANCE DEVICE INTRINSIC poly ALLGATE
</code></pre></li>
<li>屏蔽 Source/Drain 到 Bulk<pre><code>PEX IGNORE CAPACITANCE DEVICE INTRINSIC nsd ALLGATE
</code></pre></li>
<li>屏蔽 Source 到 Drain<pre><code>PEX IGNORE CAPACITANCE DEVICE nsd nsd ALLGATE
</code></pre>可以看到，这种写法比较繁琐，不如前面的方法简洁。</li>
</ul>
<p>总结，屏蔽掉 spice model 中的寄生参数最简单的方法是:在工艺文件定义中用 diffusion 的关键字，用 src_drn_layers 指定具体的layer名称。然后在提取命令文件中，把 gate 的电容通过 PEX IGNORE 语句来屏蔽掉，不需要写 source, drain 的屏蔽语句。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>半导体专业</category>
        <category>EDA工具</category>
      </categories>
      <tags>
        <tag>Calibre</tag>
      </tags>
  </entry>
  <entry>
    <title>无门关·平常是道</title>
    <url>/2023/09/13/%E6%97%A0%E9%97%A8%E5%85%B3%C2%B7%E5%B9%B3%E5%B8%B8%E6%98%AF%E9%81%93/</url>
    <content><![CDATA[<p><center><font size="5"><b>无门关·平常是道</b></font></center><br><br></p>
<p><center><font size="1">南宋 慧开</font></center><br><br></p>
<p><center>春有百花秋有月，夏有凉风冬有雪。</center></p>
<p><center>若无闲事挂心头，便是人间好时节。</center><br><br></p>
<p><center>善是青松恶是花，看看眼前不如它。</center></p>
<p><center>有朝一日遭霜打，只见青松不见花。</center><br><br></p>
<p><center>面上无嗔是供养，口里无嗔出妙香。</center></p>
<p><center>心中无嗔无价宝，不断不灭是真常。</center><br><br></p>
<p><center>佛在灵山莫远求，灵山只在汝心头。</center></p>
<p><center>人人有个灵山塔，好向灵山塔下修。</center><br><br><br><span id="more"></span><br>这是一首禅诗，诗名为《无关门·平常是道》，出自无门关(又称《禅宗无门关》)第十九则，南宋无门慧开禅师撰。<br><br><b>释义：</b>春天有百花，夏天有凉风，秋天有明月，冬天有瑞雪，但最重要的还是一个人心上没有那些人世间的俗事(功名利禄等等)，可以开开心心地欣赏这美景，这才是好季节。<br><br><b>原文如下：</b></p>
<p><center><b>《无门关》十九　　　平常是道</b></center><br>南泉因赵州问，如何是道。泉云，平常心是道。州云，还可趣向否。泉云，拟向即乖。州云，不拟争知是道。泉云，道不属知，不属不知。知是妄觉，不知是无记。若真达不拟之道，犹如太虚阔然洞豁，岂可强是非也。州于言下顿悟。<br><br>【<b>无门曰</b>】<br><br>南泉被赵州发问，直得瓦解冰消分疏不下。赵州纵饶悟去，更参三十年始得。<br><br>【<b>颂曰</b>】<br><br>春有百花秋有月，夏有凉风冬有雪，若无闲事挂心头，便是人间好时节。<br><br><b>译文：</b>赵州问南泉：“什么是道？”南泉回答：“平常心是道。”赵州说：“可还有什么趣向吗？”南泉说：“只要一拟定方向，就背离这个道了。”赵州说：“如果不预知方向，又怎么知道这就是道呢？”南泉说：“道不属于知，也不属于不知，知是妄觉，不知是无记，如果真的到达不预知的道，才会像太虚一样，阔然洞豁。这道又怎能预先拟定，强加以它是或非呢？”赵州听完这番话后，当下顿悟。<br><br>【<b>评唱</b>】<br><br>无门说：“南泉被赵州发问，直到赵州的疑团瓦解冰消。话虽这么说，赵州纵然当下已顿悟，可是非得再参上三十年不可。”</br><br>【<b>颂曰</b>】<br>春天百花盛开，秋夜月色皎洁。夏天凉风徐徐，冬天白雪皑皑。一个人只要没有闲杂的事情挂在心头，那便是人间最好的时节。<br><br>在此基础上衍生出谒子：</p>
<p><font size=2><center><b>无门关·平常是道</b></center></font></p>
<p><font size=1><center>南宋 慧开</center></p>
<p><center>春有百花秋有月，夏有凉风冬有雪。</center></p>
<p><center>若无闲事挂心头，便是人间好时节。</center></p>
<p><center>善是青松恶是花，看看眼前不如它。</center></p>
<p><center>有朝一日遭霜打，只见青松不见花。</center></p>
<p><center>面上无嗔是供养，口里无嗔出妙香。</center></p>
<p><center>心中无嗔无价宝，不断不灭是真常。</center></p>
<p><center>佛在灵山莫远求，灵山只在汝心头。</center></p>
<p><center>人人有个灵山塔，好向灵山塔下修。</center><br>&lt;/font&gt;<br><br><br>南宋高僧慧开禅师，杭州钱塘人，俗姓梁，生於宋孝宗淳熙十年。因苦参“无”字话头而开悟，慧开又特别着重“无”字法门，每天对着“无”字苦苦参究，故成为无门和尚。<br><br>慧开在法堂内经行，边走边参详“无”字话头。在夕阳西下、夜幕沉沉的寂寥中，从遥遥的斋堂那一头，传来一阵接一阵绵绵密密的鼓声，豁然如排山倒海般，慧开胸中久远以来的疑团突然被鼓声撞散，顿时消失，豁然而悟。慧开禅师心中一片大光明，高唱谒颂：<br></p>
<p><center>青天白日一声雷，大地群生眼豁开。</center></p>
<p><center>万家森罗齐稽首，须弥勃跳舞三台。</center><br>一派天淡云闲列长空，丽日高照大地春的气象。慧开就此开悟。他的很多诗歌都以富含禅理禅机，成为佛诗佳作，在禅门中代代相传。他的《饭熟已多时》便是其中的代表，诗云：</p>
<p><center>只为分明极，翻令所得迟。</center></p>
<p><center>早知灯是火，饭熟已多时。</center><br>有一年，京城大旱，理宗请慧开禅师登坛祈雨，慧开禅师持咒祝祷之后，默然返回寺中，理宗急忙遣派内侍前来询问，祈雨的结果如何？禅师淡然回答说：“寂然不动，感而后通。”语音方毕，天空俄然乌云密布，大雨倾盆注下，解除了已久的大旱，立下大功德。理宗因此颁赐慧开禅师金澜法衣，敕封为佛眼禅师，以示褒扬。就佛家而言，佛眼即是佛，而佛就是佛眼，可见对慧开禅师的评价之高。<br>无门和尚将历代禅宗之公案甄选汇编，选择其中四十八则，纂集为脍炙人口之《无门关》一书，并自作序文道：<br></p>
<p><center>“大道无门，千差有路；<br>
透得此关，乾坤独步。”</center><br>并且把赵州禅师“狗子无佛性”的公案列为第一则，深得六祖慧能大师“无念，无相，无性”的思想要旨。其第十九则诗，谒朗朗上口，最为佛弟子所爱颂：</p>
<p><center>“春有百花秋有月，夏有凉风冬有雪，<br>
若无闲事挂心头，便是人间好时节。”</center><br><br>慧开禅师晚年，倦于槌拂，于西湖边卓庵隐居。虽然如是，前来参学者犹众。<br></p>
<p><center>“三十三天天外天，九霄云外有神仙。<br>
神仙本是凡人做，只怕凡人心不坚。”</center><br>慧海禅师开示说：“世人很难做到一心一用，他们在利害得失中穿梭，囿于浮华的宠辱，产生了‘种种思量’和‘千般妄想’。”这是他们生命中最大的障碍，因此在生命的表层停留不前。<br><br>南宋理宗定元年四月命工匠砌塔，八日塔龛砌成，禅师自撰龛语道：<br></p>
<p><center>“地水火风，梦幻泡影。<br>
七八十年，一弹指顷。”</center><br>书谒毕，跏跌而逝。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>文学爱好</category>
        <category>诗歌</category>
      </categories>
  </entry>
  <entry>
    <title>日本鬼子名称的由来</title>
    <url>/2023/08/17/%E6%97%A5%E6%9C%AC%E9%AC%BC%E5%AD%90%E5%90%8D%E7%A7%B0%E7%9A%84%E7%94%B1%E6%9D%A5/</url>
    <content><![CDATA[<p>　　中日甲午战争的记者会上，日本人想嘲讽和羞辱中国人，事先准备好了一副对联的上联让与会的中国代表当场对出下联。</p>
<p><font size=10 face="华文行楷">上联：骑奇马、张长弓，琴瑟琵琶、八大王并肩居头上，单戈独战。</font><br><span id="more"></span><br>　　“骑奇马，张长弓”这两句是将第一个字本身拆开两个字组成的，而琴瑟琵琶这四个字共共有八个王字对应了后半部分“八大王并肩居头上”，末句“单戈独战”的“单戈”合成一个繁体的“战”字。日本人出这个对联的大意是自己骑着快马张着长弓，兵强马壮的兵临中国，赢得胜利，并以此鄙视和嘲讽中国。<br>　　正当日本人洋洋得意认为没有中国人对出下联时，一位负责谈判的清朝大臣拿起笔写出了下联。</p>
<p><font size=10 face="华文行楷">下联：倭委人、袭龙衣，魑魅魍魉、四小鬼屈膝跪身旁，合手擒拿。</font><br>　　这个下联真是神来之笔，令日本人膛目结舌。下面每一句都工整的对应上联。倭委人袭龙衣对应骑齐马张长弓，魑魅魍魉对应琴瑟琵琶，且魑魅魍魉左偏旁都是鬼字而且有四个。从字形看鬼字末笔一横勾就像是在下跪故屈膝跪身旁，末句合手擒拿的合手就是拿字，正好对应上面的八大王并肩居头上、单戈独战，而且还反过来将了日本人一军。下联的意思是日本小人偷穿龙袍，只不过是魑魅魍魉四个小鬼而已，赶快下跪认错否则合手擒拿，这下联是句句工整字字珠玑。<br>　　从那以后中国人不在称日本人为倭寇而叫日本鬼子了。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>文学爱好</category>
        <category>名言名句</category>
      </categories>
  </entry>
  <entry>
    <title>更换新电脑后，hexo无损重新部署</title>
    <url>/2023/11/14/%E6%9B%B4%E6%8D%A2%E6%96%B0%E7%94%B5%E8%84%91%E5%90%8E%EF%BC%8Chexo%E6%97%A0%E6%8D%9F%E9%87%8D%E6%96%B0%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<p>趁着双十一在京东￥499入手了<a href="https://item.jd.com/100048210573.html#crumb-wrap">樊想S500PRO</a>的2T SSD固态硬盘。<br>到货后就迫不及待的换下了原来笔记本里500G的老硬盘。然后发现换硬盘新装系统后各种软件的安装和配置都要重新来一遍。</p>
<h3 id="下面记录下hexo的迁移过程。"><a href="#下面记录下hexo的迁移过程。" class="headerlink" title="下面记录下hexo的迁移过程。"></a>下面记录下hexo的迁移过程。</h3><span id="more"></span>
<ul>
<li>首先将原硬盘的hexo目录拷贝到新硬盘。我自己的目录是<code>D:\99_Git\blog</code>。</li>
<li><p>配置hexo环境：</p>
<ul>
<li>安装nodejs和git，nodejs安装好才可以使用npm安装hexo，git就是用来上传博客用的；（如果不希望多装软件可只安装git而不需要git bash）</li>
<li>如果可以将原来电脑中的<code>C:\User\username\.gitconfig</code>文件和<code>C:\User\username（斜体）\.ssh\</code>目录拷贝到同目录下就不需要重新配置了。(其中username是自己电脑的用户名)<br>如果没有就只能重新设置并生成ssh key文件了，命令如下：<pre><code>git config --global user.name &quot;username&quot;
git config --global user.mail &quot;user mail address&quot;
ssh-keygen -t rsa -C &quot;user mail address&quot;
</code></pre></li>
<li>进入到hexo部署文件夹，执行命令安装hexo和hexo-depolyer-git插件<pre><code>npm install hexo-cli -g
npm install hexo-deployer-git --save
</code></pre></li>
<li><p><b>然后这里会出现一个问题:</b><br>我是使用vs code中的终端来操作的，怎么样也识别不了hexo命令，提示如下：（由于忘记截图了，网上找了张类似的）<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20231114224848.png" alt="20231114224848"></p>
</li>
<li><p><b>解决方法</b><br>可以通过访问“请参阅……”后面的链接查看，核心问题是power shell的安全策略，将hexo命令视为了不安全脚本，不允许执行。只需要放开权限就行。<br>通过管理员权限运行power shell，然后输入命令：<code>set-ExecutionPolicy RemoteSigned</code><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20231115001919.png" alt="20231115001919"><br>选择“Y”即可。<br>然后就可以正常在<a href="https://code.visualstudio.com/">VS Code</a>的终端里使用<a href="https://hexo.io/zh-cn/index.html">hexo</a>了。</p>
</li>
<li><b><font color=blue>碰到的第二个问题：</font></b><br>上传时提示有换行符的问题，在执行<code>hexo d</code>后会出现整屏的提示信息，是我这个强迫症患者所无法忍受的。</li>
<li><b><font color=blue>解决方法：</font></b><br>通过执行命令<code>git config --global core.autocrlf false</code>将默认的换行符转换功能去掉。<br>```<h1 id="提交时转换为LF，检出时转换为CRLF（默认）"><a href="#提交时转换为LF，检出时转换为CRLF（默认）" class="headerlink" title="提交时转换为LF，检出时转换为CRLF（默认）"></a>提交时转换为LF，检出时转换为CRLF（默认）</h1>git config —global core.autocrlf true</li>
</ul>
<h1 id="提交和检出时均不做换行符转换（修改）"><a href="#提交和检出时均不做换行符转换（修改）" class="headerlink" title="提交和检出时均不做换行符转换（修改）"></a>提交和检出时均不做换行符转换（修改）</h1><p>git config —global core.autocrlf false<br>```</p>
</li>
<li><p>图床设置<br>下载插件vs code的插件PicGo，配置方法网上有很多，但是需要注意一点在<code>Picgo &gt; Pic Bed &gt; Github: Custom Url</code>中需要填入图传链接格式为<code>https://raw.githubusercontent.com/用户名/仓库名/分支名</code>，一开始这个地方没有设置对对上传没有影响但是在博客中看不到图片。</p>
</li>
</ul>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>浅谈几种带宽与增益</title>
    <url>/2024/01/10/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8D%E5%B8%A6%E5%AE%BD%E4%B8%8E%E5%A2%9E%E7%9B%8A/</url>
    <content><![CDATA[<p>今天记录一下闭环增益、开环增益、环路增益，以及3dB带宽、单位增益带宽(UGB)、增益带宽积(GBW)。<br><span id="more"></span></p>
<h2 id="关于增益"><a href="#关于增益" class="headerlink" title="关于增益"></a>关于增益</h2><h3 id="闭环增益"><a href="#闭环增益" class="headerlink" title="闭环增益"></a>闭环增益</h3><p>对于一个闭环反馈系统，如下图:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240110153857.png" alt="20240110153857"><br>闭环增益即传输函数为: $\frac{Y(s)}{X(s)}=\frac{H(s)}{1+\beta H(s)}$, 是 $\frac{开环增益}{1+环路增益}$。</p>
<h3 id="开环增益"><a href="#开环增益" class="headerlink" title="开环增益"></a>开环增益</h3><p>从上面图中可知，开环增益就是去除反馈对系统的作用，看运放的增益。</p>
<h3 id="环路增益"><a href="#环路增益" class="headerlink" title="环路增益"></a>环路增益</h3><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240110154642.png" alt="20240110154642"><br>如图所示，输入置0，断开环路。<br>环路增益$\frac{V_F}{V_t}=\beta A$<br>根据巴克豪森判据判断系统是否稳定，所以仿真都是用stb仿环路稳定性，看<b>环路增益波特图</b>而不是看开环增益或者闭环增益。</p>
<p>那为什么到运放看稳定性就说开环增益了呢？<br>对于单个运放来说，由于运放一般工作在负反馈系统中，开环增益就相当于反馈系数为1的环路增益，所以到运放会说开环增益，其实还是在说环路增益。</p>
<p>那为什么说运放仿开环增益相位裕度够了就代表其接成反馈系统是稳定的呢？<br>拉扎维的10.2节完美解释了这个问题:<br>运放开环增益相当于反馈系数为1的环路增益:在反馈系统里，反馈系数最大为1，就是接成单位增益负反馈形势。这种情况下，系统的环路增益波特图与运放的完全重合，即相位裕度一样，所以可以稳定。<br>对于其它反馈系数小于1的系统来说，环路增益为$\beta A$，不管$\beta$如何变，环路增益的波特图中，极点的位置与运放极点位置一样，不会变，所以相频曲线没有任何改变。但是由于$\beta &lt;1$，幅频曲线下移，增益交点提前，相位裕度只会越来越大。<br>综上，运放单独仿真与它接在负反馈系统里相比，相位裕度是最差的情况了，即当反馈变弱时，结果是系统更稳定。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240110161104.png" alt="20240110161104"></p>
<h2 id="关于带宽"><a href="#关于带宽" class="headerlink" title="关于带宽"></a>关于带宽</h2><h3 id="3dB带宽"><a href="#3dB带宽" class="headerlink" title="3dB带宽"></a>3dB带宽</h3><p>3dB带宽就是运放的主极点处所对应的频率，幅度上对应比低频增益下降3个dB处。<br>推导:<br>运放传递函数:$A_v(s)=\frac{A_v(0)}{(1+s/\omega _0)(1+s/\omega _1)(1+s/\omega _2)···}$</p>
<p>假设次极点离主极点很远很远，那么在主极点$s=\omega _0$处，有:<br>$A_v(\omega _0)=20log(\frac{A_v(0)}{1+\omega _0/\omega _0})=20log(\frac{A_v(0))}{2}=20logA_v(0)-20log(2)\approx 20logA_v(0)-3dB$</p>
<p>所以叫做3dB带宽。</p>
<h3 id="单位增益带宽"><a href="#单位增益带宽" class="headerlink" title="单位增益带宽"></a>单位增益带宽</h3><p>顾名思义，就是运放$\frac{开环增益}{闭环负反馈系统环路增益}=1$时对应的频率。<br>为了推导方便，假设只有一个极点的运放，那么在它的单位增益带宽处，有:<br>$A_v(\omega _{UGB})=\frac{A_v(0)}{1+\frac{\omega _{UGB}}{\omega _0}}=1$<br>可得，$\omega _{UGB}=A_v(0)*\omega _0$</p>
<p>这里有一个结论: 闭环系统的3dB带宽等于环路增益的党委增益带宽。单位增益负反馈系统的3dB带宽等于该系统中所使用的运放的单位增益带宽。<br>推导:负反馈想要稳定，即相位裕度达到60°，单位增益带宽内一定只有一个极点。只看单位增益带宽内的情况，那么有:<br>环路增益: $\beta A(s)=\frac{\beta A_0}{1+\frac{s}{\omega _0}}$<br>闭环系统传输函数: $\frac{Y(s)}{X(s)}=\frac{A(s)}{1+\beta A(s)}=\frac{\frac{A_0}{1+\beta A_0}}{1+\frac{s}{(1+\beta A_0)\omega _0}}$<br>所以就闭环系统传输函数3dB带宽<b>(不是环路增益，是传输函数)</b>是$\omega _0<em>\beta A_0$，环路增益的单位增益带宽也是$\omega _0</em>\beta A_0$。<br>当系统为单位增益负反馈系统时，即反馈因子是1，系统3dB带宽是$\omega _0<em>A_0$,运放单位增益带宽也是$\omega _0</em>A_0$。</p>
<h3 id="增益带宽积-GBW"><a href="#增益带宽积-GBW" class="headerlink" title="增益带宽积(GBW)"></a>增益带宽积(GBW)</h3><p>增益与带宽的乘积。<br>重要结论:在单极点系统中，GBW是不变的，等于单位增益带宽，等于低频增益3dB带宽。因为只有一个极点的时候，极点之后，带宽每增大10倍，增益下降20dB，20dB就是10倍，一个增大十倍，一个减小十倍，自然不变。<br>结合单位增益带宽中的结论推导部分，可见，闭环系统传输函数的增益带宽积与开环的增益带宽积相等。(再次强调:是传输函数的增益带宽积，不是环路增益中的增益带宽积)<br>$A_0<em>\omega _0=\frac{A_0}{1+\beta A_0}</em>(1+\beta A_0)*\omega _0$</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>半导体专业</category>
        <category>模拟电路</category>
      </categories>
      <tags>
        <tag>反馈</tag>
      </tags>
  </entry>
  <entry>
    <title>英语--肯定句变否定句</title>
    <url>/2023/12/01/%E8%8B%B1%E8%AF%AD-%E8%82%AF%E5%AE%9A%E5%8F%A5%E5%8F%98%E5%90%A6%E5%AE%9A%E5%8F%A5/</url>
    <content><![CDATA[<h3 id="肯定句变否定句规则"><a href="#肯定句变否定句规则" class="headerlink" title="肯定句变否定句规则:"></a>肯定句变否定句规则:</h3><h4 id="一、有be动词（am、is、are）和情态动词（can、could、may、must、should、will、would等）的，直接在be动词和情态动词后面加not，some变any，and变or，too变either，其他的照抄。"><a href="#一、有be动词（am、is、are）和情态动词（can、could、may、must、should、will、would等）的，直接在be动词和情态动词后面加not，some变any，and变or，too变either，其他的照抄。" class="headerlink" title="一、有be动词（am、is、are）和情态动词（can、could、may、must、should、will、would等）的，直接在be动词和情态动词后面加not，some变any，and变or，too变either，其他的照抄。"></a>一、<font color=red>有</font>be动词（am、is、are）和情态动词（can、could、may、must、should、will、would等）的，直接在be动词和情态动词后面加not，some变any，and变or，too变either，其他的照抄。</h4><p>例如:<br>|<center>肯定句</center>|<center>否定句</center>|<br>|——|——|<br>|I am a student.|I am not a student.<br>|Amy is a good girl.|Amy <u>is not</u><em><u><font color=red>(isn\’t)</font></u></em> a good girl.<br>|These flowers are very beautiful.|These flowers <u>are not</u><em><u><font color=red>(aren\’t)</font></u></em> very beautiful.<br>|I can swim.|I <u>can not</u><em><u><font color=red>(can\’t)</font></u></em> swim.<br>|There are some books on the table.|There <u>are not</u><em><u><font color=red>(aren\’t)</font></u></em> any books on the table.<br>|Jack is a doctor.|Jack <u>is not</u><em><u><font color=red>(isn\’t)</font></u></em> a doctor.<br>|I was a student ten years ago.|I <u>was not</u><em><u><font color=red>(wasn\’t)</font></u></em> a student ten years ago.</p>
<p><b>注:&ensp;(1) some、and用于肯定句中，any、or用于否定句中；</b><br><b>　 &ensp;(2) was是is的过去式，were是are的过去式。</b><br><span id="more"></span></p>
<h3 id="二、没有be动词-am、is、are-和情态动词（can、could、may、must、should、will、would等）的，在动词前面加don-’t，doesn-’t-一般现在时第三人称单数-，didn-’t-一般过去时-，动词恢复成原形，some变any，and变or，too变either，其他的照抄。"><a href="#二、没有be动词-am、is、are-和情态动词（can、could、may、must、should、will、would等）的，在动词前面加don-’t，doesn-’t-一般现在时第三人称单数-，didn-’t-一般过去时-，动词恢复成原形，some变any，and变or，too变either，其他的照抄。" class="headerlink" title="二、没有be动词(am、is、are)和情态动词（can、could、may、must、should、will、would等）的，在动词前面加don\’t，doesn\’t(一般现在时第三人称单数)，didn\’t(一般过去时)，动词恢复成原形，some变any，and变or，too变either，其他的照抄。"></a>二、<font color=red>没有</font>be动词(am、is、are)和情态动词（can、could、may、must、should、will、would等）的，在动词前面加don\’t，doesn\’t(一般现在时第三人称单数)，didn\’t(一般过去时)，动词恢复成原形，some变any，and变or，too变either，其他的照抄。</h3><p>例如:<br>|<center>肯定句</center>|<center>否定句</center>|<br>|——|——|<br>|I like math.|I <u>do not</u><em><u><font color=red>(don\’t)</font></u></em> like math.<br>|Jack like math, too.|Jack <u>does not</u><em><u><font color=red>(doesn\’t)</font></u></em> like math, either.<br>|They like bananas and apples.|They <u>do not</u><em><u><font color=red>(don\’t)</font></u></em> like bananas or apples.<br>|Lily gets up at six every morning.|Lily <u>does not</u><em><u><font color=red>(doesn\’t)</font></u></em> get up at six every morning.<br>|His father likes playing football.|His father <u>does not</u><em><u><font color=red>(doesn\’t)</font></u></em> like playing football.<br>|I went fishing yesterday.|I <u>did not</u><em><u><font color=red>(didn\’t)</font></u></em> go fishing yesterday.</p>
<p><b>注:&ensp;(1) 当句子是一般过去时态时，在动词前面加didn\’t,动词恢复成原形；</b><br><b>　 &ensp;(2) 当句子是一般现在时态，且主语是第三人称单数时，在动词前加doesn\’t，动词恢复成原形；</b><br><b>　 &ensp;(3) 当句子是一般现在时态，且主语不是第三人称单数时，在动词前加don\’t。</b></p>
<h3 id="三、肯定句变否定句专项练习。"><a href="#三、肯定句变否定句专项练习。" class="headerlink" title="三、肯定句变否定句专项练习。"></a>三、肯定句变否定句专项练习。</h3><p><style><br>    table th:first-of-type {<br>        width: 50%<br>    }<br>    table th:nth-of-type(2) {<br>        width: 50%<br>    }
</style><br>|<center>肯定句</center>|<center>否定句</center>|<br>|——|——|<br>|He is my father.||<br>|This is a cat.||<br>|These are his books.||<br>|David can swim.||<br>|Stand up.||<br>|There are some books and two pencils on the desk.||<br>|We come from Shandong.||<br>|Milli has breakfast at 7:30 in the morning.||<br>|My parents like watching TV at night.||<br>|I often play basketball with my friends.||<br>|His brother likes swinmming and running.||<br>|My mother and I visited my grandparents last week.||<br>|I have many friends here.||<br>|Tom went to Beijing last summer vacation.||<br>|Jack likes playing football after school, too.||</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        Answers
    </div>
    <div class='spoiler-content'>
        <div class="table-container">
<table>
<thead>
<tr>
<th><center>肯定句</center></th>
<th><center>否定句</center></th>
</tr>
</thead>
<tbody>
<tr>
<td>He is my father.</td>
<td>He <u>is not</u><em><u><font color=red>(isn`t)</font></u></em> my father.</td>
</tr>
<tr>
<td>This is a cat.</td>
<td>This <u>is not</u><em><u><font color=red>(isn\’t)</font></u></em> a cat.</td>
</tr>
<tr>
<td>These are his books.</td>
<td>These <u>are not</u><em><u><font color=red>(aren\’t)</font></u></em> his books</td>
</tr>
<tr>
<td>David can swim.</td>
<td>David <u>can not</u><em><u><font color=red>(can\’t)</font></u></em> swim.</td>
</tr>
<tr>
<td>Stand up.</td>
<td><u>Do not</u><em><u><font color=red>(Don\’t)</font></u></em> stand up.</td>
</tr>
<tr>
<td>There are some books and two pencils on the desk.</td>
<td>There <u>are not</u><em><u><font color=red>(aren\’t)</font></u></em> some books or two pencils on the desk.</td>
</tr>
<tr>
<td>We come from Shandong.</td>
<td>We <u>do not</u><em><u><font color=red>(don\’t)</font></u></em> come from Shandong.</td>
</tr>
<tr>
<td>Milli has breakfast at 7:30 in the morning.</td>
<td>Milli <u>does not</u><em><u><font color=red>(doesn\’t)</font></u></em> have breakfast at 7:30 in the morning.</td>
</tr>
<tr>
<td>My parents like watching TV at night.</td>
<td>My parents <u>do not</u><em><u><font color=red>(don\’t)</font></u></em> like watching TV at night.</td>
</tr>
<tr>
<td>I often play basketball with my friends.</td>
<td>I <u>do not</u><em><u><font color=red>(don\’t)</font></u></em> often play basketball with my friends.</td>
</tr>
<tr>
<td>His brother likes swinmming and running.</td>
<td>His brother <u>does not</u><em><u><font color=red>(doesn\’t)</font></u></em> like swimming and running.</td>
</tr>
<tr>
<td>My mother and I visited my grandparents last week.</td>
<td>My mother and I <u>did not</u><em><u><font color=red>(didn\’t)</font></u></em> visit my grandparents last week.</td>
</tr>
<tr>
<td>I have many friends here.</td>
<td>I <u>do not</u><em><u><font color=red>(don\’t)</font></u></em> have many friends here.</td>
</tr>
<tr>
<td>Tom went to Beijing last summer vacation.</td>
<td>Tom <u>did not</u><em><u><font color=red>(didn\’t)</font></u></em> go to Beijing last summer vacation.</td>
</tr>
<tr>
<td>Jack likes playing football after school, too.</td>
<td>Jack <u>does not</u><em><u><font color=red>(doesn\’t)</font></u></em> like playing football after school, either.</td>
</tr>
</tbody>
</table>
</div>

    </div>
</div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>杂学</category>
        <category>社科教育等</category>
      </categories>
      <tags>
        <tag>英语</tag>
      </tags>
  </entry>
  <entry>
    <title>部署 Windows RDS 远程桌面服务器(一)</title>
    <url>/2024/03/02/%E9%83%A8%E7%BD%B2-Windows-RDS-%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%9C%8D%E5%8A%A1-%E4%B8%80/</url>
    <content><![CDATA[<p>转自<a href="https://www.cnblogs.com/heavyhe/p/4547058.html">RD网关部署说明</a>，留待以后部署自己的远程桌面网关。</p>
<p>——-<em>开始正文</em>——-<br><span id="more"></span></p>
<h2 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h2><p>实现通过RD网关服务器实现外网访问内网的远程桌面。</p>
<h3 id="1-1-远程桌面网关"><a href="#1-1-远程桌面网关" class="headerlink" title="1.1 远程桌面网关"></a>1.1 远程桌面网关</h3><p>远程桌面网关（RD 网关）是一项角色服务，使授权远程用户可以从任何连接到 Internet 并且可以运行远程桌面连接 (RDC) 客户端的设备连接到内部企业网络或专用网络上的资源。网络资源可以是远程桌面会话主机（RD 会话主机）服务器、运行 RemoteApp 程序的RD 会话主机服务器或启用了远程桌面的计算机。<br>RD 网关使用 HTTPS 上的远程桌面协议 (RDP) 在 Internet 上的远程用户与运行其生产力应用程序的内部网络资源之间建立安全的加密连接。</p>
<h3 id="1-2-为什么使用远程桌面网关？"><a href="#1-2-为什么使用远程桌面网关？" class="headerlink" title="1.2 为什么使用远程桌面网关？"></a>1.2 为什么使用远程桌面网关？</h3><p><strong>RD 网关有很多优点，其中包括:</strong><br>通过 RD 网关，远程用户可以使用加密连接，<strong>通过 Internet 连接到内部网络资源，而不必配置虚拟专用网络 (VPN) 连接。</strong><br>RD 网关提供全面的安全配置模型，使您可以控制对特定内部网络资源的访问。<strong>RD 网关提供点对点的 RDP 连接，而不是允许远程用户访问所有内部网络资源。</strong><br>通过 RD 网关，大多数远程用户可以连接到在专用网络中的防火墙后面或跨网络地址转换程序 (NAT) 托管的内部网络资源。在此方案中，<strong>通过 RD 网关，不必对 RD 网关服务器或客户端执行其他配置。</strong><br>在此版本的 Windows Server 之前，采用安全措施来阻止远程用户跨防火墙和 NAT 连接到内部网络资源。这是由于出于网络安全考虑，通常阻止端口 3389（用于 RDP 连接的端口）。RD 网关使用 HTTP 安全套接字层/传输层安全 (SSL/TLS) 隧道将 RDP 通信传输到端口 443。由于大多数公司打开端口 443 来支持 Internet 连接，所以，RD 网关利用此网络设计提供跨多个防火墙的远程访问连接。<br>通过远程桌面网关管理器可以配置授权策略，以定义远程用户要连接到内部网络资源必须满足的条件。例如，可以指定：<br>可以连接到内部网络资源的用户（即，可以连接的用户组）。<br>用户可以连接到的网络资源（计算机组）。<br>客户端计算机是否必须是 Active Directory 安全组的成员。<br>是否允许设备的重定向。<br>客户端需要使用智能卡身份验证还是密码身份验证，还是可以使用任一方法。<br>可以将 RD 网关服务器和远程桌面服务客户端配置为使用网络访问保护 (NAP) 来进一步增强安全性。NAP 是 Windows Server® 2008 R2、Windows Server® 2008、Windows® 7、Windows Vista® 和 Windows(R) XP Service Pack 3 中包含的运行状况策略创建、强制和补救技术。通过 NAP，系统管理员可以强制运行状况要求，可以包括软件要求、安全更新要求、所需的计算机配置以及其他设置。</p>
<p><strong>note备注</strong><br>如果 RD 网关强制 NAP，则运行 Windows Server 2008 R2 或 Windows Server 2008 的计算机不能作为 NAP 客户端使用。如果 RD 网关强制 NAP，则仅运行 Windows 7、Windows Vista 或 Windows XP SP3 的计算机可以作为 NAP 客户端使用。<br>有关如何将 RD 网关配置为使用 NAP 对连接到 RD 网关服务器的远程桌面服务客户端强制运行状况策略的信息，请参阅 Windows Server 2008 R2 技术中心上的”远程桌面服务”页。 <a href="http://go.microsoft.com/fwlink/?linkid=140433">http://go.microsoft.com/fwlink/?linkid=140433（可能为英文网页）</a>。<br>可以将 RD 网关服务器与 Microsoft Internet Security and Acceleration (ISA) 服务器一起使用来提高安全性。在此方案中，可以在专用网络中（而不是在外围网络中）托管 RD 网关服务器，且可以在外围网络中托管 ISA 服务器。远程桌面服务客户端与 ISA 服务器之间的安全套接字层 (SSL) 连接可以在连接到 Internet 的 ISA 服务器上终止。<br>有关如何将 ISA 服务器配置为 RD 网关服务器方案的 SSL 终结设备的信息，请参阅 Windows Server 2008 R2 技术中心上的”远程桌面服务”页。 <a href="http://go.microsoft.com/fwlink/?linkid=140433">http://go.microsoft.com/fwlink/?linkid=140433（可能为英文网页）</a>。<br>远程桌面网关管理器提供的工具帮助您监视 RD 网关服务器状态和事件。通过使用远程桌面网关管理器，可以指定为了进行审核要监视的事件（例如尝试连接到 RD 网关服务器不成功）。</p>
<h3 id="1-3-配置远程桌面网关"><a href="#1-3-配置远程桌面网关" class="headerlink" title="1.3 配置远程桌面网关"></a>1.3 配置远程桌面网关</h3><p>此清单列出了要成功地为 RD 网关核心方案配置 RD 网关需要完成的任务。通过此方案，可以配置 RD 网关服务器，使远程用户可以通过 RD 网关服务器，从 Internet 访问内部公司网络资源或专用网络资源。在此方案中，内部网络资源可以是远程桌面会话主机（RD 会话主机）服务器、运行 RemoteApp 程序的RD 会话主机服务器或启用了远程桌面的计算机。<br><strong>配置步骤</strong>|………………………………<br>——|——<br>安装远程桌面网关角色服务。|<br>获取 RD 网关服务器的证书。|<br>创建远程桌面连接授权策略(RD CAP)。|<br>创建远程桌面资源授权策略(RD RAP)。|<br>配置 RD 网关的远程桌面服务客户端。|</p>
<p>有关 RD 网关的详细信息，请参见 Windows Server 2008 R2 TechCenter 上的远程桌面服务页。 <a href="http://go.microsoft.com/fwlink/?LinkId=140433">http://go.microsoft.com/fwlink/?LinkId=140433</a>。</p>
<h3 id="1-4-安装远程桌面网关的先决条件"><a href="#1-4-安装远程桌面网关的先决条件" class="headerlink" title="1.4 安装远程桌面网关的先决条件"></a>1.4 安装远程桌面网关的先决条件</h3><p><strong>若要正常使用 RD 网关，必须满足下列先决条件：</strong><br><em>必须拥有安装了 Windows Server 2008 R2 的服务器。</em><br>在您要配置的 RD 网关服务器上具有<em>本地”管理员”组成员身份</em>（或同等身份），是完成此过程的最低要求。 查看有关使用适当帐户和组成员关系的详细信息，请访问本地默认组和域默认组。 <a href="http://go.microsoft.com/fwlink/?LinkId=83477">http://go.microsoft.com/fwlink/?LinkId=83477（可能为英文链接）</a>。<br><em>必须为 RD 网关服务器获取安全套接字层 (SSL) 证书</em>（如果还没有该证书）。默认情况下，在 RD 网关 服务器上，Internet 信息服务 (IIS) 服务使用传输层安全 (TLS) 1.0 对通过 Internet 在客户端与 RD 网关服务器之间进行的通信加密。若要正常使用 TLS，必须在 RD 网关服务器上安装 SSL 证书。<br><strong>note备注</strong><br>如果可以使用其他方法获取符合 RD 网关的要求的外部信任证书，则不需要在组织中部署证书颁发机构 (CA) 基础结构。如果您的公司没有独立 CA 或企业 CA，并且您没有受信任公用 CA 颁发的兼容证书，则可以为 RD 网关服务器创建并导入自签名证书，以便进行技术评估和测试。有关详细信息，请参阅为远程桌面网关服务器创建自签名证书。<br>有关 RD 网关 的证书要求以及如何获取并安装证书的信息，请参阅获取远程桌面网关服务器的证书。<br><em>如果配置的 RD 网关授权策略要求客户端计算机上的用户是 Active Directory 安全组的成员，才能连接到 RD 网关服务器，则 RD 网关服务器必须也是 Active Directory 域的成员。</em><br><strong>角色、角色服务和功能的依存关系</strong><br>若要正常使用 RD 网关，要求安装并运行多个角色服务和功能。使用服务器管理器安装 RD 网关角色服务时，将自动安装并启动下列附加的角色、角色服务和功能（如果尚未安装）：<br><em>HTTP 代理上的远程过程调用 (RPC)</em><br><em>Web 服务器 (IIS) [Internet 信息服务]</em><br><em>若要正常使用 HTTP 代理上的 RPC 功能，必须安装并运行 IIS。</em><br><strong>网络策略和访问服务</strong><br>还可以将 RD 网关配置为使用另一台运行网络策略服务器 (NPS) 服务的服务器上存储的远程桌面连接授权策略 (RD CAP)。这样，您将使用运行 NPS 的服务器（以前称为远程身份验证拨入用户服务 (RADIUS) 服务器）来集中存储、管理和验证RD CAP。如果已为远程访问方案（例如 VPN 和拨号网络）部署了运行 NPS 的服务器，则对 RD 网关方案同样使用这个现有的运行 NPS 的服务器，可以增强您的部署。</p>
<h2 id="2-实验环境"><a href="#2-实验环境" class="headerlink" title="2. 实验环境"></a>2. 实验环境</h2><h3 id="2-1-实验环境"><a href="#2-1-实验环境" class="headerlink" title="2.1 实验环境"></a>2.1 实验环境</h3><div class="table-container">
<table>
<thead>
<tr>
<th>服务器名称</th>
<th>系统</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>AD<br>192.168.10.1</td>
<td>Windows Server 2012</td>
<td>AD域服务，AD证书服务</td>
<td>VMHost上虚机</td>
</tr>
<tr>
<td>RD<br>192.168.10.14<br>10.0.1.1</td>
<td>Windows Server 2012</td>
<td>RD网关服务器</td>
<td>VMHost上虚机</td>
</tr>
<tr>
<td><del>RD01</del><br><del>192.168.0.15</del><br><del>10.0.1.3</del></td>
<td><del>Windows Server 2012</del></td>
<td><del>RD网关服务器</del></td>
<td><del>VMHost上虚机</del></td>
</tr>
<tr>
<td>Win-TTLSA6FVTKG<br>192.168.10.22</td>
<td>Windows 7 32 sp1</td>
<td>远程桌面</td>
<td>VMHost上虚机</td>
</tr>
<tr>
<td>Win-J3SKRGLCDLT<br>10.0.1.2</td>
<td>Windows 7 32 sp1</td>
<td>客户端</td>
<td>VMHost3上虚机</td>
</tr>
</tbody>
</table>
</div>
<h3 id="2-2-拓扑图"><a href="#2-2-拓扑图" class="headerlink" title="2.2 拓扑图"></a>2.2 拓扑图</h3><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221216.png" alt="20240302221216"></p>
<h2 id="3-实验步骤"><a href="#3-实验步骤" class="headerlink" title="3. 实验步骤"></a>3. 实验步骤</h2><h3 id="3-1-AD-证书服务安装与配置"><a href="#3-1-AD-证书服务安装与配置" class="headerlink" title="3.1 AD 证书服务安装与配置"></a>3.1 AD 证书服务安装与配置</h3><h4 id="3-1-1-添加-ADCS-角色和功能"><a href="#3-1-1-添加-ADCS-角色和功能" class="headerlink" title="3.1.1 添加 ADCS 角色和功能"></a>3.1.1 添加 ADCS 角色和功能</h4><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221315.png" alt="20240302221315"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221323.png" alt="20240302221323"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221333.png" alt="20240302221333"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221351.png" alt="20240302221351"></p>
<h4 id="3-1-2-ADCS-配置"><a href="#3-1-2-ADCS-配置" class="headerlink" title="3.1.2 ADCS 配置"></a>3.1.2 ADCS 配置</h4><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221411.png" alt="20240302221411"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221424.png" alt="20240302221424"><br>此处要选【企业 CA】<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221510.png" alt="20240302221510"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221523.png" alt="20240302221523"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221541.png" alt="20240302221541"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221551.png" alt="20240302221551"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221600.png" alt="20240302221600"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221611.png" alt="20240302221611"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221621.png" alt="20240302221621"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221634.png" alt="20240302221634"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302221642.png" alt="20240302221642"></p>
<h4 id="3-1-3-创建针对计算机的证书模板"><a href="#3-1-3-创建针对计算机的证书模板" class="headerlink" title="3.1.3 创建针对计算机的证书模板"></a>3.1.3 创建针对计算机的证书模板</h4><p>在 AD 中，创建证书模板。<br>【服务器管理器】-【工具】-【证书颁发机构】。<br>右键【证书模板】-【新建】-【要颁发的证书模板】。<br>  (1) 右击【证书模板】-【管理】- 右击【计算机】-【复制模板】，在【常规】tab 定义模板名称，在【使用者名称】选择【在请求中提供】，点击【应用】-【确定】<br>  (2) 右键【证书模板】-【新建】-【要颁发的证书模板】，选择模板名称为步骤 (1) 中创建的模板，点击确定。</p>
<h3 id="3-2-安装远程桌面网关服务"><a href="#3-2-安装远程桌面网关服务" class="headerlink" title="3.2 安装远程桌面网关服务"></a>3.2 安装远程桌面网关服务</h3><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222203.png" alt="20240302222203"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222213.png" alt="20240302222213"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222228.png" alt="20240302222228"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222238.png" alt="20240302222238"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222251.png" alt="20240302222251"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222301.png" alt="20240302222301"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222312.png" alt="20240302222312"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222323.png" alt="20240302222323"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222332.png" alt="20240302222332"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222347.png" alt="20240302222347"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222355.png" alt="20240302222355"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222405.png" alt="20240302222405"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222413.png" alt="20240302222413"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222425.png" alt="20240302222425"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222432.png" alt="20240302222432"></p>
<h3 id="3-3-配置远程桌面网关服务器"><a href="#3-3-配置远程桌面网关服务器" class="headerlink" title="3.3 配置远程桌面网关服务器"></a>3.3 配置远程桌面网关服务器</h3><p>以下所有配置均在 RD 网关服务器上进行。</p>
<h4 id="3-3-1-证书"><a href="#3-3-1-证书" class="headerlink" title="3.3.1 证书"></a>3.3.1 证书</h4><p>在【控制台】完成申请证书的相关操作。证书已由前面的ADCS证书服务配置完成。<br>申请完证书后。<br>首先，要对RD网关服务器进行导入证书。<br>其次，要把证书保存到本地硬盘，再拷贝到客户端进行安装，可进行静默安装。</p>
<h5 id="3-3-1-1-申请证书"><a href="#3-3-1-1-申请证书" class="headerlink" title="3.3.1.1 申请证书"></a>3.3.1.1 申请证书</h5><p>【开始】-【运行】 mmc<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222633.png" alt="20240302222633"><br>【文件】-【添加/删除管理单元】，选择【证书】，点击【添加】。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222718.png" alt="20240302222718"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222727.png" alt="20240302222727"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222738.png" alt="20240302222738"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222745.png" alt="20240302222745"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222751.png" alt="20240302222751"><br>右键【个人】-【证书】-【所有任务】-【申请新证书】<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222827.png" alt="20240302222827"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222837.png" alt="20240302222837"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222847.png" alt="20240302222847"><br>点击下一步<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302222907.png" alt="20240302222907"><br>选择新创建的模板下的【注册此证书需要详细信息。单击这里以配置设置】，弹出如下窗口<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223005.png" alt="20240302223005"><br>在类型处选择【公用名】，在值处填写路由器的外网地址，点击【添加】按钮，点击【应用】-【确定】<br>证书申请完成。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223129.png" alt="20240302223129"></p>
<h5 id="3-3-1-2-导出证书"><a href="#3-3-1-2-导出证书" class="headerlink" title="3.3.1.2 导出证书"></a>3.3.1.2 导出证书</h5><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223156.png" alt="20240302223156"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223207.png" alt="20240302223207"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223216.png" alt="20240302223216"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223225.png" alt="20240302223225"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223233.png" alt="20240302223233"><br>将导出的证书拷贝到客户端进行安装。</p>
<h5 id="3-3-1-3-导入证书"><a href="#3-3-1-3-导入证书" class="headerlink" title="3.3.1.3 导入证书"></a>3.3.1.3 导入证书</h5><p>【开始】-【运行】输入【tsgateway.msc】调用 RD 网关管理器。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223350.png" alt="20240302223350"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223401.png" alt="20240302223401"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223410.png" alt="20240302223410"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223418.png" alt="20240302223418"></p>
<h4 id="3-3-2-策略"><a href="#3-3-2-策略" class="headerlink" title="3.3.2 策略"></a>3.3.2 策略</h4><h5 id="3-3-2-1-创建策略"><a href="#3-3-2-1-创建策略" class="headerlink" title="3.3.2.1 创建策略"></a>3.3.2.1 创建策略</h5><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223507.png" alt="20240302223507"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223515.png" alt="20240302223515"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223524.png" alt="20240302223524"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223534.png" alt="20240302223534"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223543.png" alt="20240302223543"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223554.png" alt="20240302223554"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223608.png" alt="20240302223608"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223617.png" alt="20240302223617"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223627.png" alt="20240302223627"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223649.png" alt="20240302223649"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223657.png" alt="20240302223657"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223718.png" alt="20240302223718"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223726.png" alt="20240302223726"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223734.png" alt="20240302223734"></p>
<h3 id="3-4-客户端配置"><a href="#3-4-客户端配置" class="headerlink" title="3.4 客户端配置"></a>3.4 客户端配置</h3><h4 id="3-4-1-导入证书"><a href="#3-4-1-导入证书" class="headerlink" title="3.4.1 导入证书"></a>3.4.1 导入证书</h4><p>从 RD 网关上拷贝导出的证书文件到客户端，双击进行安装。</p>
<h4 id="3-4-2-Host-文件修改"><a href="#3-4-2-Host-文件修改" class="headerlink" title="3.4.2 Host 文件修改"></a>3.4.2 Host 文件修改</h4><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223915.png" alt="20240302223915"></p>
<h4 id="3-4-3-mstsc-设置"><a href="#3-4-3-mstsc-设置" class="headerlink" title="3.4.3 mstsc 设置"></a>3.4.3 mstsc 设置</h4><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223942.png" alt="20240302223942"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302223952.png" alt="20240302223952"></p>
<h3 id="3-5-测试远程桌面登录"><a href="#3-5-测试远程桌面登录" class="headerlink" title="3.5 测试远程桌面登录"></a>3.5 测试远程桌面登录</h3><h3 id="3-6-RD-网关服务器场"><a href="#3-6-RD-网关服务器场" class="headerlink" title="3.6 RD 网关服务器场"></a>3.6 RD 网关服务器场</h3><h2 id="4-参考资料"><a href="#4-参考资料" class="headerlink" title="4. 参考资料"></a>4. 参考资料</h2><p><a href="http://wangchunhai.blog.51cto.com/225186/1139388">http://wangchunhai.blog.51cto.com/225186/1139388</a></p>
<p>证书服务安装<br><a href="http://lixun.blog.51cto.com/4198640/942447">http://lixun.blog.51cto.com/4198640/942447</a></p>
<p>证书<br><a href="http://technet.microsoft.com/zh-cn/library/cc725949(v=ws.10).aspx">http://technet.microsoft.com/zh-cn/library/cc725949(v=ws.10).aspx</a></p>
<p><a href="http://technet.microsoft.com/zh-cn/library/cc725706(v=ws.10).aspx">http://technet.microsoft.com/zh-cn/library/cc725706(v=ws.10).aspx</a></p>
<p>配置远程桌面网关服务器<br><a href="http://technet.microsoft.com/zh-cn/library/cc754191(v=ws.10).aspx">http://technet.microsoft.com/zh-cn/library/cc754191(v=ws.10).aspx</a></p>
<p>TMG发布远程桌面网关服务器<br><a href="http://hi.baidu.com/comet82/item/e62dc17664760f480c0a0701">http://hi.baidu.com/comet82/item/e62dc17664760f480c0a0701</a></p>
<p>安装ADCS<br><a href="http://yuelei.blog.51cto.com/202879/309092/">http://yuelei.blog.51cto.com/202879/309092/</a></p>
<p>配置CA证书<br><a href="http://235898457.blog.51cto.com/512763/307612">http://235898457.blog.51cto.com/512763/307612</a></p>
<p>RD网关负载均衡<br><a href="http://blog.sina.com.cn/s/blog_643754960101b79n.html">http://blog.sina.com.cn/s/blog_643754960101b79n.html</a></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>部署 Windows RDS 远程桌面服务(二)</title>
    <url>/2024/03/02/%E9%83%A8%E7%BD%B2-Windows-RDS-%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%9C%8D%E5%8A%A1-%E4%BA%8C/</url>
    <content><![CDATA[<p>转自<a href="https://blog.csdn.net/m0_70919503/article/details/134965019">超详细的 部署Windows RDS 远程桌面服务来啦！！！确定不来看一下嘛~</a>，留待以后部署自己的远程桌面网关。</p>
<p>——-<em>开始正文</em>——-<br><span id="more"></span><br>用 Windows Server 2016 操作系统来完成 RDS 的部署，包括添加远程桌面服务角色，创建会话集合，发布 Remote App 程序，以及测试访问 Remote App 程序。<br>首先准备两台部署好域环境的虚拟机: Windows Server 2016 和 Windows 7</p>
<h3 id="添加远程桌面服务角色"><a href="#添加远程桌面服务角色" class="headerlink" title="添加远程桌面服务角色"></a>添加远程桌面服务角色</h3><p>打开 Windows Server 2016:<br>    (1) 点进服务器管理器，点击“添加角色和功能”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302204322.png" alt="20240302204322"><br>    (2) 在安装类型选择“远程桌面服务安装”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302204403.png" alt="20240302204403"><br>    (3) 在“选择部署类型”窗口中选择“标准部署”按键，后“下一步”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302204503.png" alt="20240302204503"><br>    (4) 在“选择部署方案”窗口中，选择“基于会话的桌面部署”按键，后“下一步”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302204559.png" alt="20240302204559"><br>    (5) 系统会自动安装和配置必需的角色服务，直接“下一步”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302204643.png" alt="20240302204643"><br>    (6) 依次指定下面三个服务所在的服务器，在“指定 RD 连接代理服务器”窗口中，将服务器池中的当前服务器添加到右侧窗格中，后“下一步”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302204837.png" alt="20240302204837"><br>    (7) 选择服务器池中的当前的服务器后，双击添加到右侧窗格中，后“下一步”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205006.png" alt="20240302205006"><br>    (8) 选择服务器池中的当前的服务器后，双击添加到右侧窗格中，后“下一步”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205108.png" alt="20240302205108"><br>    (9) 选择“需要时自动启动目标服务器”后，单击“部署”按键<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205210.png" alt="20240302205210"><br>    (10) 安装过程中系统自动重启，重新后会自动完成剩下的安装任务<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205308.png" alt="20240302205308"><br>登录自己的域账号<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205410.png" alt="20240302205410"></p>
<h3 id="创建会话集合"><a href="#创建会话集合" class="headerlink" title="创建会话集合"></a>创建会话集合</h3><pre><code>(1) 打开“服务器管理器”窗口，在左侧窗格单击刚安装好的“远程桌面服务”，在中间窗格选择“概述”选项，在右侧窗格单击“创建会话合集”
![20240302205757](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205757.png)
(2) 在“开始之前”窗口中，直接“下一步”
(3) 自己取一个便于识别的名称后，单击“下一步”
![20240302205902](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205902.png)
(4) 将服务器池中的目标服务双击添加至右侧窗格中后，单击“下一步”
![20240302205959](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302205959.png)
(5) 此页面可以点击“添加”按键可以添加需要授权的用户组，我们此处直接“下一步”
![20240302210101](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210101.png)
(6) 在“指定用户配置文件磁盘”窗口中，输入用户配置文件所在的位置后，单击“下一步”
![20240302210201](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210201.png)
(7) 确认信息无误后，单击“创建”
![20240302210228](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210228.png)
(8) 创建成功后单击“关闭”按键
![20240302210300](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210300.png)
</code></pre><h3 id="发布-Remote-App-程序"><a href="#发布-Remote-App-程序" class="headerlink" title="发布 Remote App 程序"></a>发布 Remote App 程序</h3><pre><code>(1) 打开“服务器管理器”窗口，单击左侧窗格“远程桌面服务”，在中间窗格单击刚创建的集合名称，单击“发布 Remote App 程序”
![20240302210553](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210553.png)
(2) 选择要发布集合的应用程序，咱选择发布自带的“画图”
![20240302210640](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210640.png)
(3) 确认要发布的 Remote App 程序列表是否正确，正确就单击“发布”按键
![20240302210731](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210731.png)
(4) 发布“画图”完成
![20240302210802](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210802.png)
</code></pre><h3 id="AD-服务端新建用户"><a href="#AD-服务端新建用户" class="headerlink" title="AD 服务端新建用户"></a>AD 服务端新建用户</h3><pre><code>(1) 打开“AD 用户和计算机”窗口
![20240302210852](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210852.png)
(2) 设置用户登录名称
![20240302210913](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210913.png)
(3) 设置用户登录密码
![20240302210937](https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302210937.png)
</code></pre><h3 id="访问-Remote-App-程序-测试"><a href="#访问-Remote-App-程序-测试" class="headerlink" title="访问 Remote App 程序(测试)"></a>访问 Remote App 程序(测试)</h3><p>进入 Windows 7 (客户端):<br>    (1) 在 Web 浏览器地址栏输入 URL: “<a href="http://FQDN/rdweb”，在打开的页面中单击“继续浏览此网站”">http://FQDN/rdweb”，在打开的页面中单击“继续浏览此网站”</a><br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211135.png" alt="20240302211135"><br>    (2) 输入”服务端域名\刚刚新建的用户的名字”，和登录密码后，点击“登录”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211242.png" alt="20240302211242"><br>        登录成功后出现“画图”程序图表即代表发布成功<br>        <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211336.png" alt="20240302211336"><br>    (3) 单击程序图标，在浏览器底部弹出的对话框单击“打开”按键<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211436.png" alt="20240302211436"><br>    (4) 点击“连接”<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211505.png" alt="20240302211505"><br>    (5) 输入账号和登录密码<br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211534.png" alt="20240302211534"><br>    <img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240302211551.png" alt="20240302211551"></p>
<p>以上便是所有内容，欢迎大家前来借鉴！</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows命令行在cmd中能执行但是在PowerShell中报错</title>
    <url>/2024/03/26/Windows%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%9C%A8cmd%E4%B8%AD%E8%83%BD%E6%89%A7%E8%A1%8C%E4%BD%86%E6%98%AF%E5%9C%A8PowerShell%E4%B8%AD%E6%8A%A5%E9%94%99/</url>
    <content><![CDATA[<p>使用ssh远程windows端的时候默认使用cmd，而用powershell可以使用很多linux的命令，像<code>ls</code>，<code>ps</code>，<code>cd</code>什么的(实际上只是映射了一下)。<br>使用管理员权限在<em>PowerShell</em>执行以下命令，使SSH连接Windows时默认使用<em>Powershell</em>。</p>
<pre><code class="lang-powershell">New-ItemProperty -Path &quot;HKLM:\SOFTWARE\OpenSSH&quot; -Name DefaultShell -Value &quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe&quot; -PropertyType String -Force
</code></pre>
<span id="more"></span>
<p>但是今天远程Windows下开启<code>http-server</code>服务时却遇到一个奇怪的问题。</p>
<blockquote>
<p>这个问题也可以描述为: powershell中无法执行命令/脚本</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326090059.png" alt="20240326090059"><br>尝试了一下发现一部分命令是可以执行的，就考虑是不是权限相关的问题，通过多方查证，总结了以下解决办法:</p>
<ul>
<li>运行命令行查看系统权限:<pre><code class="lang-powershell">Get-ExecutionPolicy -List
</code></pre>
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326090340.png" alt="20240326090340"></li>
<li>通过这个命令发现<code>CurrentUser</code>的权限是<code>Undefined</code>，那么就是权限的问题，尝试以下命令通过增加权限解决<pre><code class="lang-powershell">Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
</code></pre>
修改后再次执行<code>Get-ExecutionPolicy -List</code>查看权限<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326090815.png" alt="20240326090815"><br>再次开启<code>http-server</code>:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326090934.png" alt="20240326090934"><br>成功！</li>
</ul>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>删除docker容器和镜像</title>
    <url>/2024/03/26/%E5%88%A0%E9%99%A4docker%E5%AE%B9%E5%99%A8%E5%92%8C%E9%95%9C%E5%83%8F/</url>
    <content><![CDATA[<h1 id="什么是-Docker"><a href="#什么是-Docker" class="headerlink" title="什么是 Docker?"></a>什么是 Docker?</h1><p><code>Docker</code>是基于<code>Go语言</code>实现的在 2013 年发布的云开源项目，它利用了围绕容器这个现有的计算概念，特别是在<code>Linux</code>世界中，这些原始概念被称为<code>cgroups</code>和命名空间。<code>Docker</code>的技术之所以独特是因为它专注于开发人员和系统操作员的需求，以将应用程序依赖项与基础架构分开。<br><code>Docker</code>的主要目标是 “Build，Ship and Run Any App,Anywhere”，也就是通过对应用组件的封装、分发、部署、运行等生命周期的管理，使用户的 APP (可以是一个WEB应用或数据库应用等等) 及其运行环境能够做到“一次封装，到处运行”。<br>一句话概括，<code>Docker</code>的出现解决了运行环境和配置环境不一致的情况，从而更方便的做持续集成并有助于应用的整体发布。<br><span id="more"></span></p>
<h1 id="Docker-三要素-镜像、容器和仓库"><a href="#Docker-三要素-镜像、容器和仓库" class="headerlink" title="Docker 三要素: 镜像、容器和仓库"></a>Docker 三要素: 镜像、容器和仓库</h1><h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><p>在了解镜像这个概念之前，我们需要先大致了解一下联合文件系统:<code>UnionFS</code>，它是<code>Docker</code>镜像的基础，联合文件系统是一种分层，轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层一层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下，镜像可以通过分层来进行集成，我们可以基于一个基础的镜像，然后制作出各种各样满足我们需求的应用镜像。<br>同时，对于一个精简的<code>OS</code>，<code>rootfs</code>可以很小，有常见的命令就行，同时，底层又是直接使用的操作系统的内核，所以往往<code>Docker</code>中一个镜像的体积相对来说可以很小，比如一个完整版的<code>centos</code>可能要几个 G，但是<code>Docker</code>中的<code>centos</code>大概只有 300M.<br>对于docker镜像，官方的定义如下:</p>
<blockquote>
<p>An image is a read-only template with instructions for creating a Docker container. Often, an image is based on another image, with some additional customization. For example, you may build an image which is based on the ubuntu image, but installs the Apache web server and your application, as well as the configuration details needed to make your application run.‘<br>映像是一个只读模板，带有创建Docker容器的指令。通常，一个映像是基于另一个映像的，还需要进行一些额外的定制。例如，您可以构建一个基于ubuntu映像的映像，但是安装<code>Apache web</code>服务器和您的应用程序，以及使您的应用程序运行所需的配置细节。</p>
</blockquote>
<p>PS: <strong><font color="red">一个镜像可以创建多个容器</font></strong>。</p>
<h2 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h2><p>容器是用镜像创建的运行实例。<br>每个容器都可以被启动，开始，停止，删除，同时容器之间相互隔离，保证应用运行期间的安全。<br>我们可以把容器理解为一个精简版的<code>linux</code>操作系统，包括<code>root</code>用户权限，进程空间，用户空间和网络空间等等这些，然后加上再它之上运行的应用程序。<br>比如我们现在基于<code>mysql</code>镜像创建了一个容器，那么，这个容器其实并不是只有一个<code>mysql</code>程序，而是<code>mysql</code>同样也是安装运行在我们容器内的<code>linux</code>环境中的。</p>
<h2 id="容器和镜像的关系"><a href="#容器和镜像的关系" class="headerlink" title="容器和镜像的关系"></a>容器和镜像的关系</h2><p>再说这个问题之前，我们不妨先来看一下下面这段<code>java</code>代码:</p>
<pre><code class="lang-java">Person p = new Person();
Person p1 = new Person();
Person p2 = new Person();
</code></pre>
<p>镜像在这里就是我们的Person，容器就是一个个Person类的实例。一个Person可以创建多个实例，一个镜像也可以创建多个容器。</p>
<h2 id="仓库"><a href="#仓库" class="headerlink" title="仓库"></a>仓库</h2><p>仓库相对来说就比较容易理解了，仓库(Repository)是集中存放镜像文件的场所。<br>仓库分为公开仓库和私有仓库，目前的话，全世界最大的仓库是Docker官方的 Docker Hub<br>由于一些不可抗拒的因素，导致我们如果从 Docker Hub 上下载公开的镜像是非常蛋疼的，这点大家可以参考你用百度网盘官方下载时的感觉。所以，国内我们一般使用阿里云或者网易云的镜像仓库。<br>镜像 容器 仓库 他们三者之间的关系图如下:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326223417.png" alt="20240326223417"></p>
<h1 id="Docker-容器的创建、启动"><a href="#Docker-容器的创建、启动" class="headerlink" title="Docker 容器的创建、启动"></a>Docker 容器的创建、启动</h1><p>docker 容器的启动有三种方式:</p>
<h2 id="交互方式-基于镜像新建容器并启动"><a href="#交互方式-基于镜像新建容器并启动" class="headerlink" title="交互方式: 基于镜像新建容器并启动"></a>交互方式: 基于镜像新建容器并启动</h2><p>例如我们可以启动一个容器，打印出当前的日历表:</p>
<pre><code class="lang-bash">docker run my/python:v1 cal   ## my/python:v1 为镜像名和标签
</code></pre>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326223332.png" alt="20240326223332"><br>我们还可以通过制定参数，启动一个 bash 交互终端:</p>
<pre><code class="lang-bash">docker run -it my/python:v1 /bin/bash
</code></pre>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326223619.png" alt="20240326223619"><br>参数<code>-t</code>让 Docker 分配一个伪终端并绑定在容器的标准输入上，<code>-i</code>让容器的标准输入保持打开。</p>
<p>使用<code>docker run</code>命令来启动容器，docker 在后台运行的标准操作包括<br>1.检查本地是否存在指定的镜像，不存在则从公有仓库下载;<br>2.使用镜像创建并启动容器;<br>3.分配一个文件系统，并在只读的镜像层外面挂载一层可读可写层;<br>4.从宿主主机配置的网桥接口中桥接一个虚拟接口道容器中去;<br>5.从地址池分配一个ip地址给容器;<br>6.执行用户指定的应用程序;<br>7.执行完毕之后容器被终止。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326223751.png" alt="20240326223751"><br><code>my/sinatra:v2</code>基于<code>training/sinatra</code>镜像进行修改后的镜像，<code>training/sinatra</code>为公有仓库上的镜像。</p>
<h2 id="短暂方式-直接将一个已经终止的容器启动运行起来"><a href="#短暂方式-直接将一个已经终止的容器启动运行起来" class="headerlink" title="短暂方式: 直接将一个已经终止的容器启动运行起来"></a>短暂方式: 直接将一个已经终止的容器启动运行起来</h2><p>可以使用<code>docker start</code>命令，直接将一个已经终止的容器启动运行起来。</p>
<pre><code class="lang-bash">[root@rocketmq-nameserver4 ~]# docker run my/python:v1 /bin/echo hello test
hello test
</code></pre>
<p>命令执行完，控制台会打印<code>hello test</code>，container 就终止了，不过并没有消失，<br>可以用<code>docker ps -n 5</code>看一下最新前 5 个的 container，第一个就是刚刚执行过的 container，可以再次执行一遍：<code>docker start container_id</code><br>不过这次控制台看不到<code>hello test</code>了，只能看到 ID，用<code>logs</code>命令才能看得到：<code>docker logs container_id</code>。<br>可以看到两个<code>hello test</code>了，因为这个 container 运行了两次。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326224054.png" alt="20240326224054"></p>
<h2 id="Daemen-方式-守护态运行"><a href="#Daemen-方式-守护态运行" class="headerlink" title="Daemen 方式(守护态运行)"></a>Daemen 方式(守护态运行)</h2><p>即让软件作为长时间服务运行，这就是 SAAS 啊！<br>例如我们启动 centos 后台容器，每隔一秒打印当天的日历。</p>
<pre><code class="lang-bash">$ docker run -d centos /bin/sh -c &quot;while true;do echo hello docker;sleep 1;done&quot;
</code></pre>
<p>启动之后，我们使用<code>docker ps -n 5</code>查看容器的信息</p>
<p>要查看启动的centos容器中的输出，可以使用如下方式：</p>
<pre><code class="lang-bash">$ docker logs $CONTAINER_ID   ##在container外面查看它的输出
$ docker attach $CONTAINER_ID   ##连接上容器实时查看
</code></pre>
<h1 id="Docker-容器的终止"><a href="#Docker-容器的终止" class="headerlink" title="Docker 容器的终止"></a>Docker 容器的终止</h1><p>使用以下命令来终止一个运行中的容器。并且可以使用<code>docker ps -a</code>来看终止状态的容器。</p>
<pre><code class="lang-bash">docker stop $CONTAINER_ID
</code></pre>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326224511.png" alt="20240326224511"><br>终止状态的容器，可以使用<code>docker start</code>来重新启动。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326224547.png" alt="20240326224547"><br>使用docker restart命令来重启一个容器。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326224612.png" alt="20240326224612"></p>
<h1 id="删除-Docker-容器"><a href="#删除-Docker-容器" class="headerlink" title="删除 Docker 容器"></a>删除 Docker 容器</h1><p>如果容器还在运行，将无法删除镜像，所以从删除容器开始。</p>
<ul>
<li>查看 Docker 所有容器状态<pre><code class="lang-bash">docker ps -a
</code></pre>
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326225006.png" alt="20240326225006"></li>
<li>停止容器运行<pre><code class="lang-bash">docker stop $CONTAINER_ID
</code></pre>
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326225218.png" alt="20240326225218"></li>
<li>删除容器<pre><code class="lang-bash">docker rm $CONTAINER_ID
</code></pre>
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326225338.png" alt="20240326225338"></li>
</ul>
<h1 id="删除-Docker-镜像"><a href="#删除-Docker-镜像" class="headerlink" title="删除 Docker 镜像"></a>删除 Docker 镜像</h1><ul>
<li>查看 docker 要删除的镜像<pre><code class="lang-bash">docker images
</code></pre>
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326225523.png" alt="20240326225523"></li>
<li>由于刚才已终止此镜像的容器，所以直接删除<pre><code class="lang-bash">docker rmi $IMAGE_ID
</code></pre>
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240326225653.png" alt="20240326225653"></li>
</ul>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>&lt;转&gt;【Darwin】越狱后玩耍IPhone系统</title>
    <url>/2024/03/27/%E8%BD%AC-%E3%80%90Darwin%E3%80%91%E8%B6%8A%E7%8B%B1%E5%90%8E%E7%8E%A9%E8%80%8DIPhone%E7%B3%BB%E7%BB%9F/</url>
    <content><![CDATA[<p>无意中找到一个介绍越狱后iOS的说明， 受益匪浅， 转一下:<a href="https://www.cnblogs.com/franknihao/p/7360695.html">【Darwin】 越狱后玩耍IPhone系统</a><br><span id="more"></span><br>大家都知道 iOS 是自 Mac OS 修改而来的。而 Mac OS 和 iOS 的共同核心是 Darwin, 其基于 FreeBSD 发展而来, 整体而言也是个类Unix系统。之前把自己的手机越狱之后正好开始接触 Linux 这类 OS， 然后觉得很有意思就去网上找了些资料来自己玩自己的手机， 也做了一些笔记。说来惭愧， 当时手机系统版本还是 8.3。而后来也因为没什么时间加上这部分笔记维护在另外一个笔记本上， 导致一直没有时间记录下来【捂脸】。本来想等 10.3 的越狱出来， 把Pad越狱之后再来详细研究的， 无奈 10.3 越狱也迟迟不出， 不得已， 只好现在来记录一下了。。<br>没有什么干货的技术知识， 全部都是一点个人的爱折腾手机的小兴趣， 系统版本又老。。嗯就这样吧。</p>
<h1 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h1><p>IPhone 越狱后， 第一标志当然就是在桌面上看到了 Cydia。作为折腾手机的第一步， 当然是要让手机有本地命令行来装逼了。如果没记错的话， 几年前越狱的时候还是会附带一个命令行工具的， 现在好像必须得自己下载安装了。进入 Cydia， 搜索安装 MTerminal 这个命令行工具。其他也有一些命令行工具比如 mobileTerminal 什么的， 不过那些好像都已经过时了， 新系统们都打不开。打开 MTerminal 默认用户是 mobile， 退出时自动也会退出这个用户， 不用担心用户进程会留存在机器上。还有一点比较有意思的是 MTerminal 的非键盘区域， 点击靠上下左右的边部区域就像是键盘上按上下左右方向键， 所以可以进行退格和重复上条命令等操作。至于 Tab 键自动补全命令什么的操作至今还未发现。。<br>有了命令行， 但是在手机上敲命令太蛋疼了， 我们最好能通过电脑连入手机， 这样方便多了。第一个想到的当然是通过 SSH。在 Cydia 安装 openSSH， 之后就可以通过 22 端口远程连接手机了。一般可以直接用 root 用户连入手机， 进入之后的第一件事<br><strong>千万要记得改root账户的密码， 所有越狱后的IPhone手机root用户的默认密码都是一样的！！！都是 alpine ！不马上改掉， 那随便什么人都可以直接连入你的 IPhone， 你就没有任何安全可言了。</strong><br>改完密码之后， 就可以对字符界面的 iOS 做一些改造让它看起来更像是一台服务器了。</p>
<h1 id="适当改造"><a href="#适当改造" class="headerlink" title="适当改造"></a>适当改造</h1><p>首先可以在<code>/etc/profile</code>中加上对环境变量 PS1 的定义， 这个变量决定的是字符提示行的样式。这个文件是什么作用在 Linux 笔记中说过了， 就不说了， 样式可以选择<code>[\u@\h \W]\$</code>这款。在文件中加上<code>export PS1=&#39;[\u@\h \W]\$&#39;</code>即可。<br>默认的<code>ls</code>命令出来的文件没有任何颜色特效， 看起来很累。可以加上<code>LS_COLORS</code>这个环境变量， 至于具体的值怎么写可以参见已经配置好的 CentOS 系统等等， 我这里给出一个参考: </p>
<pre><code class="lang-bash">export LS_COLORS=&#39;no=00:fi=00:di=01;34:ln=01;36:pi=40;33:so=01;35:bd=40;33;01:cd=40;33;01:or=01;05;37;41:mi=01;05;37;41:ex=01;32:*.cmd=01;35:*.exe=01;35:*.com=01;35:*.btm=01;35:*.bat=01;35:*.sh=01;35:*.csh=01;35:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.gz=01;31:*.bz2=01;31:*.bz=01;31:*.tz=01;31:*.rpm=01;31:*.cpio=01;31:*.jpg=01;35:*.gif=01;35:*.bmp=01;35:*.xbm=01;35:*.xpm=01;35:*.png=01;35:*.tif=01;35:&#39;
</code></pre>
<p>在设置好了配置文件之后<code>source</code>之以生效， 至于<code>ls</code>的颜色， 如果还是没有效果记得看一下<code>ls</code>有没有默认<code>alias ls=&#39;ls --color&#39;</code>， 必须带上<code>color</code>参数<code>ls</code>才会显色。<br>忘记了系统是否自带了 vim 程序， 应该是没有， 那就需要安装。vim 的样式文件 vimrc 不放在<code>/etc/vimrc</code>， 而是放到<code>/usr/share/vim/</code>目录下面去。</p>
<h1 id="常用工具安装"><a href="#常用工具安装" class="headerlink" title="常用工具安装"></a>常用工具安装</h1><p>在 CentOS 上习惯了用<code>yum</code>安装包， 但是这里没有<code>yum</code>， 只有<code>apt-get</code>。用法是类似的: </p>
<pre><code class="lang-bash">apt-get install &lt;PackageName&gt;　　# 安装某个包
apt-get update　　# 更新 apt 源（是不是有点眼熟， 其实估计 Cydi 里面的更新源就是运行了下这个命令）
apt-get remove &lt;PackageName&gt;　　# 卸载某个包
</code></pre>
<p>在update过后， apt会把所有更新到的包信息放到缓存里面， 如果想要从最新的包信息中搜寻某个特定的包可以执行: </p>
<pre><code class="lang-bash">apt-cache search &lt;PackageName&gt;
</code></pre>
<p>这条命令用的还是模糊搜索， 可以帮助你寻找想要装的包名到底叫什么。由于一般人记的肯定是命令名而不是包名， 所以下面给出的是一些命令和它们所在包的名字。如果想用这些命令就<code>apt-get install</code>安装这些包吧:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Tools Name</th>
<th>Package Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>ifconfig, netstat, route</td>
<td>network-cmds</td>
</tr>
<tr>
<td>curl</td>
<td>curl</td>
</tr>
<tr>
<td>top</td>
<td>top</td>
</tr>
<tr>
<td>wget</td>
<td>wget</td>
</tr>
<tr>
<td>finger,last,ps</td>
<td>adv-cmds</td>
</tr>
<tr>
<td>vim</td>
<td>vim</td>
</tr>
<tr>
<td>locate</td>
<td>mlocate</td>
</tr>
<tr>
<td>lrz,lsz (命令名和 linux上 略有出入， linux 上是直接 rz， sz， 这里多个 l )</td>
<td>org.thebigboss.lrzsz</td>
</tr>
<tr>
<td>gcc</td>
<td>iphon-gcc</td>
</tr>
<tr>
<td>less</td>
<td>less</td>
</tr>
</tbody>
</table>
</div>
<p>这里稍微提醒一句， 如果通过SSH经电脑连入手机操作， 虽然是在电脑上打命令， 不过网络走的还是手机的路， 所以要注意手机别开 4G 跑流量了。。。<br>另外装了一个新包之后不知道有什么用或者怎么用时可以到手机端 Cydia—已安装—&lt;包名&gt; 里面， 划到最下面的文件系统内容中， 看这个包具体安装了的哪些文件， 有什么文件被安装到了<code>/usr/bin</code>这种目录下， 那个文件自然就是一个命令了。</p>
<h1 id="一些酷酷的事情"><a href="#一些酷酷的事情" class="headerlink" title="一些酷酷的事情"></a>一些酷酷的事情</h1><p>上面装的一些东西都是管理机器必须的， 实用的工具。还有一些比较花哨， 适合用于装逼的工具。比如下面: </p>
<h2 id="远程打开程序"><a href="#远程打开程序" class="headerlink" title="远程打开程序"></a>远程打开程序</h2><p>bigboss源上有个叫做 open(com.conadkramer.open) 的插件， 装上之后可以在 SSH 里输入<code>open &lt;APPID&gt;</code>命令来远程让手机打开一个 APP。APPID 是每个 APP 目录下的 plist.xml 文件中记录的<code>CFBundleIdent.fier</code>的值， 比如 safari 的话就是 com.Apple.mobilesafari ， 系统自带的音乐的话就是 com.Apple.Music。</p>
<h2 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h2><p><code>netstat -ntlp</code>在这个系统里不管用， 要用只能用<code>netstat -an</code>。而<code>-p</code>在这里的 netstat 是 protocol 的意思。所以你可以<code>netstat -ntlp TCP</code>来显示所有 TCP 连接的情况。</p>
<h2 id="安装python"><a href="#安装python" class="headerlink" title="安装python"></a>安装python</h2><p>Cydia 中搜索一下 Python， 似乎可以找到一个 python2.5.1 版本的包， 虽然老了点， 但是勉强凑合可以用。至于用源码进行安装我没有试过， 估计也可以吧。装上 python 之后就可以更加剧烈地折腾手机了。比方说为了安全性考虑， 我的手机平时都是关闭 22 端口的， 想要开启的时候再开。于是就写了一个 python 脚本， 做成命令来手动开关 22 端口的访问。</p>
<h2 id="启停服务"><a href="#启停服务" class="headerlink" title="启停服务"></a>启停服务</h2><p>其实上面说的那个 python 脚本就是调用了启停服务的命令。在<code>/System/Library/LaunchDaemons</code>和<code>/System/Library/LaunchAgents</code>下面有很多跟服务相关的 plist 文件。<code>LaunchDaemons</code>指系统启动时自动启动的程序， 而<code>LaunchAgents</code>中存放的是针对某个用户登录时自动启动的程序的配置。<br>想要启动或停止一个服务， 可以这么操作: 　　</p>
<pre><code class="lang-bash">launchctl load/unload -w &lt;plist的路径&gt;
</code></pre>
<p>因为指定了 plist 文件的路径， 所以 plist 文件未必一定要在那两个指定目录下， 完全可以拷贝出来然后自己手动指定它的路径以启动。</p>
<h2 id="查看服务状态"><a href="#查看服务状态" class="headerlink" title="查看服务状态"></a>查看服务状态</h2><pre><code class="lang-bash">launchctl list | grep ssh # 查看ssh的服务开启状态
</code></pre>
<h2 id="媒体和-APP-文件的位置-系统版本比较老，-估计新版本系统已经有变化了"><a href="#媒体和-APP-文件的位置-系统版本比较老，-估计新版本系统已经有变化了" class="headerlink" title="媒体和 APP 文件的位置(系统版本比较老， 估计新版本系统已经有变化了)"></a>媒体和 APP 文件的位置(系统版本比较老， 估计新版本系统已经有变化了)</h2><p>自带播放器的音乐和视频文件都放在<code>/private/var/mobile/Media/ITunes_Control</code>里面， 但是文件名是被点窜过的， 要用一定的手段来定位寻找特定的文件。（比如看大小， 看修改日期， MP3 文件的话还可以解析其标签来判断是什么歌等等）<br>用户的 APP 的文件基本上都放在<code>/private/var/mobile/Container/Data/Application/&lt;一个被点窜过的目录名&gt;</code>。因为目录名是一串没有规律的， 很难定位哪个目录对应哪个 APP。办法还是有的， 比如可以通过脚本把每个目录的大小算出来， 然后比较一下手机里的信息。还有定位特定的文件等等， 方法就靠灵活自己想了 。</p>
<h1 id="如何通过-usb-直接连系统后台"><a href="#如何通过-usb-直接连系统后台" class="headerlink" title="如何通过 usb 直接连系统后台"></a>如何通过 usb 直接连系统后台</h1><p>上面连接进 iOS 系统都是通过了 WIFI 这个媒介。虽然方便一些， 但是存在速度稍慢， 安全性有疑问等问题。其实我们可以通过一些手段通过 USB 来模拟 SSH 连接， 这样通过一条数据线， 即使没有WIFI也可以做到连接系统了。<br>做法是首先确保系统中有合适的驱动。Mac 之类的机器就不用说了肯定是有的， 像没有装 itunes 的 windows 机器的话可以下载安装<code>AppleApplicationSupport</code>和<code>AppleMobileDeviceSupport</code>这两个驱动程序， 只要有这两个就行， 也不用安装整个庞大的 itunes了。<br>然后， 我们下载一个名叫<em>usbmxud</em>的工具。这个百度一下就能下载到了， 然后在命令行运行一下这个工具中的一个脚本: </p>
<pre><code class="lang-bash">python &lt;usbmuxd目录&gt;/python-client/tcprelay.py -t 22:10022
</code></pre>
<p>然后这个程序就会在 PC 端开启本地的 10022 端口， 并把这个端口映射到 iOS 端的 22 端口。只要 iOS 开了 22 端口， 就可以在本地通过工具 ssh 连接 10022 端口就可以了。<br>同理， 不仅限于 22 端口， 其他任何 iOS 上的端口都可以进行映射。非常好用。</p>
<h1 id="iOS上一些重要文件的位置等"><a href="#iOS上一些重要文件的位置等" class="headerlink" title="iOS上一些重要文件的位置等"></a>iOS上一些重要文件的位置等</h1><p>这位大神的博客还挺有参考价值的。<br><a href="http://www.cnblogs.com/ygm900/category/538781.html">http://www.cnblogs.com/ygm900/category/538781.html</a></p>
<blockquote>
<p>短信数据库的存放位置在ios的: //private/var/mobile/Library/SMS/sms.db<br>联系人数据库存放的位置在ios的: //private/var/mobile/Library/AddressBook/AddressBook.sqlitedb<br>联系人的头像估计存放在这里: //private/var/mobile/Library/AddressBook/AddressBookImages.sqlitedb<br>通话记录数据库的存放路径是: //private/var/wireless/Library/CallHistory/call_history.db<br>备忘录数据库的存放路径是: //private/var/mobile/Library/Notes/notes.sqlite<br>safira 浏览器的收藏夹数据库存放路径是: //private/var/mobile/Library/Safari/Bookmarks.db<br>日历数据库的存放路径是: //private/var/mobile/Library/Calendar/Calendar.sqlitedb</p>
</blockquote>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>设备及使用</category>
      </categories>
      <tags>
        <tag>iPhone</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx反向代理实现访问路由器控制界面</title>
    <url>/2024/03/28/Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0%E8%AE%BF%E9%97%AE%E8%B7%AF%E7%94%B1%E5%99%A8%E6%8E%A7%E5%88%B6%E7%95%8C%E9%9D%A2/</url>
    <content><![CDATA[<p>前两天把家里空闲的手机翻出来想着干点什么，两个小米 Note，一个 iPhone4，两个 iPhone6，一个三星 Galaxy A9 Pro和一个三星 Galaxy A32。</p>
<ul>
<li>iPhone4 被我手残升级 iOS 搞成了砖，现在只能看白苹果了。。。</li>
<li>两个小米 Note 折腾了半天也没法解锁 BootLoader, 先放置了</li>
<li>一台 iPhone6 安装了“掌上看家” APP 在家里做个监控用来看孩子有没有玩电子设备</li>
<li>另一台 iPhone6 越狱出来做了一些小处理，本文重点来讲这个</li>
<li>三星 Galaxy A9 Pro 已经解锁 BootLoader 成功还没想好干什么</li>
<li>三星 Galaxy A32 还没折腾<span id="more"></span>
</li>
</ul>
<p>废话少说，今天来聊聊用越狱的 iPhone6 安装 nginx 实现反向代理访问华为路由器 AX3 Pro 的管理界面。</p>
<h1 id="iPhone6-越狱"><a href="#iPhone6-越狱" class="headerlink" title="iPhone6 越狱"></a>iPhone6 越狱</h1><p>这个没有记录，等后期越狱另外一台 iPhone6 的时候再详细描述。</p>
<h1 id="配置一下越狱的-iPhone6"><a href="#配置一下越狱的-iPhone6" class="headerlink" title="配置一下越狱的 iPhone6"></a>配置一下越狱的 iPhone6</h1><p>这个跟本篇设置关联不大，主要是配置了 bash 和 Vim。<br>越狱后的 iPhone 系统内核是 Drawin，使用 Linux 命令<code>uname -a</code>就可以查看:<br><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@iPhone ~]<span class="hljs-comment">#uname -a</span><br>Darwin iPhone 18.7.0 Darwin Kernel Version 18.7.0: Fri Aug 19 23:28:26 PDT 2022; root:xnu-4903.272.5~1/RELEASE_ARM64_T7000 iPhone7,1 arm Darwin<br></code></pre></td></tr></table></figure></p>
<h2 id="bash设置"><a href="#bash设置" class="headerlink" title="bash设置"></a>bash设置</h2><p>iPhone 越狱后默认的 shell 是 zsh，由于一直习惯于使用 bash，就换成了 bash。</p>
<h3 id="使用命令cat-etc-shells查看系统支持的-shell"><a href="#使用命令cat-etc-shells查看系统支持的-shell" class="headerlink" title="使用命令cat /etc/shells查看系统支持的 shell:"></a>使用命令<code>cat /etc/shells</code>查看系统支持的 shell:</h3><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@iPhone ~]<span class="hljs-comment">#cat /etc/shells</span><br><span class="hljs-comment"># /etc/shells: valid login shells</span><br>/bin/sh<br>/usr/bin/sh<br>/bin/zsh<br>/usr/bin/zsh<br>/bin/bash<br>/usr/bin/bash<br>/usr/bin/dash<br></code></pre></td></tr></table></figure>
<h3 id="将默认-shell-更改为-bash"><a href="#将默认-shell-更改为-bash" class="headerlink" title="将默认 shell 更改为 bash:"></a>将默认 shell 更改为 bash:</h3><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">chsh -s /bin/bash<br></code></pre></td></tr></table></figure>
<h3 id="查看当前用户-shell"><a href="#查看当前用户-shell" class="headerlink" title="查看当前用户 shell"></a>查看当前用户 shell</h3><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@iPhone ~]<span class="hljs-comment">#echo $SHELL</span><br>/bin/bash<br></code></pre></td></tr></table></figure>
<h3 id="更改命令行提示符-PS1-及-常用命令"><a href="#更改命令行提示符-PS1-及-常用命令" class="headerlink" title="更改命令行提示符 PS1 及 常用命令"></a>更改命令行提示符 PS1 及 常用命令</h3><pre><code><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs conf">export PATH=&#x27;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/bin/X11:/usr/games&#x27;<br># export PS1=&#x27;\h:\w \u\$ &#x27;<br>export PS1=&#x27;[\u@\h \W]\$&#x27;<br>umask 022<br><br>export EDITOR=/usr/bin/editor<br>export PAGER=/usr/bin/pager<br><br>for i in /etc/profile.d/*.sh ; do<br>    if [ -r &quot;$i&quot; ]; then<br>        . $i<br>    fi<br>done<br><br>export LS_COLORS=&#x27;no=00:fi=00:di=01;34:ln=01;36:pi=40;33:so=01;35:bd=40;33;01:cd=40;33;01:or=01;05;37;41:mi=01;05;37;41:ex=01;32:*.cmd=01;35:*.exe=01;35:*.com=01;35:*.btm=01;35:*.bat=01;35:*.sh=01;35:*.csh=01;35:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.gz=01;31:*.bz2=01;31:*.bz=01;31:*.tz=01;31:*.rpm=01;31:*.cpio=01;31:*.jpg=01;35:*.gif=01;35:*.bmp=01;35:*.xbm=01;35:*.xpm=01;35:*.png=01;35:*.tif=01;35:&#x27;<br>alias la=&#x27;ls -al&#x27;<br>alias ll=&#x27;ls -l&#x27;<br></code></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>将第3行注释掉；<br>添加第3行；<br>添加15、16、17行；<br>其它都是默认的。<br><strong>注:不知道原因，但是在这个系统里只能修改这个文件(/etc/profile)来配置 bash，在用户目录下使用<code>.bashrc</code>修改没有效果，应该是默认不 load <code>.bashrc</code>文件。</strong></p>
</blockquote>
<h2 id="配置-VIM"><a href="#配置-VIM" class="headerlink" title="配置 VIM"></a>配置 VIM</h2><p>这个就在用户目录下使用<code>touch .vimrc</code>和<code>mkdir .vim</code>创建相关的配置文件和目录即可。<br>.vimrc 配置如下:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">set</span> <span class="hljs-keyword">nu</span><br><span class="hljs-keyword">set</span> backspace=<span class="hljs-built_in">indent</span>,eol,start<br><span class="hljs-comment">&quot;set cursorline</span><br><span class="hljs-comment">&quot;hi cursorline ctermbg=lightgray guibg=lightblue</span><br><br><span class="hljs-keyword">set</span> nobackup<br><span class="hljs-keyword">set</span> noswapfile<br><span class="hljs-keyword">set</span> nowritebackup<br><span class="hljs-keyword">set</span> noundofile<br><br><span class="hljs-keyword">set</span> nocompatible<br><span class="hljs-keyword">set</span> wrap<br><span class="hljs-keyword">set</span> laststatus=<span class="hljs-number">2</span><br><span class="hljs-keyword">set</span> statusline=%<span class="hljs-keyword">f</span>%<span class="hljs-keyword">m</span>%r%h%<span class="hljs-keyword">w</span>\ [FORMAT=%&#123;&amp;ff&#125;]\ [TYPE=%Y]\ [POS=%<span class="hljs-keyword">l</span>,%v][%<span class="hljs-keyword">p</span>%%]\ [LEN=%L]<br><span class="hljs-keyword">set</span> ruler<br><span class="hljs-keyword">set</span> mouse=<span class="hljs-keyword">a</span><br><span class="hljs-keyword">set</span> showcmd<br><span class="hljs-keyword">set</span> cmdheight=<span class="hljs-number">2</span><br><span class="hljs-keyword">set</span> <span class="hljs-keyword">history</span>=<span class="hljs-number">1000</span><br><br><span class="hljs-keyword">set</span> completeopt=preview,<span class="hljs-keyword">menu</span><br><span class="hljs-keyword">set</span> clipboard+=unnamed<br><span class="hljs-keyword">set</span> autoindent<br><span class="hljs-keyword">set</span> tabstop=<span class="hljs-number">2</span><br><span class="hljs-keyword">set</span> softtabstop=<span class="hljs-number">2</span><br><span class="hljs-keyword">set</span> <span class="hljs-built_in">shiftwidth</span>=<span class="hljs-number">2</span><br><span class="hljs-keyword">set</span> noexpandtab<br><br><span class="hljs-keyword">syntax</span> <span class="hljs-keyword">on</span><br><span class="hljs-keyword">filetype</span> <span class="hljs-keyword">on</span><br><span class="hljs-keyword">filetype</span> plugin <span class="hljs-keyword">on</span><br><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">version</span> &gt;= <span class="hljs-number">603</span><br>    <span class="hljs-keyword">set</span> helplang=<span class="hljs-keyword">cn</span><br>    <span class="hljs-keyword">set</span> encoding=utf-<span class="hljs-number">8</span><br><span class="hljs-keyword">endif</span><br><br><span class="hljs-keyword">inoremap</span> ( ()<span class="hljs-symbol">&lt;ESC&gt;</span>i<br><span class="hljs-keyword">inoremap</span> [ []<span class="hljs-symbol">&lt;ESC&gt;</span>i<br><span class="hljs-keyword">inoremap</span> &#123; &#123;&#125;<span class="hljs-symbol">&lt;ESC&gt;</span>i<br><span class="hljs-keyword">inoremap</span> &lt; &lt;&gt;<span class="hljs-symbol">&lt;ESC&gt;</span>i<br><span class="hljs-keyword">inoremap</span> <span class="hljs-string">&#x27; &#x27;</span><span class="hljs-string">&#x27;&lt;ESC&gt;i</span><br><span class="hljs-string">inoremap &quot; &quot;&quot;&lt;ESC&gt;i</span><br></code></pre></td></tr></table></figure>
<h1 id="在越狱的-iPhone6-上安装-OpenSSH"><a href="#在越狱的-iPhone6-上安装-OpenSSH" class="headerlink" title="在越狱的 iPhone6 上安装 OpenSSH"></a>在越狱的 iPhone6 上安装 OpenSSH</h1><p>这个属于常规操作，在越狱的市场里下载就行。(略)</p>
<h1 id="在越狱的-iPhone6-上安装-Nginx"><a href="#在越狱的-iPhone6-上安装-Nginx" class="headerlink" title="在越狱的 iPhone6 上安装 Nginx"></a>在越狱的 iPhone6 上安装 Nginx</h1><p>使用命令:<br><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">apt-get install nginx<br></code></pre></td></tr></table></figure><br>就会下载软件和相应的依赖包，当时没有记录，应该是下载了<code>nginx</code>，<code>nginx-common</code>，<code>nginx-core</code>等文件。</p>
<h1 id="配置-Nginx-使其访问当前设备时指向路由器管理界面"><a href="#配置-Nginx-使其访问当前设备时指向路由器管理界面" class="headerlink" title="配置 Nginx 使其访问当前设备时指向路由器管理界面"></a>配置 Nginx 使其访问当前设备时指向路由器管理界面</h1><h2 id="修改-Nginx-配置文件"><a href="#修改-Nginx-配置文件" class="headerlink" title="修改 Nginx 配置文件"></a>修改 Nginx 配置文件</h2><p>安装完成后在<code>/etc/nginx</code>目录中会有<code>nginx.conf</code>和<code>nginx.conf.defaut</code>两个文件，其中<code>nginx.conf</code>是 Nginx 实际运行时使用的配置文件，<code>nginx.conf.default</code>应该是个模板示例。</p>
<ol>
<li><code>cp nginx.conf.default nginx.conf</code>使用模板覆盖原来的<code>nginx.conf</code>；</li>
<li>在 http 模块的 server 里加入语句: <code>proxy_pass http://192.168.3.1/; #即反向代理要访问的地址</code>。<br>示例如下:<br>/etc/nginx/nginx.conf 文件设置如下:<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br><span class="hljs-attribute">server_name</span>  localhost;<br><span class="hljs-comment">#charset koi8-r;</span><br><span class="hljs-comment">#access_log  logs/host.access.log  main;</span><br><span class="hljs-section">location</span> / &#123;<br>    <span class="hljs-attribute">proxy_pass</span> http://192.168.3.1/;<br>    <span class="hljs-attribute">root</span>   html;<br>    <span class="hljs-attribute">index</span>  index.html index.htm;<br>&#125;<br></code></pre></td></tr></table></figure>
其实其它都是 nginx.conf.default 中的内容，只要在<code>location</code>里面加入<code>proxy_pass http://192.168.3.1/;</code>这一句就可以，这样当访问此台设备的<code>80</code>端口时就会直接指向到路由器管理台的<code>192.168.3.1</code>了。</li>
</ol>
<h2 id="Nginx-常用命令"><a href="#Nginx-常用命令" class="headerlink" title="Nginx 常用命令"></a>Nginx 常用命令</h2><p>因为没有找到 Nginx 的 plist 文件来启停服务，所以需要使用软件命令来进行操作。<br>首先可以使用<code>nginx -h</code>来查询命令使用方法。<br>常用命令:<br><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">nginx <span class="hljs-comment"># 启动 Nginx</span><br>nginx -s reopen <span class="hljs-comment"># 重新启动 Nginx</span><br>nginx -s reload <span class="hljs-comment"># 在不关闭 Nginx 的情况下重新加载 /etc/nginx/nginx.conf 配置文件</span><br>nginx -s stop <span class="hljs-comment"># 关闭 Nginx</span><br>nginx -t <span class="hljs-comment"># 测试配置文件 /etc/nginx/nginx.conf</span><br>nginx -T <span class="hljs-comment"># 测试 配置文件 /etc/nginx/nginx.conf 并将其输出到屏幕</span><br>nginx -v <span class="hljs-comment"># 输出版本信息</span><br></code></pre></td></tr></table></figure></p>
<h1 id="外网访问路由器管理台"><a href="#外网访问路由器管理台" class="headerlink" title="外网访问路由器管理台"></a>外网访问路由器管理台</h1><p>将设置了 nginx 的设备端口<code>80</code>映射到外网即可，比如当前设备的局域网 ip 为<code>192.168.3.111</code>，映射外网端口为<code>11111</code>。<br>这样在外网访问时只要输入网址: <code>http://domain或者IP:1111</code> 就可以实现外网直接访问路由器管理后台了。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
        <tag>iPhone</tag>
      </tags>
  </entry>
  <entry>
    <title>2024孩子电话手表更换方案</title>
    <url>/2024/04/01/2024%E5%AD%A9%E5%AD%90%E7%94%B5%E8%AF%9D%E6%89%8B%E8%A1%A8%E6%9B%B4%E6%8D%A2%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[<div class="table-container">
<table>
<thead>
<tr>
<th>配置项</th>
<th>Y3</th>
<th>Y3C</th>
<th>Y3 pro</th>
</tr>
</thead>
<tbody>
<tr>
<td>内存</td>
<td>1G</td>
<td>1G</td>
<td>1G</td>
</tr>
<tr>
<td>容量</td>
<td>8G</td>
<td>16G</td>
<td>8G</td>
</tr>
<tr>
<td>摄像头像素</td>
<td>200w</td>
<td>200w</td>
<td>500w</td>
</tr>
<tr>
<td>儿童手表版微信、支付</td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>防水等级</td>
<td>2ATM</td>
<td>IPX8</td>
<td>2ATM</td>
</tr>
<tr>
<td>背单词</td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
</tbody>
</table>
</div>
<p>NFC公交和乘车码对儿童手表来说目前是个伪需求，因为无法使用学生卡。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>设备及使用</category>
      </categories>
      <tags>
        <tag>儿童手表</tag>
      </tags>
  </entry>
  <entry>
    <title>使用越狱iPhone部署ddns服务</title>
    <url>/2024/04/15/%E4%BD%BF%E7%94%A8%E8%B6%8A%E7%8B%B1iPhone%E9%83%A8%E7%BD%B2ddns%E6%9C%8D%E5%8A%A1/</url>
    <content><![CDATA[<h1 id="iPhone-越狱并获取root权限"><a href="#iPhone-越狱并获取root权限" class="headerlink" title="iPhone 越狱并获取root权限"></a>iPhone 越狱并获取root权限</h1><p>此处略，可以使用爱思助手 8.0 通过 Chimera 进行的越狱，此越狱方式并不完美，每次iPhone重启后所有越狱安装的app都会闪退，需要重新越狱一次才行。</p>
<h1 id="在-CloudFlare-上建立一个二级域名"><a href="#在-CloudFlare-上建立一个二级域名" class="headerlink" title="在 CloudFlare 上建立一个二级域名"></a>在 CloudFlare 上建立一个二级域名</h1><p>首先，在 Cloudflare 上申请一个域名或者在其他网站申请托管到 Cloudflare 上，并建立用来作为 DDNS 用的 A 记录和 AAAA 记录。假设是:<br>A 记录:     ddns.example.com      1.1.1.1<br>AAAA 记录   ddns.example.com      2606:4700:4700::1111<br>IP 地址先可以随便填。<br><span id="more"></span></p>
<h1 id="取得所需的-ZONE-ID、API-Token-和-RECORD-ID"><a href="#取得所需的-ZONE-ID、API-Token-和-RECORD-ID" class="headerlink" title="取得所需的 ZONE_ID、API_Token 和 RECORD_ID"></a>取得所需的 ZONE_ID、API_Token 和 RECORD_ID</h1><p>ZONE_ID 就在域名概述页的右下侧，名字为区域 ID。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240415210230.png" alt="20240415210230"><br>然后在同一页面的下方点击获取 API 令牌。<br>点击创建令牌，使用“编辑区域 DNS”的模板，选择相应的域名，点击显示摘要，并创建令牌。<br>把生成的 API_Token 保存好。<br>接着打开一个 Linux 终端，执行以下代码:</p>
<pre><code class="lang-bash">ZONE_ID=&quot;你的 Zone ID&quot;
API_TOKEN=&quot;你的API Token&quot;
curl -X GET &quot;https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records?name=ddns.example.com&quot; \
-H &quot;Authorization: Bearer $API_TOKEN&quot; \
-H &quot;Content-Type: application/json&quot;
</code></pre>
<p>注意替换上述代码中的 ZONE_ID，API_Token，二级域名。<br>在返回的结果中，找到“name”与相应二级域名相符的 RECORD_ID。</p>
<h1 id="建立-Shell-脚本"><a href="#建立-Shell-脚本" class="headerlink" title="建立 Shell 脚本"></a>建立 Shell 脚本</h1><p>在你想运行的位置比如<code>root</code>目录建立一个脚本文件:</p>
<pre><code class="lang-bash">mkdir cfddns &amp;&amp; cd cfddns
touch ddns.sh
</code></pre>
<p>然后用编辑器打开:</p>
<pre><code class="lang-bash">vim ddns.sh
</code></pre>
<p>复制一下代码并保存退出:</p>
<pre><code class="lang-bash">#!/bin/sh
NEW_IP=`curl -s http://ipv4.ddnspod.com`
CURRENT_IP=`cat $(dirname &quot;$0&quot;)/current_ip.txt`
CURRENT_TIME=$(date +&quot;%F %T&quot;)
DDNS=&quot;home.starnest.eu.org&quot;
ZONE_ID=&quot;1234567890abcdef1234567890abcdef&quot;
API_TOKEN=&quot;1234567890abcdef1234567890abcdef&quot;
RECORD_ID=&quot;1234567890abcdef1234567890abcdef&quot;
if [ &quot;$NEW_IP&quot; = &quot;$CURRENT_IP&quot; ]
then
        echo &quot;[$CURRENT_TIME] No Change in IP Adddress&quot; &gt;&gt; $(dirname &quot;$0&quot;)/crontab_log.txt
else
curl -k -X PUT &quot;https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records/$RECORD_ID&quot; \
     -H &quot;Authorization: Bearer $API_TOKEN&quot; \
     -H &quot;Content-Type: application/json&quot; \
     --data &#39;&#123;&quot;type&quot;:&quot;A&quot;,&quot;name&quot;:&quot;&#39;$DDNS&#39;&quot;,&quot;content&quot;:&quot;&#39;$NEW_IP&#39;&quot;,&quot;ttl&quot;:1,&quot;proxied&quot;:false&#125;&#39; &gt; /dev/null
echo $NEW_IP &gt; $(dirname &quot;$0&quot;)/current_ip.txt
echo &quot;[$CURRENT_TIME] IP changed to $NEW_IP&quot; &gt;&gt; $(dirname &quot;$0&quot;)/crontab_log.txt
fi
</code></pre>
<p>若想同时适用对 ipv6 有效则使用下面的脚本(未测试):</p>
<pre><code class="lang-bash">#!/bin/sh
# 简单的使用Clodflare API来实现DDNS的脚本
NEW_IPv4=$(curl -s http://ipv4.icanhazip.com)
NEW_IPv6=$(curl -s http://ipv6.icanhazip.com)
CURRENT_IPv4=$(cat $(dirname &quot;$0&quot;)/current_ipv4.txt)
CURRENT_IPv6=$(cat $(dirname &quot;$0&quot;)/current_ipv6.txt)
CURRENT_TIME=$(date +&quot;%F %T&quot;)
# 填入DDNS域名
DDNS=&quot;ddns.example.com&quot;
# ZONE_ID在Clouflare域名页面上获取
ZONE_ID=&quot;1234567890abcdef1234567890abcdef&quot;
# API_TOKEN在Clouflare个人资料页面上创建
API_TOKEN=&quot;1234567890abcdef1234567890abcdef&quot;
# RECORD_ID获取应执行以下代码：
# ZONE_ID=&quot;你的 Zone ID&quot;
# API_TOKEN=&quot;你的API Token&quot;
# curl -X GET &quot;https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records?name=example.com&quot; \
#     -H &quot;Authorization: Bearer $API_TOKEN&quot; \
#     -H &quot;Content-Type: application/json&quot;
RECORD_ID=&quot;1234567890abcdef1234567890abcdef&quot;
if [ -z &quot;$NEW_IPv4&quot; ] &amp;&amp; [ -z &quot;$NEW_IPv6&quot; ]; then
  echo &quot;[$CURRENT_TIME] Failed to get IP address&quot; &gt;&gt; $(dirname &quot;$0&quot;)/crontab_log.txt
  exit 1
elif [ &quot;$NEW_IPv4&quot; = &quot;$CURRENT_IPv4&quot; ] &amp;&amp; [ &quot;$NEW_IPv6&quot; = &quot;$CURRENT_IPv6&quot; ]; then
  echo &quot;[$CURRENT_TIME] No change in IP address&quot; &gt;&gt; $(dirname &quot;$0&quot;)/crontab_log.txt
else
  if [ -n &quot;$NEW_IPv4&quot; ] &amp;&amp; [ &quot;$NEW_IPv4&quot; != &quot;$CURRENT_IPv4&quot; ]; then
    curl -k -X PUT &quot;https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records/$RECORD_ID&quot; \
      -H &quot;Authorization: Bearer $API_TOKEN&quot; \
      -H &quot;Content-Type: application/json&quot; \
      --data &#39;&#123;&quot;type&quot;:&quot;A&quot;,&quot;name&quot;:&quot;&#39;$DDNS&#39;&quot;,&quot;content&quot;:&quot;&#39;$NEW_IPv4&#39;&quot;,&quot;ttl&quot;:1,&quot;proxied&quot;:false&#125;&#39; &gt; /dev/null
    echo &quot;$NEW_IPv4&quot; &gt; $(dirname &quot;$0&quot;)/current_ipv4.txt
    echo &quot;[$CURRENT_TIME] IPv4 address changed to $NEW_IPv4&quot; &gt;&gt; $(dirname &quot;$0&quot;)/crontab_log.txt
  fi
  if [ -n &quot;$NEW_IPv6&quot; ] &amp;&amp; [ &quot;$NEW_IPv6&quot; != &quot;$CURRENT_IPv6&quot; ]; then
    curl -k -X PUT &quot;https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records/$RECORD_ID&quot; \
      -H &quot;Authorization: Bearer $API_TOKEN&quot; \
      -H &quot;Content-Type: application/json&quot; \
      --data &#39;&#123;&quot;type&quot;:&quot;AAAA&quot;,&quot;name&quot;:&quot;&#39;$DDNS&#39;&quot;,&quot;content&quot;:&quot;&#39;$NEW_IPv6&#39;&quot;,&quot;ttl&quot;:1,&quot;proxied&quot;:false&#125;&#39; &gt; /dev/null
    echo &quot;$NEW_IPv6&quot; &gt; $(dirname &quot;$0&quot;)/current_ipv6.txt
    echo &quot;[$CURRENT_TIME] IPv6 address changed to $NEW_IPv6&quot; &gt;&gt; $(dirname &quot;$0&quot;)/crontab_log.txt
  fi
fi
</code></pre>
<h1 id="执行-Shell-脚本并设置定时任务"><a href="#执行-Shell-脚本并设置定时任务" class="headerlink" title="执行 Shell 脚本并设置定时任务"></a>执行 Shell 脚本并设置定时任务</h1><h2 id="手动执行确认"><a href="#手动执行确认" class="headerlink" title="手动执行确认"></a>手动执行确认</h2><p>先手动执行一次脚本，然后检查 Cloudflare 解析记录和同文件夹下生成的 crontab_log.txt，确认 IP 是否正确更新。</p>
<pre><code class="lang-bash">/bin/sh ddns.sh
</code></pre>
<h2 id="设置定时任务"><a href="#设置定时任务" class="headerlink" title="设置定时任务"></a>设置定时任务</h2><p>若上述脚本执行无误，则使用 plist 设置定时任务。<br>首先，要新增被管理项需要新增一个<code>.plist</code>放入苹果的管理文件夹下，然后使其被加载后执行。苹果根据用户的角色提供了不同的 Launtch 存放位置。</p>
<pre><code class="lang-bash">~/Library/LaunchAgents          # 当前用户定义的任务
/Library/LaunchAgents           # 系统管理员定义的任务
/Library/LaunchDaemons          # 管理员定义的系统守护进程任务
/System/Library/LaunchAgents    # 苹果定义的任务
/System/Library/LaunchDaemons   # 苹果定义的系统守护进程任务
</code></pre>
<p>很显然，我们最好不要使用下面两个位置的，我这里使用的是<code>/Library/LaunchDaemons</code>。</p>
<pre><code class="lang-bash">cd /Library/LaunchDaemons
touch starnest.ddns.plist   #前面的名字随便起，最后以`.plist`结尾
</code></pre>
<p>然后编辑<code>starnest.ddns.plist</code>文件:</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple Computer//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
    &lt;key&gt;Label&lt;/key&gt;
    &lt;string&gt;starnest.ddns&lt;/string&gt;
    &lt;key&gt;ProgramArguments&lt;/key&gt;
    &lt;array&gt;
      &lt;string&gt;/bin/sh&lt;/string&gt;
      &lt;string&gt;/var/root/script_service/ddns/ddns.sh&lt;/string&gt;
    &lt;/array&gt;
    &lt;key&gt;RunAtLoad&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;StartInterval&lt;/key&gt;
    &lt;integer&gt;180&lt;/integer&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
<blockquote>
<p>上面的 StartInterval 中的时间不是很确定，使用<code>date</code>命令测试时 interger 设置为 1 会没 10 秒执行一次任务，但是 ddns 脚本中设置 180 应该是 30 分钟执行一次，但根据日志结果来看是 1 小时 3~4 次，时间不是太固定。但对 ddns 来说每小时 3~4 的频度足够了。</p>
<h2 id="启动定时任务"><a href="#启动定时任务" class="headerlink" title="启动定时任务"></a>启动定时任务</h2><pre><code class="lang-bash">launchctl load /Library/LaunchDaemons/starnest.ddns.plist
</code></pre>
<p>确认是否启动成功</p>
<pre><code class="lang-bash">launchctl list | grep starnest
</code></pre>
<pre><code>-       0       starnest.ddns
</code></pre><p>第一列的 PID，第二列是 status，当 status 显示为 0 时表示任务正常进行。<br>我刚开始 status 显示 127，这个可以用以下命令来初步确认问题。</p>
<pre><code class="lang-bash">launchctl error 127
</code></pre>
<pre><code>127: The specified service did not ship with the operating system
</code></pre><p>最后发现是<code>plist</code>文件中脚本路径发生的错误。</p>
</blockquote>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>设备及使用</category>
      </categories>
      <tags>
        <tag>iPhone</tag>
        <tag>DDNS</tag>
      </tags>
  </entry>
  <entry>
    <title>Pura 70系列四款机型区别</title>
    <url>/2024/04/28/Pura-70%E7%B3%BB%E5%88%97%E5%9B%9B%E6%AC%BE%E6%9C%BA%E5%9E%8B%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<div class="table-container">
<table>
<thead>
<tr>
<th>机型</th>
<th>Pura 70</th>
<th>Pura 70 Pro</th>
<th>Pura 70 Pro+</th>
<th>Pura 70 Ultra</th>
</tr>
</thead>
<tbody>
<tr>
<td>颜色</td>
<td>羽纱黑/雪域白/樱玫红/冰晶蓝</td>
<td>羽纱黑/雪域白/罗兰紫</td>
<td>光织银/弦乐白/魅影黑</td>
<td>香颂绿/摩卡棕/星芒白/星芒黑</td>
</tr>
<tr>
<td>屏幕外观</td>
<td>直屏/6.6英寸/第二代昆仑玻璃</td>
<td>等深四曲设计/6.8英寸/第二代昆仑玻璃</td>
<td>等深四曲设计/6.8英寸/玄武钢化昆仑玻璃</td>
<td>等深四曲设计/6.8英寸/玄武钢化昆仑玻璃</td>
</tr>
<tr>
<td>屏幕规格</td>
<td>1~120Hz自适应刷新率、2500nits峰值亮度、460ppi像素密度</td>
<td>1~120Hz自适应刷新率、2500nits峰值亮度、460ppi像素密度</td>
<td>1~120Hz自适应刷新率、2500nits峰值亮度、460ppi像素密度</td>
<td>1~120Hz自适应刷新率、2500nits峰值亮度、460ppi像素密度</td>
</tr>
<tr>
<td>后置摄像头</td>
<td>5000万新一代超聚光主摄(F1.4~F4.0可变光圈)/1200万5倍光学变焦潜望式长焦摄像头/1300万超广角摄像头</td>
<td>5000万新一代超聚光主摄(F1.4~F4.0可变光圈)/4800万5倍光学变焦潜望式长焦摄像头/1250万超广角摄像头</td>
<td>5000万新一代超聚光主摄(F1.4~F4.0可变光圈)/4800万5倍光学变焦潜望式长焦摄像头/1250万超广角摄像头</td>
<td>5000万新一代超聚光主摄(F1.6~F4.0可变光圈)/5000万5倍光学变焦潜望式长焦摄像头/4000万超广角摄像头</td>
</tr>
<tr>
<td>前置摄像头</td>
<td>1300万摄像头</td>
<td>1300万摄像头 支持自动对焦</td>
<td>1300万摄像头 支持自动对焦</td>
<td>1300万摄像头 支持自动对焦</td>
</tr>
<tr>
<td>内存</td>
<td>12G+256G、12G+512G、12G+1TB</td>
<td>12G+256G、12G+512G、12G+1TB</td>
<td>16G+512G、16G+1TB</td>
<td>16G+512G、16G+1TB</td>
</tr>
<tr>
<td>价格</td>
<td>5499元 5999元 6999元</td>
<td>6499元 6999元 7999元</td>
<td>7999元 8999元</td>
<td>9999元 10999元</td>
</tr>
<tr>
<td>电池容量</td>
<td>4900mAh(典型值)</td>
<td>5050mAh(典型值)</td>
<td>5050mAh(典型值)</td>
<td>5200mAh(典型值)</td>
</tr>
<tr>
<td>充电功率</td>
<td>有线66W、无线50W、无线反向7.5W</td>
<td>有线100W、无线80W、无线反向20W</td>
<td>有线100W、无线80W、无线反向20W</td>
<td>有线100W、无线80W、无线反向20W</td>
</tr>
<tr>
<td>防水等级</td>
<td>IP68 1.5m</td>
<td>IP68 2m</td>
<td>IP68 2m</td>
<td>IP68 2m</td>
</tr>
<tr>
<td>卫星通信</td>
<td>/</td>
<td>北斗卫星通信</td>
<td>北斗卫星通信+天通卫星通信</td>
<td>北斗卫星通信+天通卫星通信</td>
</tr>
</tbody>
</table>
</div>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>设备及使用</category>
      </categories>
      <tags>
        <tag>Pura 70</tag>
      </tags>
  </entry>
  <entry>
    <title>Debian Linux 使用 -- 系统安装</title>
    <url>/2024/05/11/Debian-Linux-%E4%BD%BF%E7%94%A8-%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h1 id="机器配置"><a href="#机器配置" class="headerlink" title="机器配置"></a>机器配置</h1><p>这台机器比较老，是200x年在日本买的富士通的 FMV-DESKPOWER，型号是 FMVFB70T。<br>配置如下:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>配件名称</th>
<th>型号</th>
<th>规格</th>
</tr>
</thead>
<tbody>
<tr>
<td>主板</td>
<td>FJNB023</td>
<td></td>
</tr>
<tr>
<td>CPU</td>
<td>Core(TM)2 Duo P8400</td>
<td>2.26GHz 2核2线程</td>
</tr>
<tr>
<td>Chipset</td>
<td>Intel GM45 Express</td>
<td>1066MHz</td>
</tr>
<tr>
<td>内存</td>
<td>型号不明，看实物为尔必达颗粒</td>
<td>DDR3-1066 PC3-8500 1G x2</td>
</tr>
<tr>
<td>硬盘</td>
<td>Seagate ST3500820AS</td>
<td>500G容量，7200转/s，5V 0.65A，12V 0.42A</td>
</tr>
<tr>
<td>LAN</td>
<td>Marvell 88E8055</td>
<td>1000BASE-T/100BASE-TX/10BASE-T,支持WOL</td>
</tr>
<tr>
<td>WIFI</td>
<td>Qualcomm Atheros AR928X</td>
<td>IEEE802.11/a/b/g/n</td>
</tr>
<tr>
<td>USB</td>
<td></td>
<td>USB2.0(4pin x5)</td>
</tr>
<tr>
<td>显示器</td>
<td></td>
<td>19inch，1440 x 900</td>
</tr>
</tbody>
</table>
</div>
<span id="more"></span>
<blockquote>
<p>官网建议最大内存 4G(2G x2)，是因为当时预装的 Windows Vista Home 是 32 位系统，最大支持 4G 内存，而根据 GN45 Express 的 Chipset 规格最大可支持 8G(4G x2) 内存。</p>
</blockquote>
<p>相关命令:</p>
<pre><code class="lang-bash">lscpu #使用程序将 sysfs 和 /proc/cpuinfo 中的详细 CPU 信息输出到屏幕
sudo dmidecode -t 2 #主板信息
sudo dmidecode -t 16 #内存信息
lspci | grep Ethernet #有线网卡
lspci | greo Wireless #无线网卡
iwconfig #无线网卡
</code></pre>
<h1 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h1><p>Debian 有很多版本，由于机器比较老，我使用的是 32 位的 dvd 映像进行的安装。<br>下载地址: <a href="https://cdimage.debian.org/debian-cd/current/i386/bt-dvd/">debian-12.5.0-i386-DVD-1.iso.torrent</a></p>
<h1 id="安装系统"><a href="#安装系统" class="headerlink" title="安装系统"></a>安装系统</h1><p>使用 Ventoy 正常安装即可。</p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h2><p>由于使用的 DVD 映像进行的系统安装，在后续安装软件时会优先使用介质安装，需要在 <code>/etc/apt/source.list</code> 中关闭映像安装，如下在第一行中添加 <code>#</code> 进行注释(我在安装系统时选择的是华为的镜像源)。</p>
<pre><code class="lang-bash"># deb cdrom:[Debian GNU/Linux 12.5.0 _Bookworm_ - Official i386 DVD Binary-1 with firmware 20240210-11:28]/ bookworm contrib main non-free-firmware

deb http://mirrors.huaweicloud.com/debian/ bookworm main non-free-firmware
deb-src http://mirrors.huaweicloud.com/debian/ bookworm main non-free-firmware

deb http://security.debian.org/debian-security bookworm-security main non-free-firmware
deb-src http://security.debian.org/debian-security bookworm-security main non-free-firmware

# bookworm-updates, to get updates before a point release is made;
# see https://www.debian.org/doc/manuals/debian-reference/ch02.en.html#_updates_and_backports
deb http://mirrors.huaweicloud.com/debian/ bookworm-updates main non-free-firmware
deb-src http://mirrors.huaweicloud.com/debian/ bookworm-updates main non-free-firmware
</code></pre>
<h2 id="用户权限"><a href="#用户权限" class="headerlink" title="用户权限"></a>用户权限</h2><p>在安装系统时会设置两个用户，一个 root 用户，一个普通用户，而使用普通用户时默认无法使用<code>sudo</code>，所以需要安装<code>sudo</code>并添加权限。</p>
<ol>
<li>安装<code>sudo</code><br>切换至 root 用户并安装<code>sudo</code>:<pre><code class="lang-bash">su root
apt install sudo
</code></pre>
</li>
<li>添加权限<br>网上介绍了两种方法，但我使用方法一的时候没有成功，建议直接使用方法二。<br>方法一: 切换至 root 用户并执行下面的命令。<pre><code class="lang-bash">sudo usermod -aG sudo username
</code></pre>
上面命令中的 username 换成自己的用户名。<br>方法二: 切换至 root 用户，在 <code>/etc/sudoer.d/</code> 目录下新建一个以自己用户名为文件名的文件。<pre><code class="lang-bash">touch /etc/sudoer.d/username
nano /etc/sudoer.d/username
</code></pre>
添加以下内容:<pre><code class="lang-bash">username ALL=(ALL)ALL
</code></pre>
注意上面的 username 需要换成自己的用户名，然后 Ctrl+X 保存退出并切换回自己的用户就可以了。</li>
</ol>
<h2 id="配置语言"><a href="#配置语言" class="headerlink" title="配置语言"></a>配置语言</h2><p>在安装过程中如果选择系统语言为英语进行安装的话进入系统后还要设置语言为中文并安装中文输入法，折腾了一番成功了但是具体的步骤不知道是否合理。</p>
<ol>
<li>安装语言包<pre><code class="lang-bash">sudo apt update
sudo apt install locales
</code></pre>
</li>
<li>配置 <code>locale</code><pre><code class="lang-bash">sudo dpkg-reconfigure locales
</code></pre>
在出现的对话框的表里一直下拉选择 <code>zh_CN.UTF-8</code> 。然后在下一个界面中选择 <code>zh_CN.UTF-8</code> 作为默认的 <code>locale</code> 。</li>
<li>安装中文字体(非必需)<pre><code class="lang-bash">sudo apt install fonts-wqy-microhei fonts-wqy-zenhei xfonts-wqy
</code></pre>
</li>
<li>安装中文输入法<br>(1) 如果原来有安装先卸载<pre><code class="lang-bash">sudo apt purge fcitx* ibus*
</code></pre>
(2) 安装 fcitx5 中文拼音输入法<pre><code class="lang-bash">sudo apt install fcitx5 fcitx5-chinese-addons
</code></pre>
(3) 然后重启系统打开 fcitx 配置根据自己的需要进行配置即可。</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Debian Linux 使用 -- 远程桌面黑屏并闪退</title>
    <url>/2024/05/11/Debian-Linux-%E4%BD%BF%E7%94%A8-%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E9%BB%91%E5%B1%8F%E5%B9%B6%E9%97%AA%E9%80%80/</url>
    <content><![CDATA[<h1 id="安装-Xrdp-使用-Xorg-进行远程登录"><a href="#安装-Xrdp-使用-Xorg-进行远程登录" class="headerlink" title="安装 Xrdp 使用 Xorg 进行远程登录"></a>安装 Xrdp 使用 Xorg 进行远程登录</h1><p>网上有很多远程桌面的登录方法，如 VNC、X11 转发等等，由于不喜欢安装太多软件，想使用 Windoews 自带的远程桌面。</p>
<pre><code class="lang-bash">sudo apt install xrdp
</code></pre>
<span id="more"></span>
<p>安装完成后该服务将自动开启，可通过下面命令确认是否开启:</p>
<pre><code class="lang-bash">sudo systemctl status xrdp
</code></pre>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240511104423.png" alt="20240511104423"><br>红框处显示 <code>active(running)</code> 则说明已开启。</p>
<h1 id="解决远程桌面连接上之后黑屏并闪退问题"><a href="#解决远程桌面连接上之后黑屏并闪退问题" class="headerlink" title="解决远程桌面连接上之后黑屏并闪退问题"></a>解决远程桌面连接上之后黑屏并闪退问题</h1><p>这个经常会有人说更换 test 版本的 xrdp 来解决，但是通过以下办法可以正常登录。<br>编辑<code>/etc/xrdp/startwm.sh</code></p>
<pre><code class="lang-bash">sudo vi /etc/xrdp/startwm.sh
</code></pre>
<p>加入下面三行内容:</p>
<pre><code class="lang-bash">unset DBUS_SESSION_BUS_ADDRESS
unset XDG_RUNTIME_DIR
. $HOME/.profile
</code></pre>
<p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240511104947.png" alt="20240511104947"><br>然后就可以通过 Xorg 登录看到桌面了。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240511105324.png" alt="20240511105324"></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>QNAP-海报墙可刮削IP</title>
    <url>/2024/06/12/QNAP-%E6%B5%B7%E6%8A%A5%E5%A2%99%E5%8F%AF%E5%88%AE%E5%89%8AIP/</url>
    <content><![CDATA[<p>目前解决海报墙不可刮削问题的方法基本都是修改 hosts，因为墙屏蔽的是特殊 IP，而不是 themovie 等网站本身。</p>
<ol>
<li>修改 QNAP 的 hosts 文件:<br>这种方法比较简单方便，缺点就是每次威联通重启就会重置 hosts 文件。<br><code>sudo vi /etc/hosts</code><br>在 hosts 文件中指定域名的 IP 地址: <code>13.226.238.82 api.themoviedb.org</code></li>
<li>修改路由器的 hosts 文件:<br>这种方法一劳永逸，但是需要能够 ssh 路由器并取得 root 权限。<br>操作方法及添加内容与 1. 相同。</li>
</ol>
<p>在网上看到一个刮削网站的 IP 清单，将测试通过的记录如下:(摘自:<a href="https://post.smzdm.com/p/az6x9m00/">NAS干货分享 篇一：一招解决影片削挂问题，打造完美海报墙</a>)</p>
<pre><code class="lang-hosts">13.224.161.90 api.themoviedb.org
104.16.61.155 image.themoviedb.org
13.35.67.86 api.themoviedb.org
54.192.151.79 www.themoviedb.org
13.249.175.212 api.thetvdb.com
13.35.161.120 api.thetvdb.com
13.226.238.76 api.themoviedb.org
13.35.7.102 api.themoviedb.org
13.226.191.85 api.themoviedb.org
52.85.79.89 api.themoviedb.org
13.225.41.40 api.themoviedb.org
13.226.251.88 api.themoviedb.org
</code></pre>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>QNAP</tag>
      </tags>
  </entry>
  <entry>
    <title>部署私有KMS激活服务器激活Office</title>
    <url>/2024/06/14/%E9%83%A8%E7%BD%B2%E7%A7%81%E6%9C%89KMS%E6%BF%80%E6%B4%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%BF%80%E6%B4%BBOffice/</url>
    <content><![CDATA[<h1 id="创建-iStoreOS-虚拟机"><a href="#创建-iStoreOS-虚拟机" class="headerlink" title="创建 iStoreOS 虚拟机"></a>创建 iStoreOS 虚拟机</h1><p>今年 618 入坑威联通，终于知道为什么大家都推荐群晖了，软件使用还好但是配置方法确实不太人性化。话归正传:</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ol>
<li>QTS 中要安装有 <code>Virtualization Station 虚拟化工作站</code>；</li>
<li>下载 iStoreOS 映像文件，本次使用的是 <code>istoreos-22.03.6-2024052410-x86-64-squashfs-combined.vmdk</code>，可以到<a href="https://fw.koolcenter.com/iStoreOS/x86_64/">这里</a>下载。我下载的 vmdk 文件，然后发现威联通不认 vmdk，又用威联通自带的工具转成了 img 映像。感觉应该是可以直接使用下载的 img 映像来安装。<span id="more"></span>
<h2 id="安装-iStoreOS-虚拟机系统"><a href="#安装-iStoreOS-虚拟机系统" class="headerlink" title="安装 iStoreOS 虚拟机系统"></a>安装 iStoreOS 虚拟机系统</h2>打开 Virtualization Station，点击”建立”，弹出如下对话框；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/iStoreOS1.png" alt="iStoreOS1"><br>虚拟机名称自己起一个喜欢的名字就可以，文件位置是虚拟机要安装的位置。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/iStoreOS2.png" alt="iStoreOS2"><br>自定义设置里选择”使用现有映像”，然后指定转换好的的 img 映像存放路径。<br>其它默认即可，最后会出来配置总览，确认无误后点击”建立”，iStoreOS 的虚拟机系统就建立成功了。<h2 id="配置-iSoreOS"><a href="#配置-iSoreOS" class="headerlink" title="配置 iSoreOS"></a>配置 iSoreOS</h2>由于我是使用 iStoreOS 作为旁路网关，除了配置以下网络之外其它默认即可:<br>首先在主路由中确认 iStoreOS 的 IP 地址，然后在浏览器中输入就可以进入到 iStaoreOS 的管理界面。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240615125041.png" alt="20240615125041"><br>点击”网络向导”根据个人需求选择上网方式即可，这里选择”配置为旁路由”。<br>然后将 IP 地址、子网掩码、网关、DNS 依次输入即可。<blockquote>
<p>IP 地址: 192.168.50.73 (设置 iStorOS 的访问地址)<br>子网掩码: 255.255.255.0<br>网关: 192.168.50.1 (主路由的 IP 地址)<br>DNS: 192.168.50.1 (主路由的 IP 地址)<br>也可 ssh 登录使用命令<code>vi /etc/config/network</code>编辑。<br>编辑方法:<br>找到带有<code>lan</code>字符的位置，添加如下文本:</p>
<pre><code class="lang-vi">option ipaddr &#39;192.168.50.73&#39;
option netmask &#39;255.255.255.0&#39;
option gateway &#39;192.168.50.1&#39;
</code></pre>
<p>旁路网关其它设置默认即可。</p>
<h1 id="安装-KMS-服务器插件"><a href="#安装-KMS-服务器插件" class="headerlink" title="安装 KMS 服务器插件"></a>安装 KMS 服务器插件</h1><p>点击”iStore”，找到”KMS服务器”插件，点击右下角的”安装”按钮。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240615144400.png" alt="20240615144400"><br>安装完成后就可以在”iStore”的已安装中看到，点击打开，看到绿色的”KMS 运行中”就说明已经可以了。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240615144523.png" alt="20240615144523"></p>
<h1 id="激活Office"><a href="#激活Office" class="headerlink" title="激活Office"></a>激活Office</h1><p>激活 Office 这里出了一点小问题，由于以前通过激活软件进行的激活，现在到期了，如果激活时出现<code>0x80080005</code>错误码需要设置一下把原来的配置清空。<br>参照:<a href="https://github.com/YerongAI/Office-Tool/issues/216">[IDEA] 增加修复0x80080005错误的功能 #216</a><br>问题描述:<br>目前发现 服务器运行失败 (0x80080005) 是由于KMS工具劫持 SppExtComObj.exe 程序，而未能正确运行导致，因此可以在Office Tool 中增加对此劫持的检测，并进行修复。<br>如运行 C:\WINDOWS\system32\SppExtComObj.exe，正常情况应会无任何提示的返回，失效的KMS劫持会导致弹窗报错如下图<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240615144857.png" alt="20240615144857"><br>解决方法:</p>
</blockquote>
</li>
<li>检测注册表是否存在配置项 HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\SppExtComObj.exe<br>如存在，则将其删除</li>
<li>运行 C:\WINDOWS\system32\SppExtComObj.exe，如正常则会立刻返回，退出码应为0</li>
<li>提示用户尝试再次激活</li>
</ol>
<p>上述操作完成之后，如为安装可以先使用 <a href="https://otp.landian.vip/zh-cn/download.html">Office Tool Plus.exe</a> 选择需要的版本进行部署。<br>本文以 office 2021 举例:<br>开始 =&gt; CMD =&gt; 使用管理员打开，分别输入以下命令进行激活:</p>
<pre><code class="lang-bash">cd /d &quot;%ProgramFiles%\Microsoft Office\Office16&quot; #进入指定目录
cscript OSPP.VBS /sethst: 192.168.50.73:1688 #指定 kms 服务器地址和端口，默认端口 1688，如采用默认可不指定，如外网需要则要将端口映射出去
cscript OSPP.VBS /act #激活当前安装的Office。
cscript OSPP.VBS /dstatus #显示当前已安装产品密钥的许可证信息。可以查看到自已安裝的版本有多少个序列号。
</code></pre>
<p>输入上面命令后的输出分别如下:</p>
<pre><code class="lang-bash">c:\Windows\System32&gt;cd /d &quot;%ProgramFiles%\Microsoft Office\Office16&quot;
C:\Program Files\Microsoft Office\Office16&gt;cscript OSPP.VBS /sethst:kms-server addr.
Microsoft (R) Windows Script Host Version 5.812
版权所有(C) Microsoft Corporation。保留所有权利。

---Processing--------------------------
---------------------------------------
Successfully applied setting.
---------------------------------------
---Exiting-----------------------------

C:\Program Files\Microsoft Office\Office16&gt;cscript OSPP.VBS /act
Microsoft (R) Windows Script Host Version 5.812
版权所有(C) Microsoft Corporation。保留所有权利。

---Processing--------------------------
---------------------------------------
Installed product key detected - attempting to activate the following product:
SKU ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
LICENSE NAME: Office 21, Office21VisioPro2021VL_KMS_Client_AE edition
LICENSE DESCRIPTION: Office 21, VOLUME_KMSCLIENT channel
Last 5 characters of installed product key: XXXXX
&lt;Product activation successful&gt;
---------------------------------------
Installed product key detected - attempting to activate the following product:
SKU ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
LICENSE NAME: Office 21, Office21ProPlus2021VL_KMS_Client_AE edition
LICENSE DESCRIPTION: Office 21, VOLUME_KMSCLIENT channel
Last 5 characters of installed product key: XXXXX
&lt;Product activation successful&gt;
---------------------------------------
---------------------------------------
---Exiting-----------------------------

C:\Program Files\Microsoft Office\Office16&gt;cscript OSPP.VBS /dstatus
Microsoft (R) Windows Script Host Version 5.812
版权所有(C) Microsoft Corporation。保留所有权利。

---Processing--------------------------
---------------------------------------
PRODUCT ID: XXXXX-XXXXX-XXXXX-XXXXX
SKU ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
LICENSE NAME: Office 21, Office21VisioPro2021VL_KMS_Client_AE edition
LICENSE DESCRIPTION: Office 21, VOLUME_KMSCLIENT channel
BETA EXPIRATION: 1601/1/1
LICENSE STATUS:  ---LICENSED---
REMAINING GRACE: 179 days  (259172 minute(s) before expiring)
Last 5 characters of installed product key: K2HT4
Activation Type Configuration: ALL
        DNS auto-discovery: KMS name not available
        KMS machine registry override defined: kms-server addr:1688
        Activation Interval: 120 minutes
        Renewal Interval: 10080 minutes
        KMS host caching: Enabled
---------------------------------------
PRODUCT ID: XXXXX-XXXXX-XXXXX-XXXXX
SKU ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
LICENSE NAME: Office 21, Office21ProPlus2021VL_KMS_Client_AE edition
LICENSE DESCRIPTION: Office 21, VOLUME_KMSCLIENT channel
BETA EXPIRATION: 1601/1/1
LICENSE STATUS:  ---LICENSED---
REMAINING GRACE: 179 days  (259172 minute(s) before expiring)
Last 5 characters of installed product key: 6F7TH
Activation Type Configuration: ALL
        DNS auto-discovery: KMS name not available
        KMS machine registry override defined: kms-server addr:1688
        Activation Interval: 120 minutes
        Renewal Interval: 10080 minutes
        KMS host caching: Enabled
---------------------------------------
---------------------------------------
---Exiting-----------------------------
</code></pre>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>QNAP虚拟机安装ubuntu 18.04 无法登录远程桌面</title>
    <url>/2024/08/08/QNAP%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85ubuntu-18-04-%E6%97%A0%E6%B3%95%E7%99%BB%E5%BD%95%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2/</url>
    <content><![CDATA[<h1 id="在-QNAP-上安装-Ubuntu-Linux-工作站"><a href="#在-QNAP-上安装-Ubuntu-Linux-工作站" class="headerlink" title="在 QNAP 上安装 Ubuntu Linux 工作站"></a>在 QNAP 上安装 Ubuntu Linux 工作站</h1><p>本来想在 QNAP 上使用 “Vitualization Station 虚拟化工作站”中安装一个 Linux 服务器版系统跑一些服务，但是尝试了 Debian 12.6 和 Ubuntu 18.04 都卡在了磁盘分区的设置上，感觉像是识别不到硬盘，无法安装文件系统。<br>没有办法只有转战 QNAP 自带的 Ubuntu Linux 工作站了，通过跟客服咨询，这个 App 只有桌面版无法安装 Server 版。<br>既然安装了桌面版，那当然要设置成能够远程登录了。<br><span id="more"></span></p>
<h1 id="安装-xrdp-服务器等软件"><a href="#安装-xrdp-服务器等软件" class="headerlink" title="安装 xrdp 服务器等软件"></a>安装 xrdp 服务器等软件</h1><p>由于一直登录不上，所以搞清楚原因之前杂七杂八装了很多，也不知道哪个是非必需的，总之目前安装上的软件如下:(安装命令从上到下为个人感觉必要性高低)</p>
<pre><code class="lang-bash">sudo apt-get update
sudo apt-get install xrdp
sudo apt-get install xfce4 xfce4-goodies
sudo apt-get install vnc4server tightvnc
sudo apt-get install xorg
</code></pre>
<p>刚开始的时候只安装了 xrdp 和 xfce4，感觉只用这两个就可以了，但是由于后面一直登录不上不知道原因所以又装了一大堆。<br>还有好像可以不用 xfce4，直接连接 GNOME 的远程桌面，那样的话我感觉才 xfce4 都不需要安装，没有详细研究先不讨论。</p>
<p>安装完之后打开服务，由于使用 zerotier 进行组网，所以没有进行端口映射和防火墙的设置。</p>
<pre><code class="lang-bash">sudo systemctl start xrdp
</code></pre>
<h1 id="无法登录远程桌面及解决方法"><a href="#无法登录远程桌面及解决方法" class="headerlink" title="无法登录远程桌面及解决方法"></a>无法登录远程桌面及解决方法</h1><p>通过 Win11 连接远程桌面的时候发现输入完登录信息点击”OK”按钮之后就一直没有任何反应，通过查看服务状态<code>systemctl status xdrp</code>。发现错误信息:<code>[ERROR] xrdp_wm_log_msg: Error connecting to sesman: 127.0.0.1 port: 3350</code> 。<br>通过搜索，在 Github 上找到了<a href="https://github.com/neutrinolabs/xrdp/issues/1777">答案</a>，虽然对原理不是很理解，但是觉得说的很有道理于是开始尝试。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240808153629.png" alt="20240808153629"><br>这是在设置的时候有点问题，本人设置步骤如下:</p>
<pre><code class="lang-bash">sysctl -a | grep disable_ipv6
</code></pre>
<blockquote>
<p>sysctl: reading key “net.ipv6.conf.all.stable_secret”<br>net.ipv6.conf.all.disable_ipv6 = 1<br>sysctl: reading key “net.ipv6.conf.default.stable_secret”<br>net.ipv6.conf.default.disable_ipv6 = 1<br>sysctl: reading key “net.ipv6.conf.eth0.stable_secret”<br>net.ipv6.conf.eth0.disable_ipv6 = 0<br>sysctl: reading key “net.ipv6.conf.eth1.stable_secret”<br>net.ipv6.conf.eth1.disable_ipv6 = 0<br>sysctl: reading key “net.ipv6.conf.eth2.stable_secret”<br>net.ipv6.conf.eth2.disable_ipv6 = 0<br>sysctl: reading key “net.ipv6.conf.lo.stable_secret”<br>net.ipv6.conf.lo.disable_ipv6 = 1<br>sysctl: reading key “net.ipv6.conf.ztjlhq7oim.stable_secret”<br>net.ipv6.conf.ztjlhq7oim.disable_ipv6 = 1</p>
</blockquote>
<p>于是根据上面的解答解答需要将<code>net.ipv6.conf.eth0.disable_ipv6</code>、<code>net.ipv6.conf.eth1.disable_ipv6</code>、<code>net.ipv6.conf.eth2.disable_ipv6</code>的值设为 1。</p>
<h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><pre><code class="lang-bash">sudo sysctl -w net.ipv6.conf.eth0.disable_ipv6=1
sudo sysctl -w net.ipv6.conf.eth1.disable_ipv6=1
sudo sysctl -w net.ipv6.conf.eth2.disable_ipv6=1
</code></pre>
<h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p>设置<code>/etc/sysctl.conf</code>文件</p>
<pre><code class="lang-bash">sudo vi /etc/sysctl.conf
</code></pre>
<p>在文件末尾加入下面三行:</p>
<pre><code class="lang-bash">net.ipv6.conf.all.disable_ipv6=0
net.ipv6.conf.default.disable_ipv6=0
net.ipv6.conf.lo.disable_ipv6=0
</code></pre>
<p>使配置修改生效</p>
<pre><code class="lang-bash">sudo sysctl -p
</code></pre>
<p>经实验，上述两种方法只能暂时禁用<code>ipv6</code>，重启之后就会失效。长期生效方法:<a href="https://linux.cn/article-12689-1.html">如何在 Ubuntu Linux 上禁用 IPv6</a></p>
<p>然后就登录进去了，虽然是 xfce 桌面。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240808154353.png" alt="20240808154353"></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>QNAP</tag>
      </tags>
  </entry>
  <entry>
    <title>QNAP虚拟机映像转换问题</title>
    <url>/2024/08/12/QNAP%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%98%A0%E5%83%8F%E8%BD%AC%E6%8D%A2%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>QNAP 的虚拟机必须要使用自己转换出的<code>.img</code>，下面记录一下自己安装虚拟机的映像转换过程。<br><span id="more"></span></p>
<h1 id="IMG文件"><a href="#IMG文件" class="headerlink" title="IMG文件"></a>IMG文件</h1><p>QNAP 上安装了iStoreOS 系统的旁路由虚拟机，先使用 <a href="https://www.starwindsoftware.com/starwind-v2v-converter#download">StarWind V2V Convertor</a> 软件将<code>IMG</code>文件转换为 QNAP Virtual Station 中可以使用的 <code>.vdi</code> 或 <code>.vdmk</code> 文件，然后使用 QNAP Vistual Station 内置的转换工具进行转换，转换完就是其可以使用的 <code>.img</code> 文件了。</p>
<blockquote>
<p>这个系统已安装成功！</p>
</blockquote>
<h1 id="ISO文件"><a href="#ISO文件" class="headerlink" title="ISO文件"></a>ISO文件</h1><h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><p><code>.iso</code> 文件网上的信息很少，唯一有点用处的如下<a href="https://blog.csdn.net/LiniLing/article/details/119864889">将ISO镜像转换成VDI、VDH和VMDK格式</a>:</p>
<ol>
<li>首先，要先下载两个软件: <a href="https://downloads2.broadcom.com/?file=VMware-workstation-full-17.5.2-23775571.exe&amp;oid=30581048&amp;id=sQ9ZBRmMMB_QK60kfaL-tcNlwWCDromgou84_F7-Mkxcey9zd6BIhyhHVbcjvGfqYxM=&amp;verify=1722998592-oxwenmxozDwNlEOLBkXvPXCUcQOw2EOmWEej20K6%2FeU%3D">VMWare</a> 和 <a href="https://download.virtualbox.org/virtualbox/7.0.20/VirtualBox-7.0.20-163906-Win.exe">VirtualBox</a></li>
<li>在 VMWare 中使用<code>.iso</code>映像安装好虚拟机；</li>
<li>选中安装好的虚拟机，文件=&gt;导出为OVF，然后会生成 4 个文件；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240812092446.png" alt="20240812092446"></li>
<li>打开 VirtualBox 软件，</li>
<li>上述方法由于还没有实践过，未验证成功，等验证成功后再补充完整步骤。<h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><strong>.iso</strong>的文件大概介绍如下：iso格式，ISO是一种光盘镜像文件，无法直接使用，需要利用一些工具进行解压后才能使用。ISO一般都是将光盘文件做成一个文件，而有一些光盘软件设定只能从光驱进行安装，那么直接解压后还是不能使用，需要用到虚拟光驱软件（虚拟光驱的软件很多，Daemon Tools是一款不错的虚拟光驱软件）<br><strong>.img</strong>文件大概介绍如下：img格式，IMG是一种文件压缩格式（archive format），.IMG这个文件格式可视为.ISO格式的一种超集合。由于.ISO只能压缩使用ISO9660和UDF这两种文件系统的存储媒介，意即.ISO只能拿来压缩CD或DVD，因此才发展出了.IMG，它是以.ISO格式为基础另外新增可压缩使用其它文件系统的存储媒介的能力，.IMG可向后兼容于.ISO，如果是拿来压缩CD或DVD，则使用.IMG和.ISO这两种格式所压缩出来的内容是一样的。<br>从上面的介绍，可以看出.img是.iso的一种超集合，两者解压得到的东西是一样的，所以将一个.iso转化为.img，可以直接将.iso重命名为.img即可。<br>重命名为<code>.img</code>之后确实可以通过 StarWind V2V Convertor 软件转化为 <code>.vmdk</code> 文件了，并且也能够通过 QNAP Virtual Station 的转换工具转换为其可以使用的 <code>.img</code> 文件，也能开始引导安装，但是安装(Debian 12.6 和 Ubuntu 18.04)到磁盘分区的时候出现错误无法识别到硬盘，可能是设置哪里有问题，后续尝试成功后补充。</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>QNAP</tag>
      </tags>
  </entry>
  <entry>
    <title>Debian 12.6 - 安装TCP测试工具TCPing</title>
    <url>/2024/08/14/Debian-12-6-%E5%AE%89%E8%A3%85TCP%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7TCPing/</url>
    <content><![CDATA[<p><code>TCPing</code>是基于 TCP 协议的一种<code>ping</code>命令，用来测试数据包能否通过 TCP 协议到达目标主机。他的一大特点，就是可以在禁<code>ping</code>的时候检测网络连通率。<br><span id="more"></span></p>
<h1 id="安装tcptraceroute"><a href="#安装tcptraceroute" class="headerlink" title="安装tcptraceroute"></a>安装<code>tcptraceroute</code></h1><p><code>TCPing</code>本质上是一个 shell 脚本，依赖<code>tcptraceroute</code>运行。</p>
<pre><code class="lang-bash">sudo apt install tcptraceroute
</code></pre>
<h1 id="下载-TCPing"><a href="#下载-TCPing" class="headerlink" title="下载 TCPing"></a>下载 TCPing</h1><pre><code class="lang-bash">sudo wget http://www.vdberg.org/~richard/tcpping -O /usr/bin/tcping
</code></pre>
<h1 id="配置权限"><a href="#配置权限" class="headerlink" title="配置权限"></a>配置权限</h1><pre><code class="lang-bash">sudo chmod +x /usr/bin/tcping
</code></pre>
<h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><pre><code class="lang-bash">tcping 目标IP 目标端口
</code></pre>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>QNAP安装zerotier进行异地组网</title>
    <url>/2024/08/14/QNAP%E5%AE%89%E8%A3%85zerotier%E8%BF%9B%E8%A1%8C%E5%BC%82%E5%9C%B0%E7%BB%84%E7%BD%91/</url>
    <content><![CDATA[<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><ol>
<li>在 App Center 中安装 QVPN Service</li>
<li><span id="more"></span>
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240814122823.png" alt="20240814122823"></li>
<li>去 <a href="https://www.zerotier.com/download/">ZeroTier 官网</a> 下载相关的安装包<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240814123138.png" alt="20240814123138"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240814123221.png" alt="20240814123221"><h1 id="从本地安装-ZeroTier"><a href="#从本地安装-ZeroTier" class="headerlink" title="从本地安装 ZeroTier"></a>从本地安装 ZeroTier</h1><h2 id="允许没有有效数字签名的程序安装"><a href="#允许没有有效数字签名的程序安装" class="headerlink" title="允许没有有效数字签名的程序安装"></a>允许没有有效数字签名的程序安装</h2><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240814123719.png" alt="20240814123719"><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2></li>
<li>打开 App Center，右上角”手动安装”；</li>
<li>点击”浏览”，选中安装包；</li>
<li>点击”安装”。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240814124524.png" alt="20240814124524"><br>安装完成后，可以在所有应用中找到 Zerotier，但是和群晖不同，威联通上的 Zerotier 是无法点击打开的。(不明白为什么在”我的应用程序”中无法找到 Zerotier。)<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240814124911.png" alt="20240814124911"></li>
</ol>
<h1 id="加入网络"><a href="#加入网络" class="headerlink" title="加入网络"></a>加入网络</h1><p>Zerotier 的注册及申请方法不在此赘述，威联通安装好 Zerotier 软件后需要使用命令行来加入网络。且必须获取管理员权限才能安装。</p>
<pre><code class="lang-bash">[user@QNAP ~]$ zerotier-cli join xxxxxxxxxxxxxxxx
zerotier-cli: authtoken.secret not found or readable in /share/CACHEDEV1_DATA/.qpkg/zerotier (try again as root)
[user@QNAP ~]$ sudo zerotier-cli join xxxxxxxxxxxxxxxx

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

Password:
200 join OK
</code></pre>
<p>看到<code>200 join OK</code>，即意味着这台 NAS 已经加入了 zerotier 网络，然后就可以返回 zerotier 的网页管理端对这台设备进行授权。</p>
<h1 id="设置防火墙允许访问"><a href="#设置防火墙允许访问" class="headerlink" title="设置防火墙允许访问"></a>设置防火墙允许访问</h1><p>如果 QNAP 安装了防火墙<code>QuFirewall</code>，则需要添加一条规则允许 ZeroTier 虚拟局域网网段允许访问。</p>
<ol>
<li>打开<code>QuFirewall</code></li>
<li>点击”编辑”修改规则<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240814150010.png" alt="20240814150010"></li>
<li>点击”添加规则”；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240814170631.png" alt="20240814170631"></li>
<li>输入虚拟局域网的网段地址，子网掩码选<code>255.255.255.0/24</code>即可。其它设置不用更改，点击”应用”，防火墙就允许虚拟局域网网段访问了。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240814170809.png" alt="20240814170809"></li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>QNAP</tag>
        <tag>Zerotier</tag>
      </tags>
  </entry>
  <entry>
    <title>通过 ZeroTier 访问所在局域网的其它设备</title>
    <url>/2024/08/15/%E9%80%9A%E8%BF%87-ZeroTier-%E8%AE%BF%E9%97%AE%E6%89%80%E5%9C%A8%E5%B1%80%E5%9F%9F%E7%BD%91%E7%9A%84%E5%85%B6%E5%AE%83%E8%AE%BE%E5%A4%87/</url>
    <content><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>硬件: QNAP TS-464C<br>系统: iStore OS 虚拟机(Zerotier虚拟局域网网关)<br>软件: Zerotier<br>Zerotier 网段: 10.147.18.0/24<br>局域网网段: 192.168.3.0/24<br><span id="more"></span></p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="配置-Zerotier-设置"><a href="#配置-Zerotier-设置" class="headerlink" title="配置 Zerotier 设置"></a>配置 Zerotier 设置</h2><p><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240815112603.png" alt="20240815112603"></p>
<h2 id="配置-Zerotier-网关"><a href="#配置-Zerotier-网关" class="headerlink" title="配置 Zerotier 网关"></a>配置 Zerotier 网关</h2><ol>
<li>插件设置<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240815112706.png" alt="20240815112706"></li>
<li>配置网关开启内核转发<br>先 ssh 登录到 iStore OS(Zerotier虚拟局域网网关，执行以下命令:<pre><code class="lang-bash">echo &#39;net.ipv4.ip_forward=1&#39; &gt;&gt; /etc/sysctl.conf
sysctl -p
</code></pre>
<h2 id="访问方法"><a href="#访问方法" class="headerlink" title="访问方法"></a>访问方法</h2></li>
<li>重启一下使用的外网设备的 Zerotier 服务；</li>
<li>跟在局域网内访问相同，使用局域网地址访问即可。<h1 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h1></li>
<li>网上说需要开启 Zerotier 网关的地址伪装，即<code>MASQUERADE</code>；<pre><code class="lang-bash">iptables -t nat -A POSTROUTING -s 10.10.10.0/24 -j MASQUERADE
</code></pre>
</li>
<li>配置静态路由表；</li>
<li>防火墙放行 <code>9933</code> 端口。<br>上述三个步骤本次配置没有使用到，可能是 iStore OS 简化了配置，如果以后有需要使用 Linux 标准系统来使用的需求时再研究。</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>Zerotier</tag>
      </tags>
  </entry>
  <entry>
    <title>使用PS软件进行一寸证件照片打印排版</title>
    <url>/2024/08/17/%E4%BD%BF%E7%94%A8PS%E8%BD%AF%E4%BB%B6%E8%BF%9B%E8%A1%8C%E4%B8%80%E5%AF%B8%E8%AF%81%E4%BB%B6%E7%85%A7%E7%89%87%E6%89%93%E5%8D%B0%E6%8E%92%E7%89%88/</url>
    <content><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>系统: Windows 11<br>软件: Adobe Photoshop 24.5.0 版<br><span id="more"></span></p>
<h1 id="打开要排版的照片"><a href="#打开要排版的照片" class="headerlink" title="打开要排版的照片"></a>打开要排版的照片</h1><p>用 PS 软件打开要排版的照片。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817002004.png" alt="20240817002004"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817002207.png" alt="20240817002207"></p>
<h1 id="制作一寸证件照图案"><a href="#制作一寸证件照图案" class="headerlink" title="制作一寸证件照图案"></a>制作一寸证件照图案</h1><h2 id="设置画布给照片周围加上一圈白边"><a href="#设置画布给照片周围加上一圈白边" class="headerlink" title="设置画布给照片周围加上一圈白边"></a>设置画布给照片周围加上一圈白边</h2><p>图像 =&gt; 画布大小<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817002639.png" alt="20240817002639"><br>勾选相对，宽度和高度设置为 0.1 厘米，可根据实际情况调整，颜色选择白色，点击确定。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817002909.png" alt="20240817002909"></p>
<h2 id="裁剪图片"><a href="#裁剪图片" class="headerlink" title="裁剪图片"></a>裁剪图片</h2><p>图像 =&gt; 图像大小<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817003221.png" alt="20240817003221"><br>勾选重新采样，一寸照片的宽度为 2.6 厘米，高度为 3.6 厘米，分辨率填写 300 像素/英寸。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817003523.png" alt="20240817003523"><br>这样，照片就变为一寸大小了。</p>
<h2 id="定义图案"><a href="#定义图案" class="headerlink" title="定义图案"></a>定义图案</h2><p>编辑 =&gt; 定义图案<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817003819.png" alt="20240817003819"><br>图案名称根据自己需要填写，点击确定。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817003856.png" alt="20240817003856"><br>这样，图案就被定义并存在 PS 软件内备用了。</p>
<h1 id="制作画布"><a href="#制作画布" class="headerlink" title="制作画布"></a>制作画布</h1><p>文件 =&gt; 新建(画布)<br>主要填写图中框出的三个数值，即宽度、高度和分辨率。<br>如果要排版 3x3 的画布: 宽度 = 2.6厘米 x 3 = 7.8厘米；高度 = 3.6厘米 x 3 = 10.8厘米；分辨率填 300 像素/英寸。<br>如果要排版 4x2 的画布: 宽度 = 2.6厘米 x 4 = 10.4厘米；高度 = 3.6厘米 x 2 =7.2厘米；分辨率填 300 像素/英寸。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817004230.png" alt="20240817004230"><br>点击创建，画布就创建好了，下图为 3x3 画布。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817004638.png" alt="20240817004638"></p>
<h1 id="将照片嵌入画布"><a href="#将照片嵌入画布" class="headerlink" title="将照片嵌入画布"></a>将照片嵌入画布</h1><p>如上图，点击右下角中间位置的圆圈图标”创建新的填充或调整图层”，然后点击”图案”。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817005017.png" alt="20240817005017"><br>选择刚刚定义好的图案，一般会在最后一个。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817005110.png" alt="20240817005110"><br>点击”确定”，这样排版就制作好了。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817005413.png" alt="20240817005413"></p>
<h1 id="导出照片"><a href="#导出照片" class="headerlink" title="导出照片"></a>导出照片</h1><p>文件 =&gt; 导出 =&gt; 导出为<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240817005454.png" alt="20240817005454"><br>这里基本上没有什么需要设置的，点击”导出”，选择希望保存的位置和文件名即可。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>图片处理</category>
      </categories>
      <tags>
        <tag>Adobe</tag>
      </tags>
  </entry>
  <entry>
    <title>中国历史顺序表</title>
    <url>/2024/08/22/%E4%B8%AD%E5%9B%BD%E5%8E%86%E5%8F%B2%E9%A1%BA%E5%BA%8F%E8%A1%A8/</url>
    <content><![CDATA[<h1 id="中国历史顺序表"><a href="#中国历史顺序表" class="headerlink" title="中国历史顺序表"></a>中国历史顺序表</h1><h2 id="原始社会-170万年前-公元前21世纪"><a href="#原始社会-170万年前-公元前21世纪" class="headerlink" title="原始社会(170万年前~公元前21世纪)"></a>原始社会(170万年前~公元前21世纪)</h2><h3 id="旧石器时代-约170万年前-1万年前"><a href="#旧石器时代-约170万年前-1万年前" class="headerlink" title="旧石器时代(约170万年前~1万年前)"></a>旧石器时代(约170万年前~1万年前)</h3><ul>
<li>约 170 万年前，元谋人生活在云南元谋一带</li>
<li>约 80 万年前，蓝田人生活在山西蓝田一带</li>
<li>约 70~20 万年前，北京人生活在北京周口店一带</li>
<li>约 3 万年前，山顶洞人生活在北京周口店一带<span id="more"></span>
<h3 id="新石器时代-1万年前-4千年前"><a href="#新石器时代-1万年前-4千年前" class="headerlink" title="新石器时代(1万年前~4千年前)"></a>新石器时代(1万年前~4千年前)</h3></li>
<li>约 7000~5000 年前，河姆渡、半坡母系氏族公社</li>
<li>约 5000~4000 年前，大汶口文化中晚期—父系氏族公社<h3 id="三皇五帝"><a href="#三皇五帝" class="headerlink" title="三皇五帝"></a>三皇五帝</h3>三皇五帝已不可考，众说纷纭。<br>三皇:天皇、地皇、人皇<blockquote>
<blockquote>
<p>燧人、伏羲、神农 — 出自《尚书大传》<br>伏羲、女娲、神农 — 出自《春秋运斗枢》<br>伏羲、祝融、黄帝 — 出自《风俗通义》<br>伏羲　神农、黄帝 — 出自《三字经》<br>有巢氏、燧人氏 — 出自《庄子》、《纲鉴易知录》<br>五帝:东方青帝灵威仰、南方赤帝赤熛怒、中央黄帝含枢纽、西方白帝白招拒、北方黑帝汁光纪<br>太昊、炎帝、黄帝、少昊、颛顼 — 出自《吕氏春秋》<br>黄帝、颛顼、帝喾、尧、舜 — 出自《史记》《大戴礼记》<br>黄帝、少昊、颛顼、帝喾、尧 — 出自《资治通鉴外纪》</p>
</blockquote>
</blockquote>
</li>
</ul>
<h2 id="奴隶社会-公元前2070年-公元前476年"><a href="#奴隶社会-公元前2070年-公元前476年" class="headerlink" title="奴隶社会(公元前2070年~公元前476年)"></a>奴隶社会(公元前2070年~公元前476年)</h2><ul>
<li>夏: 公元前 2070 年 ~ 公元前 1600 年，禹之子启建夏，世袭取代禅让</li>
<li>商: 公元前 1601 年 ~ 公元前 1046 年，商汤灭夏，商朝建立</li>
<li>西周: 公元前 1046 年 ~ 公元前 771 年，周武王灭商，西周开始</li>
<li>东周: 公元前 770 年 ~ 公元前 476 年，俗称东周列国，分为前期和后期。<ul>
<li>东周前期俗称春秋时期，公元前 770 年 ~ 公元前 476 年，春秋时期诸侯争相称霸；</li>
<li>东周后期俗称战国时期，公元前 475 年 ~ 公元前 221 年。中国社会有奴隶制进入封建社会，出现战国七雄。<h2 id="封建社会-公元前475年-公元1840年"><a href="#封建社会-公元前475年-公元1840年" class="headerlink" title="封建社会(公元前475年~公元1840年)"></a>封建社会(公元前475年~公元1840年)</h2></li>
</ul>
</li>
<li>秦: 公元前 221 年 ~ 公元前 206 年，秦于战国七雄中崛起吞并六国，首建集权制帝国。</li>
<li>汉: 公元前 206 年 ~ 公元 220 年<ul>
<li>西汉: 公元前 206 年 ~ 公元 8 年，刘邦垓下之战灭项羽，称帝与长安。</li>
<li>新莽: 公元 9 年 ~ 公元 25 年，公元 8 年底，王莽篡位称帝，改国号为”新”。</li>
<li>东汉: 公元 25 年 ~ 公元 220 年，刘秀灭王莽，夺回政权，建都洛阳。</li>
</ul>
</li>
<li>三国: 公元 220 年 ~ 公元 280 年，东汉后期，曹操挟天子以令诸侯，出现三国鼎立。</li>
<li>西晋: 公元 266 年 ~ 公元 316年</li>
<li>东晋: 公元 317 年 ~ 公元 420 年</li>
<li>南北朝: 公元 420 年 ~ 公元 589 年</li>
<li>隋: 公元 581 年 ~ 公元 618 年</li>
<li>唐: 公元 618 年 ~ 公元 907 年</li>
<li>五代十国:<ul>
<li>五代: 公元 907 年 ~ 公元 960 年</li>
<li>十国: 公元 902 年 ~ 公元 979 年</li>
</ul>
</li>
<li>北宋: 公元 960 年 ~ 1127 年</li>
<li>南宋: 1127 年 ~ 1276 年</li>
<li>元: 1271 年 ~ 1368 年</li>
<li>明: 1368 年 ~ 1644 年</li>
<li>清: 1636 年 ~ 1911 年<h2 id="近代史"><a href="#近代史" class="headerlink" title="近代史"></a>近代史</h2>近代史从 1840 年鸦片战争开始。</li>
<li>民国: 1912 年 ~ 1949 年，中华民国成立。<h2 id="现代史"><a href="#现代史" class="headerlink" title="现代史"></a>现代史</h2>现代史从 1949 年中华人民共和国成立开始。</li>
<li>中华人民共和国: 1949 年 ~ 至今</li>
</ul>
<blockquote>
<blockquote>
<p>※※<br>三皇五帝始，尧舜禹相传。夏商与西周，东周分两段。春秋和战国，一统秦两汉。<br>三分魏蜀吴，二晋前后延。南北朝并立，隋唐五代传。宋元明清后，皇朝至此完。</p>
</blockquote>
</blockquote>
<h1 id="中国历史大事纪"><a href="#中国历史大事纪" class="headerlink" title="中国历史大事纪"></a>中国历史大事纪</h1><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>杂学</category>
        <category>历史</category>
      </categories>
  </entry>
  <entry>
    <title>相片尺寸</title>
    <url>/2024/08/28/%E7%9B%B8%E7%89%87%E5%B0%BA%E5%AF%B8/</url>
    <content><![CDATA[<p>最近想搞一个证件照片排版的小程序，上维基百科上查了相片尺寸。<br><span id="more"></span></p>
<h1 id="标准"><a href="#标准" class="headerlink" title="标准"></a>标准</h1><p>—————————————————————-Wiki—————————————————————-<br>相片尺寸是相片冲印时用到的标准尺寸。<br>这些尺寸会标示为 nR，n 是代表冲印出来相片较短一边的长度(以吋作单位)。相片的尺寸分为两类: 通常(Normal)和超级(Super)。<strong>通常</strong>类短边为十吋以内(即 10R 以内)的相片，长边会比短边长两吋。反之则会长三吋。而<strong>超级类</strong>的相片大小，则会呈大约 3:2 的比例，而尺寸会标示为 SnR。<br>这些冲印尺寸在日本有着不同的称呼，就例如 3R 在日本成为 L，两倍大的 2L 则与 5R 相符。除此以外，在日本，相片还有一些特别的尺寸和相应的称呼，就例如 KG 指日本明信片常见的大小(102x152 毫米)。而 nP 则是参照一张书写用纸张的尺寸(457x560毫米)所制订的称呼。<br>与 ISO 216 纸张尺寸不同，相片的长宽比并不标准。但是，相片的尺寸大小会有着对应，详见下表。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>美国</th>
<th>日本</th>
<th>中国</th>
<th>大小(吋)</th>
<th>大小(毫米)</th>
<th>300ppi(像素/吋)</th>
<th>长宽比</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td>1寸</td>
<td></td>
<td>25x35 mm</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>大1寸/小2寸</td>
<td></td>
<td>33x48 mm</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>2寸</td>
<td></td>
<td>37x49mm(证件照)/37x53 mm(标准2寸)</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>2” x 2”</td>
<td>51x51 mm</td>
<td></td>
<td>1:1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>E</td>
<td></td>
<td>3.25”x4.5”</td>
<td>82.5x120 mm</td>
<td></td>
<td>16:11(1.45)</td>
<td>约数</td>
</tr>
<tr>
<td>2R</td>
<td></td>
<td></td>
<td>2.5”x3.5”</td>
<td>63.5x89 mm</td>
<td>750x1050 px</td>
<td></td>
<td></td>
</tr>
<tr>
<td>3R</td>
<td>L</td>
<td>5寸</td>
<td>3.5”x5”</td>
<td>89x127mm</td>
<td>1051x1500 px</td>
<td>10:7(1.43)</td>
<td>又称为”9x13 cm”</td>
</tr>
<tr>
<td>4R</td>
<td>KG</td>
<td>6寸</td>
<td>4”x6”</td>
<td>102x152 mm</td>
<td>1205x1795 px</td>
<td>3:2(1.5)</td>
<td>标准 135 底片尺寸。美国，加拿大，澳洲及印度的标准相片尺寸。又称为”10x15 cm”</td>
</tr>
<tr>
<td>4D</td>
<td></td>
<td></td>
<td>4.5”x6”</td>
<td>114x152 mm</td>
<td>1350x1800 px</td>
<td>4:3(1.33)</td>
<td>为大部分大众化的数码相机及采用微4/3系统的相机的新尺寸</td>
</tr>
<tr>
<td>5R</td>
<td>2L</td>
<td>7寸</td>
<td>5”x7”</td>
<td>127x178 mm</td>
<td>1500x2102 px</td>
<td>7:5(1.4)</td>
<td>3R大小的两倍，又称为”13x18 cm”</td>
</tr>
<tr>
<td>6R</td>
<td>8P</td>
<td>8寸</td>
<td>6”x8”</td>
<td>152x203 mm</td>
<td>1795x2398 px</td>
<td>4:3(1.33)</td>
<td>4R大小的两倍</td>
</tr>
<tr>
<td>8R</td>
<td>6P</td>
<td></td>
<td>8”x10”</td>
<td>203x254 mm</td>
<td>2398x3000 px</td>
<td>5:4(1、/5)</td>
<td>又称为”20x25 cm”</td>
</tr>
<tr>
<td>S8R</td>
<td>6PW</td>
<td>小12寸</td>
<td>8”x12”</td>
<td>203x254 mm</td>
<td>2398x3602 px</td>
<td>3:2(1.5)</td>
<td>最接近 A4 纸的大小。6R 大小的两倍，又称为”20x30 cm”</td>
</tr>
<tr>
<td>10R</td>
<td>4P</td>
<td>大12寸</td>
<td>10”x12”</td>
<td>254x305 mm</td>
<td>3000x3602 px</td>
<td>6:5(1.2)</td>
<td></td>
</tr>
<tr>
<td>S10R</td>
<td>4PW</td>
<td></td>
<td>10”x15”</td>
<td>254x381 mm</td>
<td>3000x4500 px</td>
<td>3:2(1.5)</td>
<td></td>
</tr>
<tr>
<td>11R</td>
<td></td>
<td></td>
<td>11”x14”</td>
<td>279x356 mm</td>
<td>3295x4205 px</td>
<td>14:11(1.27)</td>
<td>又称为”28x36 cm”</td>
</tr>
<tr>
<td>S11R</td>
<td></td>
<td></td>
<td>11”x17”</td>
<td>279x432 mm</td>
<td>3295x5102 px</td>
<td>17:11(1.54)</td>
<td></td>
</tr>
<tr>
<td>12R</td>
<td></td>
<td></td>
<td>12”x15”</td>
<td>305x381 mm</td>
<td>3602x4500 px</td>
<td>5:4(1.25)</td>
<td></td>
</tr>
<tr>
<td>S12R</td>
<td></td>
<td></td>
<td>12”x18”</td>
<td>305x465 mm</td>
<td>3602x5492 px</td>
<td>3:2(1.5)</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>—————————————————————-Wiki—————————————————————-<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240828003807.png" alt="20240828003807"></p>
<h1 id="国内常用"><a href="#国内常用" class="headerlink" title="国内常用"></a>国内常用</h1><div class="table-container">
<table>
<thead>
<tr>
<th>名称</th>
<th>照片大小</th>
<th>像素大小</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>小1寸</td>
<td>2.2x3.3 cm</td>
<td></td>
<td>身份证、体检表</td>
</tr>
<tr>
<td>1寸照</td>
<td>2.5x3.5 cm</td>
<td>413x295</td>
<td>-</td>
</tr>
<tr>
<td>大1寸</td>
<td>3.3x4.8 cm</td>
<td></td>
<td>学位证书</td>
</tr>
<tr>
<td>身份证大头照</td>
<td>3.3x2.2 cm</td>
<td>390x260</td>
<td></td>
</tr>
<tr>
<td></td>
<td>2.6x3.2 cm</td>
<td></td>
<td>二代身份证</td>
</tr>
<tr>
<td>小2寸</td>
<td>3.3x4.8 cm</td>
<td>567x390</td>
<td>中国护照、港澳通行证</td>
</tr>
<tr>
<td>2寸照</td>
<td>3.5x5.3 cm</td>
<td>626x413</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td>3.5x4.5 cm</td>
<td></td>
<td>入台证、新加坡签证、英国签证</td>
</tr>
<tr>
<td></td>
<td>3.5x4.8 cm</td>
<td></td>
<td>马来西亚签证</td>
</tr>
<tr>
<td></td>
<td>5.1x5.1 cm</td>
<td></td>
<td>美国签证</td>
</tr>
<tr>
<td></td>
<td>4.5x4.5 cm</td>
<td></td>
<td>日本签证</td>
</tr>
</tbody>
</table>
</div>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>图片处理</category>
      </categories>
  </entry>
  <entry>
    <title>QNAP安装Aria2并使用油猴网盘直链进行RPC推送下载网盘资源</title>
    <url>/2024/09/03/QNAP%E5%AE%89%E8%A3%85Aria2%E5%B9%B6%E4%BD%BF%E7%94%A8%E6%B2%B9%E7%8C%B4%E7%BD%91%E7%9B%98%E7%9B%B4%E9%93%BE%E8%BF%9B%E8%A1%8CRPC%E6%8E%A8%E9%80%81%E4%B8%8B%E8%BD%BD%E7%BD%91%E7%9B%98%E8%B5%84%E6%BA%90/</url>
    <content><![CDATA[<h1 id="QNAP-安装-Aria2"><a href="#QNAP-安装-Aria2" class="headerlink" title="QNAP 安装 Aria2"></a>QNAP 安装 Aria2</h1><h2 id="QNAP-型号"><a href="#QNAP-型号" class="headerlink" title="QNAP 型号"></a>QNAP 型号</h2><p>TS-464C<br><span id="more"></span></p>
<h2 id="加入第三方资源库"><a href="#加入第三方资源库" class="headerlink" title="加入第三方资源库"></a>加入第三方资源库</h2><ol>
<li>AppCenter =&gt; 设置 =&gt; 程序来源 =&gt; 添加</li>
<li>输入名称(MyQNAP)和URL(<a href="https://www.myqnap.org/repo.xml">https://www.myqnap.org/repo.xml</a>)</li>
<li>点击确定即可完成<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240903104658.png" alt="20240903104658"><h2 id="下载并安装-Aria2"><a href="#下载并安装-Aria2" class="headerlink" title="下载并安装 Aria2"></a>下载并安装 Aria2</h2></li>
<li>在 AppCenter 中点击 MyQNAP =&gt; 所有应用 =&gt; 下载</li>
<li>找到 Aria2 1.37 并点击下载<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240903104931.png" alt="20240903104931"><h1 id="配置并使用-Aria2"><a href="#配置并使用-Aria2" class="headerlink" title="配置并使用 Aria2"></a>配置并使用 Aria2</h1><h2 id="Aria2-命令行下载常用命令及选项"><a href="#Aria2-命令行下载常用命令及选项" class="headerlink" title="Aria2 命令行下载常用命令及选项"></a>Aria2 命令行下载常用命令及选项</h2>下载并安装完成后就可以使用命令行进行下载了，常用命令如下。<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3></li>
</ol>
<ul>
<li><code>aria2c url</code>: 下载文件，url代表文件下载链接</li>
<li><code>aria2c -S file.torrent</code>: 显示 file.torrent 文件的信息</li>
<li><code>aria2c –stop</code>: 停止所有下载</li>
<li><code>aria2c –pause</code>: 暂停所有下载</li>
<li><code>aria2c –resume</code>: 恢复暂停的下载</li>
<li><code>aria2c –version</code>: 显示版本信息<h3 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h3></li>
<li><code>-x n</code>: 最大使用 n 个线程下载文件</li>
<li><code>-s n</code>: 使用 n 个连接数进行下载</li>
<li><code>-o filename</code>: 指定下载文件的文件名</li>
<li><code>-d directory</code>: 指定文件的下载目录</li>
<li><code>-c</code>: 断点续传</li>
<li><code>-m n</code>: 最大下载连接数为 n</li>
<li><code>–max-download-limit=100K</code>: 限制下载速度为 100K/S</li>
</ul>
<p>以上是 Aria2 的常用命令和选项。你可以在终端中输入“man aria2c”命令来查看完整的命令和选项列表。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><ul>
<li>直接下载<br><code>aria2c http://dl_dir.qq.com/qqfile/qq/QQ2011/QQ2011.exe</code></li>
<li>后台下载<br><code>aria2c -D url</code><br><code>aria2c –deamon=true url</code></li>
<li>重命名下载<br><code>aria2c --out=QQ http://dl_dir.qq.com/qqfile/qq/QQ2011/QQ2011.exe</code><br><code>aria2c -o QQ http://dl_dir.qq.com/qqfile/qq/QQ2011/QQ2011.exe</code></li>
<li>分段下载<br><code>aria2c -x 2 http://dl_dir.qq.com/qqfile/qq/QQ2011/QQ2011.exe</code></li>
<li>配合使用<br><code>aria2c -s 2 -x 2 -j 10 http://dl_dir.qq.com/qqfile/qq/QQ2011/QQ2011.exe</code><br>-s这个参数的意思是使用几个线程进行下载，-x是最大使用几个线程下载，-j就是同时下载几个文件。</li>
<li>断点续传<br><code>aria2c -c http://dl_dir.qq.com/qqfile/qq/QQ2011/QQ2011.exe</code></li>
<li>验证文件正确性<br><code>`aria2c -c -x16 -s20 -j20 --checksum=md5=xxxxxxxxxxxxx http://dl_dir.qq.com/qqfile/qq/QQ2011/QQ2011.exe</code></li>
<li>bt 下载<br><code>aria2c ‘path/xxx.torrnet‘</code></li>
<li>磁力链下载<ul>
<li>列出种子内容<br><code>aria2c -S target.torrent</code></li>
<li>下载种子内编号为 1、4、5、6、7 的文件<br><code>aria2c --select-file=1,4-7 target.torrent</code></li>
<li>设置 bt 端口<br><code>aria2c --listen-port=51413 ‘xxx.torrent’</code></li>
<li>设置 dht 端口<br><code>aria2c --dht-listen-port=51413 ‘xxx.torrent’</code><h2 id="Aria2-配置文件"><a href="#Aria2-配置文件" class="headerlink" title="Aria2 配置文件"></a>Aria2 配置文件</h2><h3 id="配置文件路径"><a href="#配置文件路径" class="headerlink" title="配置文件路径"></a>配置文件路径</h3>不同的系统可能会有所不同，按上述方法安装的 Aria2 的配置文件路径为: <code>/opt/AriaII/aria2.conf</code><h3 id="配置文件详解"><a href="#配置文件详解" class="headerlink" title="配置文件详解"></a>配置文件详解</h3></li>
</ul>
</li>
</ul>
<pre><code class="lang-bash">##此部分主要分为几部分##
#1、文件保存
#2、下载链接
#3、进度保存
#4、RPC相关
#5、BT\PT下载相关

##===================================##
## 文件保存相关 ##
##===================================##

# 文件保存目录
dir=../download
# 启用磁盘缓存, 0为禁用缓存, 需1.16以上版本, 默认:16M
disk-cache=16M
# 断点续传
continue=true
#日志保存
log=aria2.log

# 文件预分配方式, 能有效降低磁盘碎片, 默认:prealloc
# 预分配所需时间: none &lt; falloc ? trunc &lt; prealloc
# falloc和trunc则需要文件系统和内核支持
# NTFS建议使用falloc, EXT3/4建议trunc, MAC 下需要注释此项
file-allocation=prealloc

##===================================##
## 下载连接相关 ##
##===================================##

# 最大同时下载任务数, 运行时可修改, 默认:5
max-concurrent-downloads=100
# 同一服务器连接数, 添加时可指定, 默认:1
# 官方的aria2最高设置为16, 如果需要设置任意数值请重新编译aria2
max-connection-per-server=16

# 整体下载速度限制, 运行时可修改, 默认:0（不限制）
max-overall-download-limit=0
# 单个任务下载速度限制, 默认:0（不限制）
max-download-limit=0
# 整体上传速度限制, 运行时可修改, 默认:0（不限制）
max-overall-upload-limit=0
# 单个任务上传速度限制, 默认:0（不限制）
max-upload-limit=0

# 禁用IPv6, 默认:false
disable-ipv6=false

# 最小文件分片大小, 添加时可指定, 取值范围1M -1024M, 默认:20M
# 假定size=10M, 文件为20MiB 则使用两个来源下载; 文件为15MiB 则使用一个来源下载
min-split-size=10M

# 单个任务最大线程数, 添加时可指定, 默认:5
# 建议同max-connection-per-server设置为相同值
split=16

##===================================##
## 进度保存相关 ##
##===================================##

# 从会话文件中读取下载任务
input-file=aria2.session
# 在Aria2退出时保存错误的、未完成的下载任务到会话文件
save-session=aria2.session
# 定时保存会话, 0为退出时才保存, 需1.16.1以上版本, 默认:0
save-session-interval=60

##===================================##
## RPC相关设置 ##
##此部分必须启用，否则无法使用WebUI
##===================================##

# 启用RPC, 默认:false
enable-rpc=true
# 允许所有来源, 默认:false
rpc-allow-origin-all=true
# 允许外部访问, 默认:false
rpc-listen-all=true
# RPC端口, 仅当默认端口被占用时修改

rpc-listen-port=6800
# 设置的RPC授权令牌, v1.18.4新增功能, 取代 --rpc-user 和 --rpc-passwd 选项
rpc-secret=000789456

# 设置的RPC访问用户名, 此选项新版已废弃, 建议改用 --rpc-secret 选项
#rpc-user=&lt;USER&gt;
# 设置的RPC访问密码, 此选项新版已废弃, 建议改用 --rpc-secret 选项
#rpc-passwd=&lt;PASSWD&gt;

# 启动SSL
# rpc-secure=true
# 证书文件, 如果启用SSL则需要配置证书文件, 例如用https连接aria2
# rpc-certificate=
# rpc-private-key=

##===================================##
## BT/PT下载相关 ##
##===================================##

# 当下载的是一个种子(以.torrent结尾)时, 自动开始BT任务, 默认:true
follow-torrent=true
# BT监听端口, 当端口被屏蔽时使用, 默认:6881-6999
listen-port=51413
# 单个种子最大连接数, 默认:55
#bt-max-peers=55
# 打开DHT功能, PT需要禁用, 默认:true
enable-dht=true
# 打开IPv6 DHT功能, PT需要禁用
enable-dht6=true
# DHT网络监听端口, 默认:6881-6999
dht-listen-port=6881-6999

# 本地节点查找, PT需要禁用, 默认:false
bt-enable-lpd=true
# 种子交换, PT需要禁用, 默认:true
enable-peer-exchange=true
# 每个种子限速, 对少种的PT很有用, 默认:50K
bt-request-peer-speed-limit=50K

# 客户端伪装, PT需要
peer-id-prefix=-TR2770-
user-agent=Transmission/2.77

# 当种子的分享率达到这个数时, 自动停止做种, 0为一直做种, 默认:1.0
seed-ratio=0
# 强制保存会话, 即使任务已经完成, 默认:false
# 较新的版本开启后会在任务完成后依然保留.aria2文件
force-save=true
# BT校验相关, 默认:true
#bt-hash-check-seed=true
# 继续之前的BT任务时, 无需再次校验, 默认:false
bt-seed-unverified=true
# 保存磁力链接元数据为种子文件(.torrent文件), 默认:false
bt-save-metadata=true
# 单个种子最大连接数, 默认:55 0表示不限制
bt-max-peers=0
# 最小做种时间, 单位:分
# seed-time = 60
# 分离做种任务
bt-detach-seed-only=true
#BT Tracker List ;下载地址：https://github.com/ngosang/trackerslist
bt-tracker=udp://tracker.coppersurfer.tk:6969/announce,udp://tracker.internetwarriors.net:1337/announce,udp://tracker.opentrackr.org:1337/announce
</code></pre>
<h3 id="我的配置文件"><a href="#我的配置文件" class="headerlink" title="我的配置文件"></a>我的配置文件</h3><pre><code class="lang-bash">max-concurrent-downloads=100
max-connection-per-server=16
split=16
min-split-size=10M
enable-rpc=true
rpc-listen-all=true
rpc-allow-origin-all=true
# 上面这行非常重要，默认为 false，如果不设置为 True 则只能从特定的 IP 或域名访问，一开始就是因为没有这句在 WebUI AriaNg 里面怎么设置都显示未连接。只有协议设置为websocket时才能连接，但是使用 WebUI 也无法下载到正确的文件。加上这句后 http 协议就可以连接并且进行 RPC 推送了。
rpc-secret=7ixxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxrIZ
</code></pre>
<h1 id="WebUI-Aginx"><a href="#WebUI-Aginx" class="headerlink" title="WebUI(Aginx)"></a>WebUI(Aginx)</h1><ol>
<li>QNAP 中开启网站服务<br>控制台 =&gt; 应用程序 =&gt; Web 服务器 =&gt; 勾选”启用Web服务器”<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240903151604.png" alt="20240903151604"><br>设置默认即可。<br>开启了网站服务之后，QNAP 的共享文件夹中就会多出一个 “Web” 的文件夹。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240903152350.png" alt="20240903152350"></li>
<li>配置网站服务的虚拟机<br>虚拟主机 =&gt; 勾选”启用虚拟主机” =&gt; 点击”创建虚拟机”<br>主机名称: 可以自定义，这里使用 Aria2<br>根目录: 点击右部倒三角选择网页所在目录<br>协议: 选择 HTTP 即可<br>端口号: WebUI 的访问端口，注意与 Aria2 RPC 端口不同，要另外使用空闲端口，这里使用 6801。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240903152044.png" alt="20240903152044"><br>这里单独说一下”根目录”，在按上述方法安装了 QNAP 之后，Arial 会被建立一个软链接 <code>/opt/AriaII</code>，其真实路径为<code>/share/CACHEDEV1_DATA/.qpkg/AriaII/</code>，在这个目录里面有一个 “www” 的文件夹，这就是 AriaNg 的网站文件，我开始时将它移动到了 “Web” 文件夹里，配置好之后就不想去动了。其实完全可以在虚拟机的”根目录”里直接指定这里的路径，即<code>/opt/AriaII/wwww</code>，这样指定的话我估计就可以直接使用安装的 App 的”打开”按钮(其访问地址为:<a href="http://192.168.3.74/AriaII)来进行访问。可能还需要一些配置，因为对建站不是很熟所以不确定，也没有尝试。">http://192.168.3.74/AriaII)来进行访问。可能还需要一些配置，因为对建站不是很熟所以不确定，也没有尝试。</a></li>
<li>配置 AriaNg<br>配置完网站服务后就可以使用在浏览器中打开控制页面了。(访问地址:<a href="http://192.168.3.74:6801">http://192.168.3.74:6801</a>)<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240903153346.png" alt="20240903153346"><br>但是现在打开后”Aria2 状态”会显示红色的”未连接”。要进行一些配置来连接 Aria2 服务。<br>首先，点击 “AriaNg 设置” =&gt; 选择全局右边的 RPC<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240903153732.png" alt="20240903153732"><br>Aria2 RPC 别名: 可自定义，也可以空着自己会变成”地址:端口”<br>Aria2 RPC 地址: 安装 Aria2 服务的主机地址或IP<br>Aria2 协议: 选择”Http”<br>Aria2 RPC Http 请求方法: POST<br>Aria2 RPC 请求头:这个不了解是什么，留空不影响使用<br>Aria2 RPC 秘钥: 这个秘钥在 Aria2 配置文件 <code>/opt/AriaII/aria2.conf</code> 中的 <code>rpc-secret=</code> 行中，可自定义设置，然后点击”重新加载 AriaNg”即可。<br>这里再重复一遍，要在配置文件<code>/opt/AriaII/aria2.conf</code>中加入<code>rpc-allow-origin-all=true</code>才可以在任何主机访问，我被这个地方卡了很长时间。</li>
<li>使用油猴脚本获取网盘资源直链<ul>
<li>首先要安装一个浏览器的油猴脚本管理插件，篡改猴或者暴力猴什么的都可以。我使用的是<a href="https://microsoftedge.microsoft.com/addons/detail/%E7%AF%A1%E6%94%B9%E7%8C%B4/iikmkjmpaadaobahmlepeloendndfphd?hl=zh-CN">篡改猴</a>。在<a href="https://microsoftedge.microsoft.com/addons/Microsoft-Edge-Extensions-Home?hl=zh-CN">Edge插件商店</a>中直接搜索”tampermonkey”，前三个应该都可以使用。</li>
<li>然后，到<a href="https://greasyfork.org/zh-CN">Greasyfork</a>中下载脚本，我选择的是<a href="https://greasyfork.org/zh-CN/scripts/436446-%E7%BD%91%E7%9B%98%E7%9B%B4%E9%93%BE%E4%B8%8B%E8%BD%BD%E5%8A%A9%E6%89%8B">网盘直链下载助手</a></li>
<li>再打开网盘(这里以夸克网盘为例)的资源页就会开到多出一个”下载助手”的按钮。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240903155210.png" alt="20240903155210"><br>点击按钮或者查看脚本说明就会知道:<br>API 下载: IDM 或浏览器自带下载。<br>Aria 下载: 这个可以得到资源链接使用命令行或者 Aria2 工具进行下载。<br>RPC 下载: 这个就是使用 RPC 远程推送下载链接进行下载，设置方法见”助手设置”。<br>cURL 下载: 使用终端命令行工具<code>curl</code>下载时的链接，直链地址与 Aria 下载的是一样的，只是前面命令变成了<code>curl</code>，而不是<code>aria2c</code>。<br>BC 下载: 这个使用比特彗星(BitCommet)下载的链接，没有用过。<br>助手设置: 这里就是 RPC 推送的设置选项了，与 AriaNg 上的设置基本一致，格式略有差别。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240903155907.png" alt="20240903155907"></li>
</ul>
</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>网络服务</category>
      </categories>
      <tags>
        <tag>QNAP</tag>
        <tag>Aria2</tag>
      </tags>
  </entry>
  <entry>
    <title>打开word时MathType报错:MathType has detected an error inAutoExecCls.Main: 文件未找到: MathPage.WLL.</title>
    <url>/2024/09/04/%E6%89%93%E5%BC%80word%E6%97%B6MathType%E6%8A%A5%E9%94%99-MathType-has-detected-an-error-inAutoExecCls-Main-%E6%96%87%E4%BB%B6%E6%9C%AA%E6%89%BE%E5%88%B0-MathPage-WLL/</url>
    <content><![CDATA[<h1 id="报错信息"><a href="#报错信息" class="headerlink" title="报错信息"></a>报错信息</h1><p>不知道为什么打开 Work 时出现了 MathType 的报错。<br><span id="more"></span><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240904150316.png" alt="20240904150316"><br>连续点击两次”确定”报错对话框消失，如果点击 MathType 按钮会再次出现报错信息。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240904150429.png" alt="20240904150429"></p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>找到 MathPage.wll 文件将其复制到 Office 指定目录下。</p>
<ol>
<li>MathPage.wll<br>如果是 64 位的 Office，就去复制<code>C:\Program Files (x86)\MathType\Office Support\64\</code>中的 <code>MathPage.wll</code>。<br>如果是 32 位的 Office，就去复制<code>C:\Program Files (x86)\MathType\Office Support\32\</code>中的 <code>MathPage.wll</code>。</li>
<li>Office 指定目录<br>将上面的文件复制到目录: <code>C:\Program Files\Microsoft Office\root\Office16</code>中即可正常。</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>MathType</tag>
      </tags>
  </entry>
  <entry>
    <title>关闭 Adobe Genuine Service Alert 正版验证</title>
    <url>/2024/09/09/%E5%85%B3%E9%97%AD-Adobe-Genuine-Service-Alert-%E6%AD%A3%E7%89%88%E9%AA%8C%E8%AF%81/</url>
    <content><![CDATA[<h1 id="自用方法"><a href="#自用方法" class="headerlink" title="自用方法"></a>自用方法</h1><ol>
<li>单击 Windows 键，输入”服务”或”Service”，打开服务选项。</li>
<li><span id="more"></span>
<img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240909091647.png" alt="20240909091647"></li>
<li>在服务中找到 “Adobe Genuine Software Monitor Service” 服务。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240909091917.png" alt="20240909091917"></li>
<li>右键点击 =&gt; 左键属性，弹出属性对话框。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240909092020.png" alt="20240909092020"></li>
<li>将启动类型改为<strong>禁止</strong>，并在服务状态栏点击<strong>停止</strong>将服务状态改为<strong>已停止</strong>。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240909092245.png" alt="20240909092245"></li>
<li>防火墙设置规则让 Adobe Genuine Launcher.exe，AdobeGCClient.exe，AGMService.exe，AGSService.exe 无法联网。<br>打开 Windows 防火墙 =&gt; 入站规则 =&gt; 新建规则 =&gt; 程序(下一步) =&gt; 此程序路径中选择程序路径 (C:\Program Files (x86)\Common Files\Adobe\AdobeGCClient)并打开 =&gt; 操作:阻止连接 =&gt; 输入名称即可。<br>同样方法设置出站规则。<br>这样就不会再出现弹窗了。</li>
</ol>
<h1 id="网上博客中介绍的方法"><a href="#网上博客中介绍的方法" class="headerlink" title="网上博客中介绍的方法"></a>网上博客中介绍的方法</h1><p>网上介绍的方法都是要删掉 AdobeGCClient 正版检测文件并防止其重建，应为自用方法也可以实现，没有试过。</p>
<ol>
<li>在弹出 Adobe Genuine Service Alert 提示时打开任务管理器；</li>
<li>“任务管理器 =&gt; 进程 =&gt; 后台进程”中找到类似 “Adobe Genuine Software Client” 的进程；</li>
<li>右击上面的进程 =&gt; 打开文件所在位置；( 我的位置是:C:\Program Files (x86)\Common Files\Adobe\AdobeGCClient\ )</li>
<li>在任务管理器结束2中的进程并将以下文件移除，Adobe Genuine Launcher.exe，AdobeGCClient.exe，AGMService.exe，AGSService.exe，网上没有明确指出删除哪些文件，所以建议将其移动到一个专门地方进行备份，防止 Adobe 因缺少某些文件导致无法使用；</li>
<li>新建几个空的文本文件，文件名与上面移除的文件名相同并将后缀改为 exe，以防止程序自动生成上述文件；</li>
<li>可以在打开 Windows 的防火墙将 Adobe 相关的启动文件断网，我没有在防火墙中发现可能是以前关掉了。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20240909093621.png" alt="20240909093621"></li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>软件应用</category>
      </categories>
      <tags>
        <tag>Adobe</tag>
      </tags>
  </entry>
  <entry>
    <title>使用photoshop24.5.0将照片底色改为纯白色</title>
    <url>/2024/10/21/%E4%BD%BF%E7%94%A8photoshop24-5-0%E5%B0%86%E7%85%A7%E7%89%87%E5%BA%95%E8%89%B2%E6%94%B9%E4%B8%BA%E7%BA%AF%E7%99%BD%E8%89%B2/</url>
    <content><![CDATA[<span id="more"></span>
<ol>
<li>打开 Adobe Photoshop 24.5.0 软件；</li>
<li>文件 =&gt; 打开 =&gt; 选择要处理的图片；</li>
<li>点击图片下方的”移除背景”；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20241021140008.png" alt="20241021140008"><br>移除背景后的图片如下:<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20241021140104.png" alt="20241021140104"></li>
<li>点击右下角”创建新图层”；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20241021140204.png" alt="20241021140204"></li>
<li>选择”油漆桶工具”，然后选择底色照片(这里是白色)，然后点击图片，就增加了纯白的图层；<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20241021140339.png" alt="20241021140339"><br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20241021140454.png" alt="20241021140454"></li>
<li>将新建的图层移到原图层下方，就得到了白底的照片。<br><img src="https://raw.githubusercontent.com/shenguosai/MyPic/img/img/20241021140602.png" alt="20241021140602"></li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>技术兴趣</category>
        <category>图片处理</category>
      </categories>
      <tags>
        <tag>Adobe</tag>
      </tags>
  </entry>
</search>
